<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Android图像处理和多媒体（四） | Mofan</title><meta name="author" content="默烦,cy.mofan@foxmail.com"><meta name="copyright" content="默烦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文介绍了对 Android 图形图像处理技术和多媒体应用开发进行了介绍。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android图像处理和多媒体（四）">
<meta property="og:url" content="https://mofan212.github.io/posts/Android-4/">
<meta property="og:site_name" content="Mofan">
<meta property="og:description" content="本文介绍了对 Android 图形图像处理技术和多媒体应用开发进行了介绍。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/18.jpg">
<meta property="article:published_time" content="2020-05-28T16:00:00.000Z">
<meta property="article:modified_time" content="2020-07-19T16:00:00.000Z">
<meta property="article:author" content="默烦">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/18.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Android图像处理和多媒体（四）",
  "url": "https://mofan212.github.io/posts/Android-4/",
  "image": "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/18.jpg",
  "datePublished": "2020-05-28T16:00:00.000Z",
  "dateModified": "2020-07-19T16:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "默烦",
      "url": "https://mofan212.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/favicon.png"><link rel="canonical" href="https://mofan212.github.io/posts/Android-4/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: 默烦","link":"链接: ","source":"来源: Mofan","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  infinitegrid: {
    js: 'https://testingcf.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Android图像处理和多媒体（四）',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources@master/css/myStyle.min.css"><link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/style.css" /><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono-nl.min.css" /><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Mofan" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources/css/minimal.min.css"/><script src="https://testingcf.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">174</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">54</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw fa-solid fa-coins"></i><span> 赞助</span></a></li><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-subway"></i><span> 开往</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/post_top_img.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Mofan</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw fa-solid fa-coins"></i><span> 赞助</span></a></li><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-subway"></i><span> 开往</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Android图像处理和多媒体（四）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-05-28T16:00:00.000Z" title="发表于 2020-05-29 00:00:00">2020-05-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-07-19T16:00:00.000Z" title="更新于 2020-07-20 00:00:00">2020-07-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android/">Android</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>38分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;距离本文上次更新已经过去&quot;,&quot;messageNext&quot;:&quot;天，请注意时效性。&quot;,&quot;postUpdate&quot;:&quot;2020-07-20 00:00:00&quot;}" hidden></div>
    <style>
      .highlight-tools {
        background: #262931 !important;
      }
    </style>
    <html><head></head><body><p>封面来源未知，请多包涵</p>
<h1 id="图形图像处理技术"><a class="header-anchor" href="#图形图像处理技术"></a>图形图像处理技术</h1>
<h2 id="画笔和画布"><a class="header-anchor" href="#画笔和画布"></a>画笔和画布</h2>
<p>在安卓中，画笔用<strong>Paint类</strong>来表示，画布用<strong>Canvas类</strong>来表示。</p>
<p>画笔主要用于指定颜色、透明度、笔触的粗细、填充样式等。</p>
<p><strong>绘图的步骤：</strong></p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/AndroidImages/绘图步骤.png" alt="绘图步骤" style="zoom: 50%;">
<blockquote>
<p>在帧布局管理器上绘制一个橙色矩形</p>
</blockquote>
<p>activity_main.xml：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF"> </span></span>
<span class="line"><span style="color:#D19A66">    android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/framelayout"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>自定义MyView类：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyView</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> View</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#61AFEF"> MyView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Context</span><span style="color:#E06C75;font-style:italic"> context</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">(context);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onDraw</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Canvas</span><span style="color:#E06C75;font-style:italic"> canvas</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onDraw</span><span style="color:#ABB2BF">(canvas);</span></span>
<span class="line"><span style="color:#E5C07B">        Paint</span><span style="color:#E06C75"> paint</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> Paint</span><span style="color:#ABB2BF">();  </span><span style="color:#7F848E;font-style:italic">//定义画笔</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //安卓默认颜色是透明的 0x后紧跟的两个FF表示设置透明度为不透明</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setColor</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0xFFFF6600</span><span style="color:#ABB2BF">); </span><span style="color:#7F848E;font-style:italic">//设置画笔颜色</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setStyle</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Paint</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Style</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FILL</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//设置填充方式</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制矩形</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawRect</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">280</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">250</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>MainActivity.java：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        FrameLayout</span><span style="color:#E06C75"> frameLayout</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">framelayout</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //将自定义View添加到帧布局管理器中</span></span>
<span class="line"><span style="color:#E5C07B">        frameLayout</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addView</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#61AFEF"> MyView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<hr>
<p><mark>注意：安卓默认的画笔笔触颜色是透明，我们在设置画笔笔触颜色时需要设置其透明度。</mark></p>
<h2 id="绘制几何图形"><a class="header-anchor" href="#绘制几何图形"></a>绘制几何图形</h2>
<p>在安卓中，Canvas类提供了丰富的方法用于绘制几何图形。</p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/AndroidImages/绘制几何图形.png" alt="绘制几何图形" style="zoom: 33%;">
<blockquote>
<p>实现在屏幕上绘制Android的机器人</p>
</blockquote>
<p>activity_main.xml：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF"> </span></span>
<span class="line"><span style="color:#D19A66">    android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/framelayout"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>自定义MyView类，绘制安卓机器人：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyView</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> View</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#61AFEF"> MyView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Context</span><span style="color:#E06C75;font-style:italic"> context</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">(context);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onDraw</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Canvas</span><span style="color:#E06C75;font-style:italic"> canvas</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onDraw</span><span style="color:#ABB2BF">(canvas);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制安卓机器人</span></span>
<span class="line"><span style="color:#E5C07B">        Paint</span><span style="color:#E06C75"> paint</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> Paint</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setAntiAlias</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">); </span><span style="color:#7F848E;font-style:italic">//采用抗锯齿功能</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setColor</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0xFFA4C739</span><span style="color:#ABB2BF">); </span><span style="color:#7F848E;font-style:italic">//设置画笔颜色为绿色</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /*********绘制机器人的头********/</span></span>
<span class="line"><span style="color:#E5C07B">        RectF</span><span style="color:#E06C75"> rectF</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> RectF</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">100</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">100</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//定义外轮廓矩形</span></span>
<span class="line"><span style="color:#E5C07B">        rectF</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">offset</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">90</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">20</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制头的圆弧</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawArc</span><span style="color:#ABB2BF">(rectF,</span><span style="color:#56B6C2">-</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span><span style="color:#56B6C2">-</span><span style="color:#D19A66">160</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">false</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制眼睛</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setColor</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0xFFFFFFFF</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//设置画笔颜色</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawCircle</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">165</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">53</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">,paint);</span><span style="color:#7F848E;font-style:italic">//绘制一个眼睛的圆</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawCircle</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">125</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">53</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">,paint);</span><span style="color:#7F848E;font-style:italic">//绘制另一个眼睛的圆</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制天线</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setColor</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0xFFA4C739</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//设置画笔颜色</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setStrokeWidth</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//设置笔触宽度</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawLine</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">110</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">15</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">125</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">35</span><span style="color:#ABB2BF">,paint);</span><span style="color:#7F848E;font-style:italic">//绘制天线</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawLine</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">180</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">15</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">165</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">35</span><span style="color:#ABB2BF">,paint);</span><span style="color:#7F848E;font-style:italic">//绘制另一条天线</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /*********绘制机器人的身体********/</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawRect</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">100</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">75</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">190</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">150</span><span style="color:#ABB2BF">,paint);</span><span style="color:#7F848E;font-style:italic">//绘制矩形</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制圆角矩形（身体）</span></span>
<span class="line"><span style="color:#E5C07B">        RectF</span><span style="color:#E06C75"> rectF_body</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> RectF</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">100</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">140</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">190</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">160</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawRoundRect</span><span style="color:#ABB2BF">(rectF_body,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制胳膊</span></span>
<span class="line"><span style="color:#E5C07B">        RectF</span><span style="color:#E06C75"> rectF_arm</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> RectF</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">75</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">75</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">95</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">140</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawRoundRect</span><span style="color:#ABB2BF">(rectF_arm,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#E5C07B">        rectF_arm</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">offset</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">120</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawRoundRect</span><span style="color:#ABB2BF">(rectF_arm,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制腿</span></span>
<span class="line"><span style="color:#E5C07B">        RectF</span><span style="color:#E06C75"> rectF_leg</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> RectF</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">115</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">150</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">135</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">200</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawRoundRect</span><span style="color:#ABB2BF">(rectF_leg,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#E5C07B">        rectF_leg</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">offset</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">40</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawRoundRect</span><span style="color:#ABB2BF">(rectF_leg,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>MainActivity.java：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        FrameLayout</span><span style="color:#E06C75"> frameLayout</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">framelayout</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        frameLayout</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addView</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#61AFEF"> MyView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<h2 id="绘制文本"><a class="header-anchor" href="#绘制文本"></a>绘制文本</h2>
<p>我们可以使用Canvas类提供的<code>drawText()</code>方法来实现。</p>
<blockquote>
<p>绘制对白文字</p>
</blockquote>
<p>由于无背景图片，因此案例运行后只能看到两段文字，我们主要理解绘制文本的方法即可。</p>
<p>activity_main.xml：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF"> </span></span>
<span class="line"><span style="color:#D19A66">    android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/framelayout"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>自定义MyView类，绘制文本：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyView</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> View</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#61AFEF"> MyView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Context</span><span style="color:#E06C75;font-style:italic"> context</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">(context);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onDraw</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Canvas</span><span style="color:#E06C75;font-style:italic"> canvas</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onDraw</span><span style="color:#ABB2BF">(canvas);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">       /********绘制对白********/</span></span>
<span class="line"><span style="color:#E5C07B">        Paint</span><span style="color:#E06C75"> paint</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> Paint</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//创建画笔</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setColor</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0xFF000000</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//设置笔触为黑色</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setAntiAlias</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">); </span><span style="color:#7F848E;font-style:italic">//采用抗锯齿功能</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setTextAlign</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Paint</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Align</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LEFT</span><span style="color:#ABB2BF">);   </span><span style="color:#7F848E;font-style:italic">//设置文字对齐方式</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setTextSize</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">30</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//设置文字大小，单位sp</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //输出第一段对白</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawText</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"你想和我一起"</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">175</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">160</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawText</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"去嗨皮吗"</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">175</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">185</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //输出第二段对白</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawText</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"给爷爬！"</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">245</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">45</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>MainActivity.java：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        FrameLayout</span><span style="color:#E06C75"> frameLayout</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">framelayout</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //将自定义View添加到帧布局管理器中</span></span>
<span class="line"><span style="color:#E5C07B">        frameLayout</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addView</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#61AFEF"> MyView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<h2 id="绘制图片"><a class="header-anchor" href="#绘制图片"></a>绘制图片</h2>
<p>我们需要绘制图片就需要先创建<strong>位图对象</strong>，在安卓中位图对象用Bitmap表示。</p>
<p>创建位图对象可以通过BitmapFactory类或Bitmap类进行创建。</p>
<p><strong>BitmapFactory类或Bitmap类创建位图方式：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">BitmapFactory类</th>
<th style="text-align:center">Bitmap类</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1. 通过图片文件创建</td>
<td style="text-align:center">1. 挖取一块图像创建</td>
</tr>
<tr>
<td style="text-align:center">2. 通过输入流创建</td>
<td style="text-align:center">2. 将源位图缩放生成</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">3. 使用颜色数组创建</td>
</tr>
</tbody>
</table>
<p><strong>BitmapFactory类为创建位图提供的方法：</strong></p>
<p><code>decodeFile()</code>：通过路径创建</p>
<p><code>decodeResource()</code>：通过资源ID创建</p>
<p><code>decodeStream()</code>：通过输入流创建</p>
<blockquote>
<p>使用BitmapFactory.decodeFile()创建位图</p>
</blockquote>
<p><mark>注意：本次案例是否能成功运行与SDK版本有巨大的联系！！</mark></p>
<p>我先贴出我的SDK版本，你可以前往Gradle Scripts中查看对应Module的build.gradle文件中的SDK版本：</p>
<figure class="highlight plaintext line-numbers" data-language="PLAINTEXT">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span>minSdkVersion 21</span></span>
<span class="line"><span>targetSdkVersion 29</span></span></code></pre></td></tr></tbody></table>
      </figure>
<hr>
<p><strong>准备：</strong> 我们需要准备一张图片，命名为iriya.png（为什么这个名？别问，老二次元了），图片及名字可以自己定义，但是记得修改涉及到图片名的代码。准备好以后我们需要<strong>开启安卓虚拟机</strong>，然后将这张图片上传至虚拟机的SDcard中。</p>
<p><strong>上传方式：</strong></p>
<p>View &gt; Tool Windows &gt; Device File Explorer &gt; sdcard ，右击，Upload，选择你准备的图片上传即可。</p>
<p><strong>注意：一定要先启动虚拟机，不然在Device File Explorer中看不到虚拟机中的文件。</strong></p>
<p>检查是否上传成功：Device File Explorer &gt; storage &gt; emulated &gt; 0，在这个目录下看看有没有你上传的图片。</p>
<p><strong>代码编写：</strong></p>
<p>activity_main.xml：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF"> ...</span></span>
<span class="line"><span style="color:#D19A66">    android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/framelayout"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>MainActivity.java：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> final</span><span style="color:#C678DD"> int</span><span style="color:#E06C75"> EXTERNAL_STORAGE_REQ_CODE </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> 10</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        FrameLayout</span><span style="color:#E06C75"> frameLayout</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">framelayout</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        frameLayout</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addView</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#61AFEF"> MyView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>自定义MyView类，创建位图：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyView</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> View</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#61AFEF"> MyView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Context</span><span style="color:#E06C75;font-style:italic"> context</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">(context);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onDraw</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Canvas</span><span style="color:#E06C75;font-style:italic"> canvas</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onDraw</span><span style="color:#ABB2BF">(canvas);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //获取文件路径</span></span>
<span class="line"><span style="color:#E5C07B">        String</span><span style="color:#E06C75"> path</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> Environment</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getExternalStorageDirectory</span><span style="color:#ABB2BF">()</span><span style="color:#56B6C2">+</span><span style="color:#98C379">"/iriya.png"</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //创建位图对象</span></span>
<span class="line"><span style="color:#E5C07B">        Bitmap</span><span style="color:#E06C75"> bitmap</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> BitmapFactory</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">decodeFile</span><span style="color:#ABB2BF">(path);</span></span>
<span class="line"><span style="color:#E5C07B">        Paint</span><span style="color:#E06C75"> paint</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> Paint</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制图片</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawBitmap</span><span style="color:#ABB2BF">(bitmap,</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><mark>注意：由于需要读取虚拟机SD卡中的文件，因此我们需要设置一系列权限！！</mark></p>
<p><strong>权限设置：</strong></p>
<ol>
<li>AndroidManifest.xml：</li>
</ol>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">manifest</span><span style="color:#ABB2BF"> ...&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-permission</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.permission.READ_EXTERNAL_STORAGE"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">application</span><span style="color:#D19A66"> android:requestLegacyExternalStorage</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"true"</span><span style="color:#ABB2BF">  ...&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        ...</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;/</span><span style="color:#E06C75">application</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">manifest</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><code>android:requestLegacyExternalStorage="true"</code>和我一样的SDK版本的情况下，这个属性将很关键，一定要加上。</p>
<ol start="2">
<li>然后我们需要到虚拟机中，找到我们对应的该Module对应的应用，并设置应用的权限：<strong>允许访问储存空间</strong>。</li>
</ol>
<p>最后，我们运行即可，查看界面是否有图片显示。</p>
<hr>
<p>在上述权限设置无用的情况下，如果你的SDK版本与我不同，且Android Version &gt;= 6，你可以尝试设置动态访问权限。</p>
<p>在MainActivity.java中添加如下代码：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> static</span><span style="color:#C678DD"> final</span><span style="color:#C678DD"> int</span><span style="color:#E06C75"> EXTERNAL_STORAGE_REQ_CODE </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> 10</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75"> savedInstanceState) {</span></span>
<span class="line"><span style="color:#ABB2BF">        ...</span></span>
<span class="line"><span style="color:#C678DD">        int</span><span style="color:#E06C75"> permission </span><span style="color:#56B6C2">=</span><span style="color:#E06C75"> </span></span>
<span class="line"><span style="color:#E5C07B">            ActivityCompat</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">checkSelfPermission</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">                                               Manifest</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">permission</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">READ_EXTERNAL_STORAGE</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#E06C75"> (permission </span><span style="color:#56B6C2">!=</span><span style="color:#E5C07B"> PackageManager</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">PERMISSION_GRANTED</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">            //请求权限</span></span>
<span class="line"><span style="color:#E5C07B">            ActivityCompat</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">requestPermissions</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#C678DD">                    new</span><span style="color:#E5C07B"> String</span><span style="color:#ABB2BF">[]{</span><span style="color:#E5C07B">Manifest</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">permission</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">READ_EXTERNAL_STORAGE</span><span style="color:#ABB2BF">},</span></span>
<span class="line"><span style="color:#ABB2BF">                    EXTERNAL_STORAGE_REQ_CODE);</span></span>
<span class="line"><span style="color:#E06C75">        }</span></span>
<span class="line"><span style="color:#ABB2BF">        ...</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span></code></pre></td></tr></tbody></table>
      </figure>
<blockquote>
<p>使用Bitmap类创建位图对象</p>
</blockquote>
<p>通过使用BitmapFactory类我们可以创建一整张位图，那如果我们仅需要从图像上取一小块区域呢？这时我们可以通过Bitmap类创建一个对象。</p>
<p><strong>Bitmap类为创建位图提供的方法：</strong></p>
<p><code>createBitmap()</code>：根据重载形式创建对应的Bitmap对象。可用于挖去图片一小块区域。</p>
<p><code>compress()</code>：压缩Bitmap对象并保存到文件输出流</p>
<p><code>createScaledBitmap()</code>：将源位图缩放并创建新的Bitmap对象。</p>
<p>我们可以继续在本案例中的MyView类中的ondraw()方法中编写：</p>
<p>如果我们想挖取图片一小部分，那么可以使用：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onDraw</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">Canvas</span><span style="color:#E06C75"> canvas) {</span></span>
<span class="line"><span style="color:#ABB2BF">        ...</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /*******挖去一小块区域******/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //创建新的位图对象</span></span>
<span class="line"><span style="color:#E5C07B">        Bitmap</span><span style="color:#E06C75"> bitmap1 </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> Bitmap</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">createBitmap</span><span style="color:#ABB2BF">(bitmap, </span><span style="color:#D19A66">23</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">89</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">150</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">168</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制图片</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawBitmap</span><span style="color:#ABB2BF">(bitmap1,</span><span style="color:#D19A66">270</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">50</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>由于我选取的图片太大，我想将图片缩放，那么可以：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onDraw</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">Canvas</span><span style="color:#E06C75"> canvas) {</span></span>
<span class="line"><span style="color:#ABB2BF">        ...</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /*******缩放图片******/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //创建新的位图对象</span></span>
<span class="line"><span style="color:#E5C07B">        Bitmap</span><span style="color:#E06C75"> bitmap1 </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> Bitmap</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">createScaledBitmap</span><span style="color:#ABB2BF">(bitmap,</span><span style="color:#D19A66">500</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">500</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制图片</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawBitmap</span><span style="color:#ABB2BF">(bitmap1,</span><span style="color:#D19A66">270</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">50</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#E06C75">    }</span></span></code></pre></td></tr></tbody></table>
      </figure>
<h2 id="绘制路径"><a class="header-anchor" href="#绘制路径"></a>绘制路径</h2>
<p>创建路径使用Path类，在这个类中提供了一些矢量绘图的方法，通过这些方法可以创建各种路径。</p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/AndroidImages/Path类.png" alt="Path类" style="zoom: 25%;">
<p><strong>路径的体现形式：</strong></p>
<ul>
<li>绘制路径</li>
<li>绘制绕路径文字</li>
</ul>
<p>针对这两种体现形式，我们可以使有Canvas类的<code>drawPath()</code>方法或<code>drawTextOnPath()</code>方法来实现。</p>
<blockquote>
<p>绘制路径</p>
</blockquote>
<p>activity_main.xml：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF"> ... </span><span style="color:#D19A66">android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/framelayout"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>MainActivity.java：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        FrameLayout</span><span style="color:#E06C75"> frameLayout</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">framelayout</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        frameLayout</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addView</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#61AFEF"> MyView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>自定义MyView类，绘制路径：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MyView</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> View</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#61AFEF"> MyView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Context</span><span style="color:#E06C75;font-style:italic"> context</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">(context);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onDraw</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Canvas</span><span style="color:#E06C75;font-style:italic"> canvas</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onDraw</span><span style="color:#ABB2BF">(canvas);</span></span>
<span class="line"><span style="color:#E5C07B">        Paint</span><span style="color:#E06C75"> paint</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> Paint</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setAntiAlias</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">true</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setColor</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0xFF0000FF</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//设置笔触为蓝色</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setStyle</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Paint</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Style</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">STROKE</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//设置填充样式为描边</span></span>
<span class="line"><span style="color:#E5C07B">        Path</span><span style="color:#E06C75"> path</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> Path</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //创建圆形路径 CW：顺时针绘制；CCW：逆时针绘制</span></span>
<span class="line"><span style="color:#E5C07B">        path</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addCircle</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">150</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">100</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">50</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">Path</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Direction</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">CW</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //canvas.drawPath(path,paint); //绘制路径</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //绘制绕路径的文本</span></span>
<span class="line"><span style="color:#E5C07B">        paint</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setTextSize</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">26</span><span style="color:#ABB2BF">); </span><span style="color:#7F848E;font-style:italic">//设置文字大小，单位默认sp</span></span>
<span class="line"><span style="color:#E5C07B">        String</span><span style="color:#E06C75"> string</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> "活着就是为了改变世界"</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B">        canvas</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">drawTextOnPath</span><span style="color:#ABB2BF">(string,path,</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">,paint);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><strong>总结：</strong></p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/AndroidImages/路径绘制.png" alt="路径绘制" style="zoom: 25%;">
<h2 id="逐帧动画"><a class="header-anchor" href="#逐帧动画"></a>逐帧动画</h2>
<p><strong>创建逐帧动画的基本步骤：</strong></p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/AndroidImages/创建逐帧动画.png" alt="创建逐帧动画" style="zoom: 25%;">
<blockquote>
<p>单击屏幕播放或停止逐帧动画</p>
</blockquote>
<p><strong>准备：</strong> 我们首先需要准备逐帧动画资源图片文件，可以在网上执行搜索或联系本文作者获取。我们准备共6张逐帧动画资源图片文件，分别命名为image1~image6，将它们放置于res/drawable目录下。</p>
<p>在<mark>res/drawable</mark>目录下创建动画资源文件fairy.xml：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">animation-list</span><span style="color:#D19A66"> xmlns:android</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/apk/res/android"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">item</span><span style="color:#D19A66"> android:drawable</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/image1"</span><span style="color:#D19A66"> android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"60"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">item</span><span style="color:#D19A66"> android:drawable</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/image2"</span><span style="color:#D19A66"> android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"60"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">item</span><span style="color:#D19A66"> android:drawable</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/image3"</span><span style="color:#D19A66"> android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"60"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">item</span><span style="color:#D19A66"> android:drawable</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/image4"</span><span style="color:#D19A66"> android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"60"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">item</span><span style="color:#D19A66"> android:drawable</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/image5"</span><span style="color:#D19A66"> android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"60"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">item</span><span style="color:#D19A66"> android:drawable</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/image6"</span><span style="color:#D19A66"> android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"60"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">animation-list</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>在布局资源文件activity_main.xml文件中使用动画资源文件：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">LinearLayout</span><span style="color:#ABB2BF"> ...</span></span>
<span class="line"><span style="color:#D19A66">    android:orientation</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"vertical"</span></span>
<span class="line"><span style="color:#D19A66">    android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/linearlayout"</span></span>
<span class="line"><span style="color:#D19A66">    android:background</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/fairy"</span></span>
<span class="line"><span style="color:#D19A66">    tools:context</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">".MainActivity"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">LinearLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>在MainActivity.java中编写播放动画的代码：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#C678DD"> boolean</span><span style="color:#E06C75"> flag </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> true</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">//记录播放状态</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        LinearLayout</span><span style="color:#E06C75"> linearLayout</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">linearlayout</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //获取动画Drawable资源</span></span>
<span class="line"><span style="color:#C678DD">        final</span><span style="color:#E5C07B"> AnimationDrawable</span><span style="color:#E06C75"> animationDrawable</span><span style="color:#56B6C2"> =</span><span style="color:#ABB2BF"> (AnimationDrawable) </span><span style="color:#E5C07B">linearLayout</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getBackground</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">        linearLayout</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#ABB2BF"> (flag){</span></span>
<span class="line"><span style="color:#E5C07B">                    animationDrawable</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">start</span><span style="color:#ABB2BF">();  </span><span style="color:#7F848E;font-style:italic">//播放动画</span></span>
<span class="line"><span style="color:#ABB2BF">                    flag </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span><span style="color:#C678DD">else</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">                    animationDrawable</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stop</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">                    flag </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> true</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<h2 id="补间动画"><a class="header-anchor" href="#补间动画"></a>补间动画</h2>
<p><strong>定义：</strong> 补间动画指的是做FLASH动画时，在两个<strong>关键帧</strong>中间需要做“补间动画”，才能实现图画的运动；插入补间动画后两个关键帧之间的插补帧是由<strong>计算机</strong>自动运算而得到的。</p>
<p><strong>安卓为我们提供了4种补间动画：</strong></p>
<ol>
<li>透明度渐变动画<code>&lt;alpha&gt;</code></li>
<li>旋转动画<code>&lt;rotate&gt;</code></li>
<li>缩放动画<code>&lt;scale&gt;</code></li>
<li>平移动画<code>&lt;translate&gt;</code></li>
</ol>
<blockquote>
<p>实现4中补间动画的基本使用</p>
</blockquote>
<p><strong>准备：</strong> 需要一张图片资源文件，命名为image1，放置于res/drawable目录下。</p>
<p><strong>在res目录下创建anim目录，并编写4种补间动画文件：</strong></p>
<p>alpha.xml：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">set</span><span style="color:#D19A66"> xmlns:android</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/apk/res/android"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    &lt;!--从完全不透明到透明--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">alpha</span></span>
<span class="line"><span style="color:#D19A66">        android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"2000"</span></span>
<span class="line"><span style="color:#D19A66">        android:fromAlpha</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"0"</span></span>
<span class="line"><span style="color:#D19A66">        android:toAlpha</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"1"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">set</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>rotate.xml：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">set</span><span style="color:#D19A66"> xmlns:android</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/apk/res/android"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">rotate</span></span>
<span class="line"><span style="color:#D19A66">        android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"2000"</span></span>
<span class="line"><span style="color:#D19A66">        android:fromDegrees</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"0"</span></span>
<span class="line"><span style="color:#D19A66">        android:pivotX</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"50%"</span></span>
<span class="line"><span style="color:#D19A66">        android:pivotY</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"50%"</span></span>
<span class="line"><span style="color:#D19A66">        android:toDegrees</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"360"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">set</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>scale.xml：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">set</span><span style="color:#D19A66"> xmlns:android</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/apk/res/android"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">scale</span></span>
<span class="line"><span style="color:#D19A66">        android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"2000"</span></span>
<span class="line"><span style="color:#D19A66">        android:fromXScale</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"1"</span></span>
<span class="line"><span style="color:#D19A66">        android:fromYScale</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"1"</span></span>
<span class="line"><span style="color:#D19A66">        android:pivotX</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"50%"</span></span>
<span class="line"><span style="color:#D19A66">        android:pivotY</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"50%"</span></span>
<span class="line"><span style="color:#D19A66">        android:toXScale</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"2"</span></span>
<span class="line"><span style="color:#D19A66">        android:toYScale</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"2"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">set</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>translate.xml：	<a target="_blank" rel="noopener" href="https://www.cnblogs.com/bavariama/archive/2013/01/29/2881225.html">编写参考链接</a></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">set</span><span style="color:#D19A66"> xmlns:android</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/apk/res/android"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">translate</span></span>
<span class="line"><span style="color:#D19A66">        android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"2000"</span></span>
<span class="line"><span style="color:#D19A66">        android:fromXDelta</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"0"</span></span>
<span class="line"><span style="color:#D19A66">        android:fromYDelta</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"0"</span></span>
<span class="line"><span style="color:#D19A66">        android:toXDelta</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"300"</span></span>
<span class="line"><span style="color:#D19A66">        android:toYDelta</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"300"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">set</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><strong>在布局资源文件activity_main.xml中设置一个图像视图组件用于显示图片：</strong></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">RelativeLayout</span><span style="color:#ABB2BF"> ...&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">ImageView</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/image"</span></span>
<span class="line"><span style="color:#D19A66">        android:src</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/image1"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_alignParentTop</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"true"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_alignParentLeft</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"true"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_alignParentStart</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"true"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">RelativeLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>在MainActivity.java文件中创建动画对象：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">        final</span><span style="color:#E5C07B"> ImageView</span><span style="color:#E06C75"> imageView</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">image</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        imageView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //创建透明度渐变动画对象</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //Animation animation = AnimationUtils.loadAnimation(MainActivity.this,R.anim.alpha);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //创建旋转动画对象</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //Animation animation = AnimationUtils.loadAnimation(MainActivity.this,R.anim.rotate);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //创建缩放动画对象</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //Animation animation = AnimationUtils.loadAnimation(MainActivity.this,R.anim.scale);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //创建平移动画对象</span></span>
<span class="line"><span style="color:#E5C07B">                Animation</span><span style="color:#E06C75"> animation</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> AnimationUtils</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">loadAnimation</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">anim</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">translate</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">                imageView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">startAnimation</span><span style="color:#ABB2BF">(animation); </span><span style="color:#7F848E;font-style:italic">//开启动画</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<h2 id="实现淡入、淡出补间动画"><a class="header-anchor" href="#实现淡入、淡出补间动画"></a>实现淡入、淡出补间动画</h2>
<p><strong>准备：</strong> 需要4张图片资源文件，分别命名为image1~image4，放置于res/drawable目录下。</p>
<p><strong>在res目录下创建anim目录，并编写补间动画文件：</strong></p>
<p>anim_alpha_in.xml：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">set</span><span style="color:#D19A66"> xmlns:android</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/apk/res/android"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">alpha</span></span>
<span class="line"><span style="color:#D19A66">        android:fromAlpha</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"0"</span></span>
<span class="line"><span style="color:#D19A66">        android:toAlpha</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"1"</span></span>
<span class="line"><span style="color:#D19A66">        android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"2000"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">set</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>anim_alpha_out.xml：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">set</span><span style="color:#D19A66"> xmlns:android</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/apk/res/android"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">alpha</span></span>
<span class="line"><span style="color:#D19A66">        android:fromAlpha</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"1"</span></span>
<span class="line"><span style="color:#D19A66">        android:toAlpha</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"0"</span></span>
<span class="line"><span style="color:#D19A66">        android:duration</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"2000"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">set</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><strong>在布局资源文件activity_main.xml中设置一个ViewFlipper组件用于显示切换图片：</strong></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">ViewFlipper</span></span>
<span class="line"><span style="color:#D19A66">             android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/flipper"</span></span>
<span class="line"><span style="color:#D19A66">             android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span></span>
<span class="line"><span style="color:#D19A66">             android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">ViewFlipper</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><strong>在MainActivity.java文件中创建动画对象，并设置切换手势：</strong></p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#C678DD"> implements</span><span style="color:#E5C07B"> GestureDetector</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">OnGestureListener</span><span style="color:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E5C07B">    ViewFlipper</span><span style="color:#E06C75"> viewFlipper</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B">    GestureDetector</span><span style="color:#E06C75"> detector</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">//定义手势检测器</span></span>
<span class="line"><span style="color:#C678DD">    final</span><span style="color:#C678DD"> int</span><span style="color:#E06C75"> distance </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> 50</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">//定义手势动作两点之间最小距离</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    //定义图片数组</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#C678DD"> int</span><span style="color:#E06C75">[] images </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#C678DD"> int</span><span style="color:#E06C75">[]{</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">drawable</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">image1</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">drawable</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">image2</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">drawable</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">image3</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">drawable</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">image4</span><span style="color:#E06C75">}</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">        detector </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> GestureDetector</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">        viewFlipper </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">flipper</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">        for</span><span style="color:#ABB2BF"> (</span><span style="color:#C678DD">int</span><span style="color:#E06C75"> i</span><span style="color:#56B6C2"> =</span><span style="color:#D19A66"> 0</span><span style="color:#ABB2BF">;i</span><span style="color:#56B6C2">&lt;</span><span style="color:#E5C07B">images</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">length</span><span style="color:#ABB2BF">;i++){</span></span>
<span class="line"><span style="color:#E5C07B">            ImageView</span><span style="color:#E06C75"> imageView</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> ImageView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">            imageView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setImageResource</span><span style="color:#ABB2BF">(images[i]);</span></span>
<span class="line"><span style="color:#E5C07B">            viewFlipper</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">addView</span><span style="color:#ABB2BF">(imageView);</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //定义并初始化动画数组</span></span>
<span class="line"><span style="color:#E5C07B">        Animation</span><span style="color:#ABB2BF">[] </span><span style="color:#E06C75">animations</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> Animation</span><span style="color:#ABB2BF">[</span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">];</span></span>
<span class="line"><span style="color:#ABB2BF">        animations[</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">] </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> AnimationUtils</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">loadAnimation</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">anim</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">anim_alpha_in</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">        animations[</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">] </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> AnimationUtils</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">loadAnimation</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">anim</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">anim_alpha_out</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //指定切换的动画效果</span></span>
<span class="line"><span style="color:#E5C07B">        viewFlipper</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setInAnimation</span><span style="color:#ABB2BF">(animations[</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">]);</span></span>
<span class="line"><span style="color:#E5C07B">        viewFlipper</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOutAnimation</span><span style="color:#ABB2BF">(animations[</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">]);</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> boolean</span><span style="color:#61AFEF"> onDown</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MotionEvent</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onShowPress</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MotionEvent</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> boolean</span><span style="color:#61AFEF"> onSingleTapUp</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MotionEvent</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> boolean</span><span style="color:#61AFEF"> onScroll</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MotionEvent</span><span style="color:#E06C75;font-style:italic"> e1</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">MotionEvent</span><span style="color:#E06C75;font-style:italic"> e2</span><span style="color:#ABB2BF">, </span><span style="color:#C678DD">float</span><span style="color:#E06C75;font-style:italic"> distanceX</span><span style="color:#ABB2BF">, </span><span style="color:#C678DD">float</span><span style="color:#E06C75;font-style:italic"> distanceY</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onLongPress</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MotionEvent</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> boolean</span><span style="color:#61AFEF"> onFling</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MotionEvent</span><span style="color:#E06C75;font-style:italic"> e1</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">MotionEvent</span><span style="color:#E06C75;font-style:italic"> e2</span><span style="color:#ABB2BF">, </span><span style="color:#C678DD">float</span><span style="color:#E06C75;font-style:italic"> velocityX</span><span style="color:#ABB2BF">, </span><span style="color:#C678DD">float</span><span style="color:#E06C75;font-style:italic"> velocityY</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">e1</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getX</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">-</span><span style="color:#E5C07B"> e2</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getX</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">&gt;</span><span style="color:#ABB2BF"> distance){</span></span>
<span class="line"><span style="color:#E5C07B">            viewFlipper</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">showPrevious</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">            return</span><span style="color:#D19A66"> true</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span><span style="color:#C678DD">else</span><span style="color:#C678DD"> if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">e2</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getX</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">-</span><span style="color:#E5C07B"> e1</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getX</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">&gt;</span><span style="color:#ABB2BF"> distance){</span></span>
<span class="line"><span style="color:#E5C07B">            viewFlipper</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">showNext</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">            return</span><span style="color:#D19A66"> true</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> boolean</span><span style="color:#61AFEF"> onTouchEvent</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MotionEvent</span><span style="color:#E06C75;font-style:italic"> event</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        return</span><span style="color:#E5C07B"> detector</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onTouchEvent</span><span style="color:#ABB2BF">(event);    </span><span style="color:#7F848E;font-style:italic">//这里重写后一定要记得修改</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<h1 id="多媒体应用开发"><a class="header-anchor" href="#多媒体应用开发"></a>多媒体应用开发</h1>
<h2 id="音频——使用MediaPlayer播放"><a class="header-anchor" href="#音频——使用MediaPlayer播放"></a>音频——使用MediaPlayer播放</h2>
<p>使用MediaPlayer播放的音频格式：mp3(常用)、ogg、3gp、wav</p>
<p>什么是MediaPlayer？</p>
<p>Android提供的用来控制<strong>音频</strong>/<strong>视频</strong>文件或流播放的<strong>类</strong>。</p>
<p>使用MediaPlayer类播放音频的步骤：</p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/AndroidImages/MediaPlayer使用步骤.png" alt="MediaPlayer使用步骤" style="zoom: 50%;">
<blockquote>
<p>使用MediaPlayer播放音频文件</p>
</blockquote>
<p><strong>准备：</strong> 需要一段mp3音频文件，命名为music.mp3。在res下创建raw目录，将准备的音频文件放置于raw目录下。</p>
<p>在activity_main.xml中设计播放、暂停、停止按钮：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">LinearLayout</span><span style="color:#ABB2BF"> ...</span></span>
<span class="line"><span style="color:#D19A66">    android:orientation</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"horizontal"</span></span>
<span class="line"><span style="color:#D19A66">    android:gravity</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"center_horizontal"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">Button</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/btn_play"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:text</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"播放"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">Button</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/btn_stop"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:text</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"停止"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">Button</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/btn_pause"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:text</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"暂停"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">LinearLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>在MainActivity.java中创建MediaPlayer对象，并装载音频文件：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //创建MediaPlayer对象，并装载了播放的音频</span></span>
<span class="line"><span style="color:#C678DD">        final</span><span style="color:#E5C07B"> MediaPlayer</span><span style="color:#E06C75"> mediaPlayer</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> MediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">create</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">raw</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">music</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        Button</span><span style="color:#E06C75"> button_paly</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">btn_play</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        Button</span><span style="color:#E06C75"> button_stop</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">btn_stop</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        Button</span><span style="color:#E06C75"> button_pause</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">btn_pause</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        button_paly</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#E5C07B">                mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">start</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//开始播放音频</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#E5C07B">        button_stop</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#E5C07B">                mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stop</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//停止播放</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#E5C07B">        button_pause</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#E5C07B">                mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">pause</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//暂停播放</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<blockquote>
<p>总结</p>
</blockquote>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/AndroidImages/MediaPlayerSummary.png" alt="MediaPlayerSummary" style="zoom:33%;">
<h2 id="制作简易音乐播放器"><a class="header-anchor" href="#制作简易音乐播放器"></a>制作简易音乐播放器</h2>
<p>在本次案例中，我们将使用MediaPlayer制作一个简易音乐播放器。我们需要从模拟机SD卡中读取音乐文件，然后点击播放按钮进行播放。</p>
<p>**准备：**我们需要三张表示播放、暂停、停止的图标文件资源，分别命名为play、pause和stop，将它们放置于res/drawable目录下。我们还需要准备一段音频文件，命名为music.mp3，将这段音频文件上传至模拟器SD卡上。</p>
<p>由于我们需要上传文件至SD卡并读取SD卡的文件，所以我们需要<mark>设置权限</mark>。文件上传至模拟器和权限设置参考 <strong>图形图像处理技术中的<mark>绘制图片</mark></strong> 中的上传和配置。</p>
<p>在布局资源文件activity_main.xml中设置按钮：</p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">LinearLayout</span><span style="color:#D19A66"> xmlns:android</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/apk/res/android"</span></span>
<span class="line"><span style="color:#D19A66">    xmlns:app</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/apk/res-auto"</span></span>
<span class="line"><span style="color:#D19A66">    xmlns:tools</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/tools"</span></span>
<span class="line"><span style="color:#D19A66">    android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span></span>
<span class="line"><span style="color:#D19A66">    android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span></span>
<span class="line"><span style="color:#D19A66">    android:orientation</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"horizontal"</span></span>
<span class="line"><span style="color:#D19A66">    android:gravity</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"center_horizontal"</span></span>
<span class="line"><span style="color:#D19A66">    tools:context</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">".MainActivity"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">ImageButton</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/btn_play"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_marginEnd</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"30dp"</span></span>
<span class="line"><span style="color:#D19A66">        android:src</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/play"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">ImageButton</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/btn_stop"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:src</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/stop"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">LinearLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p>在MainActivity.java中编写音乐播放器逻辑：</p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#E5C07B"> MediaPlayer</span><span style="color:#E06C75"> mediaPlayer</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#E5C07B"> File</span><span style="color:#E06C75"> file</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#C678DD"> boolean</span><span style="color:#E06C75"> isPause </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">//定义是否暂停</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#61AFEF">        getWindow</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">setFlags</span><span style="color:#ABB2BF">(WindowManager.</span></span>
<span class="line"><span style="color:#E5C07B">                             LayoutParams</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FLAG_FULLSCREEN</span><span style="color:#ABB2BF">, </span></span>
<span class="line"><span style="color:#ABB2BF">                             WindowManager.</span></span>
<span class="line"><span style="color:#E5C07B">                             LayoutParams</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FLAG_FULLSCREEN</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //获取要播放的音频文件</span></span>
<span class="line"><span style="color:#ABB2BF">        file </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> File</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"/sdcard/music.mp3"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">exists</span><span style="color:#ABB2BF">()){</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">            //创建MediaPlayer对象，并装载音频文件</span></span>
<span class="line"><span style="color:#ABB2BF">            mediaPlayer </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> MediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">create</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">Uri</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">parse</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF">()));</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span><span style="color:#C678DD">else</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">            Toast</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">makeText</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">, </span></span>
<span class="line"><span style="color:#98C379">                           "要播放的音频文件不存在！"</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">Toast</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LENGTH_SHORT</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">show</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">            return</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#C678DD">        final</span><span style="color:#E5C07B"> ImageButton</span><span style="color:#E06C75"> btn_play</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">btn_play</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">        final</span><span style="color:#E5C07B"> ImageButton</span><span style="color:#E06C75"> btn_stop</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">btn_stop</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        btn_play</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">isPlaying</span><span style="color:#ABB2BF">() </span><span style="color:#56B6C2">&amp;&amp;</span><span style="color:#56B6C2"> !</span><span style="color:#ABB2BF">isPause){</span></span>
<span class="line"><span style="color:#E5C07B">                    mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">pause</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">                    isPause </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> true</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">                    ((ImageButton)v).</span><span style="color:#61AFEF">setImageDrawable</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">getResources</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">                                                      .</span><span style="color:#61AFEF">getDrawable</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">drawable</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">play</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">null</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span><span style="color:#C678DD">else</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">                    mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">start</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//继续播放</span></span>
<span class="line"><span style="color:#ABB2BF">                    isPause </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">                    ((ImageButton)v).</span><span style="color:#61AFEF">setImageDrawable</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">getResources</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">                                                      .</span><span style="color:#61AFEF">getDrawable</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">drawable</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">pause</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">null</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        btn_stop</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#E5C07B">                mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stop</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">                btn_play</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setImageDrawable</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">getResources</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">getDrawable</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">drawable</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">play</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">null</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //事件完成监听器</span></span>
<span class="line"><span style="color:#E5C07B">        mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnCompletionListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> MediaPlayer.</span><span style="color:#61AFEF">OnCompletionListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCompletion</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MediaPlayer</span><span style="color:#ABB2BF"> mp) {</span></span>
<span class="line"><span style="color:#61AFEF">                play</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> play</span><span style="color:#ABB2BF">(){</span></span>
<span class="line"><span style="color:#E5C07B">        mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">reset</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//重置播放器</span></span>
<span class="line"><span style="color:#C678DD">        try</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">            mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setDataSource</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B">            mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">prepare</span><span style="color:#ABB2BF">();  </span><span style="color:#7F848E;font-style:italic">//预加载音频</span></span>
<span class="line"><span style="color:#E5C07B">            mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">start</span><span style="color:#ABB2BF">(); </span><span style="color:#7F848E;font-style:italic">//播放音频</span></span>
<span class="line"><span style="color:#ABB2BF">        } </span><span style="color:#C678DD">catch</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">IOException</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B">            e</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">printStackTrace</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    //释放资源</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onDestroy</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">isPlaying</span><span style="color:#ABB2BF">()){</span></span>
<span class="line"><span style="color:#E5C07B">            mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stop</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#E5C07B">        mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">release</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onDestroy</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<h2 id="音频——使用SoundPool播放"><a class="header-anchor" href="#音频——使用SoundPool播放"></a>音频——使用SoundPool播放</h2>
<p>MediaPlayer和SoundPool区别：</p>
<table>
<thead>
<tr>
<th style="text-align:center">MediaPlayer</th>
<th style="text-align:center">SoundPool</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">延迟长，且占用资源多</td>
<td style="text-align:center">延迟短，且占用资源少</td>
</tr>
<tr>
<td style="text-align:center">不支持同时播放多个音频</td>
<td style="text-align:center">支持多个音频同时播放</td>
</tr>
</tbody>
</table>
<p><strong>但SoundPool只能播放短促的音频，否则可能无法播放完毕。</strong></p>
<p>SoundPool（音效池）：管理<mark>多个短促</mark>的音频。主要用于播放按键音，消息提示音。</p>
<hr>
<p><strong>使用SoundPool播放音频步骤：</strong></p>
<ol>
<li>创建SoundPool对象；</li>
<li>使用<code>load()</code>加载音频；</li>
<li>使用<code>play()</code>播放音频。</li>
</ol>
<blockquote>
<p>点击列表项播放铃声</p>
</blockquote>
<p><strong>准备：</strong> 我们需要准备5段铃声，时间控制在10s内，分别命名为bell_1~bell_5，然后在res目录下新建raw目录，将这些铃声放置于raw目录下。</p>
<p><strong>在res/values目录下创建bellname.xml数组资源文件：</strong></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">resources</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">array</span><span style="color:#D19A66"> name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"bellname"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">&gt;铃声1&lt;/</span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">&gt;铃声2&lt;/</span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">&gt;铃声3&lt;/</span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">&gt;铃声4&lt;/</span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">&gt;铃声5&lt;/</span><span style="color:#E06C75">item</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;/</span><span style="color:#E06C75">array</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">resources</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><strong>在布局资源文件activity_main.xml中编写列表视图：</strong></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">RelativeLayout</span><span style="color:#ABB2BF"> ...&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">ListView</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/listView"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span></span>
<span class="line"><span style="color:#D19A66">        android:entries</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@array/bellname"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">RelativeLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><strong>在MainActivity.java中加载并播放音频：</strong></p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        ListView</span><span style="color:#E06C75"> listView</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">listView</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /*****创建SoundPool对象，并且设置音频属性******/</span></span>
<span class="line"><span style="color:#E5C07B">        AudioAttributes</span><span style="color:#E06C75"> audioAttributes</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#ABB2BF"> AudioAttributes.</span><span style="color:#61AFEF">Builder</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">setUsage</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">AudioAttributes</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">USAGE_MEDIA</span><span style="color:#ABB2BF">)  </span><span style="color:#7F848E;font-style:italic">//设置音效使用场景</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">setContentType</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">AudioAttributes</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">CONTENT_TYPE_MUSIC</span><span style="color:#ABB2BF">) </span><span style="color:#7F848E;font-style:italic">//设置音效类型</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">build</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">        final</span><span style="color:#E5C07B"> SoundPool</span><span style="color:#E06C75"> soundPool</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#ABB2BF"> SoundPool.</span><span style="color:#61AFEF">Builder</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">setAudioAttributes</span><span style="color:#ABB2BF">(audioAttributes)    </span><span style="color:#7F848E;font-style:italic">//设置音效池属性</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">setMaxStreams</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">10</span><span style="color:#ABB2BF">)  </span><span style="color:#7F848E;font-style:italic">//设置最多可容纳10个音频流</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">build</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /*******将要播放的音频保存到HashMap对象中********/</span></span>
<span class="line"><span style="color:#C678DD">        final</span><span style="color:#E5C07B"> HashMap</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Integer</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">Integer</span><span style="color:#ABB2BF">&gt; </span><span style="color:#E06C75">soundMap</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#E5C07B"> HashMap</span><span style="color:#ABB2BF">&lt;</span><span style="color:#E5C07B">Integer</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">Integer</span><span style="color:#ABB2BF">&gt;();</span></span>
<span class="line"><span style="color:#E5C07B">        soundMap</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">put</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">soundPool</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">load</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">raw</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">bell_1</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B">        soundMap</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">put</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">soundPool</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">load</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">raw</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">bell_2</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B">        soundMap</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">put</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">2</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">soundPool</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">load</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">raw</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">bell_3</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B">        soundMap</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">put</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">3</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">soundPool</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">load</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">raw</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">bell_4</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B">        soundMap</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">put</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">4</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">soundPool</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">load</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">raw</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">bell_5</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">));</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /*******************播放音频********************/</span></span>
<span class="line"><span style="color:#E5C07B">        listView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnItemClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> AdapterView.</span><span style="color:#61AFEF">OnItemClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onItemClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">AdapterView</span><span style="color:#56B6C2">&lt;</span><span style="color:#C678DD">?</span><span style="color:#56B6C2">&gt;</span><span style="color:#ABB2BF"> parent, </span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> view, </span><span style="color:#C678DD">int</span><span style="color:#ABB2BF"> position, </span><span style="color:#C678DD">long</span><span style="color:#ABB2BF"> id) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //单击选项播放音频</span></span>
<span class="line"><span style="color:#E5C07B">                soundPool</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">play</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">soundMap</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">get</span><span style="color:#ABB2BF">(position),</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<h2 id="视频——使用VideoView播放"><a class="header-anchor" href="#视频——使用VideoView播放"></a>视频——使用VideoView播放</h2>
<p>Android中支持的常用视频格式：mp4、3gp</p>
<p><strong>使用VideoView播放视频的步骤：</strong></p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/AndroidImages/VideoView播放视频的步骤.png" alt="VideoView播放视频的步骤" style="zoom: 33%;">
<p>但一般情况下，<strong>我们使用Android给我们提供的MediaController类</strong>，使用这个类可以给我们的视频设置一个播放控制条，这样我们就可以不用编写控制视频进度、暂停、停止、快进的代码了。</p>
<blockquote>
<p>使用VideoView播放模拟器SD卡中的视频</p>
</blockquote>
<p><strong>准备：</strong> 我们需要准备一段时间长度适宜的视频文件，我将其命名为video_ice.mp4（你可以自由命名，但是记得修改与视频文件名相关的代码），然后开启模拟器，让其上传到模拟器的SD卡上。</p>
<p>由于我们需要上传文件至SD卡并读取SD卡的文件，所以我们需要<mark>设置权限</mark>。文件上传至模拟器和权限设置参考 <strong>图形图像处理技术中的<mark>绘制图片</mark></strong> 中的上传和配置。</p>
<p>由于本案例中的AndroidManifest.xml权限配置与以前的权限配置存在些许差异，因此在此给出此文件内容。</p>
<p><strong>在AndroidManifest.xml文件中设置权限：</strong></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">manifest</span><span style="color:#ABB2BF"> ...&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-permission</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.permission.WRITE_EXTERNAL_STORAGE"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-permission</span></span>
<span class="line"><span style="color:#D19A66">        android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.permission.MOUNT_UNMOUNT_FILESYSTEMS"</span></span>
<span class="line"><span style="color:#D19A66">        tools:ignore</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"ProtectedPermissions"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">application</span></span>
<span class="line"><span style="color:#D19A66">        android:allowBackup</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"true"</span></span>
<span class="line"><span style="color:#D19A66">        android:icon</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@mipmap/ic_launcher"</span></span>
<span class="line"><span style="color:#D19A66">        android:label</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@string/app_name"</span></span>
<span class="line"><span style="color:#D19A66">        android:requestLegacyExternalStorage</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"true"</span></span>
<span class="line"><span style="color:#D19A66">        android:roundIcon</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@mipmap/ic_launcher_round"</span></span>
<span class="line"><span style="color:#D19A66">        android:supportsRtl</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"true"</span></span>
<span class="line"><span style="color:#D19A66">        android:theme</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@style/AppTheme"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">activity</span></span>
<span class="line"><span style="color:#D19A66">            android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">".MainActivity"</span></span>
<span class="line"><span style="color:#D19A66">            android:screenOrientation</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"fullSensor"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">            &lt;</span><span style="color:#E06C75">intent-filter</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">                &lt;</span><span style="color:#E06C75">action</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.intent.action.MAIN"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">                &lt;</span><span style="color:#E06C75">category</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.intent.category.LAUNCHER"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">            &lt;/</span><span style="color:#E06C75">intent-filter</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;/</span><span style="color:#E06C75">activity</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;/</span><span style="color:#E06C75">application</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">manifest</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><strong>在布局资源文件activity_main.xml中使用VideoView组件：</strong></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">RelativeLayout</span><span style="color:#ABB2BF"> ...&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">VideoView</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/video"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">RelativeLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><strong>在MainActivity.java文件中加载并播放视频：</strong></p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#61AFEF">        getWindow</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">setFlags</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">WindowManager</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LayoutParams</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FLAG_FULLSCREEN</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">                WindowManager</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LayoutParams</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FLAG_FULLSCREEN</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        VideoView</span><span style="color:#E06C75"> videoView</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">video</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /*************加载要播放的视频***************/</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //获取文件对象</span></span>
<span class="line"><span style="color:#E5C07B">        File</span><span style="color:#E06C75"> file</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> File</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Environment</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getExternalStorageDirectory</span><span style="color:#ABB2BF">()</span><span style="color:#56B6C2">+</span><span style="color:#98C379">"/video_ice.mp4"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">exists</span><span style="color:#ABB2BF">()){</span></span>
<span class="line"><span style="color:#E5C07B">            videoView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setVideoPath</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span><span style="color:#C678DD">else</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">            Toast</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">makeText</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"要播放的视频不存在！"</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">Toast</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LENGTH_SHORT</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">show</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /****************控制视频的播放****************/</span></span>
<span class="line"><span style="color:#E5C07B">        android</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">widget</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">MediaController</span><span style="color:#ABB2BF"> mc </span></span>
<span class="line"><span style="color:#56B6C2">            =</span><span style="color:#C678DD"> new</span><span style="color:#ABB2BF"> android.</span><span style="color:#E5C07B">widget</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">MediaController</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        videoView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setMediaController</span><span style="color:#ABB2BF">(mc);</span><span style="color:#7F848E;font-style:italic">//让VideoView和MediaController关联</span></span>
<span class="line"><span style="color:#E5C07B">        videoView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">requestFocus</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//让VideoView获得焦点</span></span>
<span class="line"><span style="color:#E5C07B">        videoView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">start</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//开始播放视频</span></span>
<span class="line"><span style="color:#E5C07B">        videoView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnCompletionListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> MediaPlayer.</span><span style="color:#61AFEF">OnCompletionListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCompletion</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MediaPlayer</span><span style="color:#ABB2BF"> mp) {</span></span>
<span class="line"><span style="color:#E5C07B">                Toast</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">makeText</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"视频播放完毕"</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">Toast</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LENGTH_SHORT</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">show</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<h2 id="视频——使用MediaPlayer和SurfaceView播放"><a class="header-anchor" href="#视频——使用MediaPlayer和SurfaceView播放"></a>视频——使用MediaPlayer和SurfaceView播放</h2>
<p>播放视频的方法：VideoView和MediaPlayer、SurfaceView。</p>
<p><strong>使用MediaPlayer类播放视频：</strong></p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/AndroidImages/使用MediaPlayer类播放视频.png" alt="使用MediaPlayer类播放视频" style="zoom: 33%;">
<blockquote>
<p>使用MediaPlayer和SurfaceView制作简易视频播放器</p>
</blockquote>
<p><strong>案例描述：</strong> 使用MediaPlayer和SurfaceView制作简易视频播放器，然后播放模拟器SD卡内的视频。</p>
<p><strong>准备：</strong> 我们需要准备一段时间长度适宜的视频文件，我将其命名为video_ice.mp4（你可以自由命名，但是记得修改与视频文件名相关的代码），然后开启模拟器，让其上传到模拟器的SD卡上。除了必要的视频文件之外，我们还需要准备三张图标资源文件，用于设置播放、暂停和停止的图片按钮，将这三张图片命名为video_play、video_pause和video_stop，然后将它们放置于res/drawable目录下。</p>
<p>同样，由于需要读取SD卡内的视频，我们需要上传视频和进行<mark>权限设置</mark>。具体步骤可以参考 <strong>多媒体应用开发中的</strong> <mark>使用VideoView播放</mark> 的设置。两者的权限设置是一样的，在此不再累述。</p>
<p><strong>在布局资源文件activity_main.xml中使用VideoView组件：</strong></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">LinearLayout</span><span style="color:#D19A66"> xmlns:android</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/apk/res/android"</span></span>
<span class="line"><span style="color:#D19A66">    xmlns:app</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/apk/res-auto"</span></span>
<span class="line"><span style="color:#D19A66">    xmlns:tools</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"http://schemas.android.com/tools"</span></span>
<span class="line"><span style="color:#D19A66">    android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span></span>
<span class="line"><span style="color:#D19A66">    android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span></span>
<span class="line"><span style="color:#D19A66">    android:orientation</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"vertical"</span></span>
<span class="line"><span style="color:#D19A66">    tools:context</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">".MainActivity"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">SurfaceView</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/surfaceView"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_weight</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"10"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">LinearLayout</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_weight</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"1"</span></span>
<span class="line"><span style="color:#D19A66">        android:orientation</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"horizontal"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        &lt;!--播放按钮--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">ImageButton</span></span>
<span class="line"><span style="color:#D19A66">            android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/play"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_weight</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"1"</span></span>
<span class="line"><span style="color:#D19A66">            android:src</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/video_play"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        &lt;!--暂停按钮--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">ImageButton</span></span>
<span class="line"><span style="color:#D19A66">            android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/pause"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_weight</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"1"</span></span>
<span class="line"><span style="color:#D19A66">            android:src</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/video_pause"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        &lt;!--停止按钮--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">ImageButton</span></span>
<span class="line"><span style="color:#D19A66">            android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/stop"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_weight</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"1"</span></span>
<span class="line"><span style="color:#D19A66">            android:src</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/video_stop"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;/</span><span style="color:#E06C75">LinearLayout</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">LinearLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><strong>在MainActivity.java文件中加载并播放视频：</strong></p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#E5C07B"> ImageButton</span><span style="color:#E06C75"> play</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> pause</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> stop</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#C678DD"> boolean</span><span style="color:#E06C75"> noplay </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> true</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">//定义播放状态 当前表示未播放</span></span>
<span class="line"><span style="color:#E5C07B">    MediaPlayer</span><span style="color:#E06C75"> mediaPlayer</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B">    SurfaceHolder</span><span style="color:#E06C75"> surfaceHolder</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#61AFEF">        getWindow</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">setFlags</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">WindowManager</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LayoutParams</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FLAG_FULLSCREEN</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">                             WindowManager</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LayoutParams</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FLAG_FULLSCREEN</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /************初始化SurfaceView和MediaPlayer********************/</span></span>
<span class="line"><span style="color:#E5C07B">        SurfaceView</span><span style="color:#E06C75"> surfaceView</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">surfaceView</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">        surfaceHolder </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> surfaceView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getHolder</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        mediaPlayer </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> MediaPlayer</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //设置多媒体类型</span></span>
<span class="line"><span style="color:#E5C07B">        mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setAudioStreamType</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">AudioManager</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">STREAM_MUSIC</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnCompletionListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> MediaPlayer.</span><span style="color:#61AFEF">OnCompletionListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCompletion</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MediaPlayer</span><span style="color:#ABB2BF"> mp) {</span></span>
<span class="line"><span style="color:#E5C07B">                Toast</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">makeText</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"视频播放完毕"</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">Toast</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LENGTH_SHORT</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">show</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /****************控制视频的播放、暂停和停止*********************/</span></span>
<span class="line"><span style="color:#ABB2BF">        play </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">play</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">        pause </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">pause</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">        stop </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">stop</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        play</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#ABB2BF"> (noplay){</span></span>
<span class="line"><span style="color:#61AFEF">                    play</span><span style="color:#ABB2BF">(); </span><span style="color:#7F848E;font-style:italic">//播放视频</span></span>
<span class="line"><span style="color:#ABB2BF">                    noplay </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">//表示视频处于播放状态</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span><span style="color:#C678DD">else</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">                    mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">start</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//继续播放视频</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        pause</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">isPlaying</span><span style="color:#ABB2BF">()){</span></span>
<span class="line"><span style="color:#E5C07B">                    mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">pause</span><span style="color:#ABB2BF">();    </span><span style="color:#7F848E;font-style:italic">//暂停播放</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        stop</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">isPlaying</span><span style="color:#ABB2BF">()){</span></span>
<span class="line"><span style="color:#E5C07B">                    mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stop</span><span style="color:#ABB2BF">(); </span><span style="color:#7F848E;font-style:italic">//停止播放</span></span>
<span class="line"><span style="color:#ABB2BF">                    noplay </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> true</span><span style="color:#ABB2BF">;  </span><span style="color:#7F848E;font-style:italic">//表示视频处于未播放状态</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    //播放视频的方法</span></span>
<span class="line"><span style="color:#C678DD">    public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> play</span><span style="color:#ABB2BF">(){</span></span>
<span class="line"><span style="color:#E5C07B">        mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">reset</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//重置MediaPlayer对象</span></span>
<span class="line"><span style="color:#E5C07B">        mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setDisplay</span><span style="color:#ABB2BF">(surfaceHolder);</span><span style="color:#7F848E;font-style:italic">//把视频画面输出到SurfaceView</span></span>
<span class="line"><span style="color:#C678DD">        try</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF">            mediaPlayer</span></span>
<span class="line"><span style="color:#ABB2BF">                .</span><span style="color:#61AFEF">setDataSource</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Environment</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getExternalStorageDirectory</span><span style="color:#ABB2BF">()</span><span style="color:#56B6C2">+</span><span style="color:#98C379">"/video_ice.mp4"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">            mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">prepare</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//预加载</span></span>
<span class="line"><span style="color:#ABB2BF">        } </span><span style="color:#C678DD">catch</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">IOException</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B">            e</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">printStackTrace</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#E5C07B">        mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">start</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//播放视频</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onDestroy</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onDestroy</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (mediaPlayer </span><span style="color:#56B6C2">!=</span><span style="color:#D19A66"> null</span><span style="color:#ABB2BF">){</span></span>
<span class="line"><span style="color:#E5C07B">            mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">isPlaying</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">            mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stop</span><span style="color:#ABB2BF">(); </span><span style="color:#7F848E;font-style:italic">//停止播放</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#E5C07B">        mediaPlayer</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">release</span><span style="color:#ABB2BF">(); </span><span style="color:#7F848E;font-style:italic">//释放资源</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<h2 id="控制摄像头拍照"><a class="header-anchor" href="#控制摄像头拍照"></a>控制摄像头拍照</h2>
<p>在Android中提供了一个名为Camera的类，这个类值专门用来处理摄像头相关事件。</p>
<p><strong>控制摄像头拍照的步骤：</strong></p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/AndroidImages/控制摄像头拍照步骤.png" alt="控制摄像头拍照步骤" style="zoom:33%;">
<p>我们将通过一个案例来进行步骤讲解。</p>
<blockquote>
<p>实现控制摄像头拍照</p>
</blockquote>
<p><strong>准备：</strong> 我们需要准备两张图标资源来表示手机拍照和预览，将它们分别命名为take_photos和preview，然后我们需要将它们放置于res/drawable目录下。</p>
<p>**案例描述：**我们在真机上启动安装后，运行应用，然后点击“预览”图片按钮，打开手机摄像头，选择需要拍摄的物体后，点击“拍照”图片按钮实现拍照。</p>
<p>本案例仅仅实现了基本的拍照逻辑，<strong>使用了大量的过时的类与方法</strong>，因此<strong>本案例仅供参考</strong>，但本案例已经过测试，能够在Android 10的手机上（作者使用的是 MIX 2S 进行测试）进行运行。</p>
<p>==注意：本次案例需要用到真机测试和权限设置。==我会在案例中一步步给出。</p>
<p><strong>在布局资源文件activity_main.xml中完成基本界面布局：</strong></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF"> ...&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">   &lt;</span><span style="color:#E06C75">SurfaceView</span></span>
<span class="line"><span style="color:#D19A66">       android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/surfaceView"</span></span>
<span class="line"><span style="color:#D19A66">       android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span></span>
<span class="line"><span style="color:#D19A66">       android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">ImageButton</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/takephoto"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_gravity</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"right|top"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_marginTop</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"100dp"</span></span>
<span class="line"><span style="color:#D19A66">        android:src</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/take_photos"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">ImageButton</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/preview"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_gravity</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"right|bottom"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_marginBottom</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"100dp"</span></span>
<span class="line"><span style="color:#D19A66">        android:src</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/preview"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">FrameLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><strong>在MainActivity.java文件中实现拍照逻辑：</strong></p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> AppCompatActivity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#E5C07B"> Camera</span><span style="color:#E06C75"> camera</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic"> //定义一个摄像头对象</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#C678DD"> boolean</span><span style="color:#E06C75"> isPreview </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">//是否为预览状态，当前表示非预览状态</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#61AFEF">        getWindow</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">setFlags</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">WindowManager</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LayoutParams</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FLAG_FULLSCREEN</span><span style="color:#ABB2BF">, </span></span>
<span class="line"><span style="color:#E5C07B">                             WindowManager</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LayoutParams</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FLAG_FULLSCREEN</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //判断手机是否安装SD卡</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (</span><span style="color:#56B6C2">!</span><span style="color:#E5C07B">android</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">os</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Environment</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getExternalStorageState</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">equals</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#E5C07B">                Environment</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">MEDIA_MOUNTED</span><span style="color:#ABB2BF">)) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">            //提示安装SD卡</span></span>
<span class="line"><span style="color:#E5C07B">            Toast</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">makeText</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"请安装SD卡"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">                           Toast</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LENGTH_SHORT</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">show</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /*****************打开摄像头并预览****************/</span></span>
<span class="line"><span style="color:#E5C07B">        SurfaceView</span><span style="color:#E06C75"> surfaceView</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">surfaceView</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">        final</span><span style="color:#E5C07B"> SurfaceHolder</span><span style="color:#E06C75"> holder</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> surfaceView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getHolder</span><span style="color:#ABB2BF">(); </span><span style="color:#7F848E;font-style:italic">//获取SurfaceHolder</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //设置SurfaceView自己不维护缓冲</span></span>
<span class="line"><span style="color:#E5C07B">        holder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setType</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">SurfaceHolder</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">SURFACE_TYPE_PUSH_BUFFERS</span><span style="color:#ABB2BF">);    </span></span>
<span class="line"><span style="color:#E5C07B">        ImageButton</span><span style="color:#E06C75"> preview</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">preview</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        preview</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#ABB2BF"> (</span><span style="color:#56B6C2">!</span><span style="color:#ABB2BF">isPreview) {</span></span>
<span class="line"><span style="color:#ABB2BF">                    camera </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> Camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">open</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">                    isPreview </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> true</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#C678DD">                try</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">                    camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setPreviewDisplay</span><span style="color:#ABB2BF">(holder);   </span><span style="color:#7F848E;font-style:italic">//设置用于显示预览的SurfaceView</span></span>
<span class="line"><span style="color:#E5C07B">                    Camera</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Parameters</span><span style="color:#E06C75"> parameters</span><span style="color:#56B6C2"> =</span><span style="color:#E5C07B"> camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getParameters</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">//获取摄像头参数</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">                    parameters</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setPictureFormat</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">PixelFormat</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">JPEG</span><span style="color:#ABB2BF">);  </span><span style="color:#7F848E;font-style:italic">//设置图片为JPG图片</span></span>
<span class="line"><span style="color:#E5C07B">                    parameters</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">set</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"jpeg-quality"</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">80</span><span style="color:#ABB2BF">); </span><span style="color:#7F848E;font-style:italic">//设置图片质量</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">                    camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setParameters</span><span style="color:#ABB2BF">(parameters); </span><span style="color:#7F848E;font-style:italic">//重新设置摄像头参数</span></span>
<span class="line"><span style="color:#E5C07B">                    camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">startPreview</span><span style="color:#ABB2BF">();  </span><span style="color:#7F848E;font-style:italic">//开始预览</span></span>
<span class="line"><span style="color:#E5C07B">                    camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">autoFocus</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">null</span><span style="color:#ABB2BF">); </span><span style="color:#7F848E;font-style:italic">//设置自动对焦</span></span>
<span class="line"><span style="color:#ABB2BF">                } </span><span style="color:#C678DD">catch</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">IOException</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B">                    e</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">printStackTrace</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        ImageButton</span><span style="color:#E06C75"> takePhotos</span><span style="color:#56B6C2"> =</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">takephoto</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        takePhotos</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //实现拍照功能</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#ABB2BF"> (camera </span><span style="color:#56B6C2">!=</span><span style="color:#D19A66"> null</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B">                    camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">takePicture</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">null</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">null</span><span style="color:#ABB2BF">, jpeg); </span><span style="color:#7F848E;font-style:italic">//进行拍照</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    final</span><span style="color:#E5C07B"> Camera</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">PictureCallback</span><span style="color:#E06C75"> jpeg </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#E06C75"> Camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">PictureCallback</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75"> {</span></span>
<span class="line"><span style="color:#ABB2BF">        @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">        public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onPictureTaken</span><span style="color:#E06C75">(</span><span style="color:#C678DD">byte</span><span style="color:#E06C75">[] data</span><span style="color:#ABB2BF">,</span><span style="color:#E5C07B"> Camera</span><span style="color:#E06C75"> camera) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">            //根据拍照所得数据创建预览</span></span>
<span class="line"><span style="color:#E5C07B">            Bitmap</span><span style="color:#E06C75"> bitmap </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> BitmapFactory</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">decodeByteArray</span><span style="color:#ABB2BF">(data, </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">data</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">length</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">            camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stopPreview</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic">   //停止预览</span></span>
<span class="line"><span style="color:#E06C75">            isPreview </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">  //设置为非预览状态</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">            //获取SD卡中相片的位置</span></span>
<span class="line"><span style="color:#E5C07B">            File</span><span style="color:#E06C75"> appDir </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> File</span><span style="color:#E06C75">(</span><span style="color:#E5C07B">Environment</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getExternalStorageDirectory</span><span style="color:#ABB2BF">(),</span><span style="color:#98C379"> "/DCIM/Camera"</span><span style="color:#E06C75">)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">            if</span><span style="color:#E06C75"> (</span><span style="color:#56B6C2">!</span><span style="color:#E5C07B">appDir</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">exists</span><span style="color:#ABB2BF">()</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">                appDir</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">mkdir</span><span style="color:#ABB2BF">();</span><span style="color:#7F848E;font-style:italic"> //如果目录不存在就创建目录</span></span>
<span class="line"><span style="color:#E06C75">            }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">            //设置照片名称</span></span>
<span class="line"><span style="color:#E5C07B">            String</span><span style="color:#E06C75"> fileName </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> System</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF">()</span><span style="color:#56B6C2"> +</span><span style="color:#98C379"> ".jpg"</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B">            File</span><span style="color:#E06C75"> file </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> File</span><span style="color:#E06C75">(appDir</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> fileName)</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">  //创建文件对象</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">            try</span><span style="color:#E06C75"> {</span><span style="color:#7F848E;font-style:italic">//保存拍到的图片</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //创建文件输出流对象</span></span>
<span class="line"><span style="color:#E5C07B">                FileOutputStream</span><span style="color:#E06C75"> fos </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> FileOutputStream</span><span style="color:#E06C75">(file)</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //将图片内容压缩为JPEG格式输出</span></span>
<span class="line"><span style="color:#E5C07B">                bitmap</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">compress</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bitmap</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">CompressFormat</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">JPEG</span><span style="color:#ABB2BF">, </span><span style="color:#D19A66">100</span><span style="color:#ABB2BF">, fos);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //将缓冲区中的数据全部写出到输出流中</span></span>
<span class="line"><span style="color:#E5C07B">                fos</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">flush</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //关闭文件输出流对象</span></span>
<span class="line"><span style="color:#E5C07B">                fos</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">close</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75">            } </span><span style="color:#C678DD">catch</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">FileNotFoundException</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">                e</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">printStackTrace</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75">            } </span><span style="color:#C678DD">catch</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">IOException</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">                e</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">printStackTrace</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">            try</span><span style="color:#E06C75"> {   </span><span style="color:#7F848E;font-style:italic">//将照片插入到系统图库</span></span>
<span class="line"><span style="color:#E5C07B">                MediaStore</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Images</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Media</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">insertImage</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getContentResolver</span><span style="color:#ABB2BF">(),</span></span>
<span class="line"><span style="color:#E5C07B">                        file</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF">(), fileName, </span><span style="color:#D19A66">null</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75">            } </span><span style="color:#C678DD">catch</span><span style="color:#E06C75"> (</span><span style="color:#E5C07B">FileNotFoundException</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B">                e</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">printStackTrace</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">            //最后通知图库更新</span></span>
<span class="line"><span style="color:#E5C07B">            MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">sendBroadcast</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#61AFEF"> Intent</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Intent</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">ACTION_MEDIA_SCANNER_SCAN_FILE</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">                    Uri</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">parse</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"file://"</span><span style="color:#56B6C2"> +</span><span style="color:#98C379"> ""</span><span style="color:#ABB2BF">)));</span></span>
<span class="line"><span style="color:#E5C07B">            Toast</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">makeText</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"照片保存至"</span><span style="color:#56B6C2">+</span><span style="color:#ABB2BF">file, </span><span style="color:#E5C07B">Toast</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LENGTH_SHORT</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">show</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#61AFEF">            resetCamera</span><span style="color:#E06C75">()</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">//重新预览</span></span>
<span class="line"><span style="color:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75">    }</span><span style="color:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> resetCamera</span><span style="color:#ABB2BF">(){</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (</span><span style="color:#56B6C2">!</span><span style="color:#ABB2BF">isPreview){</span></span>
<span class="line"><span style="color:#E5C07B">            camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">startPreview</span><span style="color:#ABB2BF">();  </span><span style="color:#7F848E;font-style:italic">//开启预览</span></span>
<span class="line"><span style="color:#ABB2BF">            isPreview </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> true</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onPause</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onPause</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //停止预览并释放摄像头资源</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (camera </span><span style="color:#56B6C2">!=</span><span style="color:#D19A66"> null</span><span style="color:#ABB2BF">){</span></span>
<span class="line"><span style="color:#E5C07B">            camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stopPreview</span><span style="color:#ABB2BF">();   </span><span style="color:#7F848E;font-style:italic">//停止预览</span></span>
<span class="line"><span style="color:#E5C07B">            camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">release</span><span style="color:#ABB2BF">();   </span><span style="color:#7F848E;font-style:italic">//释放资源</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><mark>由于我们需要打开摄像头进行拍照还需要存放图片文件，因此我们需要进行权限设置。</mark></p>
<p><strong>在AndroidManifest.xml进行权限设置：</strong></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">manifest</span><span style="color:#ABB2BF"> ...&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    &lt;!--授予程序可以向SD卡中保存文件的权限--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-permission</span></span>
<span class="line"><span style="color:#D19A66">        android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.permission.MOUNT_UNMOUNT_FILESYSTEMS"</span></span>
<span class="line"><span style="color:#D19A66">        tools:ignore</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"ProtectedPermissions"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-permission</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.permission.WRITE_EXTERNAL_STORAGE"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    &lt;!--授予程序使用摄像头的权限--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-permission</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.permission.CAMERA"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-feature</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.hardware.camera.autofocus"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-feature</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.hardware.camera"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">application</span></span>
<span class="line"><span style="color:#D19A66">        android:requestLegacyExternalStorage</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"true"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">activity</span></span>
<span class="line"><span style="color:#D19A66">            android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">".MainActivity"</span></span>
<span class="line"><span style="color:#D19A66">            android:screenOrientation</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"fullSensor"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">               ...</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;/</span><span style="color:#E06C75">activity</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;/</span><span style="color:#E06C75">application</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">manifest</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><mark>除了在文件中进行权限设置外，我们在进行真机测试时打开本应用的相关权限（相机、读写手机存储等）。</mark></p>
<p><strong>不同的手机进行应用权限设置的方式不同</strong>，在此不再累述。</p>
<p><mark>什么？你说该怎么真机测试？那你接着看吧。</mark></p>
<h3 id="真机测试"><a class="header-anchor" href="#真机测试"></a>真机测试</h3>
<p>作者使用的Android Studio版本为3.6.3，真机测试选用MIX 2S作为测试设备。不同AS版本或不同测试设备在部分步骤上可能存在些许差异，请按情况自行处理。<mark>善用搜索引擎！</mark></p>
<ol>
<li>首先我们需要用数据线将我们的手机与电脑连接起来。</li>
<li>在Android Studio中进行如下操作：</li>
</ol>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/AndroidImages/%E7%9C%9F%E6%9C%BA%E6%B5%8B%E8%AF%951.png" alt="真机测试1"></p>
<ol start="3">
<li>完成第二步后我们可以看到在AS界面的右边出现一个名为“Troubleshoot device connection issues”的窗口，你只需要按照步骤完成即可。看不懂英文？好吧，我给你简述一下。
<ul>
<li>首先，AS会检测你的电脑是否已与手机连接成功，如果连接成功，点击窗口右下角的“Next”，进入第二步；</li>
<li>在第二步中你需要打开手机的“开发者选项”（不同的手机打开方式可能存在差异，可以按照窗口英文导航进行操作，也可以使用搜索引擎查询），然后进入“开发者选项”，打开“USB调试”、“USB安装”、“USB调试（安全设置）”等选项，然后点击窗口右下角的“Next”，进入最后一步；</li>
<li>如果你成功完成前两步，在这一步中基本不需要配置。到此，你已经成功连接了AS与你的手机，可以开始进行真机测试了。</li>
</ul>
</li>
<li>运行案例，在手机上完成安装，进入测试。</li>
</ol>
<p><mark>声明：不同的手机连接的方式不同，本笔记仅做参考，遇上无法解决的问题，请善用各种搜索引擎。</mark></p>
<h2 id="录制视频"><a class="header-anchor" href="#录制视频"></a>录制视频</h2>
<p><strong>控制摄像头录制视频步骤：</strong></p>
<ol>
<li>创建MediaRecorder对象，使用<code>setAudioSource()</code>设置声音来源；</li>
<li>使用<code>setOutputFormat()</code>设置输出文件的格式；</li>
<li>设置音频和视频的参数；</li>
<li>使用<code>setOutputFile()</code>设置保存位置；</li>
<li>使用<code>setPreviewDisplay()</code>设置显示预览的SurfaceView；</li>
<li>使用<code>prepare()</code>和<code>start()</code>开始录制视频，调用<code>stop()</code>方法停止录制，调用<code>release()</code>方法释放资源。</li>
</ol>
<p>我们将通过一个案例来进行步骤讲解。</p>
<blockquote>
<p>实现控制摄像头录制视频</p>
</blockquote>
<p><strong>准备：</strong> 我们需要准备两张图标资源来表示开始录像和结束录像，将它们分别命名为record和stop，然后我们需要将它们放置于res/drawable目录下。</p>
<p>**案例描述：**我们在真机上启动安装后，运行应用，然后点击“开始录像”图片按钮，打开手机摄像头，进行录像，录像完成后，点击“结束录像”保存录像文件。</p>
<p>本案例仅仅实现了基本的录像逻辑，<strong>使用了大量的过时的类与方法</strong>，因此<strong>本案例仅供参考</strong>，但本案例已经过测试，能够在Android 10的手机上（作者使用的是 MIX 2S 进行测试）进行运行。</p>
<p>==注意：本次案例需要用到真机测试和权限设置。==我会在案例中一步步给出。</p>
<p><strong>在布局资源文件activity_main.xml中完成基本界面布局：</strong></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">RelativeLayout</span><span style="color:#ABB2BF">  ...&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">SurfaceView</span></span>
<span class="line"><span style="color:#D19A66">        android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/surfaceView"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"match_parent"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">LinearLayout</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">        android:orientation</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"horizontal"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_alignParentBottom</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"true"</span></span>
<span class="line"><span style="color:#D19A66">        android:layout_centerHorizontal</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"true"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">ImageButton</span></span>
<span class="line"><span style="color:#D19A66">            android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/record"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_marginEnd</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"20dp"</span></span>
<span class="line"><span style="color:#D19A66">            android:src</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/record"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">ImageButton</span></span>
<span class="line"><span style="color:#D19A66">            android:id</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@+id/stop"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_width</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">            android:layout_height</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"wrap_content"</span></span>
<span class="line"><span style="color:#D19A66">            android:src</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"@drawable/stop"</span><span style="color:#ABB2BF">/&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;/</span><span style="color:#E06C75">LinearLayout</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">RelativeLayout</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><strong>在MainActivity.java文件中实现录像逻辑：</strong></p>
<figure class="highlight java line-numbers" data-language="JAVA">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;font-style:italic">//继承Activity，而不是AppCompatActivity</span></span>
<span class="line"><span style="color:#C678DD">public</span><span style="color:#C678DD"> class</span><span style="color:#E5C07B"> MainActivity</span><span style="color:#C678DD"> extends</span><span style="color:#E5C07B"> Activity</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#E5C07B"> ImageButton</span><span style="color:#E06C75"> stop</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> record</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#E5C07B"> SurfaceView</span><span style="color:#E06C75">  surfaceView</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#E5C07B"> File</span><span style="color:#E06C75"> videoFile</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic"> //视频文件</span></span>
<span class="line"><span style="color:#E5C07B">    MediaRecorder</span><span style="color:#E06C75"> mediaRecorder</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#E5C07B"> android</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">hardware</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Camera</span><span style="color:#E06C75"> camera</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#E5C07B"> Boolean</span><span style="color:#E06C75"> isRecord </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">   //记录录像状态</span></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onCreate</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Bundle</span><span style="color:#E06C75;font-style:italic"> savedInstanceState</span><span style="color:#ABB2BF">)</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onCreate</span><span style="color:#ABB2BF">(savedInstanceState);</span></span>
<span class="line"><span style="color:#61AFEF">        setContentView</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">layout</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">activity_main</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#61AFEF">        getWindow</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">setFlags</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">WindowManager</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LayoutParams</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FLAG_FULLSCREEN</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">                WindowManager</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LayoutParams</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">FLAG_FULLSCREEN</span><span style="color:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //判断手机是否安装SD卡</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (</span><span style="color:#56B6C2">!</span><span style="color:#E5C07B">android</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">os</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">Environment</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getExternalStorageState</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">equals</span><span style="color:#ABB2BF">(</span></span>
<span class="line"><span style="color:#E5C07B">                Environment</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">MEDIA_MOUNTED</span><span style="color:#ABB2BF">)) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">            //提示安装SD卡</span></span>
<span class="line"><span style="color:#E5C07B">            Toast</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">makeText</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"请安装SD卡"</span><span style="color:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B">                    Toast</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LENGTH_SHORT</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">show</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        /********************设置摄像头参数并开始录制视频***********************/</span></span>
<span class="line"><span style="color:#ABB2BF">        surfaceView </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">surfaceView</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //设置SurfaceView的分辨率</span></span>
<span class="line"><span style="color:#E5C07B">        surfaceView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getHolder</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">setFixedSize</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1920</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66">1080</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">        record </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">record</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF">        stop </span><span style="color:#56B6C2">=</span><span style="color:#61AFEF"> findViewById</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">R</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">id</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">stop</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        record</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#61AFEF">                record</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">        stop</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOnClickListener</span><span style="color:#ABB2BF">(</span><span style="color:#C678DD">new</span><span style="color:#ABB2BF"> View.</span><span style="color:#61AFEF">OnClickListener</span><span style="color:#ABB2BF">() {</span></span>
<span class="line"><span style="color:#ABB2BF">            @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">            public</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onClick</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">View</span><span style="color:#ABB2BF"> v) {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">                //停止录制，并提示视频保存位置</span></span>
<span class="line"><span style="color:#C678DD">                if</span><span style="color:#ABB2BF"> (isRecord){</span></span>
<span class="line"><span style="color:#E5C07B">                    mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stop</span><span style="color:#ABB2BF">();   </span><span style="color:#7F848E;font-style:italic">//停止录制</span></span>
<span class="line"><span style="color:#E5C07B">                    mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">release</span><span style="color:#ABB2BF">();    </span><span style="color:#7F848E;font-style:italic">//释放资源</span></span>
<span class="line"><span style="color:#ABB2BF">                    isRecord </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> false</span><span style="color:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B">                    Toast</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">makeText</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"录像保存在"</span><span style="color:#56B6C2">+</span><span style="color:#ABB2BF">videoFile, </span></span>
<span class="line"><span style="color:#E5C07B">                                   Toast</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LENGTH_SHORT</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">show</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    //录制视频的方法</span></span>
<span class="line"><span style="color:#C678DD">    private</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> record</span><span style="color:#ABB2BF">(){</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //视频保存的文件夹</span></span>
<span class="line"><span style="color:#E5C07B">        File</span><span style="color:#E06C75"> path</span><span style="color:#56B6C2"> =</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> File</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Environment</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getExternalStorageDirectory</span><span style="color:#ABB2BF">()</span><span style="color:#56B6C2">+</span><span style="color:#98C379">"/Myvideo/"</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD">        if</span><span style="color:#ABB2BF"> (</span><span style="color:#56B6C2">!</span><span style="color:#E5C07B">path</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">exists</span><span style="color:#ABB2BF">()){</span></span>
<span class="line"><span style="color:#E5C07B">            path</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">mkdir</span><span style="color:#ABB2BF">();   </span><span style="color:#7F848E;font-style:italic">//文件夹不存在时，创建文件夹</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#E5C07B">        String</span><span style="color:#E06C75"> fileName</span><span style="color:#56B6C2"> =</span><span style="color:#98C379"> "video.mp4"</span><span style="color:#ABB2BF">;</span><span style="color:#7F848E;font-style:italic">//视频文件名称</span></span>
<span class="line"><span style="color:#ABB2BF">        videoFile </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> File</span><span style="color:#ABB2BF">(path,fileName); </span><span style="color:#7F848E;font-style:italic">//视频文件</span></span>
<span class="line"><span style="color:#ABB2BF">        mediaRecorder </span><span style="color:#56B6C2">=</span><span style="color:#C678DD"> new</span><span style="color:#61AFEF"> MediaRecorder</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">        camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setDisplayOrientation</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">90</span><span style="color:#ABB2BF">);   </span><span style="color:#7F848E;font-style:italic">//调整摄像头角度</span></span>
<span class="line"><span style="color:#E5C07B">        camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">unlock</span><span style="color:#ABB2BF">();    </span><span style="color:#7F848E;font-style:italic">//解锁摄像头</span></span>
<span class="line"><span style="color:#E5C07B">        mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setCamera</span><span style="color:#ABB2BF">(camera);    </span><span style="color:#7F848E;font-style:italic">//使用摄像头</span></span>
<span class="line"><span style="color:#E5C07B">        mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">reset</span><span style="color:#ABB2BF">();  </span><span style="color:#7F848E;font-style:italic">//重置MediaRecorder</span></span>
<span class="line"><span style="color:#E5C07B">        mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setAudioSource</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">AudioSource</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">MIC</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//使用麦克风获取声音</span></span>
<span class="line"><span style="color:#E5C07B">        mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setVideoSource</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">VideoSource</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">CAMERA</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//使用摄像头获取图像</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //设置视频输出格式为MP4</span></span>
<span class="line"><span style="color:#E5C07B">        mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOutputFormat</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">OutputFormat</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">MPEG_4</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //设置声音编码格式</span></span>
<span class="line"><span style="color:#E5C07B">        mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setAudioEncoder</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">AudioEncoder</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">DEFAULT</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //设置视频编码格式</span></span>
<span class="line"><span style="color:#E5C07B">        mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setVideoEncoder</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">VideoEncoder</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">MPEG_4_SP</span><span style="color:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B">        mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setVideoEncodingBitRate</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1920</span><span style="color:#56B6C2">*</span><span style="color:#D19A66">1080</span><span style="color:#ABB2BF">);</span><span style="color:#7F848E;font-style:italic">//设置清晰度</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //mediaRecorder.setVideoSize(1920,1080);  //设置视频尺寸</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //mediaRecorder.setVideoFrameRate(10);  //设置每秒10帧</span></span>
<span class="line"><span style="color:#E5C07B">        mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOutputFile</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">videoFile</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF">());   </span><span style="color:#7F848E;font-style:italic">//设置视频的输出路径</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        //设置使用的SurfaceView</span></span>
<span class="line"><span style="color:#E5C07B">        mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setPreviewDisplay</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">surfaceView</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">getHolder</span><span style="color:#ABB2BF">().</span><span style="color:#61AFEF">getSurface</span><span style="color:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B">        mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">setOrientationHint</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">90</span><span style="color:#ABB2BF">);   </span><span style="color:#7F848E;font-style:italic">//调整播放视频的角度</span></span>
<span class="line"><span style="color:#C678DD">        try</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">            mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">prepare</span><span style="color:#ABB2BF">();    </span><span style="color:#7F848E;font-style:italic">//准备录像</span></span>
<span class="line"><span style="color:#ABB2BF">        } </span><span style="color:#C678DD">catch</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">IOException</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B">            e</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">printStackTrace</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#C678DD">        try</span><span style="color:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B">            mediaRecorder</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">start</span><span style="color:#ABB2BF">();  </span><span style="color:#7F848E;font-style:italic">//开始录像</span></span>
<span class="line"><span style="color:#ABB2BF">        } </span><span style="color:#C678DD">catch</span><span style="color:#ABB2BF"> (</span><span style="color:#E5C07B">IllegalStateException</span><span style="color:#E06C75;font-style:italic"> e</span><span style="color:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B">            e</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">printStackTrace</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#E5C07B">        Toast</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">makeText</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">MainActivity</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">this</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"开始录制"</span><span style="color:#ABB2BF">, </span><span style="color:#E5C07B">Toast</span><span style="color:#ABB2BF">.</span><span style="color:#E5C07B">LENGTH_SHORT</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">show</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        isRecord </span><span style="color:#56B6C2">=</span><span style="color:#D19A66"> true</span><span style="color:#ABB2BF">; </span><span style="color:#7F848E;font-style:italic">//正在录制</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onResume</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span><span style="color:#7F848E;font-style:italic">//当Activity获取焦点时</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onResume</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">        camera </span><span style="color:#56B6C2">=</span><span style="color:#E5C07B"> Camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">open</span><span style="color:#ABB2BF">(); </span><span style="color:#7F848E;font-style:italic">//开启摄像头</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    @</span><span style="color:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD">    protected</span><span style="color:#C678DD"> void</span><span style="color:#61AFEF"> onPause</span><span style="color:#ABB2BF">()</span><span style="color:#ABB2BF"> {</span><span style="color:#7F848E;font-style:italic">//当Activity失去焦点时</span></span>
<span class="line"><span style="color:#E5C07B">        super</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">onPause</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B">        camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">stopPreview</span><span style="color:#ABB2BF">();   </span><span style="color:#7F848E;font-style:italic">//停止预览</span></span>
<span class="line"><span style="color:#E5C07B">        camera</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">release</span><span style="color:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF">}</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><mark>由于我们需要打开摄像头进行录像还需要存放mp4文件，因此我们需要进行权限设置。</mark></p>
<p><strong>在AndroidManifest.xml进行权限设置：</strong></p>
<figure class="highlight xml line-numbers" data-language="XML">
        <table style="background-color: #282c34"><tbody><tr><td class="gutter" style="background-color: #282c34"><pre style="background-color: #282c34"><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code" style="background-color: #282c34"><pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF">&lt;</span><span style="color:#E06C75">manifest</span><span style="color:#ABB2BF"> ...&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    &lt;!--授予程序录制声音的权限--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-permission</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.permission.RECORD_AUDIO"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    &lt;!--授予程序使用摄像头的权限--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-permission</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.permission.CAMERA"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-permission</span></span>
<span class="line"><span style="color:#D19A66">        android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.permission.MOUNT_UNMOUNT_FILESYSTEMS"</span></span>
<span class="line"><span style="color:#D19A66">        tools:ignore</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"ProtectedPermissions"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    &lt;!--授予使用外部储存器的权限--&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">uses-permission</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"android.permission.WRITE_EXTERNAL_STORAGE"</span><span style="color:#ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;</span><span style="color:#E06C75">application</span><span style="color:#ABB2BF"> ...</span></span>
<span class="line"><span style="color:#D19A66">        android:requestLegacyExternalStorage</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">"true"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;</span><span style="color:#E06C75">activity</span><span style="color:#D19A66"> android:name</span><span style="color:#ABB2BF">=</span><span style="color:#98C379">".MainActivity"</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">            ...</span></span>
<span class="line"><span style="color:#ABB2BF">        &lt;/</span><span style="color:#E06C75">activity</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">    &lt;/</span><span style="color:#E06C75">application</span><span style="color:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF">&lt;/</span><span style="color:#E06C75">manifest</span><span style="color:#ABB2BF">&gt;</span></span></code></pre></td></tr></tbody></table>
      </figure>
<p><mark>除了在文件中进行权限设置外，我们在进行真机测试时打开本应用的相关权限（相机、读写手机存储等）。</mark></p>
<p><strong>不同的手机进行应用权限设置的方式不同</strong>，在此不再累述。</p>
<p>至于真机测试方法，参考 <strong>多媒体应用开发</strong> 中的 <mark>控制摄像头拍照 ——真机测试</mark>。</p>
<hr>
<p>​																				<mark>Android图像处理和多媒体完</mark></p>
</body></html></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mofan212.github.io">默烦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mofan212.github.io/posts/Android-4/">https://mofan212.github.io/posts/Android-4/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://mofan212.github.io" target="_blank">Mofan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a></div><div class="post-share"><div class="social-share" data-image="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/18.jpg" data-sites="wechat,qq,weibo,facebook,x"></div><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" target="_blank"><img class="post-qr-code-img" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" target="_blank"><img class="post-qr-code-img" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/Android-6/" title="Android传感器与LBS（六）"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/6.jpg" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Android传感器与LBS（六）</div></div><div class="info-2"><div class="info-item-1">本文介绍了磁场传感器、加速度传感器、方向传感器的使用，如何实现基于百度地图位置服务。</div></div></div></a><a class="pagination-related" href="/posts/Android-1/" title="Android布局与组件（一）"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/11.jpg" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Android布局与组件（一）</div></div><div class="info-2"><div class="info-item-1">本文对 Android 的 UI 布局、基本 UI 组件、高级 UI 组件进行了介绍。</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/Android-2/" title="Android核心与事件处理（二）"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/5.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-29</div><div class="info-item-2">Android核心与事件处理（二）</div></div><div class="info-2"><div class="info-item-1">本文重点介绍了基本程序单元 Activity 和应用核心 Intent 的基本使用。</div></div></div></a><a class="pagination-related" href="/posts/Android-5/" title="Android数据存储、Handler与Service（五）"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/4.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-29</div><div class="info-item-2">Android数据存储、Handler与Service（五）</div></div><div class="info-2"><div class="info-item-1">本文介绍了 Android 中的数据存储技术，并对轻量级数据库 SQLite 进行了简单的介绍使用。</div></div></div></a><a class="pagination-related" href="/posts/Android-6/" title="Android传感器与LBS（六）"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/6.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-29</div><div class="info-item-2">Android传感器与LBS（六）</div></div><div class="info-2"><div class="info-item-1">本文介绍了磁场传感器、加速度传感器、方向传感器的使用，如何实现基于百度地图位置服务。</div></div></div></a><a class="pagination-related" href="/posts/Android-3/" title="Android资源、活动条与消息通知（三）"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/17.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-29</div><div class="info-item-2">Android资源、活动条与消息通知（三）</div></div><div class="info-2"><div class="info-item-1">本文介绍了对Android各种资源的创建与使用、Action Bar的使用、消息、通知与广播的使用进行了介绍。</div></div></div></a><a class="pagination-related" href="/posts/Android-1/" title="Android布局与组件（一）"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/11.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-29</div><div class="info-item-2">Android布局与组件（一）</div></div><div class="info-2"><div class="info-item-1">本文对 Android 的 UI 布局、基本 UI 组件、高级 UI 组件进行了介绍。</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">默烦</div><div class="author-info-description">彩笔的打怪升级之路...</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">174</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">54</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mofan212"><i class="fab fa-github"></i><span>follow me</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:cy.mofan@foxmail.com" target="_blank" title="邮箱"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本站所有博文均是博主的学习笔记与个人理解。<strong><font style="color:red">除特别注明外，</font>如需转载，请在文章头部醒目处附带原文链接并<a href="./mine/" style="color:#49B1F5;text-decoration:underline">告知我</a></strong>你将转载。😊</br><strong><font style="color:red">严禁未遵循规范的转载。</font></strong>😡</br><strong>死去的评论系统复活啦！欢迎到留言板畅所欲言！</strong>当然也可以使用更高效的<a target="_blank" href="https://space.bilibili.com/23658864/dynamic" style="color:#49B1F5;text-decoration:underline"> 哔哩哔哩私信 </a>或<a href="mailto:cy.mofan@foxmail.com" style="color:#49B1F5;text-decoration:underline" target="_blank">邮箱</a>。 😉</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E6%8A%80%E6%9C%AF"><span class="toc-number">1.</span> <span class="toc-text">图形图像处理技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%BB%E7%AC%94%E5%92%8C%E7%94%BB%E5%B8%83"><span class="toc-number">1.1.</span> <span class="toc-text">画笔和画布</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2"><span class="toc-number">1.2.</span> <span class="toc-text">绘制几何图形</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E6%96%87%E6%9C%AC"><span class="toc-number">1.3.</span> <span class="toc-text">绘制文本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E5%9B%BE%E7%89%87"><span class="toc-number">1.4.</span> <span class="toc-text">绘制图片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E8%B7%AF%E5%BE%84"><span class="toc-number">1.5.</span> <span class="toc-text">绘制路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%90%E5%B8%A7%E5%8A%A8%E7%94%BB"><span class="toc-number">1.6.</span> <span class="toc-text">逐帧动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E9%97%B4%E5%8A%A8%E7%94%BB"><span class="toc-number">1.7.</span> <span class="toc-text">补间动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%B7%A1%E5%85%A5%E3%80%81%E6%B7%A1%E5%87%BA%E8%A1%A5%E9%97%B4%E5%8A%A8%E7%94%BB"><span class="toc-number">1.8.</span> <span class="toc-text">实现淡入、淡出补间动画</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E5%AA%92%E4%BD%93%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91"><span class="toc-number">2.</span> <span class="toc-text">多媒体应用开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9F%B3%E9%A2%91%E2%80%94%E2%80%94%E4%BD%BF%E7%94%A8MediaPlayer%E6%92%AD%E6%94%BE"><span class="toc-number">2.1.</span> <span class="toc-text">音频——使用MediaPlayer播放</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E7%AE%80%E6%98%93%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8"><span class="toc-number">2.2.</span> <span class="toc-text">制作简易音乐播放器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9F%B3%E9%A2%91%E2%80%94%E2%80%94%E4%BD%BF%E7%94%A8SoundPool%E6%92%AD%E6%94%BE"><span class="toc-number">2.3.</span> <span class="toc-text">音频——使用SoundPool播放</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E2%80%94%E2%80%94%E4%BD%BF%E7%94%A8VideoView%E6%92%AD%E6%94%BE"><span class="toc-number">2.4.</span> <span class="toc-text">视频——使用VideoView播放</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E2%80%94%E2%80%94%E4%BD%BF%E7%94%A8MediaPlayer%E5%92%8CSurfaceView%E6%92%AD%E6%94%BE"><span class="toc-number">2.5.</span> <span class="toc-text">视频——使用MediaPlayer和SurfaceView播放</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%91%84%E5%83%8F%E5%A4%B4%E6%8B%8D%E7%85%A7"><span class="toc-number">2.6.</span> <span class="toc-text">控制摄像头拍照</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%9F%E6%9C%BA%E6%B5%8B%E8%AF%95"><span class="toc-number">2.6.1.</span> <span class="toc-text">真机测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%95%E5%88%B6%E8%A7%86%E9%A2%91"><span class="toc-number">2.7.</span> <span class="toc-text">录制视频</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Git/" title="Git理论与使用"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/3.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Git理论与使用"/></a><div class="content"><a class="title" href="/posts/Git/" title="Git理论与使用">Git理论与使用</a><time datetime="2026-01-26T16:00:00.000Z" title="更新于 2026-01-27 00:00:00">2026-01-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Something-About-Blog/" title="博客搭建与维护"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/42.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="博客搭建与维护"/></a><div class="content"><a class="title" href="/posts/Something-About-Blog/" title="博客搭建与维护">博客搭建与维护</a><time datetime="2026-01-24T16:00:00.000Z" title="更新于 2026-01-25 00:00:00">2026-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Memory-Model/" title="Java 内存模型"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/174.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java 内存模型"/></a><div class="content"><a class="title" href="/posts/Java-Memory-Model/" title="Java 内存模型">Java 内存模型</a><time datetime="2026-01-02T16:00:00.000Z" title="更新于 2026-01-03 00:00:00">2026-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Bytecode-And-Class-Loading/" title="字节码与类加载"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/173.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="字节码与类加载"/></a><div class="content"><a class="title" href="/posts/Java-Bytecode-And-Class-Loading/" title="字节码与类加载">字节码与类加载</a><time datetime="2026-01-01T16:00:00.000Z" title="更新于 2026-01-02 00:00:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Annotation-And-Reflection/" title="注解、类的加载、反射"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/20.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="注解、类的加载、反射"/></a><div class="content"><a class="title" href="/posts/Annotation-And-Reflection/" title="注解、类的加载、反射">注解、类的加载、反射</a><time datetime="2026-01-01T16:00:00.000Z" title="更新于 2026-01-02 00:00:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Class-Resource-Loading-In-Java/" title="Java 的类资源加载"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/103.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java 的类资源加载"/></a><div class="content"><a class="title" href="/posts/Class-Resource-Loading-In-Java/" title="Java 的类资源加载">Java 的类资源加载</a><time datetime="2026-01-01T16:00:00.000Z" title="更新于 2026-01-02 00:00:00">2026-01-02</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2020 - 2026 By 默烦</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.4</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><script src="https://testingcf.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://testingcf.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://testingcf.jsdelivr.net/npm/vanilla-lazyload@latest/dist/lazyload.iife.min.js"></script><script src="https://testingcf.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const parseViewBox = viewBox => {
    if (!viewBox) return null
    const parts = viewBox.trim().split(/[\s,]+/).map(n => Number(n))
    if (parts.length !== 4 || parts.some(n => Number.isNaN(n))) return null
    return parts
  }

  const getSvgViewBox = svg => {
    const attr = parseViewBox(svg.getAttribute('viewBox'))
    if (attr) return attr

    // Fallback: use bbox to build a viewBox
    try {
      const bbox = svg.getBBox()
      if (bbox && bbox.width && bbox.height) return [bbox.x, bbox.y, bbox.width, bbox.height]
    } catch (e) {
      // getBBox may fail on some edge cases; ignore
    }

    const w = Number(svg.getAttribute('width')) || 0
    const h = Number(svg.getAttribute('height')) || 0
    if (w > 0 && h > 0) return [0, 0, w, h]
    return [0, 0, 100, 100]
  }

  const setSvgViewBox = (svg, vb) => {
    svg.setAttribute('viewBox', `${vb[0]} ${vb[1]} ${vb[2]} ${vb[3]}`)
  }

  const clamp = (v, min, max) => Math.max(min, Math.min(max, v))

  const openSvgInNewTab = ({ source, initViewBox }) => {
    const getClonedSvg = () => {
      if (typeof source === 'string') {
        const template = document.createElement('template')
        template.innerHTML = source.trim()
        const svg = template.content.querySelector('svg')
        return svg ? svg.cloneNode(true) : null
      }
      if (source && typeof source.cloneNode === 'function') {
        return source.cloneNode(true)
      }
      return null
    }

    const clone = getClonedSvg()
    if (!clone) return
    if (initViewBox && initViewBox.length === 4) {
      clone.setAttribute('viewBox', initViewBox.join(' '))
    }
    if (!clone.getAttribute('xmlns')) clone.setAttribute('xmlns', 'http://www.w3.org/2000/svg')
    if (!clone.getAttribute('xmlns:xlink') && clone.outerHTML.includes('xlink:')) {
      clone.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink')
    }
    // inject background to match current theme
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark'
    const bg = getComputedStyle(document.body).backgroundColor || (isDark ? '#1e1e1e' : '#ffffff')
    if (!clone.style.background) clone.style.background = bg

    const serializer = new XMLSerializer()
    const svgSource = serializer.serializeToString(clone)
    const htmlSource = `<!doctype html><html><head><meta charset="utf-8" />
      <style>
        html, body { width: 100%; height: 100%; margin: 0; display: flex; align-items: center; justify-content: center; background: ${bg}; }
        svg { max-width: 100%; max-height: 100%; height: auto; width: auto; }
      </style>
      </head><body>${svgSource}</body></html>`
    const blob = new Blob([htmlSource], { type: 'text/html;charset=utf-8' })
    const url = URL.createObjectURL(blob)
    window.open(url, '_blank', 'noopener')
    setTimeout(() => URL.revokeObjectURL(url), 30000)
  }

  const attachMermaidViewerButton = wrap => {
    let btn = wrap.querySelector('.mermaid-open-btn')
    if (!btn) {
      btn = document.createElement('button')
      btn.type = 'button'
      btn.className = 'mermaid-open-btn'
      wrap.appendChild(btn)
    }

    btn.innerHTML = '<i class="fa fa-search fa-fw" aria-hidden="true"></i>'

    if (!btn.__mermaidViewerBound) {
      btn.addEventListener('click', e => {
        e.preventDefault()
        e.stopPropagation()
        const svg = wrap.__mermaidOriginalSvg || wrap.querySelector('svg')
        if (!svg) return
        const initViewBox = wrap.__mermaidInitViewBox
        if (typeof svg === 'string') {
          openSvgInNewTab({ source: svg, initViewBox })
          return
        }
        openSvgInNewTab({ source: svg, initViewBox })
      })
      btn.__mermaidViewerBound = true
    }
  }

  // Zoom around a point (px, py) in the SVG viewport (in viewBox coordinates)
  const zoomAtPoint = (vb, factor, px, py) => {
    const w = vb[2] * factor
    const h = vb[3] * factor
    const nx = px - (px - vb[0]) * factor
    const ny = py - (py - vb[1]) * factor
    return [nx, ny, w, h]
  }

  const initMermaidGestures = wrap => {
    const svg = wrap.querySelector('svg')
    if (!svg) return

    // Ensure viewBox exists so gestures always work
    const initVb = getSvgViewBox(svg)
    wrap.__mermaidInitViewBox = initVb
    wrap.__mermaidCurViewBox = initVb.slice()
    setSvgViewBox(svg, initVb)

    // Avoid binding multiple times on themeChange/pjax
    if (wrap.__mermaidGestureBound) return
    wrap.__mermaidGestureBound = true

    // Helper: map client (viewport) coordinate -> viewBox coordinate
    const clientToViewBox = (clientX, clientY) => {
      const rect = svg.getBoundingClientRect()
      const vb = wrap.__mermaidCurViewBox || getSvgViewBox(svg)
      const x = vb[0] + (clientX - rect.left) * (vb[2] / rect.width)
      const y = vb[1] + (clientY - rect.top) * (vb[3] / rect.height)
      return { x, y, rect, vb }
    }

    const state = {
      pointers: new Map(),
      startVb: null,
      startDist: 0,
      startCenter: null
    }

    const clampVb = vb => {
      const init = wrap.__mermaidInitViewBox || vb
      const minW = init[2] * 0.1
      const maxW = init[2] * 10
      const minH = init[3] * 0.1
      const maxH = init[3] * 10
      vb[2] = clamp(vb[2], minW, maxW)
      vb[3] = clamp(vb[3], minH, maxH)
      return vb
    }

    const setCurVb = vb => {
      vb = clampVb(vb)
      wrap.__mermaidCurViewBox = vb
      setSvgViewBox(svg, vb)
    }

    const onPointerDown = e => {
      // Allow only primary button for mouse
      if (e.pointerType === 'mouse' && e.button !== 0) return
      svg.setPointerCapture(e.pointerId)
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      if (state.pointers.size === 1) {
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      } else if (state.pointers.size === 2) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        state.startDist = Math.hypot(dx, dy)
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        state.startCenter = { x: (pts[0].x + pts[1].x) / 2, y: (pts[0].y + pts[1].y) / 2 }
      }
    }

    const onPointerMove = e => {
      if (!state.pointers.has(e.pointerId)) return
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      // Pan with 1 pointer
      if (state.pointers.size === 1 && state.startVb) {
        const p = [...state.pointers.values()][0]
        const prev = { x: e.clientX - e.movementX, y: e.clientY - e.movementY }
        // movementX/Y unreliable on touch, compute from stored last position
        const last = wrap.__mermaidLastSinglePointer || p
        const dxClient = p.x - last.x
        const dyClient = p.y - last.y
        wrap.__mermaidLastSinglePointer = p

        const { rect } = clientToViewBox(p.x, p.y)
        const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        const dx = dxClient * (vb[2] / rect.width)
        const dy = dyClient * (vb[3] / rect.height)
        setCurVb([vb[0] - dx, vb[1] - dy, vb[2], vb[3]])
        return
      }

      // Pinch zoom with 2 pointers
      if (state.pointers.size === 2 && state.startVb && state.startDist > 0) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        const dist = Math.hypot(dx, dy)
        if (!dist) return
        const factor = state.startDist / dist // dist bigger => zoom in (viewBox smaller)

        const cx = (pts[0].x + pts[1].x) / 2
        const cy = (pts[0].y + pts[1].y) / 2
        const centerClient = { x: cx, y: cy }

        const pxy = clientToViewBox(centerClient.x, centerClient.y)
        const cpx = pxy.x
        const cpy = pxy.y

        const vb = zoomAtPoint(state.startVb, factor, cpx, cpy)
        setCurVb(vb)
      }
    }

    const onPointerUpOrCancel = e => {
      state.pointers.delete(e.pointerId)
      if (state.pointers.size === 0) {
        state.startVb = null
        state.startDist = 0
        state.startCenter = null
        wrap.__mermaidLastSinglePointer = null
      } else if (state.pointers.size === 1) {
        // reset single pointer baseline to avoid jump
        wrap.__mermaidLastSinglePointer = [...state.pointers.values()][0]
      }
    }

    // Wheel zoom (mouse/trackpad)
    const onWheel = e => {
      // ctrlKey on mac trackpad pinch; we treat both as zoom
      e.preventDefault()
      const delta = e.deltaY
      const zoomFactor = delta > 0 ? 1.1 : 0.9
      const { x, y } = clientToViewBox(e.clientX, e.clientY)
      const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      setCurVb(zoomAtPoint(vb, zoomFactor, x, y))
    }

    const onDblClick = () => {
      const init = wrap.__mermaidInitViewBox
      if (!init) return
      wrap.__mermaidCurViewBox = init.slice()
      setSvgViewBox(svg, init)
    }

    svg.addEventListener('pointerdown', onPointerDown)
    svg.addEventListener('pointermove', onPointerMove)
    svg.addEventListener('pointerup', onPointerUpOrCancel)
    svg.addEventListener('pointercancel', onPointerUpOrCancel)
    svg.addEventListener('wheel', onWheel, { passive: false })
    svg.addEventListener('dblclick', onDblClick)
  }

  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild

      // Clear old render (themeChange/pjax will rerun)
      const oldSvg = item.querySelector('svg')
      if (oldSvg) oldSvg.remove()
      item.__mermaidGestureBound = false

      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
        if (true) initMermaidGestures(item)
        item.__mermaidOriginalSvg = svg
        if (true) attachMermaidViewerButton(item)
      }


      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://gcore.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources@master/js/mine.min.js"></script><script src="/js/tip_portal.js"></script><script defer="defer" id="ribbon" src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="click-show-text" src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Azathoth,Yog-Sothoth,Shub-Niggurath,Nyarlathotep,Cthulhu,Hastur,Abhoth,Ghroth,Tsathoggua,Cthugha,Deep Ones,Dagon,Chaugnar Faugn,Mordiggian,Shoggoth,Old One,Mi-Go,Great Race of Yith,Flying Polyp,Hounds of Tindalos,Dhole" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@docsearch/css/dist/style.min.css"/><script src="https://testingcf.jsdelivr.net/npm/@docsearch/js/dist/umd/index.min.js"></script><script>(() => {
  docsearch(Object.assign({
    appId: 'BAFEL7A6K1',
    apiKey: '89fcb5961984c5c054bf04149f345f38',
    indexName: 'mofan212io',
    container: '#docsearch',
    placeholder: '输入关键字进行搜索',
  }, null))

  const handleClick = () => {
    document.querySelector('.DocSearch-Button').click()
  }

  const searchClickFn = () => {
    btf.addEventListenerPjax(document.querySelector('#search-button > .search'), 'click', handleClick)
  }

  searchClickFn()
  window.addEventListener('pjax:complete', searchClickFn)
})()</script></div></div></body></html>