<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>注解、类的加载、反射 | Mofan</title><meta name="author" content="默烦,cy.mofan@foxmail.com"><meta name="copyright" content="默烦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文从 Java 注解出发，介绍了类的加载、类初始化、类加载器以及反射的简单使用">
<meta property="og:type" content="article">
<meta property="og:title" content="注解、类的加载、反射">
<meta property="og:url" content="https://mofan212.github.io/posts/Annotation-And-Reflection/index.html">
<meta property="og:site_name" content="Mofan">
<meta property="og:description" content="本文从 Java 注解出发，介绍了类的加载、类初始化、类加载器以及反射的简单使用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/20.jpg">
<meta property="article:published_time" content="2020-05-31T16:00:00.000Z">
<meta property="article:modified_time" content="2024-06-26T16:00:00.000Z">
<meta property="article:author" content="默烦">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/20.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://mofan212.github.io/posts/Annotation-And-Reflection/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"距离本文上次更新已经过去","messageNext":"天，请注意时效性。"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 默烦","link":"链接: ","source":"来源: Mofan","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '注解、类的加载、反射',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-27 00:00:00'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="https://jsd.proxy.aks.moe/gh/mofan212/blog-static-resources@master/css/myStyle.min.css"><link rel="stylesheet" href="https://cdn.staticfile.net/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css" /><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="Mofan" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="https://jsd.proxy.aks.moe/gh/mofan212/blog-static-resources/css/fill-left.min.css"/><script src="https://jsd.proxy.aks.moe/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">150</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/post_top_img.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Mofan"><span class="site-name">Mofan</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">注解、类的加载、反射</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-05-31T16:00:00.000Z" title="发表于 2020-06-01 00:00:00">2020-06-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-26T16:00:00.000Z" title="更新于 2024-06-27 00:00:00">2024-06-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="注解、类的加载、反射"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>封面来源：本文封面来源于网络，如有侵权，请联系删除。</p>
<blockquote>
<p>本文 JDK 版本为 JDK 17</p>
</blockquote>
<h1 id="1-注解"><a class="header-anchor" href="#1-注解"></a>1. 注解</h1>
<h2 id="1-1-自定义注解"><a class="header-anchor" href="#1-1-自定义注解"></a>1.1 自定义注解</h2>
<p>使用 <code>@interface</code> 自定义注解，就会自动继承 <code>java.lang.annotation.Annotation</code> 接口。</p>
<p><code>@interface</code> 可以用来声明一个注解，格式：<code>public @interface 注解名 &#123;定义内容&#125;</code>。注解中每一个方法表示声明了一个配置参数，而方法的名称就是参数的名称，返回值类型就是参数的类型（返回值只能是基本类型、Class、String 和 enum），并且可以通过 <code>default</code> 关键词来声明参数的默认值。如果只有一个参数成员，一般参数名为 value。</p>
<p>注解元素必须要有值。定义注解元素时，经常使用空字符串或 0 作为默认值。</p>
<h2 id="1-2-元注解"><a class="header-anchor" href="#1-2-元注解"></a>1.2 元注解</h2>
<p>元注解的作用就是负责注解其他注解，Java 定义了 4 个标准的元注解（meta-annotation）类型，它们被用来提供对其它注解（annotation）类型作说明。</p>
<p>这四个元注解位于 <code>java.lang.annotation</code> 包中，它们分别是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span> <span class="comment">// 用于描述注解的使用范围</span></span><br><span class="line"><span class="meta">@Retention</span> <span class="comment">// 表示需要在什么级别保存该注解信息，用于表述注解的生命周期。SOURCE &lt; CLASS &lt; RUNTIME</span></span><br><span class="line"><span class="meta">@Documented</span> <span class="comment">// 说明该注解将被包含在 javadoc 中</span></span><br><span class="line"><span class="meta">@Inherited</span> <span class="comment">// 说明子类可以继承父类中的该注解</span></span><br></pre></td></tr></table></figure>
<h1 id="2-类的加载"><a class="header-anchor" href="#2-类的加载"></a>2. 类的加载</h1>
<h2 id="2-1-类的加载"><a class="header-anchor" href="#2-1-类的加载"></a>2.1 类的加载</h2>
<blockquote>
<p>类的加载</p>
</blockquote>
<p>将 Class 文件字节码内容加载到内存中，并将这些静态数据转换成方法区的运行时数据结构，然后生成一个代表这个类的 <code>java.lang.Class</code> 对象。</p>
<blockquote>
<p>类的连接</p>
</blockquote>
<p>类的连接是指将 Java 类的二进制代码合并到 JVM 的运行状态之中的过程。主要分为三步，分别是验证、准备和解析。</p>
<ol>
<li>验证：确保加载的类信息符合 JVM 规范，即加载的 Class 文件的格式是否正确。</li>
<li>准备：正式为类的静态变量（static）分配内存并为其设置默认初始值的阶段。</li>
<li>解析：虚拟机常量池内的符号引用（变量名）替换为直接引用（地址）的过程。</li>
</ol>
<blockquote>
<p>类的初始化</p>
</blockquote>
<p>类的初始化就是执行类构造器 <code>&lt;clinit&gt;()</code> 方法的过程。类构造器 <code>&lt;clinit&gt;()</code> 方法是由编译期自动收集类中所有类变量的赋值动作和静态代码块中的语句合并产生的（类构造器是构造类信息的，不是构造该类对象的构造器）。</p>
<p>当初始化一个类时，如果发现其父类还没有进行初始化，则需要先触发其父类的初始化。</p>
<p>虚拟机会保证一个类的 <code>&lt;clinit&gt;()</code> 方法在多线程环境中被正确加锁和同步。</p>
<h2 id="2-2-类初始化"><a class="header-anchor" href="#2-2-类初始化"></a>2.2 类初始化</h2>
<p><strong>类的主动引用一定会发生类的初始化。</strong> 比如：</p>
<ol>
<li>当虚拟机启动时，初始化 <code>main()</code> 方法所在的类；</li>
<li><code>new</code> 一个对象；</li>
<li>调用类的静态成员（final 常量除外）和静态方法；</li>
<li>使用 <code>java.lang.reflect</code> 包中的方法对类进行反射调用；</li>
<li>初始化一个类时，如果其父类没有被初始化，则会先初始化它的父类。</li>
</ol>
<p><strong>类的被动引用不会发生类的初始化。</strong> 比如：</p>
<ol>
<li>当访问一个静态域时，只有真正声明这个域的类才会被初始化。如：当通过子类引用父类的静态变量，不会导致子类初始化；</li>
<li>通过数组定义类引用，不会触发此类的初始化；</li>
<li>引用常量不会触发其所在类的初始化（常量在连接阶段就存入调用类的常量池中了）。</li>
</ol>
<h2 id="2-3-类加载器"><a class="header-anchor" href="#2-3-类加载器"></a>2.3 类加载器</h2>
<blockquote>
<p>类加载器</p>
</blockquote>
<p>类加载器（ClassLoader）的作用：将 class 文件字节码内容加载到内存中，并将这些静态数据转换成方法区的运行时数据结构，然后在堆中生成一个代表这个类的 <code>java.lang.Class</code> 对象，作为方法区中类数据的访问入口。</p>
<p>简单来说，类的加载阶段有这样一个动作：通过一个类的全限定名来获取描述此类的二进制字节流。这个动作放到了 Java 虚拟机外部实现，以便让应用程序自己决定如何去获取所需要的类，而实现这个动作的代码模块就叫做类加载器。</p>
<p>类加载器在 Java 程序中起到的作用不局限于类加载阶段。为了确定任意一个类在 JVM 中的唯一性，除了这个类本身以外，还需要加上加载这个类的类加载器作为依据。每一个类加载器，都拥有一个独立的类命名空间。</p>
<p>也就是说，要判断两个类是否相等，只有在这两个类都是由同一个类加载器加载的前提下才有意义。因此就算是两个来自于同一 class 文件，被同一个虚拟机加载的类，但加载它们的类加载器不同，那也不能认为这两个类相等。这里的“相等”不仅仅指使用 <code>equals()</code> 方法比较，还包括 <code>isAssignableFrom()</code> 方法和 <code>isInstance()</code> 方法的返回结果，以及使用 <code>instanceof</code> 关键字进行判断。</p>
<hr>
<p>拓展：<code>Class#isAssignableFrom()</code> 方法与 <code>instanceof</code> 关键词的使用。</p>
<p><code>Class#isAssignableFrom()</code> 方法用于判断某个类是否是另一个类的父类，<code>instanceof</code> 关键词用于判断某个实例是否是某个父类类型。</p>
<p>使用方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">父类.class.isAssignableFrom(子类.class)</span><br><span class="line"></span><br><span class="line">子类实例 <span class="keyword">instanceof</span> 父类类型</span><br></pre></td></tr></table></figure>
<blockquote>
<p>类加载器的种类</p>
</blockquote>
<p>1、启动类加载器（Bootstrap ClassLoader），或者说引导类加载器、根加载器。这个类加载器由 C++ 编写，是 JVM 自带的类加载器（是 JVM 的一部分）。</p>
<p>2、其他的类加载器。这些类加载器由 Java 语言实现，不在 JVM 中，并且都继承自 <code>java.lang.ClassLoader</code>。</p>
<blockquote>
<p>几个系统级别的类加载器</p>
</blockquote>
<ul>
<li>启动类加载器（类加载器的种类中的第一种）：这个类加载器负责将存放在 <code>$&#123;JAVA_HONE&#125;\lib</code> <strong>目录中</strong>，或者被 <code>-XbootstrapPath</code> 参数所指定的 <strong>目录中</strong>，并且是虚拟机 <strong>基于一定规则</strong>（如文件名称规则，如 rt.jar）标识的 <strong>类库</strong> 加载到虚拟机内存中。该加载器无法通过 Java 程序直接获取，如果想委派到启动类加载器只需直接使用 <code>null</code> 替代即可（后面会说）。</li>
<li>扩展类加载器（Extension ClassLoader）：该类加载器由 <code>sun.misc.Launcher</code> 的静态嵌套类 <code>ExtClassLoader</code> 实现。它负责将 <code>$&#123;JAVA_HONE&#125;\lib\ext</code> 目录下或通过 <code>-Djava.ext.dirs</code> 参数指定的目录下的所有类库装入工作库。开发者可以直接使用此加载器。Java 9 移除了拓展机制，ExtClassLoader 被 PlatformClassLoader 取代，PlatformClassLoader 主要用于加载 Java 平台模块中的类，包括 <code>java.sql</code>、<code>java.xml</code> 中的类。</li>
<li>应用程序类加载器（Application ClassLoader）：该类加载器由 <code>sun.misc.Launcher</code> 的静态嵌套类 <code>AppClassLoader</code> 实现，由于该类加载器的实例是 <code>ClassLoader</code> 中静态方法 <code>getSystemClassLoader()</code> 中的返回值，因此这个类加载器也被成为 <strong>系统类加载器</strong>。它负责加载用户类路径（ClassPath）或 <code>-Djava.class.path</code> 所指的目录下的所有类库装入工作库，是最常用的加载器。开发者也可以直接使用此加载器。如果程序中没有自定义类加载器，一般情况下该类加载器就是程序中默认使用的类加载器。</li>
<li>线程上下文类加载器（Thread Context ClassLoader）：后面再说。 😉</li>
</ul>
<h2 id="2-4-类加载器的工作流程"><a class="header-anchor" href="#2-4-类加载器的工作流程"></a>2.4 类加载器的工作流程</h2>
<p>我们编写的 Java 程序都是由上面四种类加载器相互配合进行类加载的，当然还可以自定义类加载器。其中，启动类加载器、拓展类加载器、系统类加载器和自定义类加载器的关系如下：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="加载器工作流程"></p>
<p>像上图这样的层次关系被称为 <strong>双亲委派模型</strong>，或者说双亲委派机制。除了顶层的启动类加载器，其他的类加载器都应当有自己的父类加载器。类加载器与其父类加载器之间的关系不会以继承（Inheritance）来实现，而是以组合（Composition）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    <span class="comment">// The parent class loader for delegation</span></span><br><span class="line">    <span class="comment">// Note: VM hardcoded the offset of this field, thus all new fields</span></span><br><span class="line">    <span class="comment">// must be added *after* it.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClassLoader parent; </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单验证下类加载器的层次关系：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> Person.class.getClassLoader();</span><br><span class="line">    System.out.println(classLoader);</span><br><span class="line">    System.out.println(classLoader.getParent());</span><br><span class="line">    System.out.println(classLoader.getParent().getParent());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下：</p>
<pre>
sun.misc.Launcher$AppClassLoader@18b4aac2
sun.misc.Launcher$ExtClassLoader@5caf905d
null    
</pre>
<p>结果符合我们的预期，而最后打印出的 <code>null</code> 说明了 <code>classLoader.getParent()</code> 指的是启动类加载器，因为它没有父类加载器。</p>
<p>那双亲委派模型的工作机制是怎样的呢？</p>
<p>当一个类加载器收到了类加载请求时，它不会自己尝试去加载这个类，而是把这个请求委派给它的父类加载器，直到请求传递到顶层的启动类加载器。如果父类加载器无法完成当前的类加载请求（在它的搜索范围内没有找到需要加载的类），那么父类加载器又会把类加载请求委派给它的子类加载器。当然也可能直到最后，这个类加载请求也没法完成，这时就会抛出 <code>ClassNotFoundException</code> 异常。</p>
<p>这里还需要引出 <strong>类缓存</strong> 的概念。所谓类缓存，就是“标准的 JavaSE 类加载器可以按要求查找类，一旦某个类被加载到类加载器中，它将维持加载（缓存）一段时间。不过 JVM 垃圾回收机制可以回收这些 Class 对象”。</p>
<p>简单来说，类加载器会缓存自己已经加载过的类。当加载一个类时，首先会从缓存中加载，如果缓存中不存在，再按照前面所说的工作机制去加载类。</p>
<blockquote>
<p>双亲委派模型的好处</p>
</blockquote>
<p>使用双亲委派模型来协调类加载器之间的关系，可以使 Java 类随着加载它的类加载器一起具备一种带有优先级的层次关系。例如存放在 <code>rt.java</code> 中的 <code>java.lang</code> 包中的类，无论是哪个类加载器加载它们，最终都将由顶层的启动类加载器进行加载。</p>
<p>也正因如此，<code>java.lang</code> 包下的类在程序的各个类加载器中被加载时都是相等的（来自同一个 class 文件且被同一个类加载器加载）。</p>
<p>如果不这样，例如 <code>java.lang</code> 包下的 <code>java.lang,Object</code> 类被不同的类加载器加载时将不会相等，那么程序中就会出现多个 <code>java.lang.Object</code> 类。由于其他类都会隐式继承 <code>java.lang.Object</code> 类，当存在多个 <code>Object</code> 类时，程序将变得混乱。</p>
<blockquote>
<p>双亲委派模型的实现</p>
</blockquote>
<p>类加载器双亲委派模型的具体实现体现在 <code>java.lang.ClassLoader</code> 中，而其中的 <code>loadClass()</code> 方法则最能体现这个机制。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Class&lt;?&gt; loadClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    <span class="keyword">return</span> loadClass(name, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve)</span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">        <span class="comment">// First, check if the class has already been loaded</span></span><br><span class="line">        <span class="comment">// 先检查类是否已经被加载</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123; <span class="comment">// 如果没被加载</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">t0</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 有父类加载器时，使用父类加载器进行加载</span></span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                    c = parent.loadClass(name, <span class="literal">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 没有父类加载器时，证明父类加载器是启动类加载器</span></span><br><span class="line">                    c = findBootstrapClassOrNull(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 父类加载器加载失败时，使用自身的 findClass 方法进行加载</span></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                <span class="comment">// to find the class.</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                c = findClass(name);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 一些耗时、计数等统计</span></span><br><span class="line">                <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-5-破坏双亲委派模型"><a class="header-anchor" href="#2-5-破坏双亲委派模型"></a>2.5 破坏双亲委派模型</h2>
<p>破坏双亲委派模型，或者说打破双亲委派机制，是什么意思？</p>
<p>在加载类时，如果不按照“自底向上检查是否已加载类，自顶向下尝试加载类”的方式去加载类，那么就可以叫做破坏双亲委派模型。</p>
<p>已经知道加载类的核心方法是抽象类 <code>ClassLoader</code> 中的 <code>loadClass()</code> 方法，可以通过继承这个抽象类并重写 <code>loadClass()</code> 方法，而且不按照双亲委派模型的方式去加载类，那么就可以打破双亲委派模型。</p>
<p>在 Java 发展史上也有双亲委派模型被破坏的情况，比如：</p>
<ol>
<li>由于 <code>java.lang.ClassLoader</code> 在 JDK1.0 中已经存在，所以会有人继承这个抽象类并重写 <code>loadClass()</code> 方法来实现自定义类加载器。为了在 JDK1.2 中引入双亲委派模型并向前兼容，<code>loadClass()</code> 方法必须要保留并且能够被重写，于是在 <code>ClassLoader</code> 类添加了一个新的被 protected 修饰的 <code>findClass()</code> 方法，并告知开发者不要重写 <code>loadClass()</code> 而是重写 <code>findClass()</code>。由于双亲委派模型的具体实现就在 <code>loadClass()</code> 方法内，并未禁止重写这个方法，因此委派的逻辑就被破坏了。</li>
<li>双亲委派模型存在缺陷：双亲委派模型很好地解决了各个类加载器加载基础类的统一问题（越基础的类由越上层的类加载器加载），这些基础类大多数情况下作为用户调用的基础类库，但 <strong>这些基础类无法回调用户的代码</strong>。以 JDBC 为例，它规定了如何使用 Java 代码来连接数据库，具体的做法需要交由各个数据库厂商实现。JDBC 位于 rt.jar 中，由启动类加载器去加载，但其具体实现是在用户定义的 ClassPath 中，只能由应用类加载器去加载，因此启动类加载器只能委托子类加载器去加载数据库厂商们的具体实现，而这就破坏了双亲委派模型。具体实现方式是引入了线程上下文类加载器（Thread Context ClassLoader），可以通过 <code>java.lang.Thread</code> 的 <code>setContextClassLoader()</code> 方法来设置，然后利用 <code>Thread.current.currentThread().getContextClassLoader()</code> 获得类加载器来加载（如果直接获取，将获取到应用程序类加载器）。</li>
<li>用户对应用程序动态性的热切追求：如代码热替换（HotSwap）、热模块部署等，因此催生出 <code>JSR-291</code> 以及它的业界实现 OSGi，而 OSGi 定制了自己的类加载规则，利用自定义类加载器机制来完成模块化热部署，不再遵循双亲委派模型。</li>
</ol>
<h1 id="3-反射"><a class="header-anchor" href="#3-反射"></a>3. 反射</h1>
<h2 id="3-1-几个相关的类"><a class="header-anchor" href="#3-1-几个相关的类"></a>3.1 几个相关的类</h2>
<ul>
<li><code>java.lang.Class</code>，代表一个类。</li>
<li><code>java.lang.reflect.Method</code>，代表类的方法。</li>
<li><code>java.lang.reflect.Field</code>，代表类的成员变量。</li>
<li><code>java.lang.reflect.Constructor</code>，代表类的构造器。</li>
</ul>
<h2 id="3-2-Class-类"><a class="header-anchor" href="#3-2-Class-类"></a>3.2 Class 类</h2>
<p>通过类的 Class 类可以知道这个类的：</p>
<ul>
<li>属性；</li>
<li>方法和构造器；</li>
<li>实现了哪些接口。</li>
</ul>
<p>对于每个类而言，JRE 都为其保留了一个不变的 Class 属性的对象。一个 Class 对象包含了特定某个结构（class/interface/enum/annotation/primitive type/void/[]）的有关信息。</p>
<p>需要注意的是：</p>
<ul>
<li>Class 类本身也是一个类；</li>
<li>Class 对象只能由系统建立对象；</li>
<li>一个加载的类在 JVM 中只会有一个 Class 实例；</li>
<li>一个 Class 对象对应的是一个加载到 JVM 中的一个 <code>.class</code> 文件；</li>
<li>可以通过任意一个类的实例获取到这个类的 Class 类；</li>
<li>通过 Class 对象可以完整地得到某一个类中所有被加载的结构；</li>
<li>Class 类是反射的根源，要想进行反射，得先获取到对应的 Class 对象。</li>
</ul>
<h2 id="3-3-如何获取-Class-类的实例"><a class="header-anchor" href="#3-3-如何获取-Class-类的实例"></a>3.3 如何获取 Class 类的实例</h2>
<p>若已知具体的类，通过类的 <code>class</code> 属性获取。该方法最为可靠，程序性能最高。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Person.class;</span><br></pre></td></tr></table></figure>
<p>已知某个类的实例，调用该实例的 <code>getClass()</code> 方法获取 <code>Class</code> 对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> person.getClass();</span><br></pre></td></tr></table></figure>
<p>已知一个类的全限定名，且该类在类路径下，可通过 <code>Class</code> 类的静态方法获取 <code>forName()</code> 获取。这一方法可能抛出 <code>ClassNotFoundException</code> 异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.yang.reflect.Person&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>内置基本数据类型可以直接用 <code>类名.Type</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;Integer&gt; type = Integer.TYPE;</span><br></pre></td></tr></table></figure>
<p>还可以利用 <code>ClassLoader</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">Class&lt;?&gt; clazz = classLoader.loadClass(<span class="string">&quot;indi.mofan.domain.Person&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>拥有 <code>Class</code> 对象的类型：外部类、成员（成员内部类、静态嵌套类）、局部内部类、匿名内部类、接口、数组、枚举、注解、基本数据类型，void。</p>
<h2 id="3-4-使用反射获取对象的信息"><a class="header-anchor" href="#3-4-使用反射获取对象的信息"></a>3.4 使用反射获取对象的信息</h2>
<p>给定一个 Person 类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yang.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(<span class="type">int</span> id, String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;<span class="keyword">return</span> id;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;<span class="built_in">this</span>.id = id;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;<span class="keyword">return</span> name;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;<span class="built_in">this</span>.name = name;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;<span class="keyword">return</span> age;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;<span class="built_in">this</span>.age = age;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>利用反射创建 Person 对象，并调用该对象的方法、修改该对象成员变量的值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获得class对象</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.yang.reflect.Person&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造一个对象</span></span><br><span class="line"><span class="comment">//        Person person = (Person) c1.newInstance();</span></span><br><span class="line"><span class="comment">//        System.out.println(person);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过构造器创建对象</span></span><br><span class="line"><span class="comment">//        Constructor constructor = c1.getDeclaredConstructor(int.class, String.class, int.class);</span></span><br><span class="line"><span class="comment">//        Person person2 = (Person) constructor.newInstance(1,&quot;Yang&quot;,18);</span></span><br><span class="line"><span class="comment">//        System.out.println(person2);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过反射调用普通方法</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person3</span> <span class="operator">=</span> (Person) c1.newInstance();</span><br><span class="line">        <span class="comment">// 通过反射获取方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">setName</span> <span class="operator">=</span> c1.getDeclaredMethod(<span class="string">&quot;setName&quot;</span>, String.class);</span><br><span class="line">        <span class="comment">// invoke: 激活</span></span><br><span class="line">        <span class="comment">//（对象 ， “方法的值”）</span></span><br><span class="line">        setName.invoke(person3,<span class="string">&quot;mofan&quot;</span>);</span><br><span class="line">        System.out.println(person3.getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过反射操作属性</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person4</span> <span class="operator">=</span> (Person) c1.newInstance();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> c1.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="comment">// 不能直接操作私有属性，需要关闭程序的安全检测，</span></span><br><span class="line">        <span class="comment">// 使属性或者方法的setAccessible为true，可提高执行效率</span></span><br><span class="line">        <span class="keyword">if</span> (!name.isAccessible()) &#123;</span><br><span class="line">            name.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        name.set(person4,<span class="string">&quot;Yang_2&quot;</span>);</span><br><span class="line">        System.out.println(person4.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>利用 <code>isAccessible()</code> 方法可以判断 <strong>是否关闭 Java 语言访问控制的检查</strong>，关闭后才能操作私有属性。当未关闭安全检测时，可以使用 <code>setAccessible()</code> 方法并传入 <code>true</code> 表示关闭检查。</p>
<p>在 JDK 9 之后 <code>isAccessible()</code> 方法被废弃，废弃原因是它的方法名称不够准确，会让人觉得此方法用于检查反射的对象是否可访问，而实际上并非如此，作为代替，引入了 <code>canAccess()</code> 方法。</p>
<p><code>canAccess()</code> 方法可以接收一个 <code>Object</code> 类型的参数，如果判断的是一个实例对象的方法或字段，应当传入此实例对象，反之传入 <code>null</code> 即可。</p>
<h2 id="3-5-使用反射获取注解信息"><a class="header-anchor" href="#3-5-使用反射获取注解信息"></a>3.5 使用反射获取注解信息</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yang.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.yang.reflect.Student&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过反射获得注解</span></span><br><span class="line">        Annotation[] annotations = c1.getAnnotations();</span><br><span class="line">        <span class="keyword">for</span> (Annotation annotation : annotations) &#123;</span><br><span class="line">            System.out.println(annotation);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获得注解的 value 的值</span></span><br><span class="line">        <span class="type">Tableyang</span> <span class="variable">tableyang</span> <span class="operator">=</span> (Tableyang) c1.getAnnotation(Tableyang.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> tableyang.value();</span><br><span class="line">        System.out.println(value);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取类指定的注解</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">name</span> <span class="operator">=</span> c1.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">Fieldyang</span> <span class="variable">annotation</span> <span class="operator">=</span> name.getAnnotation(Fieldyang.class);</span><br><span class="line">        System.out.println(annotation.columnName());</span><br><span class="line">        System.out.println(annotation.type());</span><br><span class="line">        System.out.println(annotation.length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Tableyang(&quot;db_student&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    <span class="meta">@Fieldyang(columnName = &quot;db_id&quot;,type = &quot;int&quot;,length = 10)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="meta">@Fieldyang(columnName = &quot;db_age&quot;,type = &quot;int&quot;,length = 2)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="meta">@Fieldyang(columnName = &quot;db_name&quot;,type = &quot;varchar&quot;,length = 8)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> age, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;<span class="keyword">return</span> id;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;<span class="built_in">this</span>.id = id;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;<span class="keyword">return</span> age;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;<span class="built_in">this</span>.age = age;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;<span class="keyword">return</span> name;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;<span class="built_in">this</span>.name = name;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//类名的注解</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@interface</span> Tableyang&#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//属性的注解</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@interface</span> Fieldyang&#123;</span><br><span class="line">    String <span class="title function_">columnName</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">type</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">length</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@com.yang.reflect.Tableyang(value=db_student)</span><br><span class="line">db_student</span><br><span class="line">db_name</span><br><span class="line">varchar</span><br><span class="line">8</span><br></pre></td></tr></table></figure>
<h2 id="3-6-Class-的各种-name"><a class="header-anchor" href="#3-6-Class-的各种-name"></a>3.6 Class 的各种 name</h2>
<p>参考链接：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/15202997/what-is-the-difference-between-canonical-name-simple-name-and-class-name-in-jav/15203417#">What is the difference between canonical name, simple name and class name in Java Class? </a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Goodbye_Youth/article/details/83536840">Class类 getName()、getCanonicalName()、getSimpleName()、getTypeName() 方法的异同</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/lolichan/article/details/84926335">本地类</a></li>
</ul>
<p>在 <code>Class</code> 中有 <code>getName()</code>、<code>getCanonicalName()</code>、<code>getSimpleName()</code> 以及 JDK8 中新增的 <code>getTypeName()</code> 方法。</p>
<blockquote>
<p><code>getName()</code></p>
</blockquote>
<p><code>getName()</code> 返回的信息可以在动态加载某个类时使用。比如使用默认的 <code>ClassLoader</code> 调用 <code>Class.forName()</code> 方法来加载某个类。在某个 <code>ClassLoader</code> 的范围内，所有类 <code>getName()</code> 返回的信息唯一。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="built_in">this</span>.name;</span><br><span class="line">    <span class="keyword">return</span> name != <span class="literal">null</span> ? name : initClassName();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cache the name to reduce the number of calls into the VM.</span></span><br><span class="line"><span class="comment">// This field would be set by VM itself during initClassName call.</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> String name;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">native</span> String <span class="title function_">initClassName</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>getCanonicalName()</code></p>
</blockquote>
<p><code>getCanonicalName()</code> 返回的信息可以在 <code>import</code> 语句中使用，也能在 <code>toString()</code> 方法或日志操作时使用。 <mark>注意：</mark> 在一个 <code>ClassLoader</code> 中，<code>getCanonicalName()</code> 返回的信息并不能用来唯一标识一个类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getCanonicalName</span><span class="params">()</span> &#123;</span><br><span class="line">    ReflectionData&lt;T&gt; rd = reflectionData();</span><br><span class="line">    <span class="type">String</span> <span class="variable">canonicalName</span> <span class="operator">=</span> rd.canonicalName;</span><br><span class="line">    <span class="keyword">if</span> (canonicalName == <span class="literal">null</span>) &#123;</span><br><span class="line">        rd.canonicalName = canonicalName = getCanonicalName0();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> canonicalName == ReflectionData.NULL_SENTINEL? <span class="literal">null</span> : canonicalName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 核心实现</span></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">getCanonicalName0</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isArray()) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">canonicalName</span> <span class="operator">=</span> getComponentType().getCanonicalName();</span><br><span class="line">        <span class="keyword">if</span> (canonicalName != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> canonicalName + <span class="string">&quot;[]&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> ReflectionData.NULL_SENTINEL;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isHidden() || isLocalOrAnonymousClass())</span><br><span class="line">        <span class="keyword">return</span> ReflectionData.NULL_SENTINEL;</span><br><span class="line">    Class&lt;?&gt; enclosingClass = getEnclosingClass();</span><br><span class="line">    <span class="keyword">if</span> (enclosingClass == <span class="literal">null</span>) &#123; <span class="comment">// top level class</span></span><br><span class="line">        <span class="keyword">return</span> getName();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">enclosingName</span> <span class="operator">=</span> enclosingClass.getCanonicalName();</span><br><span class="line">        <span class="keyword">if</span> (enclosingName == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> ReflectionData.NULL_SENTINEL;</span><br><span class="line">        <span class="type">String</span> <span class="variable">simpleName</span> <span class="operator">=</span> getSimpleName();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(enclosingName.length() + simpleName.length() + <span class="number">1</span>)</span><br><span class="line">            .append(enclosingName)</span><br><span class="line">            .append(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">            .append(simpleName)</span><br><span class="line">            .toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>isArray()</code> 判断该 Class 对象是否为数组。</p>
<p><code>getComponentType()</code> 返回数组中元素的 Class 对象，如果该对象不是数组，则返回 <code>null</code>。</p>
<p><code>isHidden()</code> 是 JDK15 新增的方法，用于判断一个类是否是隐藏类，像 Lambda 表达式、方法引用就是隐藏类。</p>
<p><code>isLocalOrAnonymousClass()</code> 判断该 Class 对象是否为本地类（定义在一个代码块中的类，比如定义在方法中、静态代码块中）或匿名类。匿名类和本地类在 Java 中无法呈现出类结构，所在位置不能通过名称表示出来，因此 <code>getCanonicalName()</code> 返回 <code>null</code>。</p>
<p><code>getEnclosingClass()</code> 返回该 Class 对象的封装 Class 对象，如果该 Class 对象是顶级类，则返回 <code>null</code>。</p>
<blockquote>
<p><code>getSimpleName()</code></p>
</blockquote>
<p><code>getSimpleName()</code> 返回的信息可以 <strong>不精准地</strong> 来标识一个类，因此不能保证唯一性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getSimpleName</span><span class="params">()</span> &#123;</span><br><span class="line">    ReflectionData&lt;T&gt; rd = reflectionData();</span><br><span class="line">    <span class="type">String</span> <span class="variable">simpleName</span> <span class="operator">=</span> rd.simpleName;</span><br><span class="line">    <span class="keyword">if</span> (simpleName == <span class="literal">null</span>) &#123;</span><br><span class="line">        rd.simpleName = simpleName = getSimpleName0();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> simpleName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 核心实现</span></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">getSimpleName0</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isArray()) &#123;</span><br><span class="line">        <span class="keyword">return</span> getComponentType().getSimpleName() + <span class="string">&quot;[]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">simpleName</span> <span class="operator">=</span> getSimpleBinaryName();</span><br><span class="line">    <span class="keyword">if</span> (simpleName == <span class="literal">null</span>) &#123; <span class="comment">// top level class</span></span><br><span class="line">        simpleName = getName();</span><br><span class="line">        simpleName = simpleName.substring(simpleName.lastIndexOf(<span class="string">&#x27;.&#x27;</span>) + <span class="number">1</span>); <span class="comment">// strip the package name</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> simpleName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>getSimpleBinaryName()</code> 返回该 Class 对象的简单二进制名称。如果该 Class 对象是顶级类，则返回 <code>null</code>；否则以顶级类 <code>getName()</code> 信息的长度为开始截取索引，截取该 Class 对象的 <code>getName()</code> 信息（这是 JDK 8 里的逻辑，JDK 17 中由本地方法实现）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String <span class="title function_">getSimpleBinaryName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isTopLevelClass())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> getSimpleBinaryName0();</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="literal">null</span>) <span class="comment">// anonymous class</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 逻辑由本地方法实现</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">native</span> String <span class="title function_">getSimpleBinaryName0</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>getTypeName()</code></p>
</blockquote>
<p><code>getTypeName()</code> 返回此类型名称的信息字符串，就像 <code>toString()</code> 一样，表示纯粹的信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getTypeName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isArray()) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; cl = <span class="built_in">this</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">dimensions</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                dimensions++;</span><br><span class="line">                cl = cl.getComponentType();</span><br><span class="line">            &#125; <span class="keyword">while</span> (cl.isArray());</span><br><span class="line">            <span class="keyword">return</span> cl.getName() + <span class="string">&quot;[]&quot;</span>.repeat(dimensions);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123; <span class="comment">/*FALLTHRU*/</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> getName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>示例对比</p>
</blockquote>
<p>目标测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetNameTestClass</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Inner</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">fun</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">LocalClassInMethod</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Class&lt;LocalClassInMethod&gt; localClazz = LocalClassInMethod.class;</span><br><span class="line">        System.out.println(localClazz.getName());</span><br><span class="line">        System.out.println(localClazz.getCanonicalName());</span><br><span class="line">        System.out.println(localClazz.getSimpleName());</span><br><span class="line">        System.out.println(localClazz.getTypeName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">LocalClassInStaticBlock</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Class&lt;LocalClassInStaticBlock&gt; localClazz = LocalClassInStaticBlock.class;</span><br><span class="line">        System.out.println(localClazz.getName());</span><br><span class="line">        System.out.println(localClazz.getCanonicalName());</span><br><span class="line">        System.out.println(localClazz.getSimpleName());</span><br><span class="line">        System.out.println(localClazz.getTypeName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;ConstantValue&quot;, &quot;InstantiationOfUtilityClass&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 基本类型</span></span><br><span class="line">    Class&lt;Integer&gt; intClazz = <span class="type">int</span>.class;</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;int&quot;</span>, intClazz.getName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;int&quot;</span>, intClazz.getCanonicalName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;int&quot;</span>, intClazz.getSimpleName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;int&quot;</span>, intClazz.getTypeName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 基本类型数组</span></span><br><span class="line">    Class&lt;<span class="type">byte</span>[]&gt; byteClazz = <span class="type">byte</span>[].class;</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;[B&quot;</span>, byteClazz.getName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;byte[]&quot;</span>, byteClazz.getCanonicalName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;byte[]&quot;</span>, byteClazz.getSimpleName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;byte[]&quot;</span>, byteClazz.getTypeName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 字符串数组</span></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">String</span>[]&gt; stringArrayClazz = String[].class;</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;[Ljava.lang.String;&quot;</span>, stringArrayClazz.getName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;java.lang.String[]&quot;</span>, stringArrayClazz.getCanonicalName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;String[]&quot;</span>, stringArrayClazz.getSimpleName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;java.lang.String[]&quot;</span>, stringArrayClazz.getTypeName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 普通类</span></span><br><span class="line">    Class&lt;GetNameTestClass&gt; clazz = GetNameTestClass.class;</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;indi.mofan.pojo.GetNameTestClass&quot;</span>, clazz.getName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;indi.mofan.pojo.GetNameTestClass&quot;</span>, clazz.getCanonicalName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;GetNameTestClass&quot;</span>, clazz.getSimpleName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;indi.mofan.pojo.GetNameTestClass&quot;</span>, clazz.getTypeName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 内部类</span></span><br><span class="line">    Class&lt;GetNameTestClass.Inner&gt; innerClazz = GetNameTestClass.Inner.class;</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;indi.mofan.pojo.GetNameTestClass$Inner&quot;</span>, innerClazz.getName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;indi.mofan.pojo.GetNameTestClass.Inner&quot;</span>, innerClazz.getCanonicalName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;Inner&quot;</span>, innerClazz.getSimpleName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;indi.mofan.pojo.GetNameTestClass$Inner&quot;</span>, innerClazz.getTypeName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 匿名内部类</span></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Runnable</span>&gt; runnableClazz = <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.getClass();</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;indi.mofan.reflection.JavaReflectionUtilTest$1&quot;</span>, runnableClazz.getName());</span><br><span class="line">    Assertions.assertNull(runnableClazz.getCanonicalName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;&quot;</span>, runnableClazz.getSimpleName());</span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;indi.mofan.reflection.JavaReflectionUtilTest$1&quot;</span>, runnableClazz.getTypeName());</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;静态代码块本地类: &quot;</span>);</span><br><span class="line">    <span class="type">GetNameTestClass</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetNameTestClass</span>();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;静态方法中的本地类: &quot;</span>);</span><br><span class="line">    GetNameTestClass.fun();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;Lambda 表达式: &quot;</span>);</span><br><span class="line">    Supplier&lt;String&gt; supplier = () -&gt; <span class="string">&quot;Function&quot;</span>;</span><br><span class="line">    <span class="type">var</span> <span class="variable">supplierClazz</span> <span class="operator">=</span> supplier.getClass();</span><br><span class="line">    System.out.println(supplierClazz.getName());</span><br><span class="line">    System.out.println(supplierClazz.getCanonicalName());</span><br><span class="line">    System.out.println(supplierClazz.getSimpleName());</span><br><span class="line">    System.out.println(supplierClazz.getTypeName());</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;方法引用: &quot;</span>);</span><br><span class="line">    Function&lt;Integer, String&gt; fun = String::valueOf;</span><br><span class="line">    <span class="type">var</span> <span class="variable">funClazz</span> <span class="operator">=</span> fun.getClass();</span><br><span class="line">    System.out.println(funClazz.getName());</span><br><span class="line">    System.out.println(funClazz.getCanonicalName());</span><br><span class="line">    System.out.println(funClazz.getSimpleName());</span><br><span class="line">    System.out.println(funClazz.getTypeName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行测试方法后，测试通过，控制台打印出：</p>
<pre>
静态代码块本地类: 
indi.mofan.pojo.GetNameTestClass$1LocalClassInStaticBlock
null
LocalClassInStaticBlock
indi.mofan.pojo.GetNameTestClass$1LocalClassInStaticBlock
静态方法中的本地类: 
indi.mofan.pojo.GetNameTestClass$1LocalClassInMethod
null
LocalClassInMethod
indi.mofan.pojo.GetNameTestClass$1LocalClassInMethod
Lambda 表达式: 
indi.mofan.reflection.JavaReflectionUtilTest$$Lambda$356/0x0000000800ca8c58
null
JavaReflectionUtilTest$$Lambda$356/0x0000000800ca8c58
indi.mofan.reflection.JavaReflectionUtilTest$$Lambda$356/0x0000000800ca8c58
方法引用: 
indi.mofan.reflection.JavaReflectionUtilTest$$Lambda$357/0x0000000800ca8e78
null
JavaReflectionUtilTest$$Lambda$357/0x0000000800ca8e78
indi.mofan.reflection.JavaReflectionUtilTest$$Lambda$357/0x0000000800ca8e78
</pre>
<h2 id="3-7-获取类的泛型信息"><a class="header-anchor" href="#3-7-获取类的泛型信息"></a>3.7 获取类的泛型信息</h2>
<blockquote>
<p><code>getGenericSuperclass()</code></p>
</blockquote>
<p><code>getGenericSuperclass()</code> 方法用于获取含有泛型信息的父类，如果父类不含泛型信息，该方法等价于 <code>getSuperclass()</code> 方法。</p>
<p>在测试类 <code>GetGenericInfoTest</code> 中有这样两个静态嵌套类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyList</span> <span class="keyword">extends</span> <span class="title class_">ArrayList</span>&lt;String&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyLinkList</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">LinkedList</span>&lt;T&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分别获取 <code>MyList</code> 和 <code>MyLinkList</code> 含有泛型信息的父类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetGenericSuperclass</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Type</span> <span class="variable">genericSuperclass</span> <span class="operator">=</span> MyList.class.getGenericSuperclass();</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;java.util.ArrayList&lt;java.lang.String&gt;&quot;</span>, </span><br><span class="line">                        genericSuperclass.toString());</span><br><span class="line">    Assert.assertTrue(genericSuperclass <span class="keyword">instanceof</span> ParameterizedType);</span><br><span class="line">    <span class="type">ParameterizedType</span> <span class="variable">parameterizedType</span> <span class="operator">=</span> (ParameterizedType) genericSuperclass;</span><br><span class="line">    Assert.assertArrayEquals(<span class="keyword">new</span> <span class="title class_">Type</span>[]&#123;String.class&#125;, </span><br><span class="line">                             parameterizedType.getActualTypeArguments());</span><br><span class="line">    Assert.assertEquals(ArrayList.class, parameterizedType.getRawType());</span><br><span class="line">    Assert.assertNull(parameterizedType.getOwnerType());</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;java.util.ArrayList&lt;java.lang.String&gt;&quot;</span>, </span><br><span class="line">                        parameterizedType.getTypeName());</span><br><span class="line"></span><br><span class="line">    genericSuperclass = MyLinkList.class.getGenericSuperclass();</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;java.util.LinkedList&lt;T&gt;&quot;</span>, genericSuperclass.toString());</span><br><span class="line">    Assert.assertTrue(genericSuperclass <span class="keyword">instanceof</span> ParameterizedType);</span><br><span class="line">    parameterizedType = (ParameterizedType) genericSuperclass;</span><br><span class="line">    Type[] actualTypeArguments = parameterizedType.getActualTypeArguments();</span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>, actualTypeArguments.length);</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;T&quot;</span>, actualTypeArguments[<span class="number">0</span>].toString());</span><br><span class="line">    Assert.assertEquals(LinkedList.class, parameterizedType.getRawType());</span><br><span class="line">    Assert.assertNull(parameterizedType.getOwnerType());</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;java.util.LinkedList&lt;T&gt;&quot;</span>, parameterizedType.getTypeName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对 <code>MyList</code> 来说，其父类是 <code>ArrayList</code>，不含泛型参数，其泛型是确切的 <code>String</code> 类型，因此 <code>ParameterizedType</code> 对象的 <code>getActualTypeArguments()</code> 方法返回的是含有 <code>String.class</code> 的数组。由于 <code>ArrayList</code> 不是某个类的嵌套类，因此 <code>getOwnerType()</code> 方法的返回结果是 <code>null</code>。</p>
<p>对 <code>MyLinkList</code> 来说，其父类是 <code>LinkedList</code>，含有泛型参数 <code>T</code>，因此 <code>ParameterizedType</code> 对象的 <code>getActualTypeArguments()</code> 方法返回的信息中含有泛型参数 <code>T</code>。<code>LinkedList</code> 也不是某个类的嵌套类，<code>getOwnerType()</code> 方法的返回结果也是 <code>null</code>。</p>
<p>如果要获取实现的接口的泛型信息呢？还可以使用 <code>getGenericSuperclass()</code> 方法吗？</p>
<p>比如在测试类 <code>GetGenericInfoTest</code> 中有以下接口和嵌套类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MyInterface</span>&lt;T&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyInterfaceImpl_1</span> <span class="keyword">implements</span> <span class="title class_">MyInterface</span>&lt;String&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyInterfaceImpl_2</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">MyInterface</span>&lt;T&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>尝试使用 <code>getGenericSuperclass()</code> 方法获取 <code>MyInterfaceImpl_1</code> 和 <code>MyInterfaceImpl_2</code> 的实现的接口的泛型信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetGenericSuperclass_2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Type</span> <span class="variable">genericSuperclass</span> <span class="operator">=</span> MyInterface.class.getGenericSuperclass();</span><br><span class="line">    Assert.assertNull(genericSuperclass);</span><br><span class="line"></span><br><span class="line">    genericSuperclass = MyInterfaceImpl_1.class.getGenericSuperclass();</span><br><span class="line">    Assert.assertFalse(genericSuperclass <span class="keyword">instanceof</span> ParameterizedType);</span><br><span class="line"></span><br><span class="line">    genericSuperclass = MyInterfaceImpl_2.class.getGenericSuperclass();</span><br><span class="line">    Assert.assertFalse(genericSuperclass <span class="keyword">instanceof</span> ParameterizedType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很遗憾，使用 <code>getGenericSuperclass()</code> 方法并不能成功获取，获取父接口的泛型信息可以使用 <code>getGenericInterfaces()</code> 方法。</p>
<blockquote>
<p><code>getGenericInterfaces()</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetGenericInterfaces</span><span class="params">()</span> &#123;</span><br><span class="line">    Type[] genericInterfaces = MyInterface.class.getGenericInterfaces();</span><br><span class="line">    Assert.assertEquals(<span class="number">0</span>, genericInterfaces.length);</span><br><span class="line"></span><br><span class="line">    genericInterfaces = MyInterfaceImpl_1.class.getGenericInterfaces();</span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>, genericInterfaces.length);</span><br><span class="line">    <span class="keyword">for</span> (Type genericInterface : genericInterfaces) &#123;</span><br><span class="line">        Assert.assertTrue(genericInterface <span class="keyword">instanceof</span> ParameterizedType);</span><br><span class="line">        <span class="type">ParameterizedType</span> <span class="variable">type</span> <span class="operator">=</span> (ParameterizedType) genericInterface;</span><br><span class="line">        Assert.assertArrayEquals(<span class="keyword">new</span> <span class="title class_">Type</span>[]&#123;String.class&#125;, type.getActualTypeArguments());</span><br><span class="line">        Assert.assertEquals(MyInterface.class, type.getRawType());</span><br><span class="line">        Assert.assertEquals(<span class="built_in">this</span>.getClass(), type.getOwnerType());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    genericInterfaces = MyInterfaceImpl_2.class.getGenericInterfaces();</span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>, genericInterfaces.length);</span><br><span class="line">    <span class="keyword">for</span> (Type genericInterface : genericInterfaces) &#123;</span><br><span class="line">        Assert.assertTrue(genericInterface <span class="keyword">instanceof</span> ParameterizedType);</span><br><span class="line">        <span class="type">ParameterizedType</span> <span class="variable">type</span> <span class="operator">=</span> (ParameterizedType) genericInterface;</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;T&quot;</span>, type.getActualTypeArguments()[<span class="number">0</span>].toString());</span><br><span class="line">        Assert.assertEquals(MyInterface.class, type.getRawType());</span><br><span class="line">        Assert.assertEquals(<span class="built_in">this</span>.getClass(), type.getOwnerType());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Java 不允许多继承，但允许实现多个接口，因此 <code>getGenericInterfaces()</code> 返回的是一个数组，表示实现的多个接口信息。</p>
<p>在返回的 <code>Type</code> 数组中，如果实现的某个接口带有泛型信息，可以将 <code>Type</code> 对象转换为 <code>ParameterizedType</code> 对象来获取泛型信息。</p>
<p><code>MyInterface</code> 接口是定义在测试类中的嵌套类，因此调用 <code>getOwnerType()</code> 方法返回的是当前测试类的 <code>Class</code> 对象。</p>
<p>只能使用 <code>getGenericInterfaces()</code> 方法来获取实现的接口的泛型信息，而不能获取继承的父类的泛型信息，否则最终得到的 <code>Type</code> 数组是一个空数组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyClass</span>&lt;T&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SimpleClass</span> <span class="keyword">extends</span> <span class="title class_">MyClass</span>&lt;String&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetGenericInterfaces_2</span><span class="params">()</span> &#123;</span><br><span class="line">    Type[] genericInterfaces = MyClass.class.getGenericInterfaces();</span><br><span class="line">    Assert.assertEquals(<span class="number">0</span>, genericInterfaces.length);</span><br><span class="line"></span><br><span class="line">    genericInterfaces = SimpleClass.class.getGenericInterfaces();</span><br><span class="line">    Assert.assertEquals(<span class="number">0</span>, genericInterfaces.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要获取其他位置的泛型信息时，参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/gongm24/article/details/121601473">JAVA反射 | 泛型解析</a></p>
<h2 id="3-8-反射调用可变参数方法"><a class="header-anchor" href="#3-8-反射调用可变参数方法"></a>3.8 反射调用可变参数方法</h2>
<p>可变参数可以当成对应的数组类型参数。</p>
<p>如果可变参数类型是引用类型：接收到参数后，会自动拆包取出参数再分配给底层方法，因此需要将传入的数组包装成 <code>Object</code> 对象或者将其作为 <code>Object[]</code> 中的一个元素；</p>
<p>如果可变参数类型是基本类型：不会将参数拆包，因此可以不用包装，但包装了也不会抛出异常，为了统一，可以和引用类型的可变参数一样，都包装一层。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">firstMethod</span><span class="params">(<span class="type">int</span>... ints)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;call firstMethod&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">secondMethod</span><span class="params">(String... strings)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;call secondMethod&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testVaryArgsMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line">    Class&lt;MyClass&gt; clazz = MyClass.class;</span><br><span class="line"></span><br><span class="line">    <span class="type">Method</span> <span class="variable">firstMethod</span> <span class="operator">=</span> clazz.getDeclaredMethod(<span class="string">&quot;firstMethod&quot;</span>, <span class="type">int</span>[].class);</span><br><span class="line">    firstMethod.invoke(obj, <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;);</span><br><span class="line">    firstMethod.invoke(obj, (Object) <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;);</span><br><span class="line">    firstMethod.invoke(obj, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">Method</span> <span class="variable">secondMethod</span> <span class="operator">=</span> clazz.getDeclaredMethod(<span class="string">&quot;secondMethod&quot;</span>, String[].class);</span><br><span class="line">    assertThatExceptionOfType(IllegalArgumentException.class)</span><br><span class="line">            .isThrownBy(() -&gt; secondMethod.invoke(obj, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>&#125;))</span><br><span class="line">            .withMessage(<span class="string">&quot;wrong number of arguments&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 强转为 Object</span></span><br><span class="line">    secondMethod.invoke(obj, (Object) <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>&#125;);</span><br><span class="line">    <span class="comment">// 或者是 Object[] 中的一个元素</span></span><br><span class="line">    secondMethod.invoke(obj, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>&#125;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mofan212.github.io">默烦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mofan212.github.io/posts/Annotation-And-Reflection/">https://mofan212.github.io/posts/Annotation-And-Reflection/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mofan212.github.io" target="_blank">Mofan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="post_share"><div class="social-share" data-image="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/20.jpg" data-sites="wechat,qq,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://jsd.proxy.aks.moe/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/AliPay.png" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/img/AliPay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="/img/WeChatPay.png" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/img/WeChatPay.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/Basic-JS-Knowledge/" title="应该知晓的JS知识"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/21.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">应该知晓的JS知识</div></div></a></div><div class="next-post pull-right"><a href="/posts/Android-4/" title="Android图像处理和多媒体（四）"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/18.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Android图像处理和多媒体（四）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/Combinator-Pattern/" title="Combinator Pattern"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/149.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-28</div><div class="title">Combinator Pattern</div></div></a></div><div><a href="/posts/Design-Pattern-Mediator-Pattern/" title="【设计模式】中介者模式"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/148.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-03</div><div class="title">【设计模式】中介者模式</div></div></a></div><div><a href="/posts/Design-Pattern-Singleton-Pattern/" title="【设计模式】单例模式"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/112.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-10</div><div class="title">【设计模式】单例模式</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">默烦</div><div class="author-info__description">彩笔的打怪升级之路...</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">150</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/23658864/dynamic"><i class="fas fa-running"></i><span>关注我的B站</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mofan212" target="_blank" title="GitHub"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:cy.mofan@foxmail.com" target="_blank" title="邮箱"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS链接"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本站所有博文均是博主的学习笔记与个人理解。<strong><font style="color:red">除特别注明外，</font>如需转载，请在文章头部醒目处附带原文链接并<a target="_blank" rel="noopener" href="https://mofan212.gitee.io/mine/" style="color:#49B1F5;text-decoration:underline">告知我</a></strong>你将转载。😊</br><strong><font style="color:red">严禁未遵循规范的转载。</font></strong>😡</br><strong>死去的评论系统复活啦！欢迎到留言板畅所欲言！</strong>当然也可以使用更高效的<a target="_blank" href="https://space.bilibili.com/23658864/dynamic" style="color:#49B1F5;text-decoration:underline"> 哔哩哔哩私信 </a>或<a href="mailto:cy.mofan@foxmail.com" style="color:#49B1F5;text-decoration:underline" target="_blank">邮箱</a>。 😉</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%B3%A8%E8%A7%A3"><span class="toc-text">1. 注解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-text">1.1 自定义注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%85%83%E6%B3%A8%E8%A7%A3"><span class="toc-text">1.2 元注解</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD"><span class="toc-text">2. 类的加载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD"><span class="toc-text">2.1 类的加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E7%B1%BB%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">2.2 类初始化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-text">2.3 类加载器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-text">2.4 类加载器的工作流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E7%A0%B4%E5%9D%8F%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B"><span class="toc-text">2.5 破坏双亲委派模型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%8F%8D%E5%B0%84"><span class="toc-text">3. 反射</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%87%A0%E4%B8%AA%E7%9B%B8%E5%85%B3%E7%9A%84%E7%B1%BB"><span class="toc-text">3.1 几个相关的类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Class-%E7%B1%BB"><span class="toc-text">3.2 Class 类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96-Class-%E7%B1%BB%E7%9A%84%E5%AE%9E%E4%BE%8B"><span class="toc-text">3.3 如何获取 Class 类的实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-text">3.4 使用反射获取对象的信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96%E6%B3%A8%E8%A7%A3%E4%BF%A1%E6%81%AF"><span class="toc-text">3.5 使用反射获取注解信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-Class-%E7%9A%84%E5%90%84%E7%A7%8D-name"><span class="toc-text">3.6 Class 的各种 name</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-%E8%8E%B7%E5%8F%96%E7%B1%BB%E7%9A%84%E6%B3%9B%E5%9E%8B%E4%BF%A1%E6%81%AF"><span class="toc-text">3.7 获取类的泛型信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8-%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0%E6%96%B9%E6%B3%95"><span class="toc-text">3.8 反射调用可变参数方法</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/The-Basis-Of-Java-Multithreading/" title="学毛线（Thread）的 Java"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/57.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="学毛线（Thread）的 Java"/></a><div class="content"><a class="title" href="/posts/The-Basis-Of-Java-Multithreading/" title="学毛线（Thread）的 Java">学毛线（Thread）的 Java</a><time datetime="2024-07-10T16:00:00.000Z" title="更新于 2024-07-11 00:00:00">2024-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/SpringBoot-Shutdown-Hook/" title="SpringBoot Shutdown Hook"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/141.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot Shutdown Hook"/></a><div class="content"><a class="title" href="/posts/SpringBoot-Shutdown-Hook/" title="SpringBoot Shutdown Hook">SpringBoot Shutdown Hook</a><time datetime="2024-07-10T16:00:00.000Z" title="更新于 2024-07-11 00:00:00">2024-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/LinkedHashMap-In-JDK21/" title="JDK21 中的 LinkedHashMap"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/150.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JDK21 中的 LinkedHashMap"/></a><div class="content"><a class="title" href="/posts/LinkedHashMap-In-JDK21/" title="JDK21 中的 LinkedHashMap">JDK21 中的 LinkedHashMap</a><time datetime="2024-07-06T16:00:00.000Z" title="更新于 2024-07-07 00:00:00">2024-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/The-Basics-Of-Linux-Part-One/" title="【上篇】Linux 基础"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/96.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【上篇】Linux 基础"/></a><div class="content"><a class="title" href="/posts/The-Basics-Of-Linux-Part-One/" title="【上篇】Linux 基础">【上篇】Linux 基础</a><time datetime="2024-07-04T16:00:00.000Z" title="更新于 2024-07-05 00:00:00">2024-07-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Quick-Start-To-Arthas/" title="Arthas 快速入门"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/127.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Arthas 快速入门"/></a><div class="content"><a class="title" href="/posts/Quick-Start-To-Arthas/" title="Arthas 快速入门">Arthas 快速入门</a><time datetime="2024-07-01T16:00:00.000Z" title="更新于 2024-07-02 00:00:00">2024-07-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Commonly-Used-Classes-In-Java/" title="Java 常用类"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/65.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java 常用类"/></a><div class="content"><a class="title" href="/posts/Commonly-Used-Classes-In-Java/" title="Java 常用类">Java 常用类</a><time datetime="2024-06-28T16:00:00.000Z" title="更新于 2024-06-29 00:00:00">2024-06-29</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 默烦</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://jsd.proxy.aks.moe/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://jsd.proxy.aks.moe/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://jsd.proxy.aks.moe/npm/vanilla-lazyload@latest/dist/lazyload.iife.min.js"></script><script src="https://jsd.proxy.aks.moe/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://jsd.proxy.aks.moe/npm/mermaid@10.9.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://jsd.proxy.aks.moe/gh/mofan212/blog-static-resources@master/js/mine.min.js"></script><script src="https://npm.elemecdn.com/mermaid/dist/mermaid.min.js"></script><script defer="defer" id="ribbon" src="https://jsd.proxy.aks.moe/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="click-show-text" src="https://jsd.proxy.aks.moe/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Azathoth,Yog-Sothoth,Shub-Niggurath,Nyarlathotep,Cthulhu,Hastur,Abhoth,Ghroth,Tsathoggua,Cthugha,Deep Ones,Dagon,Chaugnar Faugn,Mordiggian,Shoggoth,Old One,Mi-Go,Great Race of Yith,Flying Polyp,Hounds of Tindalos,Dhole" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/@docsearch/css/dist/style.min.css"/><script src="https://jsd.proxy.aks.moe/npm/@docsearch/js/dist/umd/index.min.js"></script><script>(() => {
  docsearch(Object.assign({
    appId: 'BAFEL7A6K1',
    apiKey: '89fcb5961984c5c054bf04149f345f38',
    indexName: 'mofan212io',
    container: '#docsearch',
  }, null))

  const handleClick = () => {
    document.querySelector('.DocSearch-Button').click()
  }

  const searchClickFn = () => {
    btf.addEventListenerPjax(document.querySelector('#search-button > .search'), 'click', handleClick)
  }

  searchClickFn()
  window.addEventListener('pjax:complete', searchClickFn)
})()</script></div></div></body></html>