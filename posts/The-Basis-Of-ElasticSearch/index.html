<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ElasticSearch 入门 | Mofan</title><meta name="author" content="默烦,cy.mofan@foxmail.com"><meta name="copyright" content="默烦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文介绍了 ES 的安装与相关基础知识，在文末实现了一个京东搜索的小 Demo。">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch 入门">
<meta property="og:url" content="https://mofan212.github.io/posts/The-Basis-Of-ElasticSearch/index.html">
<meta property="og:site_name" content="Mofan">
<meta property="og:description" content="本文介绍了 ES 的安装与相关基础知识，在文末实现了一个京东搜索的小 Demo。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/67.png">
<meta property="article:published_time" content="2020-11-17T16:00:00.000Z">
<meta property="article:modified_time" content="2020-11-17T16:00:00.000Z">
<meta property="article:author" content="默烦">
<meta property="article:tag" content="Middleware">
<meta property="article:tag" content="ElasticSearch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/67.png"><link rel="shortcut icon" href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/favicon.png"><link rel="canonical" href="https://mofan212.github.io/posts/The-Basis-Of-ElasticSearch/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"距离本文上次更新已经过去","messageNext":"天，请注意时效性。"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 默烦","link":"链接: ","source":"来源: Mofan","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ElasticSearch 入门',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-11-18 00:00:00'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/mofan212/blog-static-resources@master/css/myStyle.min.css"><link rel="stylesheet" href="https://cdn.staticfile.net/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css" /><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="Mofan" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="https://gcore.jsdelivr.net/gh/mofan212/blog-static-resources/css/fill-left.min.css"/><script src="https://gcore.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">153</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/post_top_img.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Mofan"><span class="site-name">Mofan</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ElasticSearch 入门</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-11-17T16:00:00.000Z" title="发表于 2020-11-18 00:00:00">2020-11-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-11-17T16:00:00.000Z" title="更新于 2020-11-18 00:00:00">2020-11-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Middleware/">Middleware</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">12.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>48分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ElasticSearch 入门"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>封面来源：碧蓝航线 北境序曲 活动CG</p>
<p>本文参考：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV17a4y1x7zq">【狂神说Java】ElasticSearch7.6.x最新完整教程通俗易懂</a></p>
<p>本文内容基于 ElasticSearch 7.6.x，<mark>本文包含大量图片，请保持较好的网络连接。</mark></p>
<h1 id="1-ElasticSearch-概述"><a class="header-anchor" href="#1-ElasticSearch-概述"></a>1. ElasticSearch 概述</h1>
<blockquote>
<p>概述</p>
</blockquote>
<p>Elasticsearch 是一个基于 <strong>Lucene</strong> 的 <mark>搜索服务器</mark>。它提供了一个分布式多用户能力的全文搜索引擎，基于 RESTful web 接口。Elasticsearch 是用 Java 语言开发的，并作为 Apache 许可条款下的开放源码发布，是一种流行的企业级搜索引擎。Elasticsearch 用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。官方客户端在Java、.NET（C#）、PHP、Python、Apache Groovy、Ruby和许多其他语言中都是可用的。根据 DB-Engines 的排名显示，Elasticsearch 是最受欢迎的企业搜索引擎，其次是 Apache Solr，也是基于 Lucene。</p>
<p>Elasticsearch 是一个实时分布式搜索和分析引擎，它让你以前所未有的速度处理大数据成为可能。</p>
<p>主要用于<strong>全文搜索</strong>、<strong>结构化搜索</strong>、<strong>分析</strong>以及将这三者混合使用。</p>
<p>Elasticsearch 是一个基于 Apache Lucene™ 的开源搜索引擎。无论在开源还是专有领域，Lucene 可以 被认为是迄今为止先进、性能好的、功能全的搜索引擎库。</p>
<p>但是，Lucene 只是一个库。想要使用它，你必须使用 Java 来作为开发语言并将其直接集成到你的应用 中，更糟糕的是，Lucene 非常复杂，你需要深入了解检索的相关知识来理解它是如何工作的。 Elasticsearch 也使用 Java 开发并使用 Lucene 作为其核心来实现所有索引和搜索的功能，但是它的目的是 通过简单的 RESTful API 来隐藏 Lucene 的复杂性，从而让全文搜索变得简单。</p>
<blockquote>
<p>谁在使用</p>
</blockquote>
<p>1、维基百科，实现全文搜索、高亮、搜索推荐等</p>
<p>2、The Guardian（国外新闻网站），用户行为日志、社交网络数据、数据分析、给到每篇新闻文章的作者，让他知道他的文章的公众反馈</p>
<p>3、Stack Overﬂow</p>
<p>4、GitHub</p>
<p>5、电商网站，检索商品</p>
<p>6、日志数据分析</p>
<p>7、商品价格监控网站</p>
<p>等等…</p>
<h1 id="2-与-Solr-的区别"><a class="header-anchor" href="#2-与-Solr-的区别"></a>2. 与 Solr 的区别</h1>
<h2 id="2-1-Solr-的概述"><a class="header-anchor" href="#2-1-Solr-的概述"></a>2.1 Solr 的概述</h2>
<p>Solr 是 Apache 下的一个顶级开源项目，采用 Java 语言开发，它是基于 Lucene 的全文搜索服务器。Solr 提供了比 Lucene 更为丰富的查询语言，同时实现了可配置、可扩展，并对索引、搜索性能进行了优化。</p>
<p>Solr 可以独立运行，运行在 Jetty、Tomcat 等这些 Servlet 容器中，Solr 索引的实现方法很简单，用 POST 方法向 Solr 服务器发送一个描述 Field 及其内容的 XML 文档，Solr 根据 XML 文档添加、删除、更新索引 。</p>
<p>Solr 搜索只需要发送 HTTP GET 请求，然后对 Solr 返回 XML、JSON 等格式的查询结果进行解析，组织页面布局。Solr 不提供构建 UI 的功能，Solr 提供了一个管理界面，通过管理界面可以查询 Solr 的配置和运行情况。</p>
<p>Solr 是基于 Lucene 开发企业级搜索服务器，实际上就是封装了 Lucene。Solr 是一个独立的企业级搜索应用服务器，它对外提供类似于 Web-service 的 API 接口。用户可以通过 Http 请求，向搜索引擎服务器提交一定格式的文件，生成索引，也可以通过提出查找请求，并得到返回结果。</p>
<h2 id="2-2-Solr-与-ElasticSearch"><a class="header-anchor" href="#2-2-Solr-与-ElasticSearch"></a>2.2 Solr 与 ElasticSearch</h2>
<p>参考链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/blueskyli/p/8326229.html">ElasticSearch和solr的差别</a></p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/ElasticSearch和Solr的区别_1.png" alt="ElasticSearch和Solr的区别_1" style="zoom:67%;" />
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/ElasticSearch和Solr的区别_2.png" alt="ElasticSearch和Solr的区别_2" style="zoom:67%;" />
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/ElasticSearch和Solr的区别_3.png" alt="ElasticSearch和Solr的区别_3" style="zoom:67%;" />
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/ElasticSearch%E5%92%8CSolr%E7%9A%84%E5%8C%BA%E5%88%AB_4.png" alt="ElasticSearch和Solr的区别_4"></p>
<blockquote>
<p>总结</p>
</blockquote>
<p>1、ES 基本是开箱即用，非常简单，而 Solr 安装略微复杂一丢丢</p>
<p>2、Solr 利用 Zookeeper 进行分布式管理，而 Elasticsearch 自身带有分布式协调管理功能。</p>
<p>3、Solr 支持更多格式的数据，比如 JSON、XML、CSV，而 Elasticsearch 仅支持 JSON 文件格式。</p>
<p>4、Solr 官方提供的功能更多，而 Elasticsearch 本身更注重于核心功能，高级功能多有第三方插件提供，例如图形化界面需要 Kibana 的支撑</p>
<p>5、Solr 查询快，但更新索引时慢（即插入删除慢），用于电商等查询多的应用；ES 建立索引快（即查询慢），即实时性查询快，用于 Facebook、新浪等搜索。Solr 是传统搜索应用的有力解决方案，但 Elasticsearch 更适用于新兴的实时搜索应用。</p>
<p>6、Solr比较成熟，有一个更大，更成熟的用户、开发和贡献者社区，而 Elasticsearch 相对开发维护者较少，更新太快，学习使用成本较高（这点已经不再是 ES 的缺点了）。</p>
<h1 id="3-安装-ElasticSearch"><a class="header-anchor" href="#3-安装-ElasticSearch"></a>3. 安装 ElasticSearch</h1>
<blockquote>
<p>前置要求</p>
</blockquote>
<p>Java 的版本至少是 JDK 8，ElasticSearch 的版本和我们以后要导入的依赖也要版本对应！</p>
<blockquote>
<p>下载</p>
</blockquote>
<p>官网链接：<a target="_blank" rel="noopener" href="https://www.elastic.co/cn/elasticsearch/">ElasticSearch</a></p>
<p>ELK 华为镜像：<a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/elasticsearch/?C=N&amp;O=D">ElasticSearch</a>、<a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/logstash/?C=N&amp;O=D">logstash</a>、<a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/kibana/?C=N&amp;O=D">kibana</a></p>
<p>进入系统后，点击首页的下载按钮，进入下载页面，选择和自己系统相符的压缩包下载即可。</p>
<p>学习 ElasticSearch 可以使用 Linux，也可以使用 Windows，它对系统没有强制要求，为了减少不必要的操作，我们 <strong>选择在 Windows 环境上学习</strong>。</p>
<p>下载的 ELK 压缩包解压即可使用，因为涉及到图形化界面，所以需要一些必要的环境，比如：Node.js。</p>
<blockquote>
<p>安装 ElasticSearch</p>
</blockquote>
<p>在 Windows 下安装十分减压，解压即可。解压后如下图所示：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/解压ES.png" alt="解压ES" style="zoom:67%;" />
<p>根据上面给出的示意图，来熟悉一些目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bin   启动文件</span><br><span class="line">config   配置文件</span><br><span class="line">	log4j2   日志配置文件</span><br><span class="line">	jvm.options   Java 虚拟机相关的配置</span><br><span class="line">	elasticsearch.yml   ES 的配置文件   默认端口号：9200</span><br><span class="line">lib   相关 jar 包</span><br><span class="line">modules   功能模块</span><br><span class="line">plugins   插件，比如 ik 分词器</span><br></pre></td></tr></table></figure>
<p>熟悉之后，在 Windows 上启动一下 ES，只需要前往 bin 目录下，双击 elasticsearch.bat 文件即可启动：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/ES%E5%90%AF%E5%8A%A8%E4%BF%A1%E6%81%AF.png" alt="ES启动信息"></p>
<p>可以看到默认端口号确实是 9200。</p>
<p>不关闭服务，使用浏览器，在地址栏输入 <code>localhost:9200</code> 访问：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/本地访问9200端口.png" alt="本地访问9200端口" style="zoom:67%;" />
<blockquote>
<p>安装 ES 可视化界面</p>
</blockquote>
<p>为了便于操作，我们可以安装一个 ES 的可视化界面，相当于一个插件。</p>
<p>这个插件名为：<code>ElasticSearch-head</code>，前往 GitHub 搜索下载即可。这个插件很显然是一个前端工程，因此 Node.js 环境是必不可少的。</p>
<p>ElasticSearch-head 下载地址：<a target="_blank" rel="noopener" href="https://github.com/mobz/elasticsearch-head">ElasticSearch-head</a></p>
<p>下载完成后得到一个压缩包，解压到 ES 的同目录下，解压后的目录：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E8%A7%A3%E5%8E%8BES-head%E7%9A%84%E7%9B%AE%E5%BD%95.png" alt="解压ES-head的目录"></p>
<p>进入 head-master 目录下打开 CMD，执行命令 <code>cnpm install</code>：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%AE%89%E8%A3%85head-master%E7%9A%84%E4%BE%9D%E8%B5%96%E5%8C%85.png" alt="安装head-master的依赖包"></p>
<p>依赖下好后，执行命令 <code>npm run start</code> 启动可视化界面：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%90%AF%E5%8A%A8ES%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2.png" alt="启动ES可视化界面"></p>
<p>可以看到可视化界面的访问端口是 9100，在浏览器上试试：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E8%AE%BF%E9%97%AE9100%E7%AB%AF%E5%8F%A3.png" alt="访问9100端口"></p>
<p>那么问题也来了，一个端口是 9100，一个是 9200，这不就 <mark>跨域</mark> 了，那我们怎么解决呢？</p>
<p>解决也很简单，关闭 ES，进入 ES 的目录，找到 config 目录，找到 <code>elasticsearch.yml</code> 配置文件，进行配置即可。在文件内添加以下配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>
<p>保存并退出，再次双击 elasticsearch.bat 文件运行 ES。这个时候查看可视化界面，点击连接，我们可以看到：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5ES.png" alt="可视化界面连接ES"></p>
<p>在上图中，可以看到有一个 <strong>索引</strong> 的选项。点击进入，然后新建一个名为 mofan 的索引：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/ES%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E6%96%B0%E5%BB%BA%E7%B4%A2%E5%BC%95.png" alt="ES可视化界面新建索引"></p>
<p>在初学的时候，可以将 ES 当成一个数据库，然后可以建立库（索引），添加文档（库中的数据）。</p>
<p>将可视化界面 ElasticSearch-head 当成一个数据展示工具，书写查询语句在 Kibana 中操作。</p>
<h1 id="4-安装-Kibana"><a class="header-anchor" href="#4-安装-Kibana"></a>4. 安装 Kibana</h1>
<blockquote>
<p>Kibana 简介</p>
</blockquote>
<p>Kibana 是一个针对 Elasticsearch 的开源分析及可视化平台，用来搜索、查看交互存储在 Elasticsearch 索引中的数据。 使用 Kibana，可以通过各种图表进行高级数据分析及展示。Kibana 让海量数据更容易理解。它操作简单，基于浏览器的用户界面可以快速创建仪表板（dashboard）实时显示 Elasticsearch 查询动态。</p>
<p>设置Kibana非常简单，无需编码或者额外的基础架构，几分钟内就可以完成 Kibana 安装并启动 Elasticsearch 索引监测。</p>
<blockquote>
<p>安装 Kibana</p>
</blockquote>
<p>官网下载地址：<a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/kibana">Kibana</a></p>
<p>下载 Kibana 时，需要注意其版本要和 ES 版本一致。下载完毕后，解压至 ES 相同的目录中，Kibana 是一个标准的前端化工程，别看它下载了只有将近 300M，解压还是需要一点时间的。</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/Kibana%E8%A7%A3%E5%8E%8B%E5%AE%8C%E6%88%90%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="Kibana解压完成示意图"></p>
<p>Kibana 解压完毕后的目录：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/Kibana目录.png" alt="Kibana目录" style="zoom:67%;" />
<p>可以看到有一个 bin 目录，打卡它，能找到一个名为 kibana.bat 的文件，这就是启动文件，双击启动即可。</p>
<p>当然，在启动前需要先启动 ES，启动之后我们可以看到：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/Kibana%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3%E5%8F%B7.png" alt="Kibana默认端口号"></p>
<p>Kibana 默认的端口号是 5601。因此，可以在浏览器的地址栏输入本地 ip 与端口号，即可访问 Kibana，然后可以找到 <strong>开发者工具</strong> 的图标，点击即可进入。以后关于 ES 操作的语句我们都可以在开发者工具中书写：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/Kibana%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7.png" alt="Kibana开发者工具"></p>
<p>我们还发现整个页面的语言都是英文的，Kibana 支持国际化，内置了中文语言，只不过需要设置一下。</p>
<p>进入 Kibana 的安装目录，找到 config 配置文件夹，然后找到 <code>kibana.yml</code> 文件进行配置。配置很简单，一句配置即可搞定：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure>
<p>修改了配置文件然后重启 Kibana，在浏览器地址栏输入：<code>localhost:5601</code> 再次查看：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/Kibana%E7%9A%84%E6%B1%89%E5%8C%96.png" alt="Kibana的汉化"></p>
<p>奈斯！成功汉化！🎉</p>
<h1 id="5-ES-的核心概念"><a class="header-anchor" href="#5-ES-的核心概念"></a>5. ES 的核心概念</h1>
<p>安装完 ES 后，我们来熟悉一下 ES 中的一些核心概念，比如：集群、节点、索引、类型、文档、分片、映射等等。</p>
<p>ES 是面向文档的，一切都是 JSON，来看看关系型数据库与 ES 的一个小对比：</p>
<table>
<thead>
<tr>
<th style="text-align:center">Relational DB</th>
<th style="text-align:center">ElasticSearch</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">数据库（database）</td>
<td style="text-align:center">索引（indices）</td>
</tr>
<tr>
<td style="text-align:center">表（tables）</td>
<td style="text-align:center">types</td>
</tr>
<tr>
<td style="text-align:center">行（rows）</td>
<td style="text-align:center">documents</td>
</tr>
<tr>
<td style="text-align:center">字段（columns）</td>
<td style="text-align:center">fields</td>
</tr>
</tbody>
</table>
<p>ES 集群中可以包含多个索引（类似于数据库），每个索引中又可以包含多个类型（表），每个类型下又可以包含多个文档（行），每个文档下还包含多个字段（列）。</p>
<p><strong>物理设计：</strong></p>
<p>ES 在后台把每个索引划分成多个分片，每个分片可以在集群的不同服务器间迁移。</p>
<p>“一个人”就是一个集群，可以在 <code>ElasticSearch-head</code> 中看到默认集群名就叫：elasticsearch。</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/elasticsearch集群名.png" alt="elasticsearch集群名" style="zoom:67%;" />
<p><strong>逻辑设计：</strong></p>
<p>一个索引类型中，可以包含多个文档，比如：文档 1，文档 2。 当我们索引一篇文档时，可以通过这样一个顺序找到它：索引 ▷ 类型 ▷ 文档 ID，通过这个组合我们就能找到到某个具体的文档。</p>
<p>注意：ID 不必是整数，实际上它是个字符串。</p>
<h2 id="5-1-文档"><a class="header-anchor" href="#5-1-文档"></a>5.1 文档</h2>
<p>文档（document），就是一条条数据。比方说：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user</span><br><span class="line">	1 MOFAN 18</span><br><span class="line">	2 yang 20</span><br></pre></td></tr></table></figure>
<p>我们知道 ES 是面向文档的，那么就是说索引和数据搜索的最小单位是文档，ES 中，文档有几个重要属性：</p>
<ul>
<li>
<p>自我包含，一篇文档同时包含字段和对应的值，也就是同时包含 key 和 value。</p>
</li>
<li>
<p>可以是层次型的，一个文档中包含自文档，复杂的逻辑实体就是这么来的</p>
</li>
<li>
<p>灵活的结构，文档不依赖预先定义的模式。我们知道关系型数据库中，要提前定义字段才能使用，在 ES 中，对于字段是非常灵活的，我们可以忽略该字段，或者动态的添加一个新的字段。</p>
</li>
</ul>
<p>尽管我们可以随意的新增或者忽略某个字段，但是，每个字段的类型也非常重要，比如一个年龄字段类型，可以是字符串类型也可以是整形。因为 ES 会保存字段和类型之间的映射及其他的设置，这种映射具体到每个映射的每种类型，这也是为什么在 ES 中，类型有时候也称为映射类型。</p>
<h2 id="5-2-类型"><a class="header-anchor" href="#5-2-类型"></a>5.2 类型</h2>
<p>这里的类型和我们以前说的类型区别不大。类型是文档的逻辑容器，就像关系型数据库一样，表格是行的容器。</p>
<p>类型中对于字段的定义称为映射，比如 name 映射为字符串类型。 文档是无模式的，它们不需要拥有映射中所定义的所有字段。比如新增一个字段，那么 ES 是怎么做的呢？</p>
<p>ES 会自动的将新字段加入映射，但是不知道这个字段是什么类型，因此 ES 就就会进行推测。比如这个值是18，那么 ES 会认为它是整型。 既然是预测，也就可能猜不对， 所以最安全的方式就是提前定义好所需要的映射，然后再使用，这就和关系型数据库差不多了。</p>
<h2 id="5-3-索引"><a class="header-anchor" href="#5-3-索引"></a>5.3 索引</h2>
<p>根据前面的对比，可以看出 ES 中的索引就相当于数据库。</p>
<p>索引是映射类型的容器，ES 中的索引是一个非常大的文档集合。索引存储了映射类型的字段和其他设置， 然后它们被存储到各个分片上。</p>
<p>使用 <code>ElasticSearch-head</code> 创建 ES 的索引时，就会出现分片数的设置：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%96%B0%E5%BB%BA%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE%E5%88%86%E7%89%87%E6%95%B0.png" alt="新建索引设置分片数"></p>
<p>一个集群中至少有一个节点，而一个节点就是一个 ES 进程，节点可以有多个索引默认。</p>
<p>按照上图来说，如果创建索引，那么索引将会有个 5 个分片（primary shard，又称主分片）构成，而每一个主分片还会有一个副本（replica shard，又称复制分片）。</p>
<p>简单来说，分片就是数据分成多个文件放在不同服务器上。</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/ES%E7%9A%84%E9%9B%86%E7%BE%A4%E5%92%8C%E8%8A%82%E7%82%B9.png" alt="ES的集群和节点"></p>
<p>在上图是一个有 3 个节点的集群，可以看到主分片和对应的复制分片都不会在同一个节点内，如果某个节点挂了，数据也不会丢失。 实际上，一个分片是一个 Lucene 索引，一个包含 <mark>倒排索引</mark> 的文件目录，倒排索引的结构使得 ES 在不扫描全部文档的情况下，就能告诉你哪些文档包含特定的关键字。</p>
<p>那么什么是倒排索引？</p>
<h2 id="5-4-倒排索引"><a class="header-anchor" href="#5-4-倒排索引"></a>5.4 倒排索引</h2>
<p>简单来说，倒排索引就是分片之后，以关键词做 key，分片 ID 做 value。</p>
<p>ES 使用了一种称为倒排索引的结构，采用 Lucene 倒排索作为底层。这种结构适用于快速的全文搜索， 一个索引由文档中所有不重复的列表构成，对于每一个词，都有一个包含它的文档列表。 例如，现在有两个文档， 每个文档包含如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Study every day, good good up to forever  # 文档1包含的内容 </span><br><span class="line">To forever, study every day, good good up # 文档2包含的内容</span><br></pre></td></tr></table></figure>
<p>为了创建倒排索引，首先要将每个文档拆分成独立的词（或词条、tokens），然后创建一个包含所有不重复的词条的排序列表，然后列出每个词条出现在哪个文档，比如：</p>
<table>
<thead>
<tr>
<th style="text-align:center">term</th>
<th style="text-align:center">doc_1</th>
<th style="text-align:center">doc_2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Study</td>
<td style="text-align:center">√</td>
<td style="text-align:center">×</td>
</tr>
<tr>
<td style="text-align:center">To</td>
<td style="text-align:center">×</td>
<td style="text-align:center">×</td>
</tr>
<tr>
<td style="text-align:center">every</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">forever</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">day</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">study</td>
<td style="text-align:center">×</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">good</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">every</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">to</td>
<td style="text-align:center">√</td>
<td style="text-align:center">×</td>
</tr>
<tr>
<td style="text-align:center">up</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
</tbody>
</table>
<p>如果我们试图搜索 <code>to forever</code>，就只需要查看包含每个词条的文档权重：</p>
<table>
<thead>
<tr>
<th style="text-align:center">term</th>
<th style="text-align:center">doc_1</th>
<th style="text-align:center">doc_2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">to</td>
<td style="text-align:center">√</td>
<td style="text-align:center">×</td>
</tr>
<tr>
<td style="text-align:center">forever</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">total</td>
<td style="text-align:center">2</td>
<td style="text-align:center">1</td>
</tr>
</tbody>
</table>
<p>两个文档都匹配，但是第一个文档比第二个匹配度更高。</p>
<p>如果没有别的条件，两个包含关键词的文档都会返回。</p>
<p>再看一个示例，比如我们通过博客标签来搜索博客文章。倒排索引列表有这样的一个结构：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%8D%9A%E5%AE%A2%E6%96%87%E7%AB%A0%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95.png" alt="博客文章倒排索引"></p>
<p>如果要搜索含有 python 标签的文章，那相对于查找所有原始数据而言，查找倒排索引后的数据将会快得多。只需要查看标签这一栏，然后获取相关的文章 ID 即可，这样可以完全过滤掉无关的所有数据。</p>
<blockquote>
<p>ES 的索引和 Lucene 的索引对比</p>
</blockquote>
<p>在 ES 中，索引被分为多个分片，每份分片是一个 Lucene 的索引。所以一个 ES 索引是由多个 Lucene 索引组成<br>
的。</p>
<p>如无特指，说起索引都是指 ES 的索引。</p>
<p>接下来，我们在 Kibana 中的开发者工具中编写一下 ES 的操作语句。</p>
<h1 id="6-IK-分词器"><a class="header-anchor" href="#6-IK-分词器"></a>6. IK 分词器</h1>
<h2 id="6-1-什么是-IK-分词器"><a class="header-anchor" href="#6-1-什么是-IK-分词器"></a>6.1 什么是 IK 分词器</h2>
<p>所谓分词，就是把一段中文或者别的划分成一个个的关键字，我们在搜索时候会把自己的信息进行分词，并把数据库中或者索引库中的数据也进行分词，然后进行一个匹配操作，默认的中文分词是将每个字看成一个词。比如：“默烦帅逼”一段字，就会分割成“默”、“烦”、“帅”和“逼”四个字，这显然是不正确的。</p>
<p>如果要使用中文，建议使用 IK 分词器！</p>
<p>IK 提供了两个分词算法：<code>ik_smart</code> 和 <code>ik_max_word</code>，其中 <code>ik_smart</code> 为最少切分，<code>ik_max_word</code> 为最细粒度划分！</p>
<h2 id="6-2-下载安装"><a class="header-anchor" href="#6-2-下载安装"></a>6.2 下载安装</h2>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">Github 下载地址</a></p>
<p>下载完毕后（注意版本匹配），放入我们的 ES 目录中的 plugins 目录中：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/解压ik.png" alt="解压ik"  />
<p>然后重启 ES：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%8A%A0%E8%BD%BDik%E5%88%86%E8%AF%8D%E5%99%A8.png" alt="加载ik分词器"></p>
<p>我们可以看到，解压之后运行 ES 就自动加载了 IK 分词器。</p>
<p>除此之外，可以在 ES 的 bin 目录下打开 CMD，然后运行 <code>elasticsearch-plugin list</code> 命令来查看加载的插件：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%9F%A5%E7%9C%8B%E5%8A%A0%E8%BD%BD%E6%8F%92%E4%BB%B6.png" alt="命令行查看加载插件"></p>
<h2 id="6-3-IK-分词器的使用"><a class="header-anchor" href="#6-3-IK-分词器的使用"></a>6.3 IK 分词器的使用</h2>
<blockquote>
<p>分词算法测试</p>
</blockquote>
<p>安装完毕后，我们使用 Kibana 来测试一下：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95ik_smart%E6%B5%8B%E8%AF%95.png" alt="分词算法ik_smart测试"></p>
<p>先使用分词算法 <code>ik_smart</code> 进行测试，可以在左边看到结果，是一种最小切分（没有重复的字）。</p>
<p>再使用分词算法 <code>ik_max_word</code> 进行测试，也可以看到结果，将所有可能的组合都列了出来，是一种最细粒度的气切分（有重复的字）。</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95ik_max_word%E6%B5%8B%E8%AF%95.png" alt="分词算法ik_max_word测试"></p>
<p>那为什么会切分成这样，很明显有一个字典在引导切分。</p>
<blockquote>
<p>发现问题</p>
</blockquote>
<p>再换个文本测试一下分词算法：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%88%86%E8%AF%8D%E5%99%A8%E9%97%AE%E9%A2%98%E5%8F%91%E7%8E%B0.png" alt="分词器问题发现"></p>
<p>更换测试文本后，使用两种算法得到一样的结果。但这不是最重要，最重要的是：我们发现“默烦”两字被切分开了，显然是在字典中没有这个词，那怎么办呢？</p>
<p>就需要自己增加字典配置。</p>
<blockquote>
<p>增加字典配置</p>
</blockquote>
<p>操作很简单！</p>
<p>1、进入 IK 分词器的 config 目录，创建文件 <code>mofan.dic</code>，文件内添加“默烦”两字，如：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/添加字典配置.png" alt="添加字典配置" style="zoom:67%;" />
<p>2、然后打开这个目录下的 <code>IKAnalyzer.cfg.xml</code> 文件，拓展字典：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/配置文件拓展字典.png" alt="配置文件拓展字典" style="zoom: 67%;" />
<p>3、重启 ES，重启 Kibana。重启 ES 时，可以看到已经加载了我们配置的字典：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%8A%A0%E8%BD%BD%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E5%85%B8%E9%85%8D%E7%BD%AE.png" alt="加载自定义字典配置"></p>
<p>4、浏览器进入 Kibana 的开发者工具，输入与前文相同的一段字进行测试：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%B5%8B%E8%AF%95%E5%AD%97%E5%85%B8%E9%85%8D%E7%BD%AE.png" alt="测试字典配置"></p>
<p>我们发现“默烦”两字没有被拆开，而是一个词，证明我们的字典配置正确！</p>
<h1 id="7-基本操作"><a class="header-anchor" href="#7-基本操作"></a>7. 基本操作</h1>
<h2 id="7-1-Rest-风格说明"><a class="header-anchor" href="#7-1-Rest-风格说明"></a>7.1 Rest 风格说明</h2>
<p>Rest 是一种软件架构风格，或者说是一种规范，其强调 HTTP 应当以资源为中心，并且规范了 URI 的风格，规范了 HTTP 请求动作（GET / PUT / POST / DELETE / HEAD / OPTIONS）的使用，具有对应的语义。</p>
<p>基本 Rest 命令说明：</p>
<table>
<thead>
<tr>
<th style="text-align:center">method</th>
<th style="text-align:center">URL 地址</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">PUT</td>
<td style="text-align:center">localhost:9200/索引名称/类型名称/文档id</td>
<td style="text-align:center">创建文档（指定文档id）</td>
</tr>
<tr>
<td style="text-align:center">POST</td>
<td style="text-align:center">localhost:9200/索引名称/类型名称</td>
<td style="text-align:center">创建文档（随机文档id）</td>
</tr>
<tr>
<td style="text-align:center">POST</td>
<td style="text-align:center">localhost:9200/索引名称/类型名称/文档id/_update</td>
<td style="text-align:center">修改文档</td>
</tr>
<tr>
<td style="text-align:center">DELETE</td>
<td style="text-align:center">localhost:9200/索引名称/类型名称/文档id</td>
<td style="text-align:center">删除文档</td>
</tr>
<tr>
<td style="text-align:center">GET</td>
<td style="text-align:center">localhost:9200/索引名称/类型名称/文档id</td>
<td style="text-align:center">查询文档通过 id</td>
</tr>
<tr>
<td style="text-align:center">POST</td>
<td style="text-align:center">localhost:9200/索引名称/类型名称/_search</td>
<td style="text-align:center">查询所有数据</td>
</tr>
</tbody>
</table>
<h2 id="7-2-索引的基本操作"><a class="header-anchor" href="#7-2-索引的基本操作"></a>7.2 索引的基本操作</h2>
<blockquote>
<p>创建一个索引</p>
</blockquote>
<p>先运行 <code>elasticsearch-head</code> 查看当前有哪些索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.apm-agent-configuration</span><br><span class="line">.kibana_1</span><br><span class="line">.kibana_task_manager_1</span><br></pre></td></tr></table></figure>
<p>我们发现只有上述三个索引，并且都是 ES 自带的。</p>
<p>打开 Kibana，创建一个索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PUT /索引/~类型名~/文档id</span><br><span class="line">&#123;请求体&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%B4%A2%E5%BC%95.png" alt="创建一个索引"></p>
<p>执行命令后，前往 <code>elasticsearch-head</code> 看看是否真的成功创建了索引：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%9F%A5%E7%9C%8B%E5%88%9B%E5%BB%BA%E7%9A%84%E7%B4%A2%E5%BC%95.png" alt="查看创建的索引"></p>
<p>再看看数据是否成功添加：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E6%88%90%E5%8A%9F%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE.png" alt="创建索引成功添加数据"></p>
<blockquote>
<p>指定字段类型</p>
</blockquote>
<p>前面创建了一个索引，并向其中添加了数据，但是并没有指定数据的类型，那怎么指定数据的类型呢？</p>
<p>在 ES 中，有以下类型：</p>
<ul>
<li>
<p>字符串类型：text、keyword</p>
</li>
<li>
<p>数值类型：long、integer、short、byte、double、ﬂoat、half ﬂoat、scaled ﬂoat</p>
</li>
<li>
<p>日期类型：date</p>
</li>
<li>
<p>布尔值类型：boolean</p>
</li>
<li>
<p>二进制类型：binary</p>
</li>
<li>
<p>等等…</p>
</li>
</ul>
<p>创建一个名为 test2 的索引，设置字段的类型，不添加数据：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B.png" alt="创建索引设置字段类型"></p>
<blockquote>
<p>获取信息</p>
</blockquote>
<p>那我们怎么获取 test2 的信息呢？这里有一个 <code>GET</code> 的命令可以获取：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%9F%A5%E7%9C%8Btest2%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BF%A1%E6%81%AF.png" alt="查看test2索引的信息"></p>
<p>刚刚是获取了 test2 的信息，test2 中的字段是指定了类型的，那如果没指定类型呢？</p>
<p>创建一个新索引，直接插入数据，不指定数据类型：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%88%9B%E5%BB%BAtest3%E7%B4%A2%E5%BC%95%E5%B9%B6%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE.png" alt="创建test3索引并添加数据"></p>
<p>再使用 <code>GET</code> 命令查看一下 test3 索引的信息：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%9F%A5%E7%9C%8Btest3%E7%B4%A2%E5%BC%95%E4%BF%A1%E6%81%AF.png" alt="查看test3索引信息"></p>
<p>很显然，如果文档的字段没有指定类型，ES 会默认配置字段类型。</p>
<p><strong>GET 其他用法：</strong></p>
<p>查看集群健康状态：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/health</span><br></pre></td></tr></table></figure>
<p>查看索引信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/indices?v</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E4%BF%A1%E6%81%AF.png" alt="查看索引信息"></p>
<p>通过 <code>GET  _cat/</code>  可以获得 ES 当前的很多信息，参考链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/lixi5718/article/details/76270700">curl命令操作elasticsearch</a></p>
<blockquote>
<p>数据修改</p>
</blockquote>
<p>可以直接通过 <code>PUT</code> 命令实现数据的修改，比如：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/PUT%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E4%BF%AE%E6%94%B9.png" alt="PUT实现数据修改"></p>
<p>可以发现，<code>_version</code> 为 2，<code>result</code> 为 updated。</p>
<p>但这样有一个弊端，需要将没有修改的数据也写上，否则数据会丢失。</p>
<p>那还有其他的办法吗？</p>
<p>可以使用 <code>POST</code> 命令来更新数据：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/POST%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE.png" alt="POST更新数据"></p>
<blockquote>
<p>删除索引</p>
</blockquote>
<p>直接使用 DELETE 命令来实现删除，ES 会根据编写的命令来判断是删除文档还是删除索引，比如：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/DELETE%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95.png" alt="DELETE删除索引"></p>
<p>执行上述命令，删除索引 test1，去 <code>elasticsearch-head</code> 看看是否成功删除索引：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E9%AA%8C%E8%AF%81%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95.png" alt="验证删除索引"></p>
<p>可以看到 test1 索引确实被删除了！</p>
<h2 id="7-3-文档的基本操作"><a class="header-anchor" href="#7-3-文档的基本操作"></a>7.3 文档的基本操作</h2>
<blockquote>
<p>数据准备</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT /mofan/user/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;张三&quot;,</span><br><span class="line">  &quot;age&quot;: 3,</span><br><span class="line">  &quot;desc&quot;: &quot;法外狂徒&quot;,</span><br><span class="line">  &quot;tags&quot;:[&quot;渣男&quot;, &quot;唱歌&quot;, &quot;蹦迪&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>按照这样的语法，插入三条数据：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%90%91%E5%90%8C%E4%B8%80%E7%B4%A2%E5%BC%95%E6%8F%92%E5%85%A5%E4%B8%89%E6%9D%A1%E6%95%B0%E6%8D%AE.png" alt="向同一索引插入三条数据"></p>
<blockquote>
<p>获取数据（简单版）</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET mofan/user/3</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E8%8E%B7%E5%8F%96%E7%B4%A2%E5%BC%95%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE.png" alt="获取索引中的数据"></p>
<blockquote>
<p>更新数据</p>
</blockquote>
<p>前文以及说了，可以使用 <code>PUT</code> 命令，也可以使用 <code>POST</code> 命令（推荐使用 <code>POST</code>），比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST mofan/user/1/_update</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;:&#123;</span><br><span class="line">    &quot;name&quot;: &quot;王五&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/POST%E6%9B%B4%E6%96%B0.png" alt="POST更新"></p>
<blockquote>
<p>简单的条件查询</p>
</blockquote>
<p>查询 name 为李四的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET mofan/user/_search?q=name:李四</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%9F%A5%E8%AF%A2name%E4%B8%BA%E6%9D%8E%E5%9B%9B%E7%9A%84%E6%95%B0%E6%8D%AE.png" alt="查询name为李四的数据"></p>
<h2 id="7-4-复杂搜索"><a class="header-anchor" href="#7-4-复杂搜索"></a>7.4 复杂搜索</h2>
<p>在前文的查询结果中，可以看到有一个名为 <code>_score</code> 的字段，这个字段就表示 <strong>权重</strong> 的意思。在有多个查询结果的时候，这个字段的值越大，就表示匹配度越高。</p>
<p>PS：百度就是利用这玩意赚钱的 🤮</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/score%E5%90%AB%E4%B9%89.png" alt="score含义"></p>
<p>前文涉及的查询是一种简单查询，通过参数的方式进行查询，但是实际使用时我们一般不会这么做。</p>
<p>现在对 mofan 索引增加一条数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT mofan/user/4</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;默烦&quot;,</span><br><span class="line">  &quot;age&quot;: 18,</span><br><span class="line">  &quot;desc&quot;: &quot;小菜鸡&quot;,</span><br><span class="line">  &quot;tags&quot;: [&quot;学习&quot;, &quot;写博客&quot;, &quot;看番&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>假设要查询 name 为“默烦”的数据，像前文一样，可以这么查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET mofan/user/_search?q=name:默</span><br></pre></td></tr></table></figure>
<p>这相当于一种省略的写法，其实完整的写法是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET mofan/user/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;默&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样都可以查询出对应的数据：<br>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%9F%A5%E8%AF%A2name%E4%B8%BA%E9%BB%98%E7%83%A6%E7%9A%84%E6%95%B0%E6%8D%AE.png" alt="查询name为默烦的数据"></p>
<p>假设又添加一条数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT mofan/user/5</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;默小烦&quot;,</span><br><span class="line">  &quot;age&quot;: 6,</span><br><span class="line">  &quot;desc&quot;: &quot;菜鸡&quot;,</span><br><span class="line">  &quot;tags&quot;: [&quot;学习&quot;, &quot;写博客&quot;, &quot;看番&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后再次查询：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%9F%A5%E8%AF%A2%E5%BE%97%E5%88%B0name%E4%B8%BA%E9%BB%98%E7%9A%84%E4%B8%A4%E6%9D%A1%E7%BB%93%E6%9E%9C.png" alt="查询得到name为默的两条结果"></p>
<p>可以看到，查询得到了两条结果（图片大小所限，只能显示一条，但从 hits 的 value 可见，确实得到了两条结果），两条结果的排序按照 <code>_score</code> 大小进行降序排序，同时需要注意 hits 的作用，在 Java API 中也有一个类型的类。</p>
<blockquote>
<p>查询结果字段过滤</p>
</blockquote>
<p>上面的查询会将所有字段都查询出来，如果想 <strong>查询指定的字段</strong> 该怎么做呢？</p>
<p>类似于 MySQL 中的 <code>select *</code> 变成了 <code>select name, desc</code>：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%AD%97%E6%AE%B5%E8%BF%87%E6%BB%A4.png" alt="查询结果字段过滤"></p>
<blockquote>
<p>查询结果排序</p>
</blockquote>
<p>前面的结果的排序是按照 <code>_score</code> 降序排序的，那如果要指定排序规则呢？比如按照 age 进行升序排序。</p>
<p>相当于 MySQL 中的 <code>order by</code>：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5%E5%8D%87%E5%BA%8F%E6%8E%92%E5%BA%8F.png" alt="查询结果指定字段升序排序"></p>
<blockquote>
<p>分页</p>
</blockquote>
<p>数据太多，想进行分页查询该怎么办呢？</p>
<p>相当于 MySQL 中的 <code>limit</code>：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE.png" alt="分页查询数据"></p>
<p>在【查询结果排序】中，一共查得两条数据，第一条 name 为“默小烦”，第二条 name 为“默烦”。我们这里从第二条数据开始（第一条数据的 form 值为 0），每页一条数据，因此可以查得 name 为“默烦”的数据。</p>
<p><mark>注意：</mark> 数据小标从 0 开始，第一条数据的索引是 0。</p>
<blockquote>
<p>布尔值查询</p>
</blockquote>
<p>如果想要多条件查询，应该怎么办呢？可以使用布尔值查询。</p>
<p>比如查询 name 中带有“默”的，且 age 为 6 的数据。使用 <code>must</code> 命令，相当于 MySQL 中的 <code>and</code>：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/must%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2.png" alt="must布尔查询"></p>
<p>既然有 <code>and</code> 那么就有 <code>or</code>，在 ES 中可以使用 <code>should</code> 命令：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/should%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2.png" alt="should布尔查询"></p>
<p>图片大小所限，只能显示一条结果，但从 value 的值来看，确实查询出 <strong>两条</strong> 数据。</p>
<p>那如果要查询 name 中不带有“默”字的数据应该怎么操作呢？</p>
<p>可以使用 <code>must_not</code> 操作，相当于 MySQL 中的 <code>not</code>：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/must_not%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2.png" alt="must_not布尔查询"></p>
<p>图片大小所限，只能显示一条结果，但从 value 的值来看，确实查询出 <strong>三条</strong> 数据。因为 name 中不带有“默”字的有三条数据，分别是：李四、王五和鲲鲲。</p>
<p>那如果要进行范围查询呢？比如查询 name 中带有“默”字的，且 age 大于 16 的数据。在 ES 中可以使用 <code>filter</code>：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/filter%E5%8D%95%E6%9D%A1%E4%BB%B6%E8%BF%87%E6%BB%A4.png" alt="filter单条件过滤"></p>
<p>当然也可以进行多条件过滤：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/filter%E5%A4%9A%E6%9D%A1%E4%BB%B6%E8%BF%87%E6%BB%A4.png" alt="filter多条件过滤"></p>
<blockquote>
<p>多条件匹配</p>
</blockquote>
<p>如果我想要根据 tags 进行查询，查询 tags 中包含“博客”和“男”的数据，应该怎么做？<br>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%A4%9A%E6%9D%A1%E4%BB%B6%E5%8C%B9%E9%85%8D%E6%9F%A5%E8%AF%A2.png" alt="多条件匹配查询"></p>
<p>针对同一字段的多个条件，使用空格隔开就可以了，而且只要满足其中一个条件都会被查询出来，可以通过 <code>_score</code> 进行判断。</p>
<p>查询结果有三条，分别是 name 为“默烦”、“默小烦”和“王五”的数据（上图中省略了第一条 name 为“默烦”的数据）。</p>
<blockquote>
<p>精确查询</p>
</blockquote>
<p>前文涉及的查询都是一种 <strong>模糊查询</strong>，但如果要进行精确查询应该怎么办？</p>
<p>term 查询是直接通过 <mark>倒排索引</mark> 指定的词条进程精确查找的。</p>
<p><strong>关于分词：</strong></p>
<p>term：直接查询精确</p>
<p>match：会使用分词器解析（先分析文档，然后在通过分析的文档进行查询）</p>
<p>很显然，使用 term 效率更高！</p>
<p><strong>两个类型的解析：test 和 keyword</strong></p>
<p>又创建一个索引 testdb，并添加两条数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PUT testdb</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;name&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;desc&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT testdb/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;默烦 name&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;默烦 desc&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT testdb/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;默烦 name&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;默烦 desc2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们先来测试一下：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/keyword%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95%E6%B5%8B%E8%AF%95.png" alt="keyword分词算法测试"></p>
<p>换种分词算法：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/standard%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95%E6%B5%8B%E8%AF%95.png" alt="standard分词算法测试"></p>
<p>查询 name 中带有“默”的数据：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/name%E4%B8%AD%E5%B8%A6%E6%9C%89%E9%BB%98%E7%9A%84%E6%95%B0%E6%8D%AE.png" alt="name中带有默的数据"></p>
<p>name 是 text 类型的，可以看到能查询出两条结果，再来试试查询 desc 中带有“默”的数据：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/desc%E4%B8%AD%E5%B8%A6%E6%9C%89%E9%BB%98%E7%9A%84%E6%95%B0%E6%8D%AE.png" alt="desc中带有默的数据"></p>
<p>由于 desc 的类型是 <code>keyword</code> 的，这个类型的值不会被分词器解析。也就是说，查询 desc 中带有“默”的数据只会查询出 desc 的值为“默”的数据，很显然并没有，因此不会查询出数据。换种方式试试：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/keyword%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2%E5%86%8D%E6%B5%8B%E8%AF%95.png" alt="keyword字段查询再测试"></p>
<p>这样的话就可以精确匹配了！ 🎉</p>
<blockquote>
<p>多个值匹配精确查询</p>
</blockquote>
<p>先往 testdb 索引中插入两条数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT testdb/_doc/3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;t1&quot;: &quot;22&quot;,</span><br><span class="line">  &quot;t2&quot;: &quot;2020-11-15&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT testdb/_doc/4</span><br><span class="line">&#123;</span><br><span class="line">  &quot;t1&quot;: &quot;33&quot;,</span><br><span class="line">  &quot;t2&quot;: &quot;2020-11-16&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现精确查询，需要使用 <code>term</code>；实现多个值匹配，需要使用 <code>should</code>。</p>
<p>因此，要实现多个值匹配查询，只需要将两者结合就可以了：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%A4%9A%E4%B8%AA%E5%80%BC%E5%8C%B9%E9%85%8D%E7%B2%BE%E7%A1%AE%E6%9F%A5%E8%AF%A2.png" alt="多个值匹配精确查询"></p>
<blockquote>
<p>高亮查询</p>
</blockquote>
<p>除此之外，ES 还支持一个很 <mark>牛逼</mark> 的功能——高亮查询！</p>
<p>高亮查询就像百度、淘宝、京东搜索某些东西时，会在搜索结果中根据搜索的内容进行高亮显示。比如，我想将 mofan 索引中，name 字段值带有“默烦”的文档高亮显示出来：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2%E6%B5%8B%E8%AF%95.png" alt="高亮查询测试"></p>
<p>那如果不想让高亮字段被 <code>&lt;em&gt;</code> 标签包裹起来呢？ES 支持自定义高亮包裹标签：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AB%98%E4%BA%AE%E7%BB%93%E6%9E%9C%E6%A0%87%E7%AD%BE.png" alt="自定义高亮结果标签"></p>
<p>当然，这些功能 MySQL 也能做到，但是效率就不如 ES 了。</p>
<h1 id="8-集成-SpringBoot"><a class="header-anchor" href="#8-集成-SpringBoot"></a>8. 集成 SpringBoot</h1>
<h2 id="8-1-集成准备"><a class="header-anchor" href="#8-1-集成准备"></a>8.1 集成准备</h2>
<p>看官方文档，官方怎么搞，我们怎么搞。</p>
<p>官方文档链接：<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/index.html">ES docs</a></p>
<p>进入文档后，可以看到：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/ElasticStackAndProductDocumentation.png" alt="ElasticStackAndProductDocumentation" style="zoom:50%;" />
<p>点击 <code>Elasticsearch Clients</code> 进入：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/ElasticsearchClients.png" alt="ElasticsearchClients" style="zoom:50%;" />
<p>由于官网版本是 7.10，而我们的版本是 7.6，因此点击 <code>other versions</code>，选择 7.6 的版本：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/JavaRESTClient.png" alt="JavaRESTClient" style="zoom:50%;" />
<p>进入后，可以看到：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/JavaRESTClient-7.6.png" alt="JavaRESTClient-7.6" style="zoom:50%;" />
<p>点击 <code>Java High Level REST Client</code> 旁边的 + 号，然后点击 <code>Getting started</code>：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/Getting started.png" alt="Getting started" style="zoom:50%;" />
<p>点击 <code>Maven Repository</code> 找到原生依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>点击右边的 <code>Initialization</code>：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/Initialization.png" alt="Initialization" style="zoom: 67%;" />
<p>接下来，使用 IDEA 导入对应的依赖，分析一下这个类中的方法。</p>
<blockquote>
<p>配置基本的项目</p>
</blockquote>
<p>SpringBoot 需要导入的依赖：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/项目需要导入的依赖.png" alt="项目需要导入的依赖" style="zoom:50%;" />
<p>项目创建完毕后，查看一下导入的依赖：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/依赖版本与本地版本不一致.png" alt="依赖版本与本地版本不一致" style="zoom: 67%;" />
<p><mark>注意：</mark> 一定要保证导入的依赖和 ES 版本一致！</p>
<p>因此，需要在 pom.xml 文件中进行配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--自定义 ES 的版本，保证和本地的版本一致--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.6.1<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我在此顺便也将 SpringBoot 的版本降至 2.2.6。</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/更换依赖版本.png" alt="更换依赖版本" style="zoom:67%;" />
<p>编写一个配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> indi.mofan.config;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 默烦 2020/11/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticSearchConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestHighLevelClient <span class="title function_">restHighLevelClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9200</span>, <span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在项目的依赖中，找到 ES 自动配置的依赖：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/ES自动配置依赖.png" alt="ES自动配置依赖" style="zoom: 67%;" />
<p>查看源码中提供的对象：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/ES%E6%BA%90%E7%A0%81%E4%B8%AD%E6%8F%90%E4%BE%9B%E7%9A%84%E5%AF%B9%E8%B1%A1.png" alt="ES源码中提供的对象"></p>
<p>从上图中可以看出，虽然 <code>@Import</code> 导入了三个类，其实都是内部类，核心类只有一个：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RestClientConfigurations</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RestClientBuilderConfiguration</span> &#123;</span><br><span class="line">        <span class="comment">// 省略代码</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">    <span class="meta">@ConditionalOnClass(RestHighLevelClient.class)</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RestHighLevelClientConfiguration</span> &#123;</span><br><span class="line">        <span class="comment">// 省略代码</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RestClientFallbackConfiguration</span> &#123;</span><br><span class="line">        <span class="comment">// 省略代码</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-2-索引-API-测试"><a class="header-anchor" href="#8-2-索引-API-测试"></a>8.2 索引 API 测试</h2>
<blockquote>
<p>创建索引</p>
</blockquote>
<p>在 SpringBoot 项目的测试类中进行编写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EsApiApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="meta">@Qualifier(&quot;restHighLevelClient&quot;)</span></span><br><span class="line">   <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 测试索引的创建 Request</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">testCreateIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">      <span class="comment">// 1. 创建索引请求</span></span><br><span class="line">      <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">&quot;mofan_index&quot;</span>);</span><br><span class="line">      <span class="comment">// 2. 执行创建请求 IndicesClient，请求后获得响应</span></span><br><span class="line">      <span class="type">CreateIndexResponse</span> <span class="variable">createIndexResponse</span></span><br><span class="line">            <span class="operator">=</span> client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">      System.out.println(createIndexResponse);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上述代码，启动 <code>ElasticSearch-head</code>，然后访问 9100 端口，可以看到 mofan_index 索引已经创建成功：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%88%90%E5%8A%9F%E5%88%9B%E5%BB%BAmofan_index%E7%B4%A2%E5%BC%95.png" alt="成功创建mofan_index索引"></p>
<blockquote>
<p>判断索引是否存在</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试获取索引，只能判断其是否存在</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testExistIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">   <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;mofan_index&quot;</span>);</span><br><span class="line">   <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">   System.out.println(exists); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>删除索引</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试删除索引</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDeleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">   <span class="type">DeleteIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">&quot;mofan_index&quot;</span>);</span><br><span class="line">   <span class="type">AcknowledgedResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">   <span class="comment">// 如果返回 true 证明删除成功</span></span><br><span class="line">   System.out.println(response.isAcknowledged()); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上述代码，启动 <code>ElasticSearch-head</code>，然后访问 9100 端口，可以看到 mofan_index 索引已经删除成功：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%88%90%E5%8A%9F%E5%88%A0%E9%99%A4mofan_index%E7%B4%A2%E5%BC%95.png" alt="成功删除mofan_index索引"></p>
<p>为了便于后续测试查看，我们删除除 <code>mofan_index</code> 以外的所有索引：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E5%88%A0%E9%99%A4%E5%A4%9A%E4%BD%99%E7%9A%84%E7%B4%A2%E5%BC%95.png" alt="删除多余的索引"></p>
<h2 id="8-3-文档-API-测试"><a class="header-anchor" href="#8-3-文档-API-测试"></a>8.3 文档 API 测试</h2>
<p>为便于使用 JSON，在 pom.xml 中导入 <code>fastjson</code> 依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入 fastJson --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.62<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>创建一个实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 默烦 2020/11/16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建文档</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试添加文档</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testAddDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 创建对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;默烦&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    <span class="comment">// 创建请求</span></span><br><span class="line">    <span class="type">IndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;mofan_index&quot;</span>);</span><br><span class="line">    <span class="comment">// 规则 put/mofan_index/_doc/1</span></span><br><span class="line">    <span class="comment">// 支持链式编程</span></span><br><span class="line">    request.id(<span class="string">&quot;1&quot;</span>).timeout(TimeValue.timeValueSeconds(<span class="number">1</span>));</span><br><span class="line">    <span class="comment">// 将我们的数据放入请求 json</span></span><br><span class="line">    <span class="type">IndexRequest</span> <span class="variable">source</span> <span class="operator">=</span> request.source(JSON.toJSONString(user), XContentType.JSON);</span><br><span class="line">    <span class="comment">// 客户端发送请求</span></span><br><span class="line">    <span class="type">IndexResponse</span> <span class="variable">indexResponse</span> <span class="operator">=</span> client.index(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(indexResponse.toString());</span><br><span class="line">    System.out.println(indexResponse.status()); <span class="comment">// CREATED</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上述代码后，进 9100 端口查看：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%B5%8B%E8%AF%95%E5%88%9B%E5%BB%BA%E6%96%87%E6%A1%A3.png" alt="测试创建文档"></p>
<blockquote>
<p>测试某一文档是否存在</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试获取文档，判断文档是否存在</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testIsExistDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">GetRequest</span> <span class="variable">getRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;mofan_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="comment">// 不获取返回的 _source 的上下文</span></span><br><span class="line">    getRequest.fetchSourceContext(<span class="keyword">new</span> <span class="title class_">FetchSourceContext</span>(<span class="literal">false</span>));</span><br><span class="line">    getRequest.storedFields(<span class="string">&quot;_none_&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> client.exists(getRequest, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(exists); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>获取文档的内容</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得文档的信息</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">GetRequest</span> <span class="variable">getRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;mofan_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    <span class="type">GetResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.get(getRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印文档的内容</span></span><br><span class="line">    System.out.println(response.getSourceAsString());</span><br><span class="line">    System.out.println(response); <span class="comment">// 返回的全部内容和 Kibana 看到的是一样的</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行后，控制台输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;age&quot;:18,&quot;name&quot;:&quot;默烦&quot;&#125;</span><br><span class="line">&#123;&quot;_index&quot;:&quot;mofan_index&quot;,&quot;_type&quot;:&quot;_doc&quot;,&quot;_id&quot;:&quot;1&quot;,&quot;_version&quot;:1,&quot;_seq_no&quot;:0,&quot;_primary_term&quot;:1,&quot;found&quot;:true,&quot;_source&quot;:&#123;&quot;age&quot;:18,&quot;name&quot;:&quot;默烦&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>更新文档的信息</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新文档的信息</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">UpdateRequest</span> <span class="variable">updateRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>(<span class="string">&quot;mofan_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    updateRequest.timeout(<span class="string">&quot;1s&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;mofan&quot;</span>, <span class="number">5</span>);</span><br><span class="line">    updateRequest.doc(JSON.toJSONString(user), XContentType.JSON);</span><br><span class="line"></span><br><span class="line">    <span class="type">UpdateResponse</span> <span class="variable">updateResponse</span> <span class="operator">=</span> client.update(updateRequest, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(updateResponse.status()); <span class="comment">// OK</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上述代码后，前往 9100 端口查看：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%B5%8B%E8%AF%95%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3.png" alt="测试更新文档"></p>
<blockquote>
<p>删除文档记录</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文档记录</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testDeleteRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">DeleteRequest</span> <span class="variable">deleteRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>(<span class="string">&quot;mofan_index&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">    deleteRequest.timeout(<span class="string">&quot;1s&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">DeleteResponse</span> <span class="variable">deleteResponse</span> <span class="operator">=</span> client.delete(deleteRequest, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(deleteResponse.status()); <span class="comment">// OK</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上述代码后，前往 9100 端口查看：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%B5%8B%E8%AF%95%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3.png" alt="测试删除文档"></p>
<blockquote>
<p>批量插入文档</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 批量插入数据</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBulkRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">BulkRequest</span> <span class="variable">bulkRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">    bulkRequest.timeout(<span class="string">&quot;1s&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ArrayList&lt;User&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    userList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;mofan1&quot;</span>, <span class="number">5</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;mofan2&quot;</span>, <span class="number">6</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;mofan3&quot;</span>, <span class="number">7</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;mofan4&quot;</span>, <span class="number">8</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;mofan5&quot;</span>, <span class="number">9</span>));</span><br><span class="line">    userList.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;mofan6&quot;</span>, <span class="number">10</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; userList.size(); i++) &#123;</span><br><span class="line">        bulkRequest.add(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;mofan_index&quot;</span>)</span><br><span class="line">                        .id(<span class="string">&quot;&quot;</span> + (i + <span class="number">1</span>))</span><br><span class="line">                        .source(JSON.toJSONString(userList.get(i)), XContentType.JSON)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">BulkResponse</span> <span class="variable">bulkResponse</span> <span class="operator">=</span> client.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(bulkResponse.hasFailures()); <span class="comment">// false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上述代码后，前往 9100 端口查看：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3.png" alt="批量插入文档"></p>
<blockquote>
<p>查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSearch</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;mofan_index&quot;</span>);</span><br><span class="line">    <span class="comment">// 构建搜索条件</span></span><br><span class="line">    <span class="type">SearchSourceBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">    <span class="comment">// 查询条件</span></span><br><span class="line">    <span class="type">TermQueryBuilder</span> <span class="variable">termQueryBuilder</span> <span class="operator">=</span> QueryBuilders.termQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;mofan1&quot;</span>);</span><br><span class="line">    builder.query(termQueryBuilder);</span><br><span class="line">    builder.timeout(<span class="keyword">new</span> <span class="title class_">TimeValue</span>(<span class="number">60</span>, TimeUnit.SECONDS));</span><br><span class="line"></span><br><span class="line">    searchRequest.source(builder);</span><br><span class="line"></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> client.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(JSON.toJSONString(searchResponse.getHits()));</span><br><span class="line">    System.out.println(<span class="string">&quot;===============================&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (SearchHit documentFields : searchResponse.getHits().getHits()) &#123;</span><br><span class="line">        System.out.println(documentFields.getSourceAsMap());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码实现了精确查询，控制台输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;fragment&quot;:true,&quot;hits&quot;:[&#123;&quot;fields&quot;:&#123;&#125;,&quot;fragment&quot;:false,&quot;highlightFields&quot;:&#123;&#125;,&quot;id&quot;:&quot;1&quot;,&quot;matchedQueries&quot;:[],&quot;primaryTerm&quot;:0,&quot;rawSortValues&quot;:[],&quot;score&quot;:1.540445,&quot;seqNo&quot;:-2,&quot;sortValues&quot;:[],&quot;sourceAsMap&quot;:&#123;&quot;name&quot;:&quot;mofan1&quot;,&quot;age&quot;:5&#125;,&quot;sourceAsString&quot;:&quot;&#123;\&quot;age\&quot;:5,\&quot;name\&quot;:\&quot;mofan1\&quot;&#125;&quot;,&quot;sourceRef&quot;:&#123;&quot;fragment&quot;:true&#125;,&quot;type&quot;:&quot;_doc&quot;,&quot;version&quot;:-1&#125;],&quot;maxScore&quot;:1.540445,&quot;totalHits&quot;:&#123;&quot;relation&quot;:&quot;EQUAL_TO&quot;,&quot;value&quot;:1&#125;&#125;</span><br><span class="line">===============================</span><br><span class="line">&#123;name=mofan1, age=5&#125;</span><br></pre></td></tr></table></figure>
<p>此处的 name 字段值如果是中文，由于使用了默认的分词器，将会导致查询失败！</p>
<p>其他查询 API：</p>
<p><code>termQuery(key, obj)</code>：单个精准匹配</p>
<p><code>termsQuery(key, obj1, obj2..)</code>：多个精准匹配</p>
<p><code>matchQuery(key, Obj)</code>：单个匹配</p>
<p><code>multiMatchQuery(text, field1, field2...)</code>：多字段匹配</p>
<p><code>matchAllQuery()</code>：匹配所有文件</p>
<h1 id="9-京东搜索小-Demo"><a class="header-anchor" href="#9-京东搜索小-Demo"></a>9. 京东搜索小 Demo</h1>
<h2 id="9-1-初始化-Demo"><a class="header-anchor" href="#9-1-初始化-Demo"></a>9.1 初始化 Demo</h2>
<p>关闭前面创建的 Module，在当前工程下新建一个 Module。创建一个 SpringBoot 项目，导入以下依赖：</p>
<img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/MiddlewareImages/Demo依赖.png" alt="Demo依赖" style="zoom: 50%;" />
<p>创建好项目后，更改 pom.xml 文件，修改 SpringBoot 版本至 2.2.6，设置 ES 的版本，导入 FastJSON 的依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--自定义 ES 的版本，保证和本地的版本一致--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.6.1<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入 fastJson --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.62<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后导入必要的素材，比如 JS、CSS和图片。</p>
<p>修改 application.properties 配置文件：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">9090</span></span><br><span class="line"><span class="comment"># 关闭 Thymeleaf 的缓存</span></span><br><span class="line"><span class="attr">spring.thymeleaf.cache</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>
<p>接下来，就是数据的问题了。</p>
<h2 id="9-2-爬取数据"><a class="header-anchor" href="#9-2-爬取数据"></a>9.2 爬取数据</h2>
<p>我们可以使用 JSoup 来解析网页，因此需要导入对应的依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入jsoup--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.jsoup/jsoup --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jsoup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsoup<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>需要将解析的网页内容放入一个对象中，因此需要自定义一个对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 默烦 2020/11/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Content</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String img;</span><br><span class="line">    <span class="keyword">private</span> String price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后就解析网页：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 默烦 2020/11/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HtmlParseUtil</span> &#123;</span><br><span class="line"><span class="comment">//    public static void main(String[] args)  throws IOException&#123;</span></span><br><span class="line"><span class="comment">//        // 测试</span></span><br><span class="line"><span class="comment">//        new HtmlParseUtil().parseJD(&quot;Java&quot;).forEach(System.out::println);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Content&gt; <span class="title function_">parseJD</span><span class="params">(String keywords)</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line"><span class="comment">// 获取请求 https://search.jd.com/Search?keyword=Java</span></span><br><span class="line">        <span class="comment">// 前提：需要联网，且 Ajax 的请求无法获取</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://search.jd.com/Search?keyword=&quot;</span> + keywords;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析网页 Document 对象就是浏览器的 Document 对象</span></span><br><span class="line">        <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">URL</span>(url), <span class="number">30000</span>);</span><br><span class="line">        <span class="comment">// 所有在 JS 中能使用的方法，在这里都可以使用</span></span><br><span class="line">        <span class="type">Element</span> <span class="variable">element</span> <span class="operator">=</span> document.getElementById(<span class="string">&quot;J_goodsList&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// System.out.println(element.html());</span></span><br><span class="line">        <span class="comment">// 获取所有的 &lt;li&gt; 标签</span></span><br><span class="line">        <span class="type">Elements</span> <span class="variable">elements</span> <span class="operator">=</span> element.getElementsByTag(<span class="string">&quot;li&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Content&gt; goodsList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 获取元素中的内容</span></span><br><span class="line">        <span class="keyword">for</span> (Element el : elements) &#123;</span><br><span class="line">            <span class="comment">// 这是 20-11-17 获取元素的方式，随着时间的推移，获取方式可能会发生改变</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">img</span> <span class="operator">=</span> el.getElementsByTag(<span class="string">&quot;img&quot;</span>).eq(<span class="number">0</span>).attr(<span class="string">&quot;data-lazy-img&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">price</span> <span class="operator">=</span> el.getElementsByClass(<span class="string">&quot;p-price&quot;</span>).eq(<span class="number">0</span>).text();</span><br><span class="line">            <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> el.getElementsByClass(<span class="string">&quot;p-name&quot;</span>).eq(<span class="number">0</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">//            System.out.println(&quot;================================&quot;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            System.out.println(img);</span></span><br><span class="line"><span class="comment">//            System.out.println(price);</span></span><br><span class="line"><span class="comment">//            System.out.println(title);</span></span><br><span class="line"></span><br><span class="line">            <span class="type">Content</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Content</span>();</span><br><span class="line">            content.setTitle(title);</span><br><span class="line">            content.setPrice(price);</span><br><span class="line">            content.setImg(img);</span><br><span class="line">            goodsList.add(content);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> goodsList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-3-业务编写"><a class="header-anchor" href="#9-3-业务编写"></a>9.3 业务编写</h2>
<p>同样，需要 ES 的配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 默烦 2020/11/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticSearchConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestHighLevelClient <span class="title function_">restHighLevelClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9200</span>, <span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写 Service，为了简洁，就不面向接口了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> indi.mofan.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> indi.mofan.pojo.Content;</span><br><span class="line"><span class="keyword">import</span> indi.mofan.utils.HtmlParseUtil;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.indices.CreateIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.indices.GetIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.unit.TimeValue;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.TermQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 默烦 2020/11/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;restHighLevelClient&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient restHighLevelClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 解析数据放入 es 索引中</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">parseContent</span><span class="params">(String keywords)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        List&lt;Content&gt; contents = <span class="keyword">new</span> <span class="title class_">HtmlParseUtil</span>().parseJD(keywords);</span><br><span class="line"></span><br><span class="line">        <span class="type">GetIndexRequest</span> <span class="variable">getIndexRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;jd_goods&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!client.indices().exists(getIndexRequest, RequestOptions.DEFAULT)) &#123;</span><br><span class="line">            <span class="comment">// 创建索引</span></span><br><span class="line">            <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">&quot;jd_goods&quot;</span>);</span><br><span class="line">            <span class="comment">// 执行创建请求 IndicesClient，请求后获得响应</span></span><br><span class="line">            client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把得到的数据放入 es 中</span></span><br><span class="line">        <span class="type">BulkRequest</span> <span class="variable">bulkRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line">        bulkRequest.timeout(<span class="string">&quot;2m&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; contents.size(); i++) &#123;</span><br><span class="line">            bulkRequest.add(</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;jd_goods&quot;</span>)</span><br><span class="line">                            .source(JSON.toJSONString(contents.get(i)), XContentType.JSON));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">BulkResponse</span> <span class="variable">bulk</span> <span class="operator">=</span> restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="keyword">return</span> !bulk.hasFailures();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取数据，实现搜索功能</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">searchPage</span><span class="params">(String keyword, <span class="type">int</span> pageNo, <span class="type">int</span> pageSize)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (pageNo &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            pageNo = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 条件搜索</span></span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;jd_goods&quot;</span>);</span><br><span class="line">        <span class="type">SearchSourceBuilder</span> <span class="variable">sourceBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 分页</span></span><br><span class="line">        sourceBuilder.from(pageNo);</span><br><span class="line">        sourceBuilder.size(pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 精准匹配</span></span><br><span class="line">        <span class="type">TermQueryBuilder</span> <span class="variable">termQueryBuilder</span> <span class="operator">=</span> QueryBuilders.termQuery(<span class="string">&quot;title&quot;</span>, keyword);</span><br><span class="line">        sourceBuilder.query(termQueryBuilder);</span><br><span class="line">        sourceBuilder.timeout(<span class="keyword">new</span> <span class="title class_">TimeValue</span>(<span class="number">60</span>, TimeUnit.SECONDS));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行搜索</span></span><br><span class="line">        searchRequest.source(sourceBuilder);</span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析结果</span></span><br><span class="line">        ArrayList&lt;Map&lt;String, Object&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (SearchHit documentFields : searchResponse.getHits().getHits()) &#123;</span><br><span class="line">            list.add(documentFields.getSourceAsMap());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写控制器，同时还可以进行简单的测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 默烦 2020/11/17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ContentService contentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/parse/&#123;keyword&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">parse</span><span class="params">(<span class="meta">@PathVariable(&quot;keyword&quot;)</span> String keyword)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> contentService.parseContent(keyword);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/search/&#123;keyword&#125;/&#123;pageNo&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">search</span><span class="params">(<span class="meta">@PathVariable(&quot;keyword&quot;)</span> String keyword,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@PathVariable(&quot;pageNo&quot;)</span> <span class="type">int</span> pageNo,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@PathVariable(&quot;pageSize&quot;)</span> <span class="type">int</span> pageSize)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">return</span> contentService.searchPage(keyword, pageNo, pageSize);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以打开浏览器，输入对应的地址，向 ES 中插入一些数据，也可以进行简单的搜索。</p>
<p>比如：<code>localhost:9090/parse/java</code> 就可以向 ES 中添加关于 Java 书籍的信息。由于京东商品页做了分页，因此添加数据是一次 30 条数据。</p>
<p>又比如：<code>http://localhost:9090/search/java/1/10</code> 就可以从 ES 中查出 10 条关于 Java 书籍的信息。</p>
<h2 id="9-4-前后端交互"><a class="header-anchor" href="#9-4-前后端交互"></a>9.4 前后端交互</h2>
<p>要实现前后端交互，需要使用到 Vue，因此也就需要下载 Vue 的一些 JS 文件。我们可以在桌面（当然，任何地方都行）创建一个文件夹（最好命名不含中文），然后使用 Git 或 CMD，在这个文件夹内下载需要的依赖。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">cnpm install vue</span><br><span class="line">cnpm install axios</span><br></pre></td></tr></table></figure>
<p>当然，前提需要在所用电脑上安装 Node.js 和 cnpm，可以参看【Node.js 的安装与 Hexo 的升级】一文。</p>
<p>然后将 <code>\node_modules\axios\dist\</code> 目录下的 <code>axios.min.js</code> 复制到我们的项目中，同样需要将 <code>\node_modules\vue\dist</code> 目录下的 <code>vue.min.js</code> 文件复制到我们的项目中。</p>
<p>最后在前端页面引用这两个 JS 文件。如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--前端使用 Vue，实现前后端分离--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注意这两个 JS 的顺序不要颠倒 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/js/vue.min.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/js/axios.min.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其实，更推荐使用 CDN 的方式应用 JS，不然后续可能会出现找不到对应 JS 文件的情况：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--其实更推荐使用 CDN 的方式导入--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/axios/0.18.0/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后就在前端页面书写对应的 JS 代码，<strong>整个前端页面代码在本文末给出</strong>。</p>
<p>编写完毕之后，重启 IDEA，再运行项目。</p>
<p><mark>注意：</mark> 记得保持 ES 处于运行状态！</p>
<blockquote>
<p>实现高亮</p>
</blockquote>
<p>在 Serveice 层添加一个和高亮相关的 <code>searchPageHighlightBuilder</code> 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现搜索高亮功能</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">searchPageHighlightBuilder</span><span class="params">(String keyword, <span class="type">int</span> pageNo, <span class="type">int</span> pageSize)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (pageNo &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        pageNo = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 条件搜索</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;jd_goods&quot;</span>);</span><br><span class="line">    <span class="type">SearchSourceBuilder</span> <span class="variable">sourceBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分页</span></span><br><span class="line">    sourceBuilder.from(pageNo);</span><br><span class="line">    sourceBuilder.size(pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 精准匹配</span></span><br><span class="line">    <span class="type">TermQueryBuilder</span> <span class="variable">termQueryBuilder</span> <span class="operator">=</span> QueryBuilders.termQuery(<span class="string">&quot;title&quot;</span>, keyword);</span><br><span class="line">    sourceBuilder.query(termQueryBuilder);</span><br><span class="line">    sourceBuilder.timeout(<span class="keyword">new</span> <span class="title class_">TimeValue</span>(<span class="number">60</span>, TimeUnit.SECONDS));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 高亮</span></span><br><span class="line">    <span class="type">HighlightBuilder</span> <span class="variable">highlightBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>();</span><br><span class="line">    <span class="comment">// 多个高亮显示</span></span><br><span class="line">    highlightBuilder.requireFieldMatch(<span class="literal">false</span>);</span><br><span class="line">    highlightBuilder.field(<span class="string">&quot;title&quot;</span>).preTags(<span class="string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;</span>).postTags(<span class="string">&quot;&lt;/span&gt;&quot;</span>);</span><br><span class="line">    sourceBuilder.highlighter(highlightBuilder);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行搜索</span></span><br><span class="line">    searchRequest.source(sourceBuilder);</span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析结果</span></span><br><span class="line">    ArrayList&lt;Map&lt;String, Object&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : searchResponse.getHits().getHits()) &#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();</span><br><span class="line">        <span class="type">HighlightField</span> <span class="variable">title</span> <span class="operator">=</span> highlightFields.get(<span class="string">&quot;title&quot;</span>);</span><br><span class="line">        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap(); <span class="comment">// 原来的结果</span></span><br><span class="line">        <span class="comment">// 解析高亮的字段，将原来的字段换为我们高亮的字段即可！</span></span><br><span class="line">        <span class="keyword">if</span> (title != <span class="literal">null</span>) &#123;</span><br><span class="line">            Text[] fragments = title.fragments();</span><br><span class="line">            <span class="type">String</span> <span class="variable">n_title</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (Text text : fragments) &#123;</span><br><span class="line">                n_title += text;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 高亮字段替换原来的内容</span></span><br><span class="line">            sourceAsMap.put(<span class="string">&quot;title&quot;</span>, n_title);</span><br><span class="line">        &#125;</span><br><span class="line">        list.add(sourceAsMap);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改 Controller 层的 <code>search</code> 方法，在这个方法中调用高亮显示方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/search/&#123;keyword&#125;/&#123;pageNo&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">search</span><span class="params">(<span class="meta">@PathVariable(&quot;keyword&quot;)</span> String keyword,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@PathVariable(&quot;pageNo&quot;)</span> <span class="type">int</span> pageNo,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@PathVariable(&quot;pageSize&quot;)</span> <span class="type">int</span> pageSize)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">return</span> contentService.searchPageHighlightBuilder(keyword, pageNo, pageSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-5-前端页面资源"><a class="header-anchor" href="#9-5-前端页面资源"></a>9.5 前端页面资源</h2>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>商品搜索-京东<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/css/style.css&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">&quot;pg&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page&quot;</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;mallPage&quot;</span> <span class="attr">class</span>=<span class="string">&quot; mallist tmall- page-not-market &quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 头部搜索 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;header&quot;</span> <span class="attr">class</span>=<span class="string">&quot; header-list-app&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;headerLayout&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;headerCon &quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- Logo--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;mallLogo&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/images/jdlogo.png&#125;&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header-extra&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">&lt;!--搜索--&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;mallSearch&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mall-search&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;searchTop&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mallSearch-form clearfix&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mallSearch-input clearfix&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;s-combobox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;s-combobox-685&quot;</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;s-combobox-input-wrap&quot;</span>&gt;</span></span><br><span class="line">                                                <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;keyword&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dd&quot;</span> <span class="attr">id</span>=<span class="string">&quot;mq&quot;</span></span></span><br><span class="line"><span class="tag">                                                       <span class="attr">class</span>=<span class="string">&quot;s-combobox-input&quot;</span> <span class="attr">aria-haspopup</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;searchKey&quot;</span> <span class="attr">id</span>=<span class="string">&quot;searchbtn&quot;</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;relKeyTop&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>python<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>java核心技术<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span>&gt;</span>java编程思想<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 商品详情页面 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 品牌分类 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;navAttrsForm&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;attrs j_NavAttrs&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display:block&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;brandAttr j_nav_brand&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;j_Brand attr&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;attrKey&quot;</span>&gt;</span></span><br><span class="line">                                    品牌</span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;attrValues&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;av-collapse row-2&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span> 狂神说 <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span> Java <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">&lt;!-- 排序规则 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;filter clearfix&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;fSort fSort-cur&quot;</span>&gt;</span>综合<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;f-ico-arrow-d&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;fSort&quot;</span>&gt;</span>人气<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;f-ico-arrow-d&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;fSort&quot;</span>&gt;</span>新品<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;f-ico-arrow-d&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;fSort&quot;</span>&gt;</span>销量<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;f-ico-arrow-d&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;fSort&quot;</span>&gt;</span>价格<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;f-ico-triangle-mt&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;f-ico-triangle-mb&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">&lt;!-- 商品详情 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;view grid-nosku&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;product&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;result in results&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;product-iWrap&quot;</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--商品封面--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;productImg-wrap&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;productImg&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;result.img&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--价格--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;productPrice&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">em</span>&gt;</span>&#123;&#123;result.price&#125;&#125;<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!--标题--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;productTitle&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">v-html</span>=<span class="string">&quot;result.title&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!-- 店铺名 --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;productShop&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span>&gt;</span>店铺： <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!-- 成交信息 --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;productStatus&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span>&gt;</span>月成交<span class="tag">&lt;<span class="name">em</span>&gt;</span>999笔<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">span</span>&gt;</span>评价 <span class="tag">&lt;<span class="name">a</span>&gt;</span>3<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--前端使用 Vue，实现前后端分离--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/axios/0.18.0/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">//搜索的关键字</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">results</span>: [] <span class="comment">// 搜索的结果</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">searchKey</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> keyword = <span class="variable language_">this</span>.<span class="property">keyword</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(keyword);</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 对接后端的接口</span></span></span><br><span class="line"><span class="language-javascript">                axios.<span class="title function_">get</span>(<span class="string">&#x27;search/&#x27;</span> + keyword + <span class="string">&quot;/1/10&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">results</span> = response.<span class="property">data</span>; <span class="comment">// 绑定数据</span></span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<p><span style="text-align: center;display:block;">ElasticSearch 入门完</span></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mofan212.github.io">默烦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mofan212.github.io/posts/The-Basis-Of-ElasticSearch/">https://mofan212.github.io/posts/The-Basis-Of-ElasticSearch/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mofan212.github.io" target="_blank">Mofan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Middleware/">Middleware</a><a class="post-meta__tags" href="/tags/ElasticSearch/">ElasticSearch</a></div><div class="post_share"><div class="social-share" data-image="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/67.png" data-sites="wechat,qq,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://gcore.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" target="_blank"><img class="post-qr-code-img" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" target="_blank"><img class="post-qr-code-img" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/FreeMarker-Template-Author's-Guide/" title="FreeMarker 模板开发"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/68.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">FreeMarker 模板开发</div></div></a></div><div class="next-post pull-right"><a href="/posts/How-to-install-Node.js-and-update-Hexo/" title="Node.js 的安装与 Hexo 的升级"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/66.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Node.js 的安装与 Hexo 的升级</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/HBase-Shell/" title="HBase Shell操作"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/10.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-29</div><div class="title">HBase Shell操作</div></div></a></div><div><a href="/posts/Advanced-HBase/" title="HBase原理"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/7.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-29</div><div class="title">HBase原理</div></div></a></div><div><a href="/posts/Install-HBase/" title="HBase的安装"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-29</div><div class="title">HBase的安装</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">默烦</div><div class="author-info__description">彩笔的打怪升级之路...</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">153</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mofan212"><i class="fab fa-github"></i><span>follow me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:cy.mofan@foxmail.com" target="_blank" title="邮箱"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a><a class="social-icon" href="https://www.travellings.cn/go.html" target="_blank" title="开往"><i class="fas fa-subway"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本站所有博文均是博主的学习笔记与个人理解。<strong><font style="color:red">除特别注明外，</font>如需转载，请在文章头部醒目处附带原文链接并<a target="_blank" rel="noopener" href="https://mofan212.gitee.io/mine/" style="color:#49B1F5;text-decoration:underline">告知我</a></strong>你将转载。😊</br><strong><font style="color:red">严禁未遵循规范的转载。</font></strong>😡</br><strong>死去的评论系统复活啦！欢迎到留言板畅所欲言！</strong>当然也可以使用更高效的<a target="_blank" href="https://space.bilibili.com/23658864/dynamic" style="color:#49B1F5;text-decoration:underline"> 哔哩哔哩私信 </a>或<a href="mailto:cy.mofan@foxmail.com" style="color:#49B1F5;text-decoration:underline" target="_blank">邮箱</a>。 😉</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-ElasticSearch-%E6%A6%82%E8%BF%B0"><span class="toc-text">1. ElasticSearch 概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E4%B8%8E-Solr-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">2. 与 Solr 的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Solr-%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="toc-text">2.1 Solr 的概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Solr-%E4%B8%8E-ElasticSearch"><span class="toc-text">2.2 Solr 与 ElasticSearch</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85-ElasticSearch"><span class="toc-text">3. 安装 ElasticSearch</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%AE%89%E8%A3%85-Kibana"><span class="toc-text">4. 安装 Kibana</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-ES-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">5. ES 的核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E6%96%87%E6%A1%A3"><span class="toc-text">5.1 文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E7%B1%BB%E5%9E%8B"><span class="toc-text">5.2 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E7%B4%A2%E5%BC%95"><span class="toc-text">5.3 索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-text">5.4 倒排索引</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-IK-%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text">6. IK 分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E4%BB%80%E4%B9%88%E6%98%AF-IK-%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text">6.1 什么是 IK 分词器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85"><span class="toc-text">6.2 下载安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-IK-%E5%88%86%E8%AF%8D%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">6.3 IK 分词器的使用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text">7. 基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-Rest-%E9%A3%8E%E6%A0%BC%E8%AF%B4%E6%98%8E"><span class="toc-text">7.1 Rest 风格说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E7%B4%A2%E5%BC%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text">7.2 索引的基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E6%96%87%E6%A1%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text">7.3 文档的基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-%E5%A4%8D%E6%9D%82%E6%90%9C%E7%B4%A2"><span class="toc-text">7.4 复杂搜索</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E9%9B%86%E6%88%90-SpringBoot"><span class="toc-text">8. 集成 SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E9%9B%86%E6%88%90%E5%87%86%E5%A4%87"><span class="toc-text">8.1 集成准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E7%B4%A2%E5%BC%95-API-%E6%B5%8B%E8%AF%95"><span class="toc-text">8.2 索引 API 测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E6%96%87%E6%A1%A3-API-%E6%B5%8B%E8%AF%95"><span class="toc-text">8.3 文档 API 测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E4%BA%AC%E4%B8%9C%E6%90%9C%E7%B4%A2%E5%B0%8F-Demo"><span class="toc-text">9. 京东搜索小 Demo</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E5%88%9D%E5%A7%8B%E5%8C%96-Demo"><span class="toc-text">9.1 初始化 Demo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-%E7%88%AC%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-text">9.2 爬取数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-%E4%B8%9A%E5%8A%A1%E7%BC%96%E5%86%99"><span class="toc-text">9.3 业务编写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92"><span class="toc-text">9.4 前后端交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E8%B5%84%E6%BA%90"><span class="toc-text">9.5 前端页面资源</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/DataStructure-Trie/" title="数据结构之Trie"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/43.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="数据结构之Trie"/></a><div class="content"><a class="title" href="/posts/DataStructure-Trie/" title="数据结构之Trie">数据结构之Trie</a><time datetime="2024-08-28T16:00:00.000Z" title="更新于 2024-08-29 00:00:00">2024-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Spring's-Enhancements-To-Java-Annotation/" title="Spring 对 Java 注解的增强"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/133.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Spring 对 Java 注解的增强"/></a><div class="content"><a class="title" href="/posts/Spring's-Enhancements-To-Java-Annotation/" title="Spring 对 Java 注解的增强">Spring 对 Java 注解的增强</a><time datetime="2024-08-26T16:00:00.000Z" title="更新于 2024-08-27 00:00:00">2024-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Spring-BeanDefinition/" title="BeanDefinition"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/153.webp" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="BeanDefinition"/></a><div class="content"><a class="title" href="/posts/Spring-BeanDefinition/" title="BeanDefinition">BeanDefinition</a><time datetime="2024-08-10T16:00:00.000Z" title="更新于 2024-08-11 00:00:00">2024-08-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Configuration-Annotation/" title="@Configuration 注解的那些事"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/25.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="@Configuration 注解的那些事"/></a><div class="content"><a class="title" href="/posts/Configuration-Annotation/" title="@Configuration 注解的那些事">@Configuration 注解的那些事</a><time datetime="2024-08-07T16:00:00.000Z" title="更新于 2024-08-08 00:00:00">2024-08-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/MySQL-Advanced-Fourth-Logical-Architecture/" title="【MySQL 高级篇四】逻辑架构"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/134.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="【MySQL 高级篇四】逻辑架构"/></a><div class="content"><a class="title" href="/posts/MySQL-Advanced-Fourth-Logical-Architecture/" title="【MySQL 高级篇四】逻辑架构">【MySQL 高级篇四】逻辑架构</a><time datetime="2024-07-24T16:00:00.000Z" title="更新于 2024-07-25 00:00:00">2024-07-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Combinator-Pattern/" title="Combinator Pattern"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/149.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Combinator Pattern"/></a><div class="content"><a class="title" href="/posts/Combinator-Pattern/" title="Combinator Pattern">Combinator Pattern</a><time datetime="2024-07-23T16:00:00.000Z" title="更新于 2024-07-24 00:00:00">2024-07-24</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 默烦</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://gcore.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://gcore.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://gcore.jsdelivr.net/npm/vanilla-lazyload@latest/dist/lazyload.iife.min.js"></script><script src="https://gcore.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://gcore.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://gcore.jsdelivr.net/gh/mofan212/blog-static-resources@master/js/mine.min.js"></script><script src="https://npm.elemecdn.com/mermaid/dist/mermaid.min.js"></script><script defer="defer" id="ribbon" src="https://gcore.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="click-show-text" src="https://gcore.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Azathoth,Yog-Sothoth,Shub-Niggurath,Nyarlathotep,Cthulhu,Hastur,Abhoth,Ghroth,Tsathoggua,Cthugha,Deep Ones,Dagon,Chaugnar Faugn,Mordiggian,Shoggoth,Old One,Mi-Go,Great Race of Yith,Flying Polyp,Hounds of Tindalos,Dhole" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/@docsearch/css/dist/style.min.css"/><script src="https://gcore.jsdelivr.net/npm/@docsearch/js/dist/umd/index.min.js"></script><script>(() => {
  docsearch(Object.assign({
    appId: 'BAFEL7A6K1',
    apiKey: '89fcb5961984c5c054bf04149f345f38',
    indexName: 'mofan212io',
    container: '#docsearch',
  }, null))

  const handleClick = () => {
    document.querySelector('.DocSearch-Button').click()
  }

  const searchClickFn = () => {
    btf.addEventListenerPjax(document.querySelector('#search-button > .search'), 'click', handleClick)
  }

  searchClickFn()
  window.addEventListener('pjax:complete', searchClickFn)
})()</script></div></div></body></html>