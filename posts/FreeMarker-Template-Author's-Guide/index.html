<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>FreeMarker 模板开发 | Mofan</title><meta name="author" content="默烦,cy.mofan@foxmail.com"><meta name="copyright" content="默烦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文介绍了 FreeMarker 模板引擎的模板开发。">
<meta property="og:type" content="article">
<meta property="og:title" content="FreeMarker 模板开发">
<meta property="og:url" content="https://mofan212.github.io/posts/FreeMarker-Template-Author's-Guide/index.html">
<meta property="og:site_name" content="Mofan">
<meta property="og:description" content="本文介绍了 FreeMarker 模板引擎的模板开发。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/68.png">
<meta property="article:published_time" content="2020-11-19T16:00:00.000Z">
<meta property="article:modified_time" content="2025-06-26T16:00:00.000Z">
<meta property="article:author" content="默烦">
<meta property="article:tag" content="FreeMarker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/68.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "FreeMarker 模板开发",
  "url": "https://mofan212.github.io/posts/FreeMarker-Template-Author's-Guide/",
  "image": "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/68.png",
  "datePublished": "2020-11-19T16:00:00.000Z",
  "dateModified": "2025-06-26T16:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "默烦",
      "url": "https://mofan212.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/favicon.png"><link rel="canonical" href="https://mofan212.github.io/posts/FreeMarker-Template-Author's-Guide/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: 默烦","link":"链接: ","source":"来源: Mofan","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  infinitegrid: {
    js: 'https://fastly.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'FreeMarker 模板开发',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/mofan212/blog-static-resources@master/css/myStyle.min.css"><link rel="stylesheet" href="https://cdn.staticfile.net/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono-nl.min.css" /><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Mofan" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/mofan212/blog-static-resources/css/minimal.min.css"/><script src="https://fastly.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">162</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-subway"></i><span> 开往</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/post_top_img.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Mofan</span></a><a class="nav-page-title" href="/"><span class="site-name">FreeMarker 模板开发</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-subway"></i><span> 开往</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">FreeMarker 模板开发</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-11-19T16:00:00.000Z" title="发表于 2020-11-20 00:00:00">2020-11-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-26T16:00:00.000Z" title="更新于 2025-06-27 00:00:00">2025-06-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/TemplateEngine/">TemplateEngine</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">14.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>55分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;距离本文上次更新已经过去&quot;,&quot;messageNext&quot;:&quot;天，请注意时效性。&quot;,&quot;postUpdate&quot;:&quot;2025-06-27 00:00:00&quot;}" hidden></div><p>封面来源：由博主个人绘制，如需使用请联系博主。</p>
<p>本文摘录自：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/toc.html">FreeMarker 中文官方参考手册</a></p>
<h1 id="0-前言"><a class="header-anchor" href="#0-前言"></a>0. 前言</h1>
<p>公司的项目需要用到模板引擎 FreeMarker，因此，不会的我也就只有学习。</p>
<p>曾经在学习 SpringBoot 的时候，学习过另外一种模板引擎 Thymeleaf，这俩也有相似之处，但是不同点也挺多。</p>
<p>本文只作为一个备忘录，或者说知识梳理，不作为入门级教程。</p>
<p>入门级教程建议查看：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/toc.html">FreeMarker 中文官方参考手册</a>，本文大多数内容摘录于此手册。</p>
<h1 id="1-FreeMarker-入门"><a class="header-anchor" href="#1-FreeMarker-入门"></a>1. FreeMarker 入门</h1>
<h2 id="1-1-模板-数据模型-输出"><a class="header-anchor" href="#1-1-模板-数据模型-输出"></a>1.1 模板 + 数据模型 = 输出</h2>
<p>模板引擎，模板引擎，那肯定是需要编写模板的。但是也不能只有一个光模板，还需要数据来填充。</p>
<p>为模板准备的数据整体被称作为 <strong>数据模型</strong>。 模板作者要关心的是，数据模型是树形结构（就像硬盘上的文件夹和文件），在视觉效果上， 数据模型就像是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(root)</span><br><span class="line">  |</span><br><span class="line">  +- user = &quot;Big Joe&quot;</span><br><span class="line">  |</span><br><span class="line">  +- latestProduct</span><br><span class="line">      |</span><br><span class="line">      +- url = &quot;products/greenmouse.html&quot;</span><br><span class="line">      |</span><br><span class="line">      +- name = &quot;green mouse&quot;</span><br></pre></td></tr></table></figure>
<p>总的来说，模板和数据模型是 FreeMarker 来生成输出所必须的，因此就有：模板 + 数据模型 = 输出</p>
<h2 id="1-2-数据模型"><a class="header-anchor" href="#1-2-数据模型"></a>1.2 数据模型</h2>
<blockquote>
<p>哈希</p>
</blockquote>
<p>数据模型的基本结构是树状的。 这棵树可以很复杂，并且可以有很大的深度，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(root)</span><br><span class="line">  |</span><br><span class="line">  +- animals</span><br><span class="line">  |   |</span><br><span class="line">  |   +- mouse</span><br><span class="line">  |   |   |   </span><br><span class="line">  |   |   +- size = &quot;small&quot;</span><br><span class="line">  |   |   |   </span><br><span class="line">  |   |   +- price = 50</span><br><span class="line">  |   |</span><br><span class="line">  |   +- elephant</span><br><span class="line">  |   |   |   </span><br><span class="line">  |   |   +- size = &quot;large&quot;</span><br><span class="line">  |   |   |   </span><br><span class="line">  |   |   +- price = 5000</span><br><span class="line">  |   |</span><br><span class="line">  |   +- python</span><br><span class="line">  |       |   </span><br><span class="line">  |       +- size = &quot;medium&quot;</span><br><span class="line">  |       |   </span><br><span class="line">  |       +- price = 4999</span><br><span class="line">  |</span><br><span class="line">  +- message = &quot;It is a test&quot;</span><br><span class="line">  |</span><br><span class="line">  +- misc</span><br><span class="line">      |</span><br><span class="line">      +- foo = &quot;Something&quot;</span><br></pre></td></tr></table></figure>
<p>上图中的变量扮演目录的角色（比如 <code>root</code>、<code>animals</code>、<code>mouse</code>、 <code>elephant</code>、 <code>python</code>、 <code>misc</code>）被称为 <strong>hashes</strong>。</p>
<p>存储单值的变量（<code>size</code>, <code>price</code>, <code>message</code> 和 <code>foo</code>）称为 <strong>scalars</strong>（标量）。</p>
<blockquote>
<p>序列</p>
</blockquote>
<p>还有一种很重要的变量是 <strong>sequences</strong>。它们像哈希表那样存储子变量，但是子变量没有名字，它们只是列表中的项。 比如，在下面这个数据模型中，<code>animals</code> 和 <code>misc.fruits</code> 就是序列：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">(root)</span><br><span class="line">  |</span><br><span class="line">  +- animals</span><br><span class="line">  |   |</span><br><span class="line">  |   +- (1st)</span><br><span class="line">  |   |   |</span><br><span class="line">  |   |   +- name = &quot;mouse&quot;</span><br><span class="line">  |   |   |</span><br><span class="line">  |   |   +- size = &quot;small&quot;</span><br><span class="line">  |   |   |</span><br><span class="line">  |   |   +- price = 50</span><br><span class="line">  |   |</span><br><span class="line">  |   +- (2nd)</span><br><span class="line">  |   |   |</span><br><span class="line">  |   |   +- name = &quot;elephant&quot;</span><br><span class="line">  |   |   |</span><br><span class="line">  |   |   +- size = &quot;large&quot;</span><br><span class="line">  |   |   |</span><br><span class="line">  |   |   +- price = 5000</span><br><span class="line">  |   |</span><br><span class="line">  |   +- (3rd)</span><br><span class="line">  |       |</span><br><span class="line">  |       +- name = &quot;python&quot;</span><br><span class="line">  |       |</span><br><span class="line">  |       +- size = &quot;medium&quot;</span><br><span class="line">  |       |</span><br><span class="line">  |       +- price = 4999</span><br><span class="line">  |</span><br><span class="line">  +- misc</span><br><span class="line">      |</span><br><span class="line">      +- fruits</span><br><span class="line">          |</span><br><span class="line">          +- (1st) = &quot;orange&quot;</span><br><span class="line">          |</span><br><span class="line">          +- (2nd) = &quot;banana&quot;</span><br></pre></td></tr></table></figure>
<p>要访问序列的子变量，可以使用方括号形式的数字索引下标。 索引下标从 0 开始（懂的都懂 😂）。</p>
<p>比如，要得到第一个动物的名称的话，可以这么来写代码 <code>animals[0].name</code>。要得到 <code>misc.fruits</code> 中的第二项（字符串<code>&quot;banana&quot;</code>）可以这么来写 <code>misc.fruits[1]</code>。</p>
<p><strong>标量类型</strong> 可以分为如下的类别：</p>
<ul>
<li>字符串</li>
<li>数字，需要注意 <code>212</code> 和 <code>&quot;212&quot;</code> 的区别</li>
<li>日期 / 时间：可以是日期 - 时间格式（存储某一天的日期和时间），或者是日期（只有日期，没有时间），或者是时间（只有时间，没有日期）。</li>
<li>布尔值</li>
</ul>
<p>还有一些其它更为高级的类型，比如方法和指令。</p>
<h2 id="1-3-指令"><a class="header-anchor" href="#1-3-指令"></a>1.3 指令</h2>
<p>能被 FreeMarker 所解析的特殊代码片段有：</p>
<ol>
<li><code>$&#123;...&#125;</code>：这样的表达式被称为 <strong>interpolation</strong>（插值）。</li>
<li><strong>FTL 标签</strong>：这些标签的名字以 <code>#</code> 开头，用户自定义的 FTL 标签则需要使用 <code>@</code> 来代替 <code>#</code>，FTL 标签也被成为 <strong>指令</strong>。</li>
<li><strong>注释</strong>：使用 <code>&lt;#--</code> and <code>--&gt;</code> 来标识。 与 HTML 注释不同，FTL 注释不出现在访问者的页面中，因为 FreeMarker 会跳过它们。</li>
</ol>
<blockquote>
<p>if 指令的基本使用</p>
</blockquote>
<ol>
<li><code>&lt;#if condition&gt;</code> condition为 true 执行内容，为 false 就略过 <code>&lt;/#if&gt;</code></li>
<li><code>&lt;#if&gt;</code> 标签体内可以存在标签 <code>&lt;# else&gt;</code></li>
<li><code>&lt;#if&gt;</code> 标签体内还可以存在标签 <code>&lt;# elseif&gt;</code></li>
</ol>
<blockquote>
<p>list 指令的基本使用</p>
</blockquote>
<p><code>&lt;#list&gt;</code> 标签可以用来显示列表内容，基本语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list sequence as loopVariable&gt; repeatThis &lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<p>就我个人的理解来说，<code>&lt;#list&gt;</code> 标签就和循环一样。</p>
<p><code>&lt;#list&gt;</code> 标签内还可以有 <code>&lt;#items&gt;</code> 标签、 <code>&lt;#sep&gt;</code> 标签、<code>&lt;# else&gt;</code> 标签。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list misc.fruits&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;#items as fruit&gt;</span><br><span class="line">      &lt;li&gt;$&#123;fruit&#125;</span><br><span class="line">    &lt;/#items&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<p>如果 <code>&lt;#list&gt;</code> 标签内有 <code>&lt;#items&gt;</code> 标签，那么<code>list</code> 指令将列表视为一个整体， 在 <code>items</code> 指令中的部分才会为每个水果重复。 如果我们有 0 个水果，那么在 <code>list</code> 中的所有东西都被略过了， 因此就不会有 <code>&lt;ul&gt;</code> 标签了。</p>
<p>还有一种场景，使用分隔符来列出一些水果，比如用逗号作为分隔符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;Fruits: &lt;#list misc.fruits as fruit&gt;$&#123;fruit&#125;&lt;#sep&gt;, &lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<p>然后就会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;Fruits: orange, banana</span><br></pre></td></tr></table></figure>
<p>被 <code>sep</code> 覆盖的部分只有当还有下一项时才会被执行，因此最后一个水果后面不会有逗号。</p>
<p><code>list</code> 指令也像 <code>if</code> 指令那样，可以有 <code>else</code> 部分，如果列表中有 0 个元素时就会被执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;Fruits: &lt;#list misc.fruits as fruit&gt;$&#123;fruit&#125;&lt;#sep&gt;, &lt;#else&gt;None&lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<p>当然，指令 <code>list</code>、<code>items</code>、<code>sep</code> 和 <code>else</code> 可以联合起来使用。</p>
<blockquote>
<p>include 指令的基本使用</p>
</blockquote>
<p>使用 <code>include</code> 指令， 就可以在模板中插入其他文件的内容。</p>
<p>比方说，我们可以将版权信息单独存放在页面文件 <code>copyright_footer.html</code> 中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span>&gt;</span></span><br><span class="line">Copyright (c) 2020 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://mofan212.github.io/&quot;</span>&gt;</span>Mofan<span class="tag">&lt;/<span class="name">a</span>&gt;</span>,</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">All Rights Reserved.</span><br><span class="line"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当需要用到这个文件时，就可以使用 <code>include</code> 指令来插入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;Test page&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;Test page&lt;/h1&gt;</span><br><span class="line">  &lt;p&gt;Blah blah...</span><br><span class="line">  &lt;#include &quot;/copyright_footer.html&quot;&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>当修改了 <code>copyright_footer.html</code> 文件， 那么访问者在所有页面都会看到版权声明的新内容。</p>
<p><strong>重用代码片段的一个更有力的方式是使用宏。</strong></p>
<p>在页面上也可以多次使用指令，而且指令间也可以很容易地相互嵌套。比如，在 <code>list</code> 指令中嵌套 <code>if</code> 指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list animals as animal&gt;</span><br><span class="line">	&lt;div&lt;#if animal.protected&gt; class=&quot;protected&quot;&lt;/#if&gt;&gt;</span><br><span class="line">	$&#123;animal.name&#125; for $&#123;animal.price&#125; Euros</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<p>Freemarker 不会解析 FTL 标签以外的文本，甚至可在 HTML 标签内写 FTL 标签，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div &lt;#if&gt;&lt;#/if&gt;&gt; 内容 &lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p><mark>注意：</mark> FTL 标签区分带小写。插值只能在文本中使用，FTL 标签不可以在其他 FTL 标签和插值中使用，注释可以放在 FTL 标签和插值中。</p>
<p>FreeMarker 参考指令：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/ref_directives.html">指令参考</a></p>
<h2 id="1-4-内建函数"><a class="header-anchor" href="#1-4-内建函数"></a>1.4 内建函数</h2>
<p>内建函数很像子变量（或者说 Java 中的方法），它们并不是数据模型中的东西，是 FreeMarker 在数值上添加的。 为了清晰子变量是哪部分，使用 <code>?</code>（问号）代替 <code>.</code>（点）来访问它们。常用内建函数的示例：</p>
<ul>
<li><code>user?html</code> 给出 <code>user</code> 的 HTML 转义版本</li>
<li><code>user?upper_case</code> 给出 <code>user</code> 值的大写版本</li>
<li><code>animal.name?cap_first</code> 给出 <code>animal.name</code> 的首字母大写版本</li>
<li><code>user?length</code> 给出 <code>user</code> 值中字符的数量</li>
<li><code>animals?size</code> 给出 <code>animals</code> 序列中项目的个数</li>
<li>如果在 <code>&lt;#list animals as animal&gt;</code> 和对应的 <code>&lt;/#list&gt;</code> 标签中：
<ul>
<li><code>animal?index</code> 给出了在 <code>animals</code> 中基于 0 开始的 <code>animal</code>的索引值</li>
<li><code>animal?counter</code> 也像 <code>index</code>， 但是给出的是基于 1 的索引值</li>
<li><code>animal?item_parity</code> 基于当前计数的奇偶性，给出字符串 “odd” 或 “even”。在给不同行着色时非常有用，比如在 <code>&lt;td class=&quot;$&#123;animal?item_parity&#125;Row&quot;&gt;</code>中。</li>
</ul>
</li>
</ul>
<p>一些内建函数需要参数来指定行为，比如：</p>
<ul>
<li><code>animal.protected?string(&quot;Y&quot;, &quot;N&quot;)</code> 基于 <code>animal.protected</code> 的布尔值来返回字符串 “Y” 或 “N”。</li>
<li><code>animal?item_cycle('lightRow','darkRow')</code> 是之前介绍的 <code>item_parity</code> 更为常用的变体形式。</li>
<li><code>fruits?join(&quot;, &quot;)</code> 通过连接所有项，将列表转换为字符串， 在每个项之间插入参数分隔符</li>
<li><code>user?starts_with(&quot;J&quot;)</code> 根据 <code>user</code> 的首字母是否是 “J” 返回布尔值 true 或 false。</li>
</ul>
<p>一些内建函数可以对字符串进行转义：</p>
<ul>
<li>Java 语言规则的字符串转义：<code>content?j_string</code></li>
<li>JavaScript 语言规则的字符串转义：<code>content?js_string</code></li>
<li>JSON 规则的字符串转义：<code>content?json_string</code></li>
</ul>
<p>内建函数应用可以链式操作，比如<code>user?upper_case?html</code> 会先转换用户名到大写形式，之后再进行 HTML 转义。</p>
<p>更多内建函数参考：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/ref_builtins.html">内建函数参考 - FreeMarker 中文官方参考手册</a></p>
<blockquote>
<p>哈希表内建函数</p>
</blockquote>
<ul>
<li><code>keys</code> 获取一个包含哈希表中查找到的键的序列。 请注意，并不是所有哈希表都支持该内建函数。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign h = &#123;&quot;name&quot;:&quot;mouse&quot;, &quot;price&quot;:50&#125;&gt;</span><br><span class="line">&lt;#assign keys = h?keys&gt;</span><br><span class="line">&lt;#list keys as key&gt;$&#123;key&#125; = $&#123;h[key]&#125;; &lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<pre>
name = mouse; price = 50; 
</pre>
<p>哈希表的键通常是无序的，因此 <code>keys</code> 获取到的序列通常也是无序的。对于某些维持了键的顺序的哈希表，<code>keys</code> 获取到的序列中的元素也将按照那个维持的顺序排列。</p>
<ul>
<li><code>values</code> 获取一个包含哈希表中所有键的序列。请注意，并不是所有哈希表都支持该内建函数。<code>values</code> 获取到的序列的元素顺序与 <code>keys</code> 的规则一致。</li>
</ul>
<blockquote>
<p>字符串内建函数中的大坑</p>
</blockquote>
<p><code>cap_first</code>：字符串中的 <strong>首单词</strong> 的首字母大写。</p>
<p><code>capitalize</code>：字符串中 <strong>所有单词</strong> 的首字母大写。</p>
<p>为什么说这是一个大坑？</p>
<p>Apache 为 Java 提供了许多常用的工具包，其中有一个工具包叫做 common-lang3，在这个工具包中有一个名为 <code>StringUtils</code> 的工具类，可以使用这个工具类对 Java 中的字符串进行操作。</p>
<p>在 <code>StringUtils</code> 中有一个名为 <code>capitalize()</code> 的方法，此方法可以将传入字符串的首字母大写并返回， <strong>不会改变其他字符串。</strong></p>
<p>针对字符串 <code>GreEN mouse</code> 来说：</p>
<ul>
<li><code>StringUtils.capitalize(&quot;GreEN mouse&quot;)</code> 将返回 <code>GreEN mouse</code>；</li>
<li>而在 FreeMarker 中，<code>$&#123;&quot;GreEN mouse&quot;?capitalize&#125;</code> 会返回 <code>Green Mouse</code>，原本的 <code>mouse</code> 居然变成了 <code>Mouse</code>？！</li>
</ul>
<p>这是因为 FreeMarker 中字符串内建函数 <code>capitalize</code> 会将字符串中 <strong>所有单词</strong> 的首字母大写。</p>
<p>这里的单词指的是不间断的字符序列，包含了任意字符，但是没有空白。FreeMarker 中的空白是指完全透明的字符，但是对文本的视觉呈现会有作用。 比如空格，制表符（水平和垂直），换行符（CR 和 LF），换页。</p>
<p>因此，在 FreeMarker 中，想让字符串的首字母大写，应该使用 <code>cap_first</code> 内建函数。</p>
<blockquote>
<p>布尔值内建函数 <code>then</code></p>
</blockquote>
<p><code>then</code>，使用方式是 <code>booleanExp?then(whenTrue, whenFalse)</code>，类似于三元运算符 <code>booleanExp ? whenTrue : whenFalse</code>。如果 <code>booleanExp</code> 是 <code>true</code>，返回第一个参数 <code>whenTrue</code>，否则返回第二个参数 <code>whenFalse</code>。包括 <code>booleanExp</code> 在内的三个表达式可以是任意复杂的，可以是任意类型，也可以是不同类型。</p>
<p>该内建函数的一个重要特殊属性是 <strong>只会计算一个参数表达式</strong>。这与普通方法调用不同，在普通方法调用中，所有参数表达式都会被求值，而不管方法是否需要它们。这也意味着在 <code>then</code> 内建函数中不需要的参数甚至可以引用不存在的变量，而不会导致错误。（当然它不能是非法的语法。）</p>
<blockquote>
<p>循环变量内建函数</p>
</blockquote>
<p>上文中介绍了循环变量的 <code>index</code>、<code>counter</code> 和 <code>item_parity</code> 内建函数，再补充一些：</p>
<ul>
<li><code>has_next</code>：判断当前循环项后是否还有可用的循环项；</li>
<li><code>is_even_item</code>：判断循环项是否是当前迭代间隔 1 的奇数项，比如：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;] as i&gt;$&#123;i?is_even_item?c&#125; &lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">false true false true</span><br></pre></td></tr></table></figure>
<ul>
<li><code>is_first</code>：判断循环项是否是当前迭代的第一项；</li>
<li><code>is_last</code>：判断循环项是否是当前迭代的最后一项；</li>
<li><code>is_odd_item</code>：判断循环项是否是当前迭代间隔 1 的偶数项，比如：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;] as i&gt;$&#123;i?is_odd_item?c&#125; &lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">true false true false </span><br></pre></td></tr></table></figure>
<ul>
<li><code>item_cycle</code>：与 <code>item_parity</code> 类似，它更加通用，直接上例子：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;, &#x27;f&#x27;, &#x27;g&#x27;] as i&gt;</span><br><span class="line">  &lt;tr class=&quot;$&#123;i?item_cycle(&#x27;row1&#x27;, &#x27;row2&#x27;, &#x27;row3&#x27;)&#125;&quot;&gt;$&#123;i&#125;&lt;/tr&gt;</span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;row1&quot;</span>&gt;</span>a<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;row2&quot;</span>&gt;</span>b<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;row3&quot;</span>&gt;</span>c<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;row1&quot;</span>&gt;</span>d<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;row2&quot;</span>&gt;</span>e<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;row3&quot;</span>&gt;</span>f<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;row1&quot;</span>&gt;</span>g<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>内置函数 <code>item_cycle</code> 的使用细节：参数的个数至少是1个，没有上限，参数的类型是任意的，无需只是字符串。</p>
<ul>
<li><code>item_parity</code>：该内置函数只会返回字符串值 <code>&quot;odd&quot;</code> 或 <code>&quot;even&quot;</code>，常用于表格中行间的颜色变换：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;] as i&gt;</span><br><span class="line">  &lt;tr class=&quot;$&#123;i?item_parity&#125;Row&quot;&gt;$&#123;i&#125;&lt;/tr&gt;</span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;oddRow&quot;</span>&gt;</span>a<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;evenRow&quot;</span>&gt;</span>b<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;oddRow&quot;</span>&gt;</span>c<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">&quot;evenRow&quot;</span>&gt;</span>d<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>item_parity_cap</code>：与 <code>item_parity</code> 使用方式相同，只不过返回的是首字母大写的 <code>&quot;Odd&quot;</code> 和 <code>&quot;Even&quot;</code>。</li>
</ul>
<h2 id="1-5-处理不存在的变量"><a class="header-anchor" href="#1-5-处理不存在的变量"></a>1.5 处理不存在的变量</h2>
<p>除了一些典型的人为原因导致失误外，FreeMarker 绝不能容忍引用不存在的变量， 除非明确地告诉它当变量不存在时如何处理。这里来介绍两种典型的处理方法。</p>
<p>可以指定一个默认值来避免变量丢失这种情况， 通过在变量名后面跟着一个 <code>!</code> 和默认值。 就像下面的这个例子，当 <code>user</code> 不存在于数据模型时, 模板将会将 <code>user</code> 的值表示为字符串 <code>&quot;visitor&quot;</code>， 而当 <code>user</code> 存在时， 模板就会表现出 <code>$&#123;user&#125;</code> 的值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;Welcome $&#123;user!&quot;visitor&quot;&#125;!&lt;/h1&gt;</span><br></pre></td></tr></table></figure>
<p>注意区分：<code>$&#123;object!&#125;</code> 表示如果 object 为空则不执行</p>
<p>除此之外，还有 <code>&lt;#if object ??&gt;$&#123;object&#125;&lt;#if&gt;</code> 表示如果 object 不为空，则执行里面语句，相当于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if object?if_exits&gt;$&#123;object&#125;&lt;/#if&gt;</span><br></pre></td></tr></table></figure>
<p>关于多级访问的变量，<code>animals.python.price!0</code> 当且仅当 <code>animals.python</code> 永远存在， 而仅仅最后一个子变量 <code>price</code> 可能不存在时，这种情况下默认值是 0。 如果 <code>animals</code> 或 <code>python</code> 不存在， 那么模板处理过程将会以「未定义的变量」错误而停止。</p>
<p>为了防止这种情况的发生， 可以如下这样来编写代码 <code>(animals.python.price)!0</code> 来解决。 这种情况就是说当 <code>animals</code>、<code>python</code> 或 <code>price</code> 任意一个不存在时， 表达式的结果是 <code>0</code>。对于 <code>??</code> 也是同样用来的处理这种逻辑的，可以将 <code>animals.python.price??</code> 对比 <code>(animals.python.price)??</code>来看。</p>
<blockquote>
<p>在 <code>&lt;#if&gt;</code> 标签中处理不存在的变量</p>
</blockquote>
<p>假设需要判断 <code>parent</code> 中的 <code>child</code> 中的 <code>str</code> 是否等于 <code>mofan</code>，但 <code>parent</code>、<code>child</code> 和 <code>str</code> 都可能不存在，因此有这样「恶心」的判断：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if parent?? &amp;&amp; parent.child?? &amp;&amp; parent.child.str?? &amp;&amp; parent.child.str == &quot;mofan&quot;&gt;</span><br><span class="line">&lt;/#if&gt;</span><br></pre></td></tr></table></figure>
<p>或者是套多层 <code>&lt;#if&gt;</code> 标签。那是否有优雅点的写法呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if (parent.child.str)!&quot;&quot; == &quot;mofan&quot;&gt;&lt;/#if&gt;</span><br></pre></td></tr></table></figure>
<p>当 <code>parent</code>、<code>child</code> 或 <code>str</code> 三者中的任意一个不存在时，返回空字符串，空字符与字符串 <code>mofan</code> 比较结果返回 <code>false</code>，这与多次非空判断或多层 <code>&lt;#if&gt;</code> 标签嵌套返回的结果是一样的。</p>
<p>但在实际运行过程中，上述代码并不会按照预期执行，反而抛出异常，提示 <code>&lt;#if&gt;</code> 标签中的表达式 <strong>不是布尔值，</strong> 于是又进行如下尝试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if ((parent.child.str)!&quot;&quot; == &quot;mofan&quot;)&gt;&lt;/#if&gt;</span><br><span class="line"></span><br><span class="line">&lt;#if ((parent.child.str)!&quot;&quot; == &quot;mofan&quot;)?boolean&gt;&lt;/#if&gt;</span><br></pre></td></tr></table></figure>
<p>错误依旧没有得到结果，依旧显示同样的错误。</p>
<p>按照以下方式编写方可正常执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if ((parent.child.str)!&quot;&quot;) == &quot;mofan&quot;&gt;&lt;/#if&gt;</span><br></pre></td></tr></table></figure>
<h1 id="2-数值与类型"><a class="header-anchor" href="#2-数值与类型"></a>2. 数值与类型</h1>
<h2 id="2-1-基本内容"><a class="header-anchor" href="#2-1-基本内容"></a>2.1 基本内容</h2>
<p>数值的概念很好理解，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(root)</span><br><span class="line"> |</span><br><span class="line"> +- user = &quot;Big Joe&quot;</span><br><span class="line"> |</span><br><span class="line"> +- today = Jul 6, 2007</span><br><span class="line"> |</span><br><span class="line"> +- todayHoliday = false</span><br><span class="line"> |</span><br><span class="line"> +- lotteryNumbers</span><br><span class="line"> |   |</span><br><span class="line"> |   +- (1st) = 20</span><br><span class="line"> |   |</span><br><span class="line"> |   +- (2st) = 14</span><br><span class="line"> |</span><br><span class="line"> +- mouse = &quot;Yerri&quot;</span><br><span class="line">     |</span><br><span class="line">     +- age = 12</span><br><span class="line">     |</span><br><span class="line">     +- color = &quot;brown&quot;</span><br></pre></td></tr></table></figure>
<p>变量 <code>user</code> 的数值就是 <code>&quot;Big Joe&quot;</code>，它的类型是字符串。</p>
<p><code>lotteryNumbers</code> 的数值是包含 20，14 的序列。它包含多个值，但是 <code>lotteryNumbers</code> 本身还是单值。它就像一个装有其它很多东西的盒子 (或者说容器)，但盒子作为整体还是视作单独的。</p>
<p>对 <code>mouse</code> 来说也是这样，它的数值是一个哈希表（也是类似盒子一样的东西）。</p>
<p>所以说，数值就是存储在变量中的的那个东西。但不需要存储于变量之中的数值也可以称之为数值，比如下面的数字 100：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if cargo.weight &lt; 100&gt;Light cargo&lt;/#if&gt;</span><br></pre></td></tr></table></figure>
<p>类型也很好理解，比方说，类型有：字符串、日期、数字、布尔值、序列、哈希表等等。</p>
<p>数值也可以含有多种类型，尽管很少这么使用。比方说上面数据模型中的 <code>mouse</code> 它本身就又是字符串，又是哈希表。</p>
<p>从每个数据模型的例子可以发现，被 <code>root</code> 所标识的内容就是哈希表类型的值。</p>
<p>根哈希表包含更多的哈希表或序列。 哈希表包含其他变量，那些变量包含其它值，这些数值可以是字符串，数字等变量， 当然也可以是哈希表或序列变量（相当于可以一直套娃）。</p>
<h2 id="2-2-类型"><a class="header-anchor" href="#2-2-类型"></a>2.2 类型</h2>
<blockquote>
<p>标量</p>
</blockquote>
<p>标量是最基本，最简单的数值类型，它们可以是：</p>
<ol>
<li>字符串：表示简单的文本。将文本内容写在引号内即可，单引号、双引号都可以。</li>
<li>数值：整数和非整数不区分</li>
<li>布尔值</li>
<li>日期：日期变量可以存储和日期 / 时间相关的数据。有三种格式：
<ul>
<li>日期：精确到天的日期，没有时间部分，比如 <code>April 4, 2003</code>。</li>
<li>时间：精确到毫秒，没有日期部分，比如 <code>10:19:18 PM</code>。</li>
<li>日期 - 时间（有时也被称为「时间戳」），比如 <code>April 4,2003 10:19:18 PM</code>。 有日期和时间两部分，时间部分的存储精确到毫秒。</li>
</ul>
</li>
</ol>
<p>不幸的是，受到 Java 平台的限制，FreeMarker 有时是不能决定日期的部哪分被使用（也就是说，是日期 - 时间格式，日期格式还是时间格式无法确定）。</p>
<blockquote>
<p>容器</p>
</blockquote>
<p>这些值存在的目的是为了包含其他变量，它们只是容器。 它们包含的变量通常视为 <em>subvariables</em> (子变量)。容器的类型有：</p>
<ol>
<li>哈希表</li>
<li>序列</li>
<li>集合：从模板设计者角度来看，集合是有限制的序列。不能获取集合的大小， 也不能通过索引取出集合中的子变量，但是它们仍然可以通过 list 指令来遍历。</li>
</ol>
<p>请注意，<mark>一个值也可有多种类型。</mark>  对于一个值可以同时存在哈希表和序列这两种类型，这时该变量就支持索引和名称两种访问方式，但我们一般不会两者同时使用。</p>
<p>存储在哈希表，序列（集合）中的变量可以是任意类型的， 这些变量也可以是哈希表、序列(或集合)，这样就可以构建任意深度的数据结构。</p>
<p>数据模型本身（最好说成是它的根 root）也是哈希表。</p>
<blockquote>
<p>方法和函数</p>
</blockquote>
<p>当一个值是方法或函数的时候，那么它就可以计算其他值，结果取决于传递给它的参数。</p>
<p>假设程序员在数据模型中放置了一个方法变量 <code>avg</code>， 该变量用来计算数字的平均值。如果给定 3 和 5 作为参数，访问 <code>avg</code> 时就能得到结果 4。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The average of 3 and 5 is: $&#123;avg(3, 5)&#125;</span><br></pre></td></tr></table></figure>
<p>那么会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The average of 3 and 5 is: 4</span><br></pre></td></tr></table></figure>
<blockquote>
<p>用户自定义指令</p>
</blockquote>
<p>这种类型的值可以作为用户自定义指令（用户可以自定义自己的 FreeMarker 的标签），用户自定义指令是一种子程序，一种可以复用的模板代码段。</p>
<p>自定义指令可以使用 <code>&lt;# macro&gt;</code> 指令来定义，使用自定义指令的时候要用 <code>@</code> 而不是 <code>#</code>。</p>
<p>具体方式参看后文介绍。</p>
<blockquote>
<p>函数 / 方法和用户自定义指令的比较</p>
</blockquote>
<p>对于函数 / 方法和用户自定义指令的选择，按经验来说，如果能够实现需求， 请先用自定义指令而不要用函数 / 方法。对于自定义指令来说：</p>
<ul>
<li>输出（返回值）的是标记（HTML、XML 等）。 主要原因是函数的返回结果可以自动进行 XML 转义（因为 <code>$&#123;...&#125;</code> 的特性）， 而用户自定义指令的输出则不是（因为 <code>&lt;@...&gt;</code> 的特性所致，它的输出假定是标记，因此已经转义过了）；</li>
<li>没有返回值；</li>
<li>会进行流程的控制（就像 <code>list</code> 或 <code>if</code> 指令那样），但是不能在函数 / 方法上这么做。</li>
</ul>
<h1 id="3-模板总体结构"><a class="header-anchor" href="#3-模板总体结构"></a>3. 模板总体结构</h1>
<p>所谓模板，就是我们编写的 <code>.ftl</code> 文件，模板是由以下部分混合而成的：</p>
<ul>
<li>
<p>文本：照着原样输出</p>
</li>
<li>
<p>插值：<code>$&#123;....&#125;</code></p>
</li>
<li>
<p>FTL 标签</p>
</li>
<li>
<p>注释</p>
</li>
</ul>
<p>FTL 标签是区分大小写的。 <code>list</code> 是指令的名称但 <code>List</code> 就不是，同样 <code>$&#123;name&#125;</code> 和 <code>$&#123;Name&#125;</code> 或 <code>$&#123;NAME&#125;</code> 也是不同的。</p>
<p><mark>请注意非常重要的一点： 插值仅仅可以在文本中使用。</mark></p>
<p>FTL 标签不可以在其他 FTL 标签和插值中使用。比如，下面这样就是错的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if &lt;#include &#x27;foo&#x27;&gt;=&#x27;bar&#x27;&gt;...&lt;/#if&gt;</span><br></pre></td></tr></table></figure>
<p>注释可以放在 FTL 标签和插值中。</p>
<p>和 HTML 标签一样，FTL 标签必须正确地嵌套使用，像下面这样就是错的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">&lt;#list animals as animal&gt;</span><br><span class="line">	&lt;li&gt;$&#123;animal.name&#125; for $&#123;animal.price&#125; Euros</span><br><span class="line">	&lt;#if user == &quot;Big Joe&quot;&gt;</span><br><span class="line">	(except for you)</span><br><span class="line">&lt;/#list&gt; &lt;#-- WRONG! The &quot;if&quot; has to be closed first. --&gt;</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<h1 id="4-表达式"><a class="header-anchor" href="#4-表达式"></a>4. 表达式</h1>
<h2 id="4-1-直接指定值"><a class="header-anchor" href="#4-1-直接指定值"></a>4.1 直接指定值</h2>
<blockquote>
<p>字符串</p>
</blockquote>
<p>确定字符串值的方法就是看双引号或单引号，这两个是等同的。</p>
<p>如果文本自身包含用于字符引用的引号（ <code>&quot;</code> 或 <code>'</code>）或反斜杠时， 应该在它们的前面再加一个反斜杠，这就是转义。 转义允许直接在文本中输入任何字符， 也包括换行。</p>
<table>
<thead>
<tr>
<th style="text-align:center">转义序列</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>\&quot;</code></td>
<td style="text-align:center">引号 (u0022)</td>
</tr>
<tr>
<td style="text-align:center"><code>\'</code></td>
<td style="text-align:center">单引号(又称为撇号) (u0027)</td>
</tr>
<tr>
<td style="text-align:center"><code>\&#123;</code></td>
<td style="text-align:center">起始花括号：<code>&#123;</code></td>
</tr>
<tr>
<td style="text-align:center"><code>\\</code></td>
<td style="text-align:center">反斜杠 (u005C)</td>
</tr>
<tr>
<td style="text-align:center"><code>\n</code></td>
<td style="text-align:center">换行符 (u000A)</td>
</tr>
<tr>
<td style="text-align:center"><code>\r</code></td>
<td style="text-align:center">回车 (u000D)</td>
</tr>
<tr>
<td style="text-align:center"><code>\t</code></td>
<td style="text-align:center">水平制表符(又称为tab) (u0009)</td>
</tr>
<tr>
<td style="text-align:center"><code>\b</code></td>
<td style="text-align:center">退格 (u0008)</td>
</tr>
<tr>
<td style="text-align:center"><code>\f</code></td>
<td style="text-align:center">换页 (u000C)</td>
</tr>
<tr>
<td style="text-align:center"><code>\l</code></td>
<td style="text-align:center">小于号：<code>&lt;</code></td>
</tr>
<tr>
<td style="text-align:center"><code>\g</code></td>
<td style="text-align:center">大于号：<code>&gt;</code></td>
</tr>
<tr>
<td style="text-align:center"><code>\a</code></td>
<td style="text-align:center">&amp;符：<code>&amp;</code></td>
</tr>
<tr>
<td style="text-align:center"><code>\xCode</code></td>
<td style="text-align:center">字符的16进制 Unicode码 (UCS码)</td>
</tr>
</tbody>
</table>
<p>在最后一样中的 Code 表示 1 - 4 位的 16 进制码。 如果紧跟 16 进制码后一位的字符也能解释成 16 进制码时， 就必须把 4 位补全，否则 FreeMarker 就会误解你的意图。</p>
<p>如果想要打印 <code>$&#123;</code> 或 <code>#&#123;</code>， 就要使用原生字符串，或者进行转义。</p>
<p>为了表明字符串是原生字符串， 在开始的引号或单引号之前放置字母<code>r</code>，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;r&quot;$&#123;foo&#125;&quot;&#125;</span><br><span class="line">$&#123;r&quot;C:\foo\bar&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;foo&#125;</span><br><span class="line">C:\foo\bar</span><br></pre></td></tr></table></figure>
<blockquote>
<p>数字</p>
</blockquote>
<p>数字的指定很简单，直接写就行了，但是不支持科学计数法也不能省略小数点前的 0。</p>
<p>下面这些写法都是正确的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.08、-5.013、8、008、11、+11</span><br></pre></td></tr></table></figure>
<blockquote>
<p>序列</p>
</blockquote>
<p>指定一个文字的序列，使用逗号来分隔其中的每个子变量，然后把整个列表放到方括号中。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list [&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;] as x&gt;</span><br><span class="line">$&#123;x&#125;</span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>值域</p>
</blockquote>
<p>值域也是序列，但它们由指定包含的数字范围所创建， 而不需指定序列中每一项。</p>
<p>比如： <code>0..&lt;m</code>，假设 <code>m</code> 变量的值是5，那么这个序列就包含 <code>[0, 1, 2, 3, 4]</code>。值域的主要作用有：使用 <code>&lt;#list ...&gt;</code> 来迭代一定范围内的数字、序列切分和字符串切分。</p>
<p>值域表达式的通用形式是（ <code>start</code> 和 <code>end</code> 可以是任意的结果为数字表达式）：</p>
<ul>
<li><code>start..end</code>：包含结尾的值域。</li>
<li><code>star..&lt;end</code> 或  <code>start..!end</code>：不包含结尾的值域。<code>1..&lt;1</code> 表示 <code>[]</code></li>
<li><code>start..*length</code>：限定长度的值域，比如 <code>10..*4</code> 就是 <code>[10, 11, 12, 13]</code>，<code>10..*-4</code> 就是 <code>[10, 9, 8, 7]</code>，而 <code>10..*0</code> 表示 <code>[]</code>。当这些值域被用来切分时， 如果切分后的序列或者字符串结尾在指定值域长度之前，则切分不会有问题。</li>
<li><code>start..</code>： 无右边界值域。注意内存溢出。</li>
</ul>
<p>需要注意的是：</p>
<ul>
<li>无右边界值域的定义大小是 2147483647， 这是由于技术上的限制（32位），但当列表显示它们的时候，实际的长度是无穷大。</li>
<li>值域并不存储它们包含的数字，那么对于 <code>0..1</code> 和 <code>0..100000000</code> 来说，创建速度都是一样的， 并且占用的内存也是一样的。</li>
</ul>
<blockquote>
<p>哈希表</p>
</blockquote>
<p>在模板中指定一个哈希表，就可以遍历用逗号分隔开的&quot;键/值&quot;对， 把列表放到花括号内即可。键和值成对出现并以冒号分隔。比如： <code>&#123; &quot;name&quot;: &quot;green mouse&quot;, &quot;price&quot;: 150 &#125;</code>。</p>
<p>键和值都是表达式，但是 <mark>用来检索的键必须是字符串类型，</mark>  而值可以是任意类型。</p>
<p>在遍历哈希表时，可以使用 <code>keys</code> 或 <code>values</code> 内建函数。</p>
<h2 id="4-2-检索变量"><a class="header-anchor" href="#4-2-检索变量"></a>4.2 检索变量</h2>
<p>检索遍历很简单，使用 <code>$&#123;...&#125;</code> 就可以了。说一下内部表达式需要注意的：</p>
<p>变量名只可以包含字母（也可以是非拉丁文）， 数字（也可以是非拉丁数字），下划线 (<code>_</code>)， 美元符号 (<code>$</code>)，at 符号 (<code>@</code>)。 此外，第一个字符不可以是 ASCII 码数字(<code>0</code>-<code>9</code>)。 从 FreeMarker 2.3.22 版本开始，变量名在任何位置也可以包含负号 (<code>-</code>)，点(<code>.</code>)和冒号(<code>:</code>)， 但这些必须使用前置的反斜杠(<code>\</code>)来转义， 否则它们将被解释成操作符。</p>
<p>比如，读取名为 <code>data-id</code> 的变量， 表达式为 <code>data\-id</code>，因为 <code>data-id</code> 将被解释成 <code>data minus id</code>。</p>
<p><mark>请注意，这些转义仅在标识符中起作用，而不是字符串中。</mark></p>
<h2 id="4-3-字符串操作"><a class="header-anchor" href="#4-3-字符串操作"></a>4.3 字符串操作</h2>
<blockquote>
<p>插值（或链接）</p>
</blockquote>
<p>所谓插值，就是 <code>$&#123;...&#125;</code>。但需要注意的是，<mark>插值只能在文本区中有效，</mark> 比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;Hello $&#123;name&#125;!&lt;/h1&gt;</span><br><span class="line">&lt;#include &quot;/footer/$&#123;company&#125;.html&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>但是，这样就是错误的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if $&#123;big&#125;&gt;...&lt;/#if&gt;</span><br><span class="line">&lt;#if &quot;$&#123;big&#125;&quot;&gt;...&lt;/#if&gt; &lt;#--参数相当于字符串，但是 if 只能接受布尔值--&gt;</span><br></pre></td></tr></table></figure>
<p>这样写才是对的：<code>&lt;#if big&gt;...&lt;/#if&gt;</code></p>
<p>下面这两种写法是等效的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign s = &quot;Hello $&#123;user&#125;!&quot;&gt;</span><br><span class="line">&lt;#assign s = &quot;Hello &quot; + user + &quot;!&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>由于地区差异，很多地区会使用千分位分隔符，那么 <code>&quot;someUrl?id=&quot; + id</code> 就可能会是 <code>&quot;someUrl?id=1 234&quot;</code>（<code>1</code> 与 <code>234</code> 之间存在一个空格）。 要预防这种事情的发生，请使用 <code>?c</code> 内建函数，那么在 <code>&quot;someUrl?id=&quot; + id?c</code> 或 <code>&quot;someUrl?id=$&#123;id?c&#125;&quot;</code>中， 就会得到如 <code>&quot;someUrl?id=1234&quot;</code> 的输出， 而不管本地化和格式的设置是什么，当然也可以在填充参数时就将数值转换成字符串。</p>
<blockquote>
<p>获取字符</p>
</blockquote>
<p>要想获取字符串中的某个字符，和获取序列中某个索引位置的值是一样的，比如：</p>
<p>假设 user 是 “mofan”：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;user[0]&#125;</span><br><span class="line">$&#123;user[4]&#125;</span><br></pre></td></tr></table></figure>
<p>将会得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m</span><br><span class="line">n</span><br></pre></td></tr></table></figure>
<blockquote>
<p>字符串切分</p>
</blockquote>
<p>字符串切分也很简单，但需要 <mark>注意</mark> 的是：</p>
<ul>
<li>降序域不允许进行字符串切分。</li>
<li>如果变量的值既是字符串又是序列（变量时多类型值），那么切分将会对序列进行，而不是字符串。当处理 XML 时，这样的值就是普通的了。此时，可以使用 <code>someXMLnode?string[range]</code>。</li>
<li>一个遗留的 bug：值域包含结尾时，结尾小于开始索引并且是非负的（就像在 <code>&quot;abc&quot;[1..0]</code> 中）， 会返回空字符串而不是错误（因为不符合我们说的第一点）。在实际使用时，不应该这样使用。</li>
</ul>
<p>字符串切分示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign s = &quot;ABCDEF&quot;&gt;</span><br><span class="line">$&#123;s[2..3]&#125;</span><br><span class="line">$&#123;s[2..&lt;4]&#125;</span><br><span class="line">$&#123;s[2..*3]&#125;</span><br><span class="line">$&#123;s[2..*100]&#125;</span><br><span class="line">$&#123;s[2..]&#125;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CD</span><br><span class="line">CD</span><br><span class="line">CDE</span><br><span class="line">CDEF</span><br><span class="line">CDEF</span><br></pre></td></tr></table></figure>
<h2 id="4-4-序列操作"><a class="header-anchor" href="#4-4-序列操作"></a>4.4 序列操作</h2>
<blockquote>
<p>连接</p>
</blockquote>
<p>序列可以像字符串那样使用 <code>+</code> 进行连接，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list [&quot;Joe&quot;, &quot;Fred&quot;] + [&quot;Julia&quot;, &quot;Kate&quot;] as user&gt;</span><br><span class="line">- $&#123;user&#125;</span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>序列切分</p>
</blockquote>
<p>序列切分和字符串切分类似，使用 <code>seq[range]</code> 进行切分，range 是一个值域，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assert seq = [&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;]&gt;</span><br><span class="line">&lt;#list seq[1..3] as i&gt; $&#123;i&#125; &lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BCD </span><br></pre></td></tr></table></figure>
<p>但是序列切分允许使用降值域，比如：<code>seq[3..1]</code> 将会输出 DCB。</p>
<p>值域中的数字必须是序列可使用的合法索引， 否则模板的处理将会终止并报错。不能出现负数的索引，索引不能越界，但是 <code>seq[100..&lt;100]</code> 或 <code>seq[100..*0]</code> 是合法的，因为这些值域是空的，尽管索引越界了。</p>
<p>限制长度的值域（<code>start..*length</code>）和无右边界值域（<code>start..</code>）适用于切分后序列的长度。它们会切分可用项中尽可能多的部分。</p>
<h2 id="4-5-哈希表操作"><a class="header-anchor" href="#4-5-哈希表操作"></a>4.5 哈希表操作</h2>
<blockquote>
<p>连接</p>
</blockquote>
<p>像连接字符串那样，也可以使用 <code>+</code> 号的方式来连接哈希表。如果两个哈希表含有键相同的项，那么在 <code>+</code> 号 <mark>右侧</mark> 的哈希表中的项优先。</p>
<h2 id="4-6-算数运算"><a class="header-anchor" href="#4-6-算数运算"></a>4.6 算数运算</h2>
<p>算数运算包含基本的四则运算和求模运算，运算符有：</p>
<ul>
<li>加法： <code>+</code></li>
<li>减法： <code>-</code></li>
<li>乘法： <code>*</code></li>
<li>除法： <code>/</code></li>
<li>求模 (求余)： <code>%</code></li>
</ul>
<p>进行算数运算的两个操作数都是结果为数字的表达式。</p>
<p>但也有例外，<code>+</code> 号可以用来连接字符串，如果 <code>+</code> 号的一端是字符串，<code>+</code> 号的另外一端是数字，那么数字就会自动转换为字符串类型（使用当前页面语言的适当格式），之后使用 <code>+</code> 号作为字符串连接操作符。</p>
<p>FreeMarker 不能自动将字符串转换为数字，反之可以自动进行。</p>
<p>如果我们只想获取除法计算（或其它运算）的整数部分， 这可以使用内建函数 <code>int</code> 来解决：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&#123;(x/2)?int&#125;</span><br><span class="line">$&#123;1.1?int&#125;</span><br><span class="line">$&#123;1.999?int&#125;</span><br><span class="line">$&#123;-1.1?int&#125;</span><br><span class="line">$&#123;-1.999?int&#125;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">-1</span><br><span class="line">-1</span><br></pre></td></tr></table></figure>
<h2 id="4-7-比较运算"><a class="header-anchor" href="#4-7-比较运算"></a>4.7 比较运算</h2>
<p>如果要比较两个值是否相等，可以使用 <code>=</code>，或者 <code>==</code>，两者是等效的。</p>
<p><code>=</code> 或 <code>!=</code> 两边的表达式的结果都必须是标量，而且两个标量都必须是相同类型（也就是说字符串只能和字符串来比较，数字只能和数字来比较等）否则将会出错， 模板执行中断。</p>
<p>请注意FreeMarker进行的是精确的比较，所以字符串在比较时要注意大小写和空格： <code>&quot;x&quot;</code> 和 <code>&quot;x &quot;</code> 和 <code>&quot;X&quot;</code> 是不同的值。</p>
<p>对数字和日期类型的比较，也可以使用 <code>&lt;</code>， <code>&lt;=</code>，<code>&gt;=</code> 和 <code>&gt;</code>。不能把它们当作字符串来比较。</p>
<p>使用 <code>&gt;=</code> 和 <code>&gt;</code> 的时候有一点小问题。FreeMarker 解释 <code>&gt;</code> 的时候可以把它当作 FTL 标签的结束符。为了避免这种问题，可以使用 <code>lt</code> 代替 <code>&lt;</code>， <code>lte</code> 代替 <code>&lt;=</code>， <code>gt</code> 代替 <code>&gt;</code> 还有 <code>gte</code> 代替 <code>&gt;=</code>， 例如 <code>&lt;#if x gt y&gt;</code>。另外一个技巧是将表达式放到圆括号中，例如 <code>&lt;#if (x &gt; y)&gt;</code>，但第二种显然不优雅。</p>
<h2 id="4-8-逻辑操作"><a class="header-anchor" href="#4-8-逻辑操作"></a>4.8 逻辑操作</h2>
<p>常用的逻辑操作符：</p>
<ul>
<li>逻辑 或： <code>||</code></li>
<li>逻辑 与： <code>&amp;&amp;</code></li>
<li>逻辑 非： <code>!</code></li>
</ul>
<p>逻辑操作符仅仅在布尔值之间有效，若用在其他类型将会产生错误导致模板执行中止。</p>
<h2 id="4-9-内建函数"><a class="header-anchor" href="#4-9-内建函数"></a>4.9 内建函数</h2>
<p>内建函数就像 FreeMarker 在对象中添加的方法一样。要防止和实际方法和其它子变量的命名冲突，则不能使用点 (<code>.</code>)，这里使用问号 (<code>?</code>)来和父对象分隔开。</p>
<p>为了简洁，如果方法没有参数，那么就可以忽略 <code>()</code>，比如想要获取 <code>path</code> 的长度，就可以写作：<code>path?length</code>， 而不是 <code>path?length()</code>。</p>
<p>重要的常见内建函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&#123;testString?upper_case&#125;</span><br><span class="line">$&#123;testString?html&#125;</span><br><span class="line">$&#123;testString?upper_case?html&#125;</span><br><span class="line"></span><br><span class="line">$&#123;testSequence?size&#125;</span><br><span class="line">$&#123;testSequence?join(&quot;, &quot;)&#125;</span><br></pre></td></tr></table></figure>
<p>假设 <code>testString</code> 中存储了字符串「Tom &amp; Jerry」，而 <code>testSequnce</code> 中存储了字符串「foo」，「bar」和「baz」，将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TOM &amp; JERRY</span><br><span class="line">Tom &amp;amp; Jerry</span><br><span class="line">TOM &amp;amp; JERRY</span><br><span class="line"></span><br><span class="line">3</span><br><span class="line">foo, bar, baz</span><br></pre></td></tr></table></figure>
<p>内建函数的左侧可以是任意的表达式，而不仅仅是变量名。</p>
<p>完整的内建函数参考：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/ref_builtins.html">内建函数参考</a></p>
<h2 id="4-10-方法调用"><a class="header-anchor" href="#4-10-方法调用"></a>4.10 方法调用</h2>
<p>如果有一个方法，那么可以使用方法调用操作。方法调用操作是使用逗号来分割在括号内的表达式而形成参数列表，这些值就是参数。方法调用操作将这些值传递给方法，然后返回一个结果。这个结果就是整个方法调用表达式的值。</p>
<p>假设程序员定义了一个可供调用的方法 <code>repeat</code>。第一个参数是字符串类型，第二个参数是数字类型。方法的返回值是字符串类型，而方法要完成的操作是将第一个参数重复显示，显示的次数是第二个参数设定的值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;repeat(&quot;Foo&quot;, 3)&#125;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FooFooFoo</span><br></pre></td></tr></table></figure>
<p>方法调用也是普通表达式，和其它都是一样的，所以：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;repeat(repeat(&quot;x&quot;, 2), 3) + repeat(&quot;Foo&quot;, 4)?upper_case&#125;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxFOOFOOFOOFOO</span><br></pre></td></tr></table></figure>
<h2 id="4-11-赋值运算符"><a class="header-anchor" href="#4-11-赋值运算符"></a>4.11 赋值运算符</h2>
<p>这些并不是表达式，只是复制指令语法的一部分，比如 <code>assign</code>, <code>local</code>和 <code>global</code>。 照这样，它们不能任意被使用。</p>
<p><code>&lt;#assign x += y&gt;</code> 是 <code>&lt;#assign x = x + y&gt;</code> 的简写，<code>&lt;#assign x *= y&gt;</code> 是 <code>&lt;#assign x = x * y&gt;</code>的简写等等…</p>
<p><code>&lt;#assign x++ &gt;</code> 和 <code>&lt;#assign x += 1&gt;</code> （或 <code>&lt;#assign x = x + 1&gt;</code>）不同，它只做算术加法运算（如果变量不是数字的话就会失败），而其它的是进行字符串，序列连接和哈希表连接的重载。 <code>&lt;#assign x-- &gt;</code> 是 <code>&lt;#assign x -= 1&gt;</code> 的简写。</p>
<h2 id="4-12-操作符优先级"><a class="header-anchor" href="#4-12-操作符优先级"></a>4.12 操作符优先级</h2>
<p>下表中的运算符按照优先程度降序排列：上面的操作符优先级高于它下面的。高优先级的运算符执行要先于优先级比它低的。表格同一行上的两个操作符优先级相同。当有相同优先级的二元运算符挨着出现时，它们按照从左到右的原则运算。</p>
<table>
<thead>
<tr>
<th style="text-align:center">运算符组</th>
<th style="text-align:center">运算符</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">最高优先级运算符</td>
<td style="text-align:center"><code>[subvarName]</code> <code>[subStringRange]</code> <code>.</code> <code>?(methodParams)</code> <code>expr! </code> <code>expr??</code></td>
</tr>
<tr>
<td style="text-align:center">一元前缀运算符</td>
<td style="text-align:center"><code>+ - !</code></td>
</tr>
<tr>
<td style="text-align:center">乘除法，求模运算符</td>
<td style="text-align:center"><code>* / %</code></td>
</tr>
<tr>
<td style="text-align:center">加减法运算符</td>
<td style="text-align:center"><code>+ -</code></td>
</tr>
<tr>
<td style="text-align:center">数字值域</td>
<td style="text-align:center"><code>..</code> <code>..&lt;</code> <code>..!</code> <code>..*</code></td>
</tr>
<tr>
<td style="text-align:center">关系运算符</td>
<td style="text-align:center"><code>&lt; &gt; &lt;= &gt;=</code> （<code>gt</code>，<code>lt</code>，etc.）</td>
</tr>
<tr>
<td style="text-align:center">相等，不等运算符</td>
<td style="text-align:center"><code>== != =</code></td>
</tr>
<tr>
<td style="text-align:center">逻辑 「与」 运算符</td>
<td style="text-align:center"><code>&amp;&amp;</code></td>
</tr>
<tr>
<td style="text-align:center">逻辑「或」运算符</td>
<td style="text-align:center">`</td>
</tr>
</tbody>
</table>
<h1 id="5-插值"><a class="header-anchor" href="#5-插值"></a>5. 插值</h1>
<p>插值的使用格式是： <code>$&#123;expression&#125;</code>，这里的 <code>expression</code> 可以是所有种类的表达式(比如 <code>$&#123;100 + x&#125;</code>)。插值只能在文本区和字符串表达式中使用。</p>
<p>表达式的结果必须是字符串，数字或者日期 / 时间 / 日期 - 时间值， 因为（默认是这样）仅仅这些值可以被插值自动转换为字符串。其它类型的值（比如布尔值，序列）必须「手动地」转换成字符串（后续会有一些建议）， 否则就会发生错误，中止模板执行。</p>
<p>具体插值指南可以参考：<a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/dgui_template_valueinsertion.html">插值</a></p>
<h1 id="6-自定义指令"><a class="header-anchor" href="#6-自定义指令"></a>6. 自定义指令</h1>
<h2 id="6-1-基本内容"><a class="header-anchor" href="#6-1-基本内容"></a>6.1 基本内容</h2>
<p>宏是有一个变量名的模板片段。可以在模板中使用宏作为自定义指令， 这样就能进行重复性的工作。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro greet&gt;</span><br><span class="line">  &lt;font size=&quot;+2&quot;&gt;Hello Joe!&lt;/font&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure>
<p>在 <code>&lt;#macro greet&gt;</code> 和 <code>&lt;/#macro&gt;</code> 之间的内容（称为 <strong>宏定义体</strong>）将会在使用该变量作为指令时执行。可以这样使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;@greet&gt;&lt;/@greet&gt;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;@greet/&gt;</span><br></pre></td></tr></table></figure>
<p>然后会输出：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">&quot;+2&quot;</span>&gt;</span>Hello Joe!<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="6-2-参数"><a class="header-anchor" href="#6-2-参数"></a>6.2 参数</h2>
<p>在自定义指令时，还可以指定若干个参数，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro greet person&gt;</span><br><span class="line">  &lt;font size=&quot;+2&quot;&gt;Hello $&#123;person&#125;!&lt;/font&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure>
<p>可以这样使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;@greet person=&quot;Fred&quot;/&gt; and &lt;@greet person=&quot;Batman&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>最终打印结果是这样的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">&quot;+2&quot;</span>&gt;</span>Hello Fred!<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line"> and   <span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">&quot;+2&quot;</span>&gt;</span>Hello Batman!<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>=</code> 右边不一定是字符串，可以是 FTL 表达式。比如： <code>&lt;@greet person=Fred/&gt;</code> 也意味着使用变量的值 <code>Fred</code> 作为 <code>person</code> 参数， 而不是字符串<code>&quot;Fred&quot;</code>。甚至还可以是复杂表达式。</p>
<p>自定义指令可以有多个参数。在使用时，参数的顺序不重要，因为在使用时我们已经指定了参数名和对应的值。</p>
<p><mark>需要注意的是，</mark> 在使用自定义指令时，不能使用未提及的参数，同时也必须给出在宏中定义所有参数的值。</p>
<p>当然，我们在创建自定义指令时，可以给参数指定默认值，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro greet person color=&quot;black&quot;&gt;</span><br><span class="line">  &lt;font size=&quot;+2&quot; color=&quot;$&#123;color&#125;&quot;&gt;Hello $&#123;person&#125;!&lt;/font&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure>
<p>后续可以这样使用宏：<code>&lt;@greet person=&quot;Fred&quot;/&gt;</code>，因为它和 <code>&lt;@greet person=&quot;Fred&quot; color=&quot;black&quot;/&gt;</code> 是相等的。如果在使用时重新设置 color 的值，那么新值会覆盖默认值。</p>
<p>明白下面这一点是至关重要的：<code>someParam=foo</code> 和 <code>someParam=&quot;$&#123;foo&#125;&quot;</code> 是不同的。第一种情况， 是把变量 <code>foo</code> 的值作为参数的值来使用。第二种情况则是使用插值形式的字符串，那么参数值就是字符串了，这个时候，<code>foo</code> 的值呈现为文本， 而不管 <code>foo</code> 是什么类型的。看下面这个例子： <code>someParam=3/4</code> 和 <code>someParam=&quot;$&#123;3/4&#125;&quot;</code> 是不同的。 如果指令需要 <code>someParam</code> 是一个数字值， 那么就不要用第二种方式。切记不要改变这些。</p>
<h2 id="6-3-嵌套内容"><a class="header-anchor" href="#6-3-嵌套内容"></a>6.3 嵌套内容</h2>
<p>自定义指令可以嵌套内容。 例如，下面这个例子中是创建了一个可以为嵌套的内容画出边框的宏：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro border&gt;</span><br><span class="line">  &lt;table border=4 cellspacing=0 cellpadding=4&gt;&lt;tr&gt;&lt;td&gt;</span><br><span class="line">    &lt;#nested&gt;</span><br><span class="line">  &lt;/tr&gt;&lt;/td&gt;&lt;/table&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure>
<p><code>&lt;#nested&gt;</code> 指令执行位于开始和结束标记指令之间的模板代码段。 如果这样写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;@border&gt;The bordered text&lt;/@border&gt;</span><br></pre></td></tr></table></figure>
<p>那么会输出：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">4</span> <span class="attr">cellspacing</span>=<span class="string">0</span> <span class="attr">cellpadding</span>=<span class="string">4</span>&gt;</span><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">    The bordered text</span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;#nested&gt;</code> 指令也可以被多次调用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro do_thrice&gt;</span><br><span class="line">  &lt;#nested&gt;</span><br><span class="line">  &lt;#nested&gt;</span><br><span class="line">  &lt;#nested&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line">&lt;@do_thrice&gt;</span><br><span class="line">  Anything.</span><br><span class="line">&lt;/@do_thrice&gt;</span><br></pre></td></tr></table></figure>
<p>那么就会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Anything.</span><br><span class="line">Anything.</span><br><span class="line">Anything.</span><br></pre></td></tr></table></figure>
<p>如果不使用 <code>nested</code> 指令， 那么嵌套的内容就不会被执行。比如前面自定义的 <code>great</code> 指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro greet&gt;</span><br><span class="line">  &lt;font size=&quot;+2&quot;&gt;Hello Joe!&lt;/font&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure>
<p>然后这样使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;@greet person=&quot;Joe&quot;&gt;</span><br><span class="line">  Anything.</span><br><span class="line">&lt;/@greet&gt;</span><br></pre></td></tr></table></figure>
<p><code>greet</code> 宏没有使用 <code>nested</code> 指令，FreeMarker 不会把它视为错误，只是输出：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span>=<span class="string">&quot;+2&quot;</span>&gt;</span>Hello Joe!<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>嵌套的内容可以是任意有效的 FTL，包含其他的用户自定义指令。</p>
<p>在嵌套的内容中，宏的局部变量是不可见的。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro repeat count&gt;</span><br><span class="line">  &lt;#local y = &quot;test&quot;&gt;</span><br><span class="line">  &lt;#list 1..count as x&gt;</span><br><span class="line">    $&#123;y&#125; $&#123;count&#125;/$&#123;x&#125;: &lt;#nested&gt;</span><br><span class="line">  &lt;/#list&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line">&lt;@repeat count=3&gt;$&#123;y!&quot;?&quot;&#125; $&#123;x!&quot;?&quot;&#125; $&#123;count!&quot;?&quot;&#125;&lt;/@repeat&gt;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test 3/1: ? ? ?</span><br><span class="line">test 3/2: ? ? ?</span><br><span class="line">test 3/3: ? ? ?</span><br></pre></td></tr></table></figure>
<p>此外不同的局部变量的设置是为每个宏自己调用的，不会导致混乱。比如有模板：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro test foo&gt;$&#123;foo&#125; (&lt;#nested&gt;) $&#123;foo&#125;&lt;/#macro&gt;</span><br><span class="line">&lt;@test foo=&quot;A&quot;&gt;&lt;@test foo=&quot;B&quot;&gt;&lt;@test foo=&quot;C&quot;/&gt;&lt;/@test&gt;&lt;/@test&gt;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A (B (C () C) B) A</span><br></pre></td></tr></table></figure>
<h2 id="6-4-宏和循环变量"><a class="header-anchor" href="#6-4-宏和循环变量"></a>6.4 宏和循环变量</h2>
<p>像 <code>list</code> 这样的预定义指令可以使用循环变量，自定义指令也可以有循环变量。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro do_thrice&gt;</span><br><span class="line">  &lt;#nested 1&gt;</span><br><span class="line">  &lt;#nested 2&gt;</span><br><span class="line">  &lt;#nested 3&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line">&lt;@do_thrice ; x&gt; &lt;#-- user-defined directive uses &quot;;&quot; instead of &quot;as&quot; --&gt;</span><br><span class="line">  $&#123;x&#125; Anything.</span><br><span class="line">&lt;/@do_thrice&gt;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 Anything.</span><br><span class="line">2 Anything.</span><br><span class="line">3 Anything.</span><br></pre></td></tr></table></figure>
<p>语法规则是给确定「循环」的循环变量传递真实值（比如重复嵌套内容）来作为 <code>nested</code> 指令的参数（当然参数可以是任意的表达式）。 循环变量的名称是在自定义指令的开始标记（<code>&lt;@...&gt;</code>）的参数后面通过分号确定的。</p>
<p>一个宏可以使用多个循环变量（注意变量的顺序）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro repeat count&gt;</span><br><span class="line">  &lt;#list 1..count as x&gt;</span><br><span class="line">    &lt;#nested x, x/2, x==count&gt;</span><br><span class="line">  &lt;/#list&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line">&lt;@repeat count=4 ; c, halfc, last&gt;</span><br><span class="line">  $&#123;c&#125;. $&#123;halfc&#125;&lt;#if last&gt; Last!&lt;/#if&gt;</span><br><span class="line">&lt;/@repeat&gt;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 0.5</span><br><span class="line">2. 1</span><br><span class="line">3. 1.5</span><br><span class="line">4. 2 Last!</span><br></pre></td></tr></table></figure>
<p>在自定义指令的开始标签（分号之后）为循环变量指定不同的数字是没有问题的， 而不能在 <code>nested</code> 指令上使用。如果在分号之后指定的循环变量少， 那么就看不到 <code>nested</code> 指令提供的最后的值， 因为没有循环变量来存储这些值，下面这样使用是可以的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;@repeat count=4 ; c, halfc, last&gt;</span><br><span class="line">  $&#123;c&#125;. $&#123;halfc&#125;&lt;#if last&gt; Last!&lt;/#if&gt;</span><br><span class="line">&lt;/@repeat&gt;</span><br><span class="line">&lt;@repeat count=4 ; c, halfc&gt;</span><br><span class="line">  $&#123;c&#125;. $&#123;halfc&#125;</span><br><span class="line">&lt;/@repeat&gt;</span><br><span class="line">&lt;@repeat count=4&gt;</span><br><span class="line">  Just repeat it...</span><br><span class="line">&lt;/@repeat&gt;</span><br></pre></td></tr></table></figure>
<p>如果在分号后面指定了比 <code>nested</code> 指令还多的变量， 那么最后的循环变量将不会被创建（在嵌套内容中不会被定义）。</p>
<h2 id="6-5-递归中使用嵌套内容"><a class="header-anchor" href="#6-5-递归中使用嵌套内容"></a>6.5  递归中使用嵌套内容</h2>
<p>构建的模板参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title function_">buildTemplateParam</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">entityMap</span> <span class="operator">=</span> Map.of(</span><br><span class="line">            <span class="string">&quot;1&quot;</span>, <span class="keyword">new</span> <span class="title class_">Entity</span>(<span class="string">&quot;Son&quot;</span>, <span class="string">&quot;son&quot;</span>),</span><br><span class="line">            <span class="string">&quot;2&quot;</span>, <span class="keyword">new</span> <span class="title class_">Entity</span>(<span class="string">&quot;Parent&quot;</span>, <span class="string">&quot;parent&quot;</span>),</span><br><span class="line">            <span class="string">&quot;3&quot;</span>, <span class="keyword">new</span> <span class="title class_">Entity</span>(<span class="string">&quot;Grandson&quot;</span>, <span class="string">&quot;grandson&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> Map.of(</span><br><span class="line">            <span class="string">&quot;entityMap&quot;</span>, entityMap,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>, List.of(<span class="string">&quot;2&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模板使用参数，不可修改 public 的访问修饰符</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在处理类似 <code>主-子-孙</code> 的聚合结构时，经常需要递归调用宏，而在处理最后一层模板参数时，执行嵌套内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;@precessChildrenAttribute entityMap &quot;dto&quot; path 0 ; nestedParam&gt;</span><br><span class="line">    $&#123;nestedParam&#125;.addError(&quot;Error Info&quot;);</span><br><span class="line">&lt;/@precessChildrenAttribute&gt;</span><br><span class="line"></span><br><span class="line">&lt;#macro precessChildrenAttribute entityMap paramName path index &gt;</span><br><span class="line">    &lt;#if index lt path?size&gt;</span><br><span class="line">        &lt;#local cur = entityMap[path[index]]</span><br><span class="line">                , curCapName = cur.name?cap_first</span><br><span class="line">                , subEntity = &quot;item&quot; + cur.name?cap_first&gt;</span><br><span class="line">        if ($&#123;paramName&#125;.get$&#123;curCapName&#125;DtoList() != null) &#123;</span><br><span class="line">            for($&#123;cur.type&#125; $&#123;subEntity&#125; : $&#123;paramName&#125;.get$&#123;curCapName&#125;DtoList()) &#123;</span><br><span class="line">                if ($&#123;subEntity&#125; != null) &#123;</span><br><span class="line">                    &lt;#-- 递归调用宏，调用时声明循环变量 --&gt;</span><br><span class="line">                    &lt;@precessChildrenAttribute entityMap subEntity path index + 1 ; nestedParam&gt;</span><br><span class="line">                        &lt;#-- 嵌套内容使用调用宏时声明的循环变量 --&gt;</span><br><span class="line">                        &lt;#nested nestedParam&gt;</span><br><span class="line">                    &lt;/@precessChildrenAttribute&gt;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;#elseif index == path?size&gt;</span><br><span class="line">        &lt;#-- 最后调用的嵌套内容，传入实际的参数 --&gt;</span><br><span class="line">        &lt;#nested paramName&gt;</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (dto.getParentDtoList() != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span>(Parent itemParent : dto.getParentDtoList()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (itemParent != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (itemParent.getSonDtoList() != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span>(Son itemSon : itemParent.getSonDtoList()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (itemSon != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (itemSon.getGrandsonDtoList() != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">for</span>(Grandson itemGrandson : itemSon.getGrandsonDtoList()) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (itemGrandson != <span class="literal">null</span>) &#123;</span><br><span class="line">                                    itemGrandson.addError(<span class="string">&quot;Error Info&quot;</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在更复杂的场景中，宏的内部不止一个 <code>&lt;#nested&gt;</code>，并要求它们生成不同的嵌套内容。此时可以在调用宏时额外定义一个循环变量，它作为 <code>&lt;#nested&gt;</code> 的标识，以便在第一次调用宏时能够根据这个标识生成不同内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;#-- nestedPosition 作为嵌套内容的标识 --&gt;</span><br><span class="line">&lt;@precessChildrenAttribute entityMap &quot;dto&quot; path 0 ; param, subParam, nestedPosition&gt;</span><br><span class="line">    &lt;#-- 标识为 if 时生成下述内容 --&gt;</span><br><span class="line">    &lt;#if nestedPosition == &quot;if&quot;&gt;</span><br><span class="line">        $&#123;param&#125;.addError(&quot;Error Info&quot;);</span><br><span class="line">    &lt;#else &gt;</span><br><span class="line">        &lt;#-- 否则生成下述内容 --&gt;</span><br><span class="line">        $&#123;subParam&#125;.addError(&quot;Error Info&quot;);</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">&lt;/@precessChildrenAttribute&gt;</span><br><span class="line"></span><br><span class="line">&lt;#macro precessChildrenAttribute entityMap paramName path index &gt;</span><br><span class="line">    &lt;#if index lt path?size&gt;</span><br><span class="line">        &lt;#local cur = entityMap[path[index]]</span><br><span class="line">                , curCapName = cur.name?cap_first</span><br><span class="line">                , subEntity = &quot;item&quot; + cur.name?cap_first&gt;</span><br><span class="line">        if (CollectionUtils.isEmpty($&#123;paramName&#125;.get$&#123;curCapName&#125;DtoList())) &#123;</span><br><span class="line">            &lt;#-- 嵌套内容标识在定义宏声明 &lt;#nested&gt; 时传入 --&gt;</span><br><span class="line">            &lt;#nested paramName subEntity &quot;if&quot; &gt;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for ($&#123;cur.type&#125; $&#123;subEntity&#125; : $&#123;paramName&#125;.get$&#123;curCapName&#125;DtoList()) &#123;</span><br><span class="line">                if ($&#123;subEntity&#125; != null) &#123;</span><br><span class="line">                    &lt;#-- 递归调用宏时，循环变量一个不能少 --&gt;</span><br><span class="line">                    &lt;@precessChildrenAttribute entityMap subEntity path index + 1 ;  param, subParam, nestedPosition&gt;</span><br><span class="line">                        &lt;#nested param, subParam, nestedPosition&gt;</span><br><span class="line">                    &lt;/@precessChildrenAttribute&gt;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;#elseif index == path?size&gt;</span><br><span class="line">        &lt;#-- 嵌套内容标识在定义宏声明 &lt;#nested&gt; 时传入 --&gt;</span><br><span class="line">        &lt;#nested &quot;&quot; paramName &quot;&quot;&gt;</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (CollectionUtils.isEmpty(dto.getParentDtoList())) &#123;</span><br><span class="line">    dto.addError(<span class="string">&quot;Error Info&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Parent itemParent : dto.getParentDtoList()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (itemParent != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (CollectionUtils.isEmpty(itemParent.getSonDtoList())) &#123;</span><br><span class="line">                itemParent.addError(<span class="string">&quot;Error Info&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (Son itemSon : itemParent.getSonDtoList()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (itemSon != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (CollectionUtils.isEmpty(itemSon.getGrandsonDtoList())) &#123;</span><br><span class="line">                            itemSon.addError(<span class="string">&quot;Error Info&quot;</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">for</span> (Grandson itemGrandson : itemSon.getGrandsonDtoList()) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (itemGrandson != <span class="literal">null</span>) &#123;</span><br><span class="line">                                    itemGrandson.addError(<span class="string">&quot;Error Info&quot;</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="7-在模板中定义变量"><a class="header-anchor" href="#7-在模板中定义变量"></a>7. 在模板中定义变量</h1>
<p>我们知道，模板可以使用在数据模型中定义的变量。 在数据模型之外，模板本身也可以定义变量来使用，这些临时变量可以使用 FTL 指令来创建和替换。请注意每一次的模板执行工作都维护它自己的私有变量， 同时来渲染页面。变量的初始值是空，当模板执行工作结束这些变量便被销毁了。</p>
<p>可以访问一个在模板里定义的变量，就像是访问数据模型根 root 上的变量一样。 这个变量比定义在数据模型中的同名参数有更高的优先级，也就是说， 如果恰巧定义了一个名为 <code>foo</code> 的变量，而在数据模型中也有一个名为 <code>foo</code> 的变量， 那么模板中的变量就会将数据模型根上的变量隐藏（不是覆盖！）。 例如，<code>$&#123;foo&#125;</code> 将会输出在模板中定义的变量。</p>
<p>在模板中可以定义三种类型的变量：</p>
<ul>
<li><strong>「简单」变量</strong>： 它能从模板中的任何位置来访问，或者从使用 <code>include</code> 指令引入的模板访问。可以使用 <code>assign</code> 指令来创建或替换这些变量。因为宏和方法只是变量，那么 <code>macro</code> 指令和 <code>function</code> 指令也可以用来设置变量，就像 <code>assign</code> 那样。</li>
<li><strong>局部变量</strong>：它们只能被设置在宏定义体内， 而且只在宏内可见。一个局部变量的生命周期只是宏的调用过程。可以使用 <code>local</code> 指令在宏定义体内创建或替换局部变量。</li>
<li><strong>循环变量</strong>：循环变量是由如 <code>list</code> 指令自动创建的，而且它们只在指令的开始和结束标记内有效。宏的参数是局部变量而不是循环变量。</li>
<li><strong>全局变量</strong>：这是一个高级话题了， 并且这种变量最好别用。即便它们属于不同的命名空间， 全局变量也被所有模板共享，因为它们是被 <code>import</code>进来的， 不同于 <code>include</code> 进来的。那么它们的可见度就像数据模型那样。 全局变量通过 <code>global</code>指令来定义。</li>
</ul>
<p>使用 <code>assign</code> 创建和替换变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign x = 1&gt;  &lt;#-- create variable x --&gt;</span><br><span class="line">$&#123;x&#125;</span><br><span class="line">&lt;#assign x = x + 3&gt; &lt;#-- replace variable x --&gt;</span><br><span class="line">$&#123;x&#125;</span><br></pre></td></tr></table></figure>
<p>输出为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<p>局部变量也会隐藏（不是覆盖）同名的 「简单」 变量，循环变量也会隐藏（不是覆盖）同名的 「简单」 变量，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign x = &quot;plain&quot;&gt;</span><br><span class="line">1. $&#123;x&#125;  </span><br><span class="line">&lt;@test/&gt;</span><br><span class="line">6. $&#123;x&#125;  </span><br><span class="line">&lt;#list [&quot;loop&quot;] as x&gt;</span><br><span class="line">    7. $&#123;x&#125;  </span><br><span class="line">    &lt;#assign x = &quot;plain2&quot;&gt; </span><br><span class="line">    8. $&#123;x&#125;  </span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">9. $&#123;x&#125;  </span><br><span class="line"></span><br><span class="line">&lt;#macro test&gt;</span><br><span class="line">  2. $&#123;x&#125; </span><br><span class="line">  &lt;#local x = &quot;local&quot;&gt;</span><br><span class="line">  3. $&#123;x&#125;  </span><br><span class="line">  &lt;#list [&quot;loop&quot;] as x&gt;</span><br><span class="line">    4. $&#123;x&#125;  </span><br><span class="line">  &lt;/#list&gt;</span><br><span class="line">  5. $&#123;x&#125;  </span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. plain</span><br><span class="line">  2. plain</span><br><span class="line">  3. local</span><br><span class="line">    4. loop</span><br><span class="line">  5. local</span><br><span class="line">6. plain</span><br><span class="line">    7. loop</span><br><span class="line">    8. loop</span><br><span class="line">9. plain2</span><br></pre></td></tr></table></figure>
<p>内部循环变量可以隐藏外部循环变量，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list [&quot;loop 1&quot;] as x&gt;</span><br><span class="line">  $&#123;x&#125;</span><br><span class="line">  &lt;#list [&quot;loop 2&quot;] as x&gt;</span><br><span class="line">    $&#123;x&#125;</span><br><span class="line">    &lt;#list [&quot;loop 3&quot;] as x&gt;</span><br><span class="line">      $&#123;x&#125;</span><br><span class="line">    &lt;/#list&gt;</span><br><span class="line">    $&#123;x&#125;</span><br><span class="line">  &lt;/#list&gt;</span><br><span class="line">  $&#123;x&#125;</span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">loop 1</span><br><span class="line">  loop 2</span><br><span class="line">    loop 3</span><br><span class="line">  loop 2</span><br><span class="line">loop 1</span><br></pre></td></tr></table></figure>
<p>请注意，循环变量的设置是通过指令调用时创建的（本例中的 <code>&lt;list ...&gt;</code> 标签）。没有其他的方式去改变循环变量的值（也就是说，不能使用定义指令来改变它的值），但可以使用一个循环变量来暂时隐藏另外一个。</p>
<p>有时会发生一个变量隐藏数据模型中的同名变量， 但是如果想访问数据模型中的变量，此时就可以使用 特殊变量 <code>globals</code>。例如，假设我们在数据模型中有一个名为 <code>user</code> 的变量，值为 <code>Big Joe</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign user = &quot;Joe Hider&quot;&gt;</span><br><span class="line">$&#123;user&#125;          &lt;#-- prints: Joe Hider --&gt;</span><br><span class="line">$&#123;.globals.user&#125; &lt;#-- prints: Big Joe --&gt;</span><br></pre></td></tr></table></figure>
<p>通过 <code>global </code>指令设置的变量可以隐藏数据模型中的同名变量。通常，全局变量的设置会有精确的目的，但仍然可以使用如下方式来访问数据模型变量：<code>.data_model.user</code>。</p>
<blockquote>
<p>一个坑</p>
</blockquote>
<p>使用 <code>local</code> 或 <code>assign</code> 指令在模板中定义变量通常有以下两种方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#local name = value&gt;</span><br><span class="line">&lt;#-- 或者 --&gt;</span><br><span class="line">&lt;#local name&gt;</span><br><span class="line">  capture this</span><br><span class="line">&lt;/#local&gt;</span><br></pre></td></tr></table></figure>
<p>如果需要在不同的条件下定义不同的值，那么可以：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;#local name&gt;</span><br><span class="line">	&lt;#if xxx&gt;</span><br><span class="line">		value1</span><br><span class="line">    &lt;#else&gt;</span><br><span class="line">        value2</span><br><span class="line">    &lt;/#if&gt;</span><br><span class="line">&lt;/#local&gt;</span><br><span class="line">&lt;#-- 或者 --&gt;</span><br><span class="line">&lt;#if xxx&gt;</span><br><span class="line">	&lt;#local name = value1&gt;</span><br><span class="line">&lt;#else&gt;</span><br><span class="line">	&lt;#local name = value2&gt;</span><br><span class="line">&lt;/#if&gt;</span><br></pre></td></tr></table></figure>
<p>在一般的场景下，这两种方式并没有区别，但如果后续要使用定义的变量进行逻辑判断，那这两种方式就有些区别了。</p>
<p>假设当满足某些条件时，定义的变量值为 <code>value1</code>，否则是空串，即 <code>value2</code> 是空串。后续使用定义的变量 <code>name</code> 进行 <strong>空串</strong> 判断，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if StringUtils.isNotEmpty(name)&gt;&lt;/#if&gt;</span><br><span class="line">&lt;#-- 或者 --&gt;</span><br><span class="line">&lt;#if name?? &amp;&amp; name?length gt 0&gt;&lt;/#if&gt;</span><br></pre></td></tr></table></figure>
<p>但最终得到的结果并不是原本期望的。</p>
<p>这是因为 <strong>采用第一种方式定义的变量所指向的值的两端存在一些空白字符。</strong></p>
<p>为了避免这种情况，可以采用第二种方式来定义变量（更推荐），或者在使用定义的变量进行逻辑判断前，移除值两端的空白字符。</p>
<h1 id="8-命名空间"><a class="header-anchor" href="#8-命名空间"></a>8. 命名空间</h1>
<h2 id="8-1-命名空间和库"><a class="header-anchor" href="#8-1-命名空间和库"></a>8.1 命名空间和库</h2>
<p>当运行 FTL 模板时，可以使用 <code>assign</code> 和 <code>macro</code> 指令创建的变量的集合（可能是空的）。像这样的变量集合被称为 <strong>命名空间</strong>。 简单的情况下可以只使用一个命名空间，称之为 <strong>主命名空间</strong>。因为通常只使用该命名空间， 所以就没有意识到这点。</p>
<p>如果想创建可以重复使用的宏，函数和其他变量的集合，通常用术语来说就是引用 <strong>库</strong>。</p>
<p>使用多个命名空间是必然的。只要考虑你在一些项目中， 或者想和他人共享使用的时候，你是否有一个很大的宏的集合。但要确保库中没有宏（或其他变量）名和数据模型中变量同名， 而且也不能和模板中引用其他库中的变量同名是不可能的。通常来说，变量因为名称冲突时也会相互冲突。所以要为每个库中的变量使用不同的命名空间。</p>
<h2 id="8-2-创建一个库"><a class="header-anchor" href="#8-2-创建一个库"></a>8.2 创建一个库</h2>
<p>假设需要通用的变量 <code>copyright</code> 和 <code>mail</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro copyright date&gt;</span><br><span class="line">  &lt;p&gt;Copyright (C) $&#123;date&#125; Julia Smith. All rights reserved.&lt;/p&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line"></span><br><span class="line">&lt;#assign mail = &quot;jsmith@acme.com&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>把上面的这些定义存储在文件 <code>lib/my_test.ftl</code> 中（目录是存放模板的位置），假设想在 <code>aWebPage.ftl</code> 中使用这个模板。我们可以使用 <code>&lt;# import&gt;</code> 指令，就像下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#import &quot;/lib/my_test.ftl&quot; as my&gt; </span><br><span class="line">&lt;@my.copyright date=&quot;1999-2002&quot;/&gt;</span><br><span class="line">$&#123;my.mail&#125;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> &lt;p&gt;Copyright (C) 1999-2002 Julia Smith. All rights reserved.&lt;/p&gt;</span><br><span class="line">jsmith@acme.com</span><br></pre></td></tr></table></figure>
<p>就算在主命名空间中有一个变量，名为 <code>mail</code> 或 <code>copyright</code>，也不会引起混乱，因为两个模板使用了不同的命名空间。</p>
<h2 id="8-2-在引入的命名空间中编写变量"><a class="header-anchor" href="#8-2-在引入的命名空间中编写变量"></a>8.2 在引入的命名空间中编写变量</h2>
<p>偶尔想要在一个被包含的命名空间上创建或替换一个变量。 那么可以使用 <code>assign</code> 指令， 如果用到了它的 <code>namespace</code> 变量，例如下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;#import &quot;/lib/my_test.ftl&quot; as my&gt;</span><br><span class="line">$&#123;my.mail&#125;</span><br><span class="line">&lt;#assign mail=&quot;jsmith@other.com&quot; in my&gt;</span><br><span class="line">$&#123;my.mail&#125;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jsmith@acme.com</span><br><span class="line">jsmith@other.com</span><br></pre></td></tr></table></figure>
<h2 id="8-3-命名空间和数据模型"><a class="header-anchor" href="#8-3-命名空间和数据模型"></a>8.3 命名空间和数据模型</h2>
<p>数据模型中的变量在任何位置都是可见的。例如， 如果在数据模型中有一个名为 <code>user</code> 的变量，那么 <code>lib/my_test.ftl</code> 也能访问它， <code>aWebPage.ftl</code> 当然也能：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro copyright date&gt;</span><br><span class="line">  &lt;p&gt;Copyright (C) $&#123;date&#125; $&#123;user&#125;. All rights reserved.&lt;/p&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line"></span><br><span class="line">&lt;#assign mail = &quot;$&#123;user&#125;@acme.com&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>如果 <code>user</code> 是 <code>Fred</code> 的话，下面这个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#import &quot;/lib/my_test.ftl&quot; as my&gt;</span><br><span class="line">&lt;@my.copyright date=&quot;1999-2002&quot;/&gt;</span><br><span class="line">$&#123;my.mail&#125;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  &lt;p&gt;Copyright (C) 1999-2002 Fred. All rights reserved.&lt;/p&gt;</span><br><span class="line">Fred@acme.com</span><br></pre></td></tr></table></figure>
<p>不要忘了在模板的命名空间（可以使用 <code>assign</code> 或 <code>macro</code> 指令来创建的变量）中的变量有着比数据模型中的变量更高的优先级。因此，数据模型的内容不会干涉到由库创建的变量。</p>
<h2 id="8-4-命名空间的生命周期"><a class="header-anchor" href="#8-4-命名空间的生命周期"></a>8.4 命名空间的生命周期</h2>
<p>命名空间由使用 <code>import</code> 指令中所写的路径来识别。如果想多次 <code>import</code> 这个路径，那么只会为第一次 <code>import</code> 引用创建命名空间并执行模板。后面相同路径的 <code>import</code> 只是创建一个哈希表当作访问相同命名空间的「门」。</p>
<p><code>my_test.ftl</code> 中有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro copyright date&gt;</span><br><span class="line">  &lt;p&gt;Copyright (C) $&#123;date&#125; Julia Smith. All rights reserved.&lt;/p&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line"></span><br><span class="line">&lt;#assign mail = &quot;jsmith@acme.com&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>在 <code>aWebPage.ftl</code> 中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;#import &quot;/lib/my_test.ftl&quot; as my&gt;</span><br><span class="line">&lt;#import &quot;/lib/my_test.ftl&quot; as foo&gt;</span><br><span class="line">&lt;#import &quot;/lib/my_test.ftl&quot; as bar&gt;</span><br><span class="line">$&#123;my.mail&#125;, $&#123;foo.mail&#125;, $&#123;bar.mail&#125;</span><br><span class="line">&lt;#assign mail=&quot;jsmith@other.com&quot; in my&gt;</span><br><span class="line">$&#123;my.mail&#125;, $&#123;foo.mail&#125;, $&#123;bar.mail&#125;</span><br></pre></td></tr></table></figure>
<p>将会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jsmith@acme.com, jsmith@acme.com, jsmith@acme.com</span><br><span class="line">jsmith@other.com, jsmith@other.com, jsmith@other.com</span><br></pre></td></tr></table></figure>
<p>请注意，命名空间是不分层次的，它们相互之间是独立存在的。 那么，如果在命名空间 N1 中 <code>import</code> 命名空间 N2， 那 N2 也不在 N1 中，N1 只是可以通过哈希表来访问 N2。这和在主命名空间中 <code>import</code> N2，然后直接访问命名空间 N2 是一样的过程。</p>
<p>每一次模板的执行过程，它都有一个私有的命名空间的集合。每一次模板执行工作都是一个分离且有序的过程，它们仅仅存在一段很短的时间，同时页面用以渲染内容，然后就和所有填充过的命名空间一起消失了。因此，无论何时我们说第一次调用 <code>import</code>，一个单一模板执行工作的内容都是这样。</p>
<h2 id="8-5-为他人编写库"><a class="header-anchor" href="#8-5-为他人编写库"></a>8.5 为他人编写库</h2>
<p>如果想将一个库放在网络上，为了防止和其他作者使用库的命名相冲突，而且引入其他库时要书写简单，可以指定库路径的格式。</p>
<p>这个标准是： 库的路径必须对模板和其他库可用（可引用），就像这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/lib/yourcompany.com/your_library.ftl</span><br></pre></td></tr></table></figure>
<p>假设我们为 Example 公司工作，它们拥有 <code>www.example.com</code> 网的主页， 我开发了一个部件库，那么要引入所写的 FTL 的路径应该是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/lib/example.com/widget.ftl</span><br></pre></td></tr></table></figure>
<p>需要注意的是，www 已经被省略了。第三次路径分割后的部分可以包含子目录，可以像下面这样写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/lib/example.com/commons/string.ftl</span><br></pre></td></tr></table></figure>
<p>一个重要的规则就是路径不应该包含大写字母，为了分隔词语， 使用下划线 <code>_</code>，就像 <code>wml_form</code>（而不是 <code>wmlForm</code> 这样的驼峰命名）</p>
<p>请注意，如果你的工作不是为公司或组织开发库，你应该使用项目主页的 URL，比如 <code>/lib/example.sourceforge.net/example.ftl</code>，或 <code>/lib/geocities.com/jsmith/example.ftl</code>。</p>
<h1 id="9-其他"><a class="header-anchor" href="#9-其他"></a>9. 其他</h1>
<p>这两个内容不是很重要，可以直接参考文档：</p>
<p><a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/dgui_misc_whitespace.html">空白处理</a></p>
<p><a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/dgui_misc_alternativesyntax.html">替换(方括号)语法</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mofan212.github.io">默烦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mofan212.github.io/posts/FreeMarker-Template-Author's-Guide/">https://mofan212.github.io/posts/FreeMarker-Template-Author's-Guide/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://mofan212.github.io" target="_blank">Mofan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/FreeMarker/">FreeMarker</a></div><div class="post-share"><div class="social-share" data-image="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/68.png" data-sites="wechat,qq,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://fastly.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" target="_blank"><img class="post-qr-code-img" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" target="_blank"><img class="post-qr-code-img" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/The-Basis-Of-ElasticSearch/" title="Elasticsearch 入门"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/67.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Elasticsearch 入门</div></div><div class="info-2"><div class="info-item-1">本文介绍了 ES 的安装与相关基础知识，在文末实现了一个京东搜索的小 Demo。</div></div></div></a><a class="pagination-related" href="/posts/The-Basis-Of-Dubbo/" title="【RPC框架】Dubbo 入门"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/69.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">【RPC框架】Dubbo 入门</div></div><div class="info-2"><div class="info-item-1">本文介绍了 Dubbo 基本知识、配置、高可用和原理四个部分的内容。</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">默烦</div><div class="author-info-description">彩笔的打怪升级之路...</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">162</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mofan212"><i class="fab fa-github"></i><span>follow me</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:cy.mofan@foxmail.com" target="_blank" title="邮箱"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本站所有博文均是博主的学习笔记与个人理解。<strong><font style="color:red">除特别注明外，</font>如需转载，请在文章头部醒目处附带原文链接并<a href="./mine/" style="color:#49B1F5;text-decoration:underline">告知我</a></strong>你将转载。😊</br><strong><font style="color:red">严禁未遵循规范的转载。</font></strong>😡</br><strong>死去的评论系统复活啦！欢迎到留言板畅所欲言！</strong>当然也可以使用更高效的<a target="_blank" href="https://space.bilibili.com/23658864/dynamic" style="color:#49B1F5;text-decoration:underline"> 哔哩哔哩私信 </a>或<a href="mailto:cy.mofan@foxmail.com" style="color:#49B1F5;text-decoration:underline" target="_blank">邮箱</a>。 😉</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0-%E5%89%8D%E8%A8%80"><span class="toc-text">0. 前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-FreeMarker-%E5%85%A5%E9%97%A8"><span class="toc-text">1. FreeMarker 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E6%A8%A1%E6%9D%BF-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-%E8%BE%93%E5%87%BA"><span class="toc-text">1.1 模板 + 数据模型 &#x3D; 输出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-text">1.2 数据模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E6%8C%87%E4%BB%A4"><span class="toc-text">1.3 指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="toc-text">1.4 内建函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E5%A4%84%E7%90%86%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-text">1.5 处理不存在的变量</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E6%95%B0%E5%80%BC%E4%B8%8E%E7%B1%BB%E5%9E%8B"><span class="toc-text">2. 数值与类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%9F%BA%E6%9C%AC%E5%86%85%E5%AE%B9"><span class="toc-text">2.1 基本内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E7%B1%BB%E5%9E%8B"><span class="toc-text">2.2 类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%A8%A1%E6%9D%BF%E6%80%BB%E4%BD%93%E7%BB%93%E6%9E%84"><span class="toc-text">3. 模板总体结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">4. 表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E7%9B%B4%E6%8E%A5%E6%8C%87%E5%AE%9A%E5%80%BC"><span class="toc-text">4.1 直接指定值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E6%A3%80%E7%B4%A2%E5%8F%98%E9%87%8F"><span class="toc-text">4.2 检索变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="toc-text">4.3 字符串操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E5%BA%8F%E5%88%97%E6%93%8D%E4%BD%9C"><span class="toc-text">4.4 序列操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-%E5%93%88%E5%B8%8C%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">4.5 哈希表操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-%E7%AE%97%E6%95%B0%E8%BF%90%E7%AE%97"><span class="toc-text">4.6 算数运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7-%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97"><span class="toc-text">4.7 比较运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-8-%E9%80%BB%E8%BE%91%E6%93%8D%E4%BD%9C"><span class="toc-text">4.8 逻辑操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-9-%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0"><span class="toc-text">4.9 内建函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-10-%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="toc-text">4.10 方法调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-11-%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">4.11 赋值运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-12-%E6%93%8D%E4%BD%9C%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-text">4.12 操作符优先级</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%8F%92%E5%80%BC"><span class="toc-text">5. 插值</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4"><span class="toc-text">6. 自定义指令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%9F%BA%E6%9C%AC%E5%86%85%E5%AE%B9"><span class="toc-text">6.1 基本内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%8F%82%E6%95%B0"><span class="toc-text">6.2 参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E5%B5%8C%E5%A5%97%E5%86%85%E5%AE%B9"><span class="toc-text">6.3 嵌套内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-%E5%AE%8F%E5%92%8C%E5%BE%AA%E7%8E%AF%E5%8F%98%E9%87%8F"><span class="toc-text">6.4 宏和循环变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-%E9%80%92%E5%BD%92%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%B5%8C%E5%A5%97%E5%86%85%E5%AE%B9"><span class="toc-text">6.5  递归中使用嵌套内容</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E5%9C%A8%E6%A8%A1%E6%9D%BF%E4%B8%AD%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F"><span class="toc-text">7. 在模板中定义变量</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-text">8. 命名空间</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%92%8C%E5%BA%93"><span class="toc-text">8.1 命名空间和库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%BA%93"><span class="toc-text">8.2 创建一个库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E5%9C%A8%E5%BC%95%E5%85%A5%E7%9A%84%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD%E7%BC%96%E5%86%99%E5%8F%98%E9%87%8F"><span class="toc-text">8.2 在引入的命名空间中编写变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%92%8C%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-text">8.3 命名空间和数据模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">8.4 命名空间的生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-%E4%B8%BA%E4%BB%96%E4%BA%BA%E7%BC%96%E5%86%99%E5%BA%93"><span class="toc-text">8.5 为他人编写库</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E5%85%B6%E4%BB%96"><span class="toc-text">9. 其他</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Lambda-In-Action/" title="Java Lambda In Action"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/159.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java Lambda In Action"/></a><div class="content"><a class="title" href="/posts/Java-Lambda-In-Action/" title="Java Lambda In Action">Java Lambda In Action</a><time datetime="2025-07-04T16:00:00.000Z" title="更新于 2025-07-05 00:00:00">2025-07-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Functors-Applicatives-And-Monads-In-Pictures/" title="Functors, Applicatives and Monads In Pictures"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/162.webp" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Functors, Applicatives and Monads In Pictures"/></a><div class="content"><a class="title" href="/posts/Functors-Applicatives-And-Monads-In-Pictures/" title="Functors, Applicatives and Monads In Pictures">Functors, Applicatives and Monads In Pictures</a><time datetime="2025-07-04T16:00:00.000Z" title="更新于 2025-07-05 00:00:00">2025-07-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/DQL-Of-MySQL/" title="【MySQL 一】DQL"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/105.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="【MySQL 一】DQL"/></a><div class="content"><a class="title" href="/posts/DQL-Of-MySQL/" title="【MySQL 一】DQL">【MySQL 一】DQL</a><time datetime="2025-06-29T16:00:00.000Z" title="更新于 2025-06-30 00:00:00">2025-06-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/FreeMarker-Template-Author's-Guide/" title="FreeMarker 模板开发"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/68.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="FreeMarker 模板开发"/></a><div class="content"><a class="title" href="/posts/FreeMarker-Template-Author's-Guide/" title="FreeMarker 模板开发">FreeMarker 模板开发</a><time datetime="2025-06-26T16:00:00.000Z" title="更新于 2025-06-27 00:00:00">2025-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Git/" title="Git理论与使用"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/3.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Git理论与使用"/></a><div class="content"><a class="title" href="/posts/Git/" title="Git理论与使用">Git理论与使用</a><time datetime="2025-06-14T16:00:00.000Z" title="更新于 2025-06-15 00:00:00">2025-06-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Genericity/" title="Java 泛型"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/58.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java 泛型"/></a><div class="content"><a class="title" href="/posts/Java-Genericity/" title="Java 泛型">Java 泛型</a><time datetime="2025-06-09T16:00:00.000Z" title="更新于 2025-06-10 00:00:00">2025-06-10</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2020 - 2025 By 默烦</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://fastly.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://fastly.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://fastly.jsdelivr.net/npm/vanilla-lazyload@latest/dist/lazyload.iife.min.js"></script><script src="https://fastly.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://npm.elemecdn.com/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://fastly.jsdelivr.net/gh/mofan212/blog-static-resources@master/js/mine.min.js"></script><script defer="defer" id="ribbon" src="https://fastly.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="click-show-text" src="https://fastly.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Azathoth,Yog-Sothoth,Shub-Niggurath,Nyarlathotep,Cthulhu,Hastur,Abhoth,Ghroth,Tsathoggua,Cthugha,Deep Ones,Dagon,Chaugnar Faugn,Mordiggian,Shoggoth,Old One,Mi-Go,Great Race of Yith,Flying Polyp,Hounds of Tindalos,Dhole" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@docsearch/css/dist/style.min.css"/><script src="https://fastly.jsdelivr.net/npm/@docsearch/js/dist/umd/index.min.js"></script><script>(() => {
  docsearch(Object.assign({
    appId: 'BAFEL7A6K1',
    apiKey: '89fcb5961984c5c054bf04149f345f38',
    indexName: 'mofan212io',
    container: '#docsearch',
    placeholder: '输入关键字进行搜索',
  }, null))

  const handleClick = () => {
    document.querySelector('.DocSearch-Button').click()
  }

  const searchClickFn = () => {
    btf.addEventListenerPjax(document.querySelector('#search-button > .search'), 'click', handleClick)
  }

  searchClickFn()
  window.addEventListener('pjax:complete', searchClickFn)
})()</script></div></div></body></html>