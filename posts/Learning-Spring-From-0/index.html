<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ä» 0 å¼€å§‹çš„ Spring 5.x å­¦ä¹  | Mofan</title><meta name="author" content="é»˜çƒ¦,cy.mofan@foxmail.com"><meta name="copyright" content="é»˜çƒ¦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ä¸çŸ¥åˆ·äº†å‡ éè¿™ä¸ªè§†é¢‘ï¼Œæ¯æ¬¡éƒ½æœ‰æ–°çš„æ”¶è·ï¼Œè¿™æ¬¡åˆ·çš„æ—¶å€™é¡ºä¾¿åšäº†æ€»ç»“ç¬”è®°ï¼Œæ–¹ä¾¿ä¸‹æ¬¡å¤ä¹ ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="ä» 0 å¼€å§‹çš„ Spring 5.x å­¦ä¹ ">
<meta property="og:url" content="https://mofan212.github.io/posts/Learning-Spring-From-0/">
<meta property="og:site_name" content="Mofan">
<meta property="og:description" content="ä¸çŸ¥åˆ·äº†å‡ éè¿™ä¸ªè§†é¢‘ï¼Œæ¯æ¬¡éƒ½æœ‰æ–°çš„æ”¶è·ï¼Œè¿™æ¬¡åˆ·çš„æ—¶å€™é¡ºä¾¿åšäº†æ€»ç»“ç¬”è®°ï¼Œæ–¹ä¾¿ä¸‹æ¬¡å¤ä¹ ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/61.jpg">
<meta property="article:published_time" content="2020-10-21T16:00:00.000Z">
<meta property="article:modified_time" content="2022-11-09T16:00:00.000Z">
<meta property="article:author" content="é»˜çƒ¦">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/61.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ä» 0 å¼€å§‹çš„ Spring 5.x å­¦ä¹ ",
  "url": "https://mofan212.github.io/posts/Learning-Spring-From-0/",
  "image": "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/61.jpg",
  "datePublished": "2020-10-21T16:00:00.000Z",
  "dateModified": "2022-11-09T16:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "é»˜çƒ¦",
      "url": "https://mofan212.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/favicon.png"><link rel="canonical" href="https://mofan212.github.io/posts/Learning-Spring-From-0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":150,"languages":{"author":"ä½œè€…: é»˜çƒ¦","link":"é“¾æ¥: ","source":"æ¥æº: Mofan","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡","cht_to_chs":"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡","day_to_night":"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  infinitegrid: {
    js: 'https://testingcf.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ä» 0 å¼€å§‹çš„ Spring 5.x å­¦ä¹ ',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources@master/css/myStyle.min.css"><link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/style.css" /><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono-nl.min.css" /><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Mofan" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources/css/minimal.min.css"/><script src="https://testingcf.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">174</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">54</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">37</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> æ–‡ç« </span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> è®¡åˆ’</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> ç»´æŠ¤</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> å…³äºæœ¬ç«™</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> å…³äºæˆ‘</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw fa-solid fa-coins"></i><span> èµåŠ©</span></a></li><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> é‡Œç¨‹ç¢‘</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-subway"></i><span> å¼€å¾€</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/post_top_img.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Mofan</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> æ–‡ç« </span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> è®¡åˆ’</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> ç»´æŠ¤</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> å…³äºæœ¬ç«™</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> å…³äºæˆ‘</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw fa-solid fa-coins"></i><span> èµåŠ©</span></a></li><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> é‡Œç¨‹ç¢‘</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-subway"></i><span> å¼€å¾€</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ä» 0 å¼€å§‹çš„ Spring 5.x å­¦ä¹ </h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2020-10-21T16:00:00.000Z" title="å‘è¡¨äº 2020-10-22 00:00:00">2020-10-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-11-09T16:00:00.000Z" title="æ›´æ–°äº 2022-11-10 00:00:00">2022-11-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Spring/">Spring</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">23.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>91åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;è·ç¦»æœ¬æ–‡ä¸Šæ¬¡æ›´æ–°å·²ç»è¿‡å»&quot;,&quot;messageNext&quot;:&quot;å¤©ï¼Œè¯·æ³¨æ„æ—¶æ•ˆæ€§ã€‚&quot;,&quot;postUpdate&quot;:&quot;2022-11-10 00:00:00&quot;}" hidden></div><p>å°é¢ç”»å¸ˆï¼šT5-èŒ¨èˆï¼ˆå¾®åšï¼‰â€ƒ â€ƒâ€ƒâ€ƒå°é¢IDï¼š84928287_p0</p>
<p>æœ¬æ–‡å‚è€ƒï¼š2018 é»‘é©¬ç¨‹åºå‘˜ 57 æœŸ å¼ é˜³ Spring æ•™ç¨‹ IDEA ç‰ˆ</p>
<h1 id="1-Spring-æ¦‚è¿°"><a class="header-anchor" href="#1-Spring-æ¦‚è¿°"></a>1. Spring æ¦‚è¿°</h1>
<h2 id="1-1-Spring-æ˜¯ä»€ä¹ˆ"><a class="header-anchor" href="#1-1-Spring-æ˜¯ä»€ä¹ˆ"></a>1.1 Spring æ˜¯ä»€ä¹ˆ</h2>
<p>Spring æ˜¯åˆ†å±‚çš„ Java SE/EE åº”ç”¨ full-stack è½»é‡çº§å¼€æºæ¡†æ¶ï¼Œä»¥ IoCï¼ˆInverse Of Controlï¼šåè½¬æ§åˆ¶ï¼‰å’ŒAOPï¼ˆAspect Ori ented Programmingï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ä¸ºå†…æ ¸ï¼Œæä¾›äº†å±•ç°å±‚Spring MVCå’ŒæŒä¹…å±‚ Spring JDBC ä»¥åŠä¸šåŠ¡å±‚äº‹åŠ¡ç®¡ç†ç­‰ä¼—å¤šçš„ä¼ä¸šçº§åº”ç”¨æŠ€æœ¯ï¼Œè¿˜èƒ½æ•´åˆå¼€æºä¸–ç•Œä¼—å¤šè‘—åçš„ç¬¬ä¸‰æ–¹æ¡†æ¶å’Œç±»åº“ï¼Œé€æ¸æˆä¸ºä½¿ç”¨æœ€å¤šçš„ Java EE ä¼ä¸šåº”ç”¨å¼€æºæ¡†æ¶ã€‚</p>
<h2 id="1-2-Spring-å‘å±•æ¦‚è¿°"><a class="header-anchor" href="#1-2-Spring-å‘å±•æ¦‚è¿°"></a>1.2 Spring å‘å±•æ¦‚è¿°</h2>
<p>1997 å¹´ IBM æå‡ºäº† EJB çš„æ€æƒ³</p>
<p>1998 å¹´ï¼ŒSUN åˆ¶å®šå¼€å‘æ ‡å‡†è§„èŒƒ EJB 1.0</p>
<p>1999 å¹´ï¼ŒEJB 1.1 å‘å¸ƒ</p>
<p>2001 å¹´ï¼ŒEJB 2.0 å‘å¸ƒ</p>
<p>2003 å¹´ï¼ŒEJB2.1 å‘å¸ƒ</p>
<p>2006 å¹´ï¼ŒEJB3.0 å‘å¸ƒ</p>
<p>Rod Johnson (Spring ä¹‹çˆ¶)ï¼Œè‘—åä½œè€…ã€‚Rod åœ¨æ‚‰å°¼å¤§å­¦ä¸ä»…è·å¾—äº†è®¡ç®—æœºå­¦ä½ï¼ŒåŒæ—¶è¿˜è·å¾—äº†éŸ³ä¹å­¦ä½ã€‚åœ¨å›åˆ°è½¯ä»¶å¼€å‘é¢†åŸŸä¹‹å‰ï¼Œä»–è¿˜è·å¾—äº†éŸ³ä¹å­¦çš„åšå£«å­¦ä½ã€‚</p>
<p>Expert 0ne-to-0ne J2EE Design and Development (2002) é˜è¿°äº† J2EE ä½¿ç”¨ EJB å¼€å‘è®¾è®¡çš„ä¼˜ç‚¹åŠè§£å†³æ–¹æ¡ˆ</p>
<p>Expert One-to-0ne J2EE Development without EJB (2004) é˜è¿°äº† J2EE å¼€å‘ä¸ä½¿ç”¨ EJB çš„è§£å†³æ–¹å¼ï¼ˆSpringé›å½¢ï¼‰</p>
<p>2017å¹´9æœˆä»½å‘å¸ƒäº† Spring çš„æœ€æ–°ç‰ˆæœ¬ Spring 5.0 é€šç”¨ç‰ˆï¼ˆGAï¼‰</p>
<h2 id="1-3-Spring-çš„ä¼˜åŠ¿"><a class="header-anchor" href="#1-3-Spring-çš„ä¼˜åŠ¿"></a>1.3 Spring çš„ä¼˜åŠ¿</h2>
<p><strong>æ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘</strong><br>
é€šè¿‡ Spring æä¾›çš„ IoC å®¹å™¨ï¼Œå¯ä»¥å°†å¯¹è±¡é—´çš„ä¾èµ–å…³ç³»äº¤ç”± Spring è¿›è¡Œæ§åˆ¶ï¼Œé¿å…ç¡¬ç¼–ç æ‰€é€ æˆçš„è¿‡åº¦ç¨‹åºè€¦åˆã€‚ç”¨æˆ·ä¹Ÿä¸å¿…å†ä¸ºå•ä¾‹æ¨¡å¼ç±»ã€å±æ€§æ–‡ä»¶è§£æç­‰è¿™äº›å¾ˆåº•å±‚çš„éœ€æ±‚ç¼–å†™ä»£ç ï¼Œå¯ä»¥æ›´ä¸“æ³¨äºä¸Šå±‚çš„åº”ç”¨ã€‚</p>
<p><strong>AOP ç¼–ç¨‹çš„æ”¯æŒ</strong><br>
é€šè¿‡ Spring çš„ AOP åŠŸèƒ½ï¼Œæ–¹ä¾¿è¿›è¡Œé¢å‘åˆ‡é¢çš„ç¼–ç¨‹ï¼Œè®¸å¤šä¸å®¹æ˜“ç”¨ä¼ ç»Ÿ OOP å®ç°çš„åŠŸèƒ½å¯ä»¥é€šè¿‡AOP è½»æ¾åº”ä»˜ã€‚</p>
<p><strong>å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒ</strong><br>
å¯ä»¥å°†æˆ‘ä»¬ä»å•è°ƒçƒ¦é—·çš„äº‹åŠ¡ç®¡ç†ä»£ç ä¸­è§£è„±å‡ºæ¥ï¼Œé€šè¿‡å£°æ˜å¼æ–¹å¼çµæ´»çš„è¿›è¡Œäº‹åŠ¡çš„ç®¡ç†ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œè´¨é‡ã€‚</p>
<p><strong>æ–¹ä¾¿ç¨‹åºçš„æµ‹è¯•</strong><br>
å¯ä»¥ç”¨éå®¹å™¨ä¾èµ–çš„ç¼–ç¨‹æ–¹å¼è¿›è¡Œå‡ ä¹æ‰€æœ‰çš„æµ‹è¯•å·¥ä½œï¼Œæµ‹è¯•ä¸å†æ˜¯æ˜‚è´µçš„æ“ä½œï¼Œè€Œæ˜¯éšæ‰‹å¯åšçš„äº‹æƒ…ã€‚</p>
<p><strong>æ–¹ä¾¿é›†æˆå„ç§ä¼˜ç§€æ¡†æ¶</strong></p>
<p>Spring å¯ä»¥é™ä½å„ç§æ¡†æ¶çš„ä½¿ç”¨éš¾åº¦,æä¾›äº†å¯¹å„ç§ä¼˜ç§€æ¡†æ¶ï¼ˆStrutsã€Hibernateã€Hessianã€Quartz<br>
ç­‰ï¼‰çš„ç›´æ¥æ”¯æŒã€‚</p>
<p><strong>é™ä½ JavaEE API çš„ä½¿ç”¨éš¾åº¦</strong></p>
<p>Spring å¯¹ JavaEE API ï¼ˆå¦‚ JDBCã€JavaMailã€ è¿œç¨‹è°ƒç”¨ç­‰ï¼‰è¿›è¡Œäº†è–„è–„çš„å°è£å±‚ï¼Œä½¿è¿™äº› API çš„ä½¿ç”¨éš¾åº¦å¤§ä¸ºé™ä½ã€‚</p>
<p><strong>Java æºç æ˜¯ç»å…¸å­¦ä¹ èŒƒä¾‹</strong></p>
<p>Spring çš„æºä»£ç è®¾è®¡ç²¾å¦™ã€ç»“æ„æ¸…æ™°ã€åŒ å¿ƒç‹¬ç”¨ï¼Œå¤„å¤„ä½“ç°ç€å¤§å¸ˆå¯¹ Java è®¾è®¡æ¨¡å¼çµæ´»è¿ç”¨ä»¥åŠå¯¹ Java æŠ€æœ¯çš„é«˜æ·±é€ è¯£ã€‚å®ƒçš„æºä»£ç æ— ç–‘æ˜¯ Java æŠ€æœ¯çš„æœ€ä½³å®è·µçš„èŒƒä¾‹ã€‚</p>
<h2 id="1-4-Spring-çš„ä½“ç³»ç»“æ„"><a class="header-anchor" href="#1-4-Spring-çš„ä½“ç³»ç»“æ„"></a>1.4 Spring çš„ä½“ç³»ç»“æ„</h2>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/spring-overview.png" alt="spring-overview"></p>
<h1 id="2-ç¨‹åºçš„è€¦åˆ"><a class="header-anchor" href="#2-ç¨‹åºçš„è€¦åˆ"></a>2. ç¨‹åºçš„è€¦åˆ</h1>
<h2 id="2-1-è€¦åˆä¸è§£è€¦çš„åˆ†æ"><a class="header-anchor" href="#2-1-è€¦åˆä¸è§£è€¦çš„åˆ†æ"></a>2.1 è€¦åˆä¸è§£è€¦çš„åˆ†æ</h2>
<blockquote>
<p>è€¦åˆçš„æµ‹è¯•</p>
</blockquote>
<p>åˆ›å»ºä¸€ä¸ª Maven é¡¹ç›®å¯¼å…¥å¯¹åº”çš„ mysql ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¼–å†™ä»¥ä¸‹æµ‹è¯•ä»£ç è¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcDemo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">// 1. æ³¨å†Œé©±åŠ¨</span></span><br><span class="line">        DriverManager.registerDriver(<span class="keyword">new</span> <span class="title class_">com</span>.mysql.cj.jdbc.Driver());</span><br><span class="line">        <span class="comment">// 2. è·å–è¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/ssm?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true&amp;serverTimezone=GMT%2B8&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="comment">// 3. è·å–æ“ä½œæ•°æ®åº“çš„é¢„å¤„ç†å¯¹è±¡â€˜</span></span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">pstm</span> <span class="operator">=</span> connection.prepareStatement(<span class="string">&quot;select * from account&quot;</span>);</span><br><span class="line">        <span class="comment">// 4. æ‰§è¡ŒSQLï¼Œå¾—åˆ°ç»“æœé›†</span></span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> pstm.executeQuery();</span><br><span class="line">        <span class="comment">// 5. éå†ç»“æœé›†</span></span><br><span class="line">        <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">            System.out.println(resultSet.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6. é‡Šæ”¾èµ„æº</span></span><br><span class="line">        resultSet.close();</span><br><span class="line">        pstm.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•°æ®åº“ä¸­å¯¹åº”çš„ account è¡¨ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/account%E8%A1%A8.png" alt="accountè¡¨"></p>
<p>è¿è¡Œåæµ‹è¯•ç»“æœï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/account%E8%A1%A8%E6%9F%A5%E8%AF%A2name%E7%BB%93%E6%9E%9C.png" alt="accountè¡¨æŸ¥è¯¢nameç»“æœ"></p>
<hr>
<p>å¦‚æœ IDEA åœ¨è¿è¡Œæ—¶å‡ºç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IntelliJ IDEA æºå€¼<span class="number">1.5</span>å·²è¿‡æ—¶ï¼Œå°†åœ¨æœªæ¥æ‰€æœ‰ç‰ˆæœ¬ä¸­åˆ é™¤</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥ Project Structure ä¿®æ”¹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E4%BF%AE%E6%94%B9ProjectStructure.png" alt="ä¿®æ”¹ProjectStructure"></p>
<p>ç„¶åå‰å¾€ pom.xml ä¸­æ·»åŠ ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<p>å¾—åˆ°è¿è¡Œç»“æœåæˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸€ä¸ªæ€è€ƒï¼šä¸Šè¿°ä»£ç ä¸­å­˜åœ¨ä¸€ä¸ªé©±åŠ¨ç±» <code>com.mysql.cj.jdbc.Driver()</code>ï¼Œå¦‚æœåœ¨ pom.xml ä¸­å¯¹å¯¼å…¥çš„ä¾èµ–è¿›è¡Œæ³¨é‡Šï¼Œå†æ¬¡è¿è¡Œä»£ç ï¼Œæ§åˆ¶å°ä¼šç›´æ¥åœ¨ä»£ç ç¼–è¯‘çš„æ—¶å€™å°±æŠ¥é”™ï¼ˆä¾èµ–æ³¨é‡Šåï¼Œé©±åŠ¨ç±»å·²ç»ä¸å­˜åœ¨ï¼Œå› æ­¤åœ¨ç¼–è¯‘æœŸæŠ¥é”™ï¼‰ã€‚</p>
<p>æˆ‘ä»¬çš„ç±»ä¾èµ–äº†æ•°æ®åº“çš„å…·ä½“é©±åŠ¨ç±»ï¼ˆMySQLï¼‰ï¼Œå¦‚æœè¿™æ—¶å€™æ›´æ¢äº†æ•°æ®åº“å“ç‰Œï¼ˆæ¯”å¦‚ Oracleï¼‰ï¼Œéœ€è¦ä¿®æ”¹æºç æ¥é‡æ–°æ•°æ®åº“é©±åŠ¨ã€‚è¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<p>è¿™å°±æ˜¯<strong>ç¨‹åºçš„ä¸€ç§è€¦åˆ</strong> ï¼Œæ‰€è°“è€¦åˆå°±æ˜¯ç¨‹åºé—´çš„ä¾èµ–å…³ç³»ã€‚è¿™åŒ…æ‹¬ï¼š<strong>ç±»ä¹‹é—´çš„ä¾èµ–ã€æ–¹æ³•é—´çš„ä¾èµ–</strong>ã€‚æœ‰äº›è€¦åˆå¯ä»¥é™ä½ï¼Œä½†æ˜¯æœ‰äº›è€¦åˆæ— æ³•é™ä½ï¼Œå°±åƒä¸Šæ–‡ä»£ç ä¸­çš„ mysql ä¾èµ–ä¸€æ ·ï¼Œå¦‚æœå»é™¤ä¼šç›´æ¥æŠ¥é”™ã€‚æˆ‘ä»¬åº”å½“æƒ³æ–¹è®¾æ³•é™ä½è€¦åˆã€‚</p>
<p>è€Œè§£è€¦ï¼Œå°±æ˜¯é™ä½ç¨‹åºé—´çš„ä¾èµ–å…³ç³»ã€‚è¿˜æœ‰ä¸€ç‚¹å¾ˆé‡è¦ï¼šè€¦åˆåªèƒ½é™ä½ï¼Œä¸èƒ½è¢«æ¶ˆé™¤ï¼ˆæœ‰ç‚¹ç±»ä¼¼ç‰©ç†ä¸­çš„è¯¯å·®ï¼‰ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥åšåˆ°ï¼š<strong>ç¼–è¯‘æœŸä¸ä¾èµ–ï¼Œè¿è¡Œæ—¶æ‰ä¾èµ–</strong>ã€‚</p>
<p>åœ¨æœ€åˆå­¦ä¹  JDBC æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯åƒä¸Šæ–‡é‚£æ ·æ³¨å†Œé©±åŠ¨çš„ï¼Œè€Œæ˜¯é‡‡ç”¨åå°„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æ³¨å†Œé©±åŠ¨æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œæ˜¯æ ¹æ®å­—ç¬¦ä¸²æ¥æ³¨å†Œçš„ï¼Œä¸åƒæœ€å¼€å§‹é€šè¿‡ä¸€ä¸ªç±»è¿›è¡Œæ³¨å†Œã€‚</p>
<p>å¦‚æœè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°† pom.xml ä¸­å¯¼å…¥çš„ mysql ä¾èµ–æ³¨é‡Šï¼Œå¹¶å†æ¬¡è¿è¡Œä»£ç ï¼šç¨‹åºä¾ç„¶æ— æ³•è·‘é€šï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åœ¨ç¼–è¯‘æœŸæŠ¥é”™ï¼Œè€Œæ˜¯è¿è¡Œæ—¶å‡ºç°äº†ä¸€ä¸ªå¼‚å¸¸ <code>ClassNotFoundException</code>ã€‚</p>
<p>åŒæ—¶ï¼Œä¹Ÿäº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œmysql é©±åŠ¨çš„å…¨é™å®šç±»åå­—ç¬¦ä¸²æ˜¯åœ¨ java ç±»ä¸­å†™æ­»çš„ï¼Œä¸€æ—¦è¦æ”¹è¿˜æ˜¯è¦ä¿®æ”¹æºç ã€‚è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆç®€å•ï¼Œ <strong>ä½¿ç”¨é…ç½®æ–‡ä»¶é…ç½®</strong>ã€‚</p>
<blockquote>
<p>è§£è€¦çš„æ€è·¯</p>
</blockquote>
<p>é€šè¿‡ä¸Šé¢çš„ä»£ç å’Œåˆ†æï¼Œæˆ‘ä»¬ä¸éš¾å¾—åˆ°è§£è€¦çš„æ€è·¯ï¼š</p>
<p>1ã€é€šè¿‡åå°„æ¥åˆ›å»ºå¯¹è±¡ï¼Œè€Œé¿å…ä½¿ç”¨ <code>new</code> å…³é”®è¯</p>
<p>2ã€é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶æ¥è·å–è¦åˆ›å»ºå¯¹è±¡çš„å…¨é™å®šç±»å</p>
<h2 id="2-2-ä»£ç é—®é¢˜åˆ†æ"><a class="header-anchor" href="#2-2-ä»£ç é—®é¢˜åˆ†æ"></a>2.2 ä»£ç é—®é¢˜åˆ†æ</h2>
<p>åœ¨ä¸€ä¸ª Web é¡¹ç›®ä¸­ï¼Œé€šå¸¸æœ‰è¿™æ ·ä¸‰å±‚ï¼šè¡¨ç°å±‚ã€ä¸šåŠ¡å±‚ã€æŒä¹…å±‚ã€‚æˆ‘ä»¬ä»åå±‚å‘å‰ä¹¦å†™ï¼Œé‚£ä¹ˆåˆ™æœ‰ï¼š</p>
<p>æŒä¹…å±‚æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IAccountDao</span> &#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿä¿å­˜è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŒä¹…å±‚å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/15</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è´¦æˆ·çš„æŒä¹…å±‚å®ç°ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">IAccountDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿å­˜äº†è´¦æˆ·...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸šåŠ¡å±‚æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IAccountService</span> &#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿä¿å­˜è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸šåŠ¡å±‚å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">IAccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span> &#123;</span><br><span class="line">        accountDao.saveAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¨¡æ‹Ÿè¡¨ç°å±‚è°ƒç”¨ä¸šåŠ¡å±‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/15</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æ¨¡æ‹Ÿä¸€ä¸ªè¡¨ç°å±‚ï¼Œç”¨äºè°ƒç”¨ä¸šåŠ¡å±‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">IAccountService</span> <span class="variable">as</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountServiceImpl</span>();</span><br><span class="line">        as.saveAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œä¸Šè¿°ä»£ç åï¼Œæ§åˆ¶å°ä¼šæ‰“å°å‡ºï¼šä¿å­˜äº†è´¦æˆ·â€¦</p>
<p>ä½†æ˜¯åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å¤§é‡çš„ <code>new</code> å…³é”®è¯ã€‚å¦‚æœåˆ é™¤æŸä¸ªå®ç°ç±»ï¼Œå†è¿è¡Œä»£ç ï¼Œä¹Ÿå’Œæœ€åˆæµ‹è¯• JDBC ä¸€æ ·ï¼Œä¼šåœ¨ç¼–è¯‘æ—¶å°±æŠ¥é”™ï¼Œè€Œè¿™å°±æ˜¯ç±»ä¹‹é—´ä¾èµ–çš„è€¦åˆã€‚</p>
<h2 id="2-3-å·¥å‚æ¨¡å¼è§£è€¦"><a class="header-anchor" href="#2-3-å·¥å‚æ¨¡å¼è§£è€¦"></a>2.3 å·¥å‚æ¨¡å¼è§£è€¦</h2>
<blockquote>
<p>æ¦‚å¿µä»‹ç»</p>
</blockquote>
<p>åœ¨å¼€å§‹è¿›å…¥æœ¬èŠ‚ä¸»è¦å†…å®¹ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆæ˜ç™½å‡ ä¸ªæ¦‚å¿µï¼š</p>
<p><code>Bean</code>ï¼šåœ¨è®¡ç®—æœºè‹±è¯­ä¸­ï¼Œ<code>Bean</code> æœ‰å¯é‡ç”¨ç»„ä»¶çš„å«ä¹‰ã€‚</p>
<p>æˆ‘ä»¬ä»¥å‰è¿˜æ¥è§¦äº†ä¸€ä¸ªæ¦‚å¿µï¼Œå« <code>JavaBean</code>ï¼Œå½“æ—¶å¯¹å…¶çš„ç†è§£å°±æ˜¯å®ä½“ç±»ã€‚å®åˆ™éä¹Ÿï¼Œ<code>JavaBean</code> è¡¨ç¤ºç”¨ <code>Java</code> è¯­è¨€åˆ›å»ºçš„å¯é‡ç”¨ç»„ä»¶ã€‚å› æ­¤ï¼Œ<code>JavaBean</code> å¹¶ä¸ç­‰äºå®ä½“ç±»ã€‚</p>
<p>åœ¨ Web é¡¹ç›®ä¸­ï¼Œåƒ <code>xxxService</code> æˆ–è€… <code>xxxDao</code> éƒ½æ˜¯å¯ä»¥é‡ç”¨çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸éš¾æƒ³åˆ°åˆ›å»ºä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»åä¸º <code>BeanFactory</code>ï¼Œè¿™ä¸ªç±»å°±æ˜¯åˆ›å»º service å’Œ dao å¯¹è±¡çš„å·¥å‚ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•åˆ›å»ºå‘¢ï¼Ÿ</p>
<p>1ã€éœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥é…ç½®æˆ‘ä»¬çš„ service å’Œ daoã€‚é…ç½®çš„å†…å®¹ï¼šå”¯ä¸€æ ‡è¯†ç¬¦ = å…¨é™å®šç±»å ï¼ˆç±»ä¼¼äº key = valueï¼‰ã€‚</p>
<p>2ã€é€šè¿‡åå°„è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®å†…å®¹ï¼Œåå°„åˆ›å»ºå¯¹è±¡ã€‚é…ç½®æ–‡ä»¶å¯ä»¥æ˜¯ xml ä¹Ÿå¯ä»¥æ˜¯ propertiesã€‚</p>
<blockquote>
<p>å…·ä½“å®ç°</p>
</blockquote>
<p>ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ª <code>bean.properties</code> æ–‡ä»¶æ¥ä¿å­˜é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">accountService</span> = <span class="string">com.yang.service.impl.AccountServiceImpl</span></span><br><span class="line"><span class="attr">accountDao</span> = <span class="string">com.yang.dao.impl.AccountDaoImpl</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åå®Œå–„ <code>BeanFactory</code> ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanFactory</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ª Properties å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Properties properties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨é™æ€ä»£ç å—ä¸º Properties å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line">            properties = <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            <span class="comment">// è·å– Properties æ–‡ä»¶çš„æµå¯¹è±¡</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> BeanFactory.class.getClassLoader().getResourceAsStream(<span class="string">&quot;bean.properties&quot;</span>);</span><br><span class="line">            properties.load(in);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExceptionInInitializerError</span>(<span class="string">&quot;åˆå§‹åŒ– properties å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®Beançš„åç§°è·å–Beanå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getBean</span><span class="params">(String beanName)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">beanPath</span> <span class="operator">=</span> properties.getProperty(beanName);</span><br><span class="line">            System.out.println(beanPath);</span><br><span class="line">            <span class="comment">// æ¯æ¬¡éƒ½ä¼šè°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">            bean = Class.forName(beanPath).newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åæˆ‘ä»¬éœ€è¦æ”¹å†™å‰é¢ç¼–å†™çš„ä¸šåŠ¡å±‚å’Œè¡¨ç°å±‚ä»£ç ï¼Œæ”¹å†™ä¸šåŠ¡å±‚å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAccountService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    private IAccountDao accountDao = new AccountDaoImpl();</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">IAccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> ((IAccountDao) BeanFactory.getBean(<span class="string">&quot;accountDao&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span> &#123;</span><br><span class="line">        accountDao.saveAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ”¹å†™æ¨¡æ‹Ÿçš„è¡¨ç°å±‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        IAccountService as = new AccountServiceImpl();</span></span><br><span class="line">        <span class="type">IAccountService</span> <span class="variable">as</span> <span class="operator">=</span> (IAccountService) BeanFactory.getBean(<span class="string">&quot;accountService&quot;</span>);</span><br><span class="line">        as.saveAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åè¿è¡Œä»£ç ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E5%B7%A5%E7%A8%8B%E6%A8%A1%E5%BC%8F%E8%A7%A3%E8%80%A6%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C.png" alt="å·¥ç¨‹æ¨¡å¼è§£è€¦è¿è¡Œç»“æœ"></p>
<p>é€šè¿‡ä¸Šé¢çš„è¿è¡Œç»“æœä¸æœ€åˆçš„è¿è¡Œç»“æœæ¯”è¾ƒï¼Œæˆ‘ä»¬å‘ç°å¹¶æ— å·®å¼‚ã€‚</p>
<p>é‚£è¿™çœŸçš„åšåˆ°äº†è§£è€¦å—ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ é™¤æŸä¸ªå®ç°ç±»ï¼Œæ¯”å¦‚ï¼š<code>AccountServiceImpl</code> æˆ– <code>AccountDaoImpl</code>ï¼Œç„¶åå†è¿è¡Œä»£ç ï¼Œè™½ç„¶æ§åˆ¶å°ä¾æ—§æ— æ³•æ­£å¸¸æ‰“å°å‡ºç»“æœï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åœ¨ç¼–è¯‘æœŸæŠ¥é”™ï¼Œè€Œæ˜¯è¿è¡ŒåæŠ›å‡º <code>ClassNotFoundException</code> çš„å¼‚å¸¸ã€‚</p>
<p>å¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„å·¥å‚æ¨¡å¼å®ç°äº†è§£è€¦ã€‚ ğŸ˜</p>
<h2 id="2-4-å­˜åœ¨çš„é—®é¢˜ä¸æ”¹è¿›"><a class="header-anchor" href="#2-4-å­˜åœ¨çš„é—®é¢˜ä¸æ”¹è¿›"></a>2.4 å­˜åœ¨çš„é—®é¢˜ä¸æ”¹è¿›</h2>
<p>é€šè¿‡ 2.3 çš„åˆ†æï¼Œæˆ‘ä»¬å·²ç»åˆ©ç”¨å·¥å‚æ¨¡å¼å®ç°äº†è§£è€¦ï¼Œä½†ä»ç„¶å­˜åœ¨å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ã€‚</p>
<p>æˆ‘ä»¬æ”¹å†™ä¸€ä¸‹æ¨¡æ‹Ÿçš„è¡¨ç°å±‚ï¼Œåˆ©ç”¨ <code>for</code> å¾ªç¯ï¼Œæ‰“å° <code>IAccountService</code> å¯¹è±¡ï¼ŒåŒæ—¶æ³¨é‡Š <code>BeanFactory</code> ç±»ä¸­ <code>getBean()</code> æ–¹æ³•æ‰“å° <code>beanPath</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="type">IAccountService</span> <span class="variable">as</span> <span class="operator">=</span> (IAccountService) BeanFactory.getBean(<span class="string">&quot;accountService&quot;</span>);</span><br><span class="line">        System.out.println(as);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//        as.saveAccount();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E5%8F%8D%E5%B0%84%E8%A7%A3%E8%80%A6%E5%88%9B%E5%BB%BA%E7%9A%84%E5%A4%9A%E4%BE%8B%E5%AF%B9%E8%B1%A1.png" alt="åå°„è§£è€¦åˆ›å»ºçš„å¤šä¾‹å¯¹è±¡"></p>
<p>ä»æ‰“å°ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸ª <code>IAccountServiceImpl</code> å¯¹è±¡éƒ½ä¸ç›¸åŒï¼Œç®€å•æ¥è¯´å°±æ˜¯å®ä¾‹åŒ–çš„ <code>IAccountServiceImpl</code> å¯¹è±¡æ˜¯å¤šä¾‹çš„ï¼Œè€Œéå•ä¾‹çš„ã€‚</p>
<p>æˆ‘ä»¬å†æ”¹é€ ä¸€ä¸‹ <code>AccountServiceImpl</code> ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">IAccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> ((IAccountDao) BeanFactory.getBean(<span class="string">&quot;accountDao&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span> &#123;</span><br><span class="line">        accountDao.saveAccount();</span><br><span class="line">        System.out.println(i);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬å†è¿›å…¥æ¨¡æ‹Ÿçš„è¡¨ç°å±‚åœ¨ <code>for</code> å¾ªç¯ä¸­è°ƒç”¨ <code>saveAccount()</code> å¹¶è¿è¡Œï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/å¤šä¾‹å¯¹è±¡è¾“å‡ºç»“æœ.png" alt="å¤šä¾‹å¯¹è±¡è¾“å‡ºç»“æœ" style="zoom:67%;" />
<p>æˆ‘ä»¬çŸ¥é“ç±»ä¸­çš„æ–¹æ³•å¯ä»¥æ“ä½œç±»ä¸­çš„æˆå‘˜å˜é‡ï¼Œå¹¶å¯ä»¥æ”¹å˜æˆå‘˜å˜é‡çš„å€¼ã€‚ç”±äºå®ä¾‹åŒ–çš„å¯¹è±¡æ˜¯å¤šä¾‹çš„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å®ä¾‹ï¼Œä»è€Œä¿è¯äº†ç±»å¯¹è±¡åœ¨åˆ›å»ºæ—¶é‡æ–°åˆå§‹åŒ–ç±»ä¸­çš„å±æ€§ï¼ˆæˆå‘˜å˜é‡ï¼‰ï¼Œå› æ­¤æˆå‘˜å˜é‡ <code>i</code> ä¸€ç›´éƒ½è¾“å‡º 1ï¼Œå°±ç®—æ˜¯ <code>i++</code> åä¹Ÿä¸ä¼šå¢åŠ  <code>i</code> çš„å€¼ã€‚</p>
<p>ä½†å¦‚æœå®ä¾‹åŒ–çš„å¯¹è±¡æ˜¯å•ä¾‹çš„ï¼Œå¯¹è±¡åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ï¼Œä»è€Œç±»ä¸­çš„æˆå‘˜å˜é‡ä¹Ÿåªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ã€‚</p>
<p>åœ¨å¤šä¸ªçº¿ç¨‹æˆ–å¤šä¸ªå¯¹è±¡è®¿é—®å•ä¾‹å¯¹è±¡æˆå‘˜å˜é‡çš„å€¼ï¼Œå°±ä¼šå¼•èµ·å€¼çš„æ”¹å˜ï¼Œè€Œå¯¹äºå¤šä¾‹å¯¹è±¡å°±ä¸ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ã€‚ä¸è¿‡åè¿‡æ¥æƒ³ï¼Œå¤šä¾‹å¯¹è±¡ä¼šè¢«åˆ›å»ºå¤šæ¬¡ï¼Œé‚£ä¹ˆæ‰§è¡Œæ•ˆç‡ä¼šæ²¡æœ‰å•ä¾‹å¯¹è±¡é«˜ã€‚</p>
<p><strong>åœ¨ Web é¡¹ç›®çš„ service å’Œ dao ä¸­ä¸å­˜åœ¨ç±»ä¸­æˆå‘˜å˜é‡ä¼šè¢«ç±»ä¸­çš„æ–¹æ³•è°ƒæ•´çš„æƒ…å†µï¼Œä¹Ÿä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› æ­¤åœ¨ Web é¡¹ç›®ä¸­ä½¿ç”¨å•ä¾‹çš„å¯¹è±¡æ›´å¥½ï¼Œå¯ä»¥æé«˜æ•ˆç‡ã€‚</strong></p>
<p>å®ä¾‹åŒ–çš„å¯¹è±¡æ˜¯å¤šä¾‹çš„ä¸»è¦åŸå› æ˜¯åœ¨åå°„åˆ›å»ºå¯¹è±¡æ˜¯è°ƒç”¨äº† <code>newInstance()</code> æ–¹æ³•ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•åæ¯æ¬¡éƒ½ä¼šè°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œå› æ­¤å®ä¾‹åŒ–çš„å¯¹è±¡æ˜¯å¤šä¾‹çš„ã€‚</p>
<p>å¦‚æœæƒ³è®©åˆ›å»ºçš„ Bean å¯¹è±¡æ˜¯å•ä¾‹çš„ï¼Œæˆ‘ä»¬åªèƒ½è°ƒç”¨ <code>newInstance()</code> ä¸€æ¬¡ï¼ŒåŒæ—¶è¿˜è¦å°†åˆ›å»ºçš„å¯¹è±¡å­˜å…¥å®¹å™¨ä¸­ã€‚å› ä¸ºä¸å­˜å…¥å®¹å™¨ä¸­ï¼Œä¸”é•¿æ—¶é—´ä¸ä½¿ç”¨è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œç”±äº Java çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè¢«å›æ”¶ï¼Œç­‰åˆ°ä¸‹æ¬¡è¿˜æƒ³ç”¨æ—¶ï¼ŒåŸæœ¬åˆ›å»ºçš„å¯¹è±¡å°±ä¸å­˜åœ¨äº†ã€‚</p>
<p>è¿™ä¸ªæˆ‘çŸ¥é“ï¼Œé‚£å†åˆ›å»ºä¸€ä¸ªå¯¹è±¡å‘—ã€‚</p>
<p>åˆ›å»ºä¸ª ğŸ”¨ï¼Œå¦‚æœå†åˆ›å»ºä¸€ä¸ªä¸å°±æ˜¯å¤šä¾‹çš„äº†ï¼Œåˆç€æˆ‘å‰é¢éƒ½ç™½è®²äº†ï¼Ÿ ğŸ˜¡</p>
<p>é‚£æ€ä¹ˆå­˜è¿™ä¸ªå¯¹è±¡ï¼Ÿæˆ–è€…è¯´ç”¨ä»€ä¹ˆå®¹å™¨å­˜ï¼Ÿ</p>
<p>å‰é¢è¯´äº†é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¸”ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦å¯¹åº”ä¸€ä¸ªå…¨é™å®šç±»åï¼Œè¿™æ˜¯ä¸€ç§ key-value å½¢å¼ï¼Œé‚£å¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Map</code> æ¥å­˜è¿™ä¸ªå¯¹è±¡ã€‚</p>
<p>é‚£å¯¹è±¡åœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºï¼Ÿ</p>
<p>ç”±äºå¯¹è±¡è¦æ˜¯å•ä¾‹çš„ï¼Œé‚£ä¹ˆåœ¨é™æ€ä»£ç å—ä¸­è¯»å–é…ç½®æ–‡ä»¶åï¼Œå°±å¯ä»¥åˆ›å»ºå¯¹è±¡äº†ï¼Œå¹¶å°†å¯¹è±¡å­˜å…¥å®¹å™¨ä¸­ã€‚</p>
<p>æœ€ç»ˆä¿®æ”¹ <code>BeanFactory</code> ç±»ï¼Œå¾—åˆ°ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanFactory</span> &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ª Properties å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Properties properties;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ª Mapï¼Œç”¨äºå­˜æ”¾æˆ‘ä»¬è¦åˆ›å»ºçš„å¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠå®ƒç§°ä¹‹ä¸ºå®¹å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Object&gt; beans;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨é™æ€ä»£ç å—ä¸º Properties å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line">            properties = <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            <span class="comment">// è·å– Properties æ–‡ä»¶çš„æµå¯¹è±¡</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> BeanFactory.class.getClassLoader().getResourceAsStream(<span class="string">&quot;bean.properties&quot;</span>);</span><br><span class="line">            properties.load(in);</span><br><span class="line">            <span class="comment">// å®ä¾‹åŒ–å®¹å™¨</span></span><br><span class="line">            beans = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            <span class="comment">// å–å‡ºé…ç½®æ–‡ä»¶ä¸­æ‰€æœ‰çš„ key</span></span><br><span class="line">            Enumeration&lt;Object&gt; keys = properties.keys();</span><br><span class="line">            <span class="comment">// éå†æšä¸¾</span></span><br><span class="line">            <span class="keyword">while</span> (keys.hasMoreElements()) &#123;</span><br><span class="line">                <span class="comment">// å–å‡ºæ¯ä¸ª key</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> keys.nextElement().toString();</span><br><span class="line">                <span class="comment">// æ ¹æ® key è·å– value</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">beanPath</span> <span class="operator">=</span> properties.getProperty(key);</span><br><span class="line">                <span class="comment">// åå°„åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> Class.forName(beanPath).newInstance();</span><br><span class="line">                <span class="comment">// æŠŠ key å’Œ value å­˜å…¥å®¹å™¨</span></span><br><span class="line">                beans.put(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExceptionInInitializerError</span>(<span class="string">&quot;åˆå§‹åŒ– properties å¤±è´¥&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ® bean çš„åç§°è·å–å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">getBean</span><span class="params">(String beanName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beans.get(beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå…¶ä»–ä»£ç ä¸å˜ï¼Œè¿›å…¥æ¨¡æ‹Ÿçš„è¡¨ç°å±‚è¿è¡Œ <code>main()</code> æ–¹æ³•ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/å•ä¾‹å¯¹è±¡è¾“å‡ºç»“æœ.png" alt="å•ä¾‹å¯¹è±¡è¾“å‡ºç»“æœ" style="zoom:67%;" />
<p>ä»è¾“å‡ºç»“æœæˆ‘ä»¬çœ‹åˆ°åˆ›å»ºçš„ <code>IAccountServiceImpl</code> å¯¹è±¡æ˜¯å•ä¾‹çš„ï¼Œåªåˆ›å»ºäº†ä¸€ä¸ª <code>IAccountServiceImpl</code> å¯¹è±¡ï¼Œå¹¶ä¸”éšç€å¾ªç¯çš„æ‰§è¡Œï¼Œè¾“å‡ºçš„ <code>i</code> å€¼ä¹Ÿé€æ¸å¢åŠ ï¼Œè¿™ä¹ŸéªŒè¯äº†åˆ›å»ºçš„å¯¹è±¡æ˜¯å•ä¾‹çš„ã€‚</p>
<p>åˆ°æ­¤ï¼Œæˆ‘ä»¬ä¸ä»…å®ç°äº†åˆ©ç”¨å·¥å‚æ¨¡å¼è§£è€¦ï¼Œè¿˜è®©æˆ‘ä»¬åˆ©ç”¨åå°„åˆ›å»ºçš„å¯¹è±¡æ˜¯å•ä¾‹çš„ï¼Œåœ¨ Web é¡¹ç›®ä¸­æ‹¥æœ‰æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚</p>
<h2 id="2-5-æ§åˆ¶åè½¬-IoC"><a class="header-anchor" href="#2-5-æ§åˆ¶åè½¬-IoC"></a>2.5 æ§åˆ¶åè½¬ - IoC</h2>
<p>å‰æ–‡ä¸­å™è¿°äº†åˆ©ç”¨å·¥å‚æ¨¡å¼å®ç°è§£è€¦ï¼Œä½†è¿˜æ˜¯æ²¡è§£é‡Šä»€ä¹ˆæ˜¯å·¥å‚ã€‚</p>
<p>å·¥å‚å°±æ˜¯è´Ÿè´£ä»å®¹å™¨ä¸­è·å–æŒ‡å®šå¯¹è±¡çš„ç±»ï¼Œè€Œè¿™æ—¶å€™æˆ‘ä»¬è·å–å¯¹è±¡çš„æ–¹å¼å‘ç”Ÿäº†æ”¹å˜ã€‚</p>
<p>åœ¨æ²¡ä½¿ç”¨å·¥å‚æ—¶ï¼Œæˆ‘ä»¬é‡‡ç”¨è¿™ç§æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">IAccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountDaoImpl</span>();</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼è·å–å¯¹è±¡æ—¶ï¼Œé‡‡ç”¨ <code>new</code> çš„æ–¹å¼ï¼Œæ˜¯<mark>ä¸»åŠ¨</mark>çš„ã€‚</p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/ä½¿ç”¨newåˆ›å»ºå¯¹è±¡.png" alt="ä½¿ç”¨newåˆ›å»ºå¯¹è±¡" style="zoom: 67%;" />
<p>ä½¿ç”¨è¿™ç§æ–¹å¼ï¼ŒAPP æˆ–è€…è¯´åº”ç”¨è·Ÿèµ„æºå­˜åœ¨å¿…ç„¶çš„è”ç³»ï¼Œå¹¶ä¸”è¿™ç§è”ç³»æ˜¯æ— æ³•ç›¸å¤„çš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ APP æˆ–èµ„æºç‹¬ç«‹ï¼Œå°±å¾ˆéš¾åšåˆ°ï¼Œå› ä¸ºåº”ç”¨å’Œèµ„æºä¹‹é—´æœ‰å¿…ç„¶çš„è”ç³»ã€‚</p>
<p>å½“æˆ‘ä»¬ä½¿ç”¨å·¥å‚æ¥è·å–å¯¹è±¡æ—¶ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">IAccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> ((IAccountDao) BeanFactory.getBean(<span class="string">&quot;accountDao&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼è·å–å¯¹è±¡æ—¶ï¼Œå°±ä¼šå‘å·¥å‚è¦ï¼Œæœ‰å·¥å‚ä¸ºæˆ‘ä»¬æŸ¥æ‰¾æˆ–è€…åˆ›å»ºå¯¹è±¡ï¼Œæ˜¯<mark>è¢«åŠ¨</mark>çš„ã€‚</p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/å·¥å‚æŸ¥æ‰¾æˆ–åˆ›å»ºå¯¹è±¡.png" alt="å·¥å‚æŸ¥æ‰¾æˆ–åˆ›å»ºå¯¹è±¡" style="zoom:67%;" />
<p>ä½¿ç”¨è¿™ç§æ–¹å¼æŸ¥æ‰¾æˆ–åˆ›å»ºå¯¹è±¡æ—¶ï¼ŒAPPï¼ˆåº”ç”¨ï¼‰ä¸èµ„æºä¹‹é—´çš„è”ç³»å°±æ–­å¼€äº†ï¼Œè€Œæ˜¯æ‰¾å·¥å‚è¦èµ„æºï¼Œå·¥å‚è´Ÿè´£è·Ÿèµ„æºå–å¾—è”ç³»ï¼Œå¹¶æŠŠ APPï¼ˆåº”ç”¨ï¼‰æƒ³è¦çš„èµ„æºç»™å®ƒã€‚</p>
<p>è¿™ç§è¢«åŠ¨è·å–å¯¹è±¡çš„æ€æƒ³å°±æ˜¯<strong>æ§åˆ¶åè½¬</strong>ï¼Œå®ƒæ˜¯ Spring æ¡†æ¶çš„æ ¸å¿ƒä¹‹ä¸€ã€‚</p>
<p><strong>æ§åˆ¶åè½¬</strong>ï¼ˆInversion of Controlï¼Œç¼©å†™ä¸º<strong>IoC</strong>ï¼‰ï¼Œæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œå¯ä»¥ç”¨æ¥å‡ä½è®¡ç®—æœºä»£ç ä¹‹é—´çš„è€¦åˆåº¦ï¼Œè¿™ç§æ–¹å¼æŠŠåˆ›å»ºå¯¹è±¡çš„æƒåˆ©äº¤ç»™äº†æ¡†æ¶ï¼Œæ˜¯æ¡†æ¶çš„é‡è¦ç‰¹æ€§ï¼Œå¹¶éé¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸“ç”¨æœ¯è¯­ã€‚å…¶ä¸­æœ€å¸¸è§çš„æ–¹å¼å«åš<strong>ä¾èµ–æ³¨å…¥</strong>ï¼ˆDependency Injectionï¼Œç®€ç§°<strong>DI</strong>ï¼‰ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼å«â€œä¾èµ–æŸ¥æ‰¾â€ï¼ˆDependency Lookupï¼‰ã€‚</p>
<blockquote>
<p>é‚£è¿™ä¸ºä»€ä¹ˆå«åšæ§åˆ¶åè½¬è€Œä¸å«é™ä½ä¾èµ–å‘¢ï¼Ÿ</p>
</blockquote>
<p>æœ€å¼€å§‹ä½¿ç”¨ <code>new</code> å…³é”®è¯æ¥åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼šæ˜ç¡®æŒ‡å®šéœ€è¦çš„é‚£ä¸ªèµ„æºï¼ˆç±»ï¼‰ï¼Œå¯ä»¥è‡ªå·±è‡ªä¸»æ‰¾åˆ°éœ€è¦çš„èµ„æºã€‚è€Œåæˆ‘ä»¬æ”¾å¼ƒä½¿ç”¨è¿™ç§æ–¹å¼æ¥è·å–èµ„æºï¼Œä½¿ç”¨å·¥å‚æ¥æŸ¥è¯¢æˆ–åˆ›å»ºèµ„æºï¼Œå·¥å‚ä¼šåˆ©ç”¨ä¸€ä¸ªæŒ‡å®šçš„åç§°æ¥æ‰¾åˆ°æŸä¸ªèµ„æºï¼Œä½†è¿™ä¸ªèµ„æºæ˜¯å¦å¯ç”¨ã€æ˜¯å¦æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå°±æ— ä»å¾—çŸ¥äº†ï¼Œè¿™æ˜¯æ ¹æ®æŒ‡å®šçš„åç§°ç”±å·¥å‚è·å–çš„ã€‚</p>
<p>æœ€å¼€å§‹çš„æ–¹å¼æœ‰è‡ªä¸»è·å–èµ„æºçš„æƒåˆ©ï¼Œæƒ³è¦è°å°±è¦è°ï¼Œ<code>new</code> ä¸€ä¸‹å°±è¡Œäº†ï¼Œåé¢çš„æ–¹å¼å°±ä¸åŒäº†ï¼Œæ²¡æœ‰äº†è‡ªä¸»è·å–èµ„æºçš„æƒåˆ©ï¼Œè€Œæ˜¯åˆ©ç”¨æŒ‡å®šçš„åç§°ç”±å·¥å‚è·å–ï¼Œæ§åˆ¶æƒäº¤ç»™äº†å·¥å‚ï¼Œæ§åˆ¶å‘ç”Ÿäº†åè½¬ï¼Œå› æ­¤å°±å«åšæ§åˆ¶åè½¬ï¼Œæ§åˆ¶åè½¬å¯ä»¥é™ä½ç¨‹åºä¹‹é—´çš„è€¦åˆã€‚</p>
<p>æ˜ç¡® IoC çš„ä½œç”¨ï¼š å‰Šå‡è®¡ç®—æœºç¨‹åºçš„è€¦åˆï¼ˆè§£é™¤æˆ‘ä»¬ä»£ç ä¸­çš„ä¾èµ–å…³ç³»ï¼‰ã€‚</p>
<p>åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±ç¼–å†™åˆ©ç”¨å·¥å‚è·å–èµ„æºçš„ä»£ç ï¼Œä½†æ˜¯è¿™ç§åº•å±‚ä»£ç è¿‡äºç¹çï¼Œç»å¸¸ä¹¦å†™ä¼šå¾ˆéº»çƒ¦ï¼Œè¿™ä¸ªæ—¶å€™ Spring å°±å‡ºç°äº†ï¼Œåˆ©ç”¨è¿™ä¸ªæ¡†æ¶å°±å¯ä»¥å®ç° IoCã€‚</p>
<h1 id="3-Spring-ä¸-IoC"><a class="header-anchor" href="#3-Spring-ä¸-IoC"></a>3. Spring ä¸ IoC</h1>
<h2 id="3-1-ä½¿ç”¨-Spring-åˆ›å»ºå¯¹è±¡"><a class="header-anchor" href="#3-1-ä½¿ç”¨-Spring-åˆ›å»ºå¯¹è±¡"></a>3.1 ä½¿ç”¨ Spring åˆ›å»ºå¯¹è±¡</h2>
<p>åœ¨å‰æ–‡ä¸­ä»£ç çš„åŸºç¡€ä¸Šä½¿ç”¨ Spring æ¥åˆ›å»ºå¯¹è±¡ï¼Œ<code>IAccountDao</code> å’Œ <code>IAccountService</code> æ¥å£ä¸å˜ï¼Œ<code>AccountDaoImpl</code> å®ç°ç±»ä¹Ÿä¸è¿›è¡Œä¿®æ”¹ï¼Œå°† <code>IAccountService</code> çš„å®ç°ç±» <code>AccountServiceImpl</code> è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">IAccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span> &#123;</span><br><span class="line">        accountDao.saveAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€é‡è¦çš„æ˜¯éœ€è¦åœ¨æˆ‘ä»¬åˆ›å»ºçš„ Maven é¡¹ç›®ä¸­å¯¼å…¥ Spring ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¹¶åœ¨ resources ç›®å½•ä¸‹åˆ›å»º Spring çš„é…ç½®æ–‡ä»¶ï¼Œå‡è®¾å–åä¸º <code>bean.xml</code>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æŠŠå¯¹è±¡çš„åˆ›å»ºäº¤ç»™springç®¡ç†--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.service.impl.AccountServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.dao.impl.AccountDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœ€åä¿®æ”¹ <code>Client</code> ç±»å¹¶è¿è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿä¸€ä¸ªè¡¨ç°å±‚ï¼Œç”¨äºè°ƒç”¨ä¸šåŠ¡å±‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * è·å– Spring çš„ IoC å®¹å™¨ï¼Œå¹¶æ ¹æ® id è·å–å¯¹è±¡</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. è·å–æ ¸å¿ƒå®¹å™¨å¯¹è±¡</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="comment">// 2. æ ¹æ® id è·å–å¯¹è±¡</span></span><br><span class="line">        <span class="type">IAccountService</span> <span class="variable">as</span> <span class="operator">=</span> (IAccountService) ac.getBean(<span class="string">&quot;accountService&quot;</span>);</span><br><span class="line">        <span class="type">IAccountDao</span> <span class="variable">adao</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;accountDao&quot;</span>, IAccountDao.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(as);</span><br><span class="line">        System.out.println(adao);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ§åˆ¶å°è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E4%BD%BF%E7%94%A8Spring%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1.png" alt="ä½¿ç”¨Springåˆ›å»ºå¯¹è±¡"></p>
<p>ä»æ§åˆ¶å°çš„è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ä½¿ç”¨ Spring æˆåŠŸåˆ›å»ºäº†å¯¹è±¡ã€‚ğŸ‰</p>
<h2 id="3-2-ApplicationContext"><a class="header-anchor" href="#3-2-ApplicationContext"></a>3.2 ApplicationContext</h2>
<blockquote>
<p>ApplicationContext ä¸‰ä¸ªå¸¸ç”¨çš„å®ç°ç±»</p>
</blockquote>
<p>1ã€<code>ClassPathXmlApplicationContext</code>ï¼šå®ƒå¯ä»¥åŠ è½½ç±»è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œè¦æ±‚é…ç½®æ–‡ä»¶å¿…é¡»åœ¨ç±»è·¯å¾„ä¸‹ã€‚å¦‚æœä¸åœ¨ï¼Œå½“ç„¶å°±åŠ è½½ä¸äº†ï¼ˆç›¸æ¯”äºç¬¬äºŒä¸ªå®ç°ç±»ï¼Œè¿™ä¸ªæ›´å¸¸ç”¨ï¼‰ã€‚</p>
<p>2ã€<code>FileSystemXmlApplicationContext</code>ï¼šå®ƒå¯ä»¥åŠ è½½ç£ç›˜ä»»æ„è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶ï¼ˆå¿…é¡»æœ‰è®¿é—®æƒé™ï¼‰</p>
<p>3ã€<code>AnnotationConfigApplicationContext</code>ï¼šå®ƒç”¨äºè¯»å–æ³¨è§£æ¥åˆ›å»ºå®¹å™¨</p>
<blockquote>
<p>ApplicationContext ä¸ BeanFactory</p>
</blockquote>
<p>æˆ‘ä»¬é€‰ä¸­ <code>ApplicationContext</code> åï¼Œåœ¨ IDEA ä¸­å³å‡»å®ƒï¼Œé€‰ä¸­ Diagrams ï¼Œå†ç‚¹å‡» Show Diagramâ€¦ å¯å¾—ä»¥ä¸‹ç±»å›¾ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/ApplicationContext%E7%9A%84%E7%B1%BB%E5%9B%BE.png" alt="ApplicationContextçš„ç±»å›¾"></p>
<p>å¯ä»¥çœ‹å‡º <code>ApplicationContext</code> ç¡®å®æ˜¯ä¸ªå€Ÿå£ï¼Œä½†å¹¶ä¸æ˜¯æœ€åº•å±‚å€Ÿå£ï¼Œå®ƒè¿˜ç»§æ‰¿äº† <code>BeanFactory</code> æ¥å£ã€‚</p>
<p>é‚£ä¹ˆè¿™ä¸¤ä¸ªæ¥å£æœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿ</p>
<p><code>ApplicationContext</code>ï¼šå®ƒåœ¨åˆ›å»ºæ ¸å¿ƒå®¹å™¨æ—¶ï¼Œåˆ›å»ºå¯¹è±¡é‡‡å–çš„ç­–ç•¥æ˜¯ <mark>ç«‹å³åŠ è½½</mark> çš„æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ä¸€è¯»å–å®Œé…ç½®æ–‡ä»¶å°±ä¼šé©¬ä¸Šåˆ›å»ºé…ç½®æ–‡ä»¶ä¸­é…ç½®çš„å¯¹è±¡ï¼ˆå•ä¾‹å¯¹è±¡é€‚ç”¨ï¼‰ã€‚</p>
<p><code>BeanFactory</code>ï¼šå®ƒåœ¨æ„å»ºæ ¸å¿ƒå®¹å™¨æ—¶ï¼Œåˆ›å»ºå¯¹è±¡é‡‡å–çš„ç­–ç•¥æ˜¯ <mark>å»¶è¿ŸåŠ è½½</mark> çš„æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»€ä¹ˆæ—¶å€™æ ¹æ® id è·å–å¯¹è±¡äº†ï¼Œä»€ä¹ˆæ—¶å€™æ‰çœŸæ­£åˆ›å»ºå¯¹è±¡ï¼ˆå¤šä¾‹å¯¹è±¡é€‚ç”¨ï¼‰ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ—¢ç„¶æœ‰è¿™ä¸¤ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å®é™…ä½¿ç”¨æ—¶é‡‡å–å“ªä¸ªå±…å¤šå‘¢ï¼Ÿ</p>
<p>å‰æ–‡ä¸­è¯´ï¼Œæˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡éƒ½æ˜¯å•ä¾‹çš„ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œå“ªä»€ä¹ˆæ—¶å€™åˆ›å»ºæ›´å¥½ï¼Ÿ</p>
<p>ä¸ç”¨å¤šè¯´ï¼Œæ˜¾ç„¶æ˜¯è¯»å–å®Œé…ç½®æ–‡ä»¶å°±åˆ›å»ºå¯¹è±¡ï¼Œå³é‡‡ç”¨ <code>ApplicationContext</code> æ¥å£åˆ›å»ºã€‚åŒæ—¶ï¼Œ<code>BeanFactory</code> ä½œä¸ºä¸€ä¸ªé¡¶å±‚æ¥å£ï¼Œå®ƒé‡Œé¢çš„æŠ½è±¡æ–¹æ³•æ˜¾ç„¶ä¸å¦‚å…¶å­ç±» <code>ApplicationContext</code> å®Œå–„çš„ï¼Œå› æ­¤ï¼Œ<code>ApplicationContext</code> æ›´åŠ å¸¸ç”¨ã€‚</p>
<h2 id="3-3-Spring-ä¸­-Bean-çš„ç»†èŠ‚"><a class="header-anchor" href="#3-3-Spring-ä¸­-Bean-çš„ç»†èŠ‚"></a>3.3 Spring ä¸­ Bean çš„ç»†èŠ‚</h2>
<blockquote>
<p>ä¸‰ç§åˆ›å»º Bean çš„æ–¹å¼</p>
</blockquote>
<p>1ã€ä½¿ç”¨<strong>é»˜è®¤æ„é€ å‡½æ•°</strong>åˆ›å»º Bean</p>
<p>åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ <code>&lt;bean&gt;</code> æ ‡ç­¾ï¼Œé…ä»¥ id å’Œ class å±æ€§åï¼Œä¸”æ²¡æœ‰å…¶ä»–å±æ€§å’Œæ ‡ç­¾æ—¶ï¼Œé‡‡ç”¨çš„å°±æ˜¯é»˜è®¤æ„é€ å‡½æ•°åˆ›å»º Bean å¯¹è±¡ã€‚</p>
<p>å¦‚æœç±»ä¸­æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œåˆ™å¯¹è±¡æ— æ³•åˆ›å»ºã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.service.impl.AccountServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2ã€ä½¿ç”¨<strong>æ™®é€šå·¥å‚ä¸­çš„æ–¹æ³•</strong>åˆ›å»ºå¯¹è±¡ï¼ˆä½¿ç”¨æŸä¸ªç±»çš„æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œå¹¶å­˜å…¥ Spring å®¹å™¨ï¼‰</p>
<p>å·¥å‚ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/19</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æ¨¡æ‹Ÿä¸€ä¸ªå·¥å‚ç±»ï¼ˆå·¥å‚åˆ›å»ºçš„ç±»å¯èƒ½æ˜¯å­˜åœ¨ jar åŒ…ä¸­çš„ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ä¿®æ”¹æºç çš„æ–¹å¼æ¥æä¾›é»˜è®¤æ„é€ å‡½æ•°ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InstanceFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> IAccountService <span class="title function_">getAccountService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å‡è®¾ AccountServiceImpl ç±»æ˜¯å­˜åœ¨ jar åŒ…ä¸­çš„</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AccountServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;instanceFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.factory.InstanceFactory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;instanceFactory&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">&quot;getAccountService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3ã€ä½¿ç”¨<strong>å·¥å‚ä¸­çš„é™æ€æ–¹æ³•</strong>åˆ›å»ºå¯¹è±¡ï¼ˆä½¿ç”¨æŸä¸ªç±»ä¸­çš„é™æ€æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œå¹¶å­˜å…¥ Spring å®¹å™¨ï¼‰</p>
<p>å·¥å‚ç±»ä¸é™æ€æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ‹Ÿä¸€ä¸ªå·¥å‚ç±»ï¼ˆå·¥å‚åˆ›å»ºçš„ç±»å­˜åœ¨ jar åŒ…ä¸­çš„ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ä¿®æ”¹æºç çš„æ–¹å¼æ¥æä¾›é»˜è®¤æ„é€ å‡½æ•°ï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IAccountService <span class="title function_">getAccountService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å‡è®¾ AccountServiceImpl ç±»æ˜¯å­˜åœ¨ jar åŒ…ä¸­çš„</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AccountServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.factory.StaticFactory&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">&quot;getAccountService&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Bean å¯¹è±¡çš„ä½œç”¨èŒƒå›´</p>
</blockquote>
<p>Spring ä¸­åˆ›å»ºçš„ Bean å¯¹è±¡é»˜è®¤æ˜¯å•ä¾‹çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆè°ƒæ•´ Bean çš„å·¦å³èŒƒå›´å‘¢ï¼Ÿ</p>
<p>å¯ä»¥ä½¿ç”¨ <code>&lt;bean&gt;</code> æ ‡ç­¾ä¸­çš„ <code>scope</code> å±æ€§ã€‚è¿™ä¸ªå±æ€§ç”¨äºæŒ‡å®š Bean çš„ä½œç”¨èŒƒå›´ï¼Œå®ƒæœ‰å¦‚ä¸‹å–å€¼ï¼š</p>
<ul>
<li>singletonï¼šå•ä¾‹ï¼ˆé»˜è®¤å€¼ï¼‰</li>
<li>prototypeï¼šå¤šä¾‹</li>
<li>requestï¼šä½œç”¨äº Web åº”ç”¨çš„è¯·æ±‚èŒƒå›´</li>
<li>sessionï¼šä½œç”¨äº Web åº”ç”¨çš„ä¼šè¯èŒƒå›´</li>
<li><s>global-sessionï¼šä½œç”¨äºé›†ç¾¤ç¯å¢ƒçš„ä¼šè¯èŒƒå›´ï¼ˆå…¨å±€ä¼šè¯èŒƒå›´ï¼‰ï¼Œå¦‚æœå½“å‰ç¯å¢ƒä¸æ˜¯é›†ç¾¤ç¯å¢ƒï¼Œæ•ˆæœç­‰äº <code>session</code>ï¼ˆæ¶‰åŠè´Ÿè½½å‡è¡¡ã€é›†ç¾¤ç­‰çŸ¥è¯†ç‚¹ï¼‰</s></li>
<li>applicationï¼šä½œç”¨äº Web åº”ç”¨çš„ <code>ServletContext</code>ã€‚Web å®¹å™¨ç”¨åˆ°æ­¤ Bean æ—¶åˆ›å»ºï¼Œå®¹å™¨å…³é—­æ—¶é”€æ¯</li>
</ul>
<blockquote>
<p>Bean å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</p>
</blockquote>
<p>é¦–å…ˆå¾—æ˜ç™½ä¸€ç‚¹ï¼šå•ä¾‹å¯¹è±¡å’Œå¤šä¾‹å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<p>å¯¹å•ä¾‹å¯¹è±¡æ¥è¯´ï¼šå½“å®¹å™¨åˆ›å»ºæ—¶ï¼Œå¯¹è±¡å‡ºç”Ÿï¼›åªè¦å®¹å™¨è¿˜åœ¨ï¼Œå¯¹è±¡ä¸€ç›´æ´»ç€ï¼›å¦‚æœå®¹å™¨é”€æ¯ï¼Œå¯¹è±¡å°±æ­»äº¡äº†ã€‚</p>
<p>æ€»ç»“ï¼šå•ä¾‹å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå’Œå®¹å™¨ç›¸åŒã€‚</p>
<p>å¯¹å¤šä¾‹å¯¹è±¡æ¥è¯´ï¼šå½“æˆ‘ä»¬ä½¿ç”¨å¯¹è±¡æ—¶ï¼ŒSpring æ¡†æ¶ä¸ºæˆ‘ä»¬åˆ›å»ºï¼›å¯¹è±¡åªè¦æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å°±ä¸€ç›´æ´»ç€ï¼›å½“å¯¹è±¡é•¿æ—¶é—´ä¸ç”¨ä¸”æ²¡æœ‰åˆ«çš„å¯¹è±¡å¼•ç”¨æ—¶ï¼Œç”± Java çš„åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p>
<h2 id="3-4-ä¾èµ–æ³¨å…¥"><a class="header-anchor" href="#3-4-ä¾èµ–æ³¨å…¥"></a>3.4 ä¾èµ–æ³¨å…¥</h2>
<blockquote>
<p>åŸºæœ¬æ¦‚å¿µ</p>
</blockquote>
<p>ä¾èµ–æ³¨å…¥ï¼šDependency Injectionã€‚å®ƒæ˜¯ Spring æ¡†æ¶æ ¸å¿ƒ IoC çš„å…·ä½“å®ç°ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ IoC çš„ä½œç”¨æ˜¯ï¼šé™ä½ç¨‹åºé—´çš„ä¾èµ–å…³ç³»ï¼Œæˆ–è€…è¯´é™ä½ç¨‹åºé—´çš„ä¾èµ–å…³ç³»ã€‚</p>
<p>åŒæ—¶å°†ä¾èµ–å…³ç³»çš„ç®¡ç†éƒ½äº¤ç»™ Spring æ¥ç»´æŠ¤ï¼Œåœ¨å½“å‰ç±»éœ€è¦ç”¨åˆ°å…¶ä»–ç±»çš„å¯¹è±¡æ—¶ï¼Œç”± Spring ä¸ºæˆ‘ä»¬æä¾›ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è¯´æ˜å³å¯ã€‚</p>
<p>è¿™ç§ä¾èµ–å…³ç³»çš„ç»´æŠ¤å°±ç§°ä¹‹ä¸ºï¼šä¾èµ–æ³¨å…¥ã€‚</p>
<p>ä¾èµ–æ³¨å…¥èƒ½å¤Ÿæ³¨å…¥çš„æ•°æ®æœ‰ä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼šåŸºæœ¬æ•°æ®ç±»å‹å’Œ <code>String</code>ã€å…¶ä»– Bean ç±»å‹ï¼ˆåœ¨é…ç½®æ–‡ä»¶ä¸­æˆ–è€…æ³¨è§£é…ç½®è¿‡çš„ Beanï¼‰ï¼Œå¤æ‚ç±»å‹ / é›†åˆç±»å‹ã€‚</p>
<p>ä¾èµ–æ³¨å…¥çš„æ–¹å¼ä¹Ÿæœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ï¼šä½¿ç”¨æ„é€ å‡½æ•°æä¾›ã€ä½¿ç”¨ set æ–¹æ³•æä¾›ï¼Œä½¿ç”¨æ³¨è§£æä¾›ã€‚</p>
<blockquote>
<p>æ„é€ å‡½æ•°æ³¨å…¥</p>
</blockquote>
<p>ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥æ—¶ï¼Œéœ€è¦åœ¨ <code>&lt;bean&gt;</code> æ ‡ç­¾å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªæ–°çš„æ ‡ç­¾ <code>&lt;constructor-arg&gt;</code>ã€‚</p>
<p>è¿™ä¸ªæ ‡ç­¾ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªå±æ€§ï¼š</p>
<ul>
<li>typeï¼šç”¨äºæŒ‡å®šè¦æ³¨å…¥çš„æ•°æ®çš„æ•°æ®ç±»å‹ï¼Œè¯¥æ•°æ®ç±»å‹ä¹Ÿæ˜¯æ„é€ å‡½æ•°ä¸­æŸä¸ªæˆ–æŸäº›å‚æ•°çš„ç±»å‹</li>
<li>indexï¼šç”¨äºæŒ‡å®šè¦æ³¨å…¥çš„æ•°æ®åœ¨æ„é€ å‡½æ•°ä¸­å‚æ•°çš„ç´¢å¼•ï¼Œç´¢å¼•çš„ä½ç½®ä» 0 å¼€å§‹</li>
<li>nameï¼šç”¨äºæŒ‡å®šè¦æ³¨å…¥çš„æ•°æ®åœ¨æ„é€ å‡½æ•°ä¸­å‚æ•°çš„åç§°</li>
</ul>
<p>PSï¼šä»¥ä¸Šä¸‰ä¸ªå±æ€§ç”¨äºæŒ‡å®šç»™æ„é€ å‡½æ•°ä¸­å“ªä¸ªå‚æ•°è¿›è¡Œèµ‹å€¼ï¼Œä¸‹é¢ä¸¤ä¸ªæŒ‡çš„æ˜¯èµ‹ä»€ä¹ˆå€¼</p>
<ul>
<li>valueï¼šç”¨äºèµ‹å€¼åŸºæœ¬æ•°æ®ç±»å‹å’Œ <code>String</code> ç±»å‹çš„æ•°æ®</li>
<li>refï¼šç”¨äºèµ‹å€¼å…¶ä»– Bean ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¿…é¡»å¾—æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®è¿‡çš„ Bean</li>
</ul>
<p>ç‰¹ç‚¹ï¼šåœ¨è·å– Bean å¯¹è±¡æ—¶ï¼Œæ³¨å…¥çš„æ•°æ®æ˜¯å¿…é¡»çš„æ“ä½œï¼Œå¦åˆ™å¯¹è±¡æ— æ³•åˆ›å»ºæˆåŠŸã€‚</p>
<p>å¼Šç«¯ï¼šæ”¹å˜äº† Bean å¯¹è±¡çš„å®ä¾‹åŒ–æ–¹å¼ï¼Œä½¿æˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå¦‚æœç”¨ä¸åˆ°æŸäº›æ•°æ®æ—¶ï¼Œä¹Ÿå¿…é¡»æä¾›ï¼ˆæ³¨å…¥ï¼‰ã€‚</p>
<blockquote>
<p>set æ–¹æ³•æ³¨å…¥</p>
</blockquote>
<p>ä½¿ç”¨ set æ–¹æ³•æ³¨å…¥æ—¶ï¼Œè¦æ±‚è¢«æ³¨å…¥çš„å±æ€§å¿…é¡»æœ‰ set æ–¹æ³•ï¼Œset æ–¹æ³•çš„æ–¹æ³•åç”± set + å±æ€§é¦–å­—æ¯å¤§å†™ï¼Œå¦‚æœå±æ€§æ˜¯ <code>boolean</code> ç±»å‹å°±æ²¡æœ‰ set æ–¹æ³• , æ˜¯ isã€‚ï¼ˆå°½é‡ä½¿ç”¨ IDEA çš„è‡ªåŠ¨ç”Ÿæˆï¼Œè¿˜éœ€æ³¨æ„å‘½åè§„èŒƒï¼‰</p>
<p>ä½¿ç”¨ set æ–¹æ³•æ³¨å…¥æ—¶ï¼Œéœ€è¦åœ¨ <code>&lt;bean&gt;</code> æ ‡ç­¾å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªæ–°æ ‡ç­¾ <code>&lt;property&gt;</code>ã€‚</p>
<p>è¿™ä¸ªæ ‡ç­¾æœ‰ä»¥ä¸‹å‡ ä¸ªå±æ€§ï¼š</p>
<ul>
<li>nameï¼šç”¨äºæŒ‡å®šæ³¨å…¥æ—¶æ‰€è°ƒç”¨çš„ set æ–¹æ³•åç§°</li>
<li>valueï¼šç”¨äºèµ‹å€¼åŸºæœ¬æ•°æ®ç±»å‹å’Œ <code>String</code> ç±»å‹çš„æ•°æ®</li>
<li>refï¼šç”¨äºèµ‹å€¼å…¶ä»– Bean ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¿…é¡»å¾—æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®è¿‡çš„ Bean</li>
</ul>
<p>ç‰¹ç‚¹ï¼šåˆ›å»ºå¯¹è±¡æ—¶æ²¡æœ‰æ˜ç¡®çš„é™åˆ¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°ã€‚</p>
<p>å¼Šç«¯ï¼šå¦‚æœæœ‰æŸä¸ªæˆå‘˜å¿…é¡»æœ‰å€¼ï¼Œè·å–å¯¹è±¡çš„ set æ–¹æ³•å¯èƒ½æ²¡æœ‰æ‰§è¡Œï¼ˆå¯èƒ½æ²¡æœ‰ set æ–¹æ³•ï¼‰ã€‚</p>
<blockquote>
<p>æ³¨å…¥é›†åˆæ•°æ®</p>
</blockquote>
<p>å‡è®¾æˆ‘ä»¬ä¾æ—§é‡‡ç”¨ set æ–¹æ³•æ³¨å…¥é›†åˆæ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥åƒä¸‹é¢çš„ä»£ç ä¸€æ ·è¿›è¡Œæ•°æ®æ³¨å…¥ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¤æ‚ç±»å‹æ³¨å…¥--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.service.impl.AccountServiceImpl3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myStrs&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myList&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mySet&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;TestA&quot;</span> <span class="attr">value</span>=<span class="string">&quot;aaa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;TestB&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>BBB<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;myProps&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;TestC&quot;</span>&gt;</span>CCC<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;TestD&quot;</span>&gt;</span>DDD<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œç”¨äºç»™ List ç»“æ„é›†åˆæ³¨å…¥çš„æ ‡ç­¾æœ‰ <code>&lt;array&gt;</code>ã€<code>&lt;list&gt;</code>ã€<code>&lt;set&gt;</code>ï¼Œç”¨äºç»™ Map ç»“æ„é›†åˆæ³¨å…¥çš„æ ‡ç­¾æœ‰ <code>&lt;map&gt;</code> å’Œ <code>&lt;props&gt;</code>ï¼Œç»“æ„ç›¸åŒï¼Œæ ‡ç­¾å¯ä»¥äº’æ¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ³¨å…¥æ•°ç»„æ—¶ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨<code>&lt;array&gt;</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>&lt;list&gt;</code> å’Œ <code>&lt;set&gt;</code>ã€‚</p>
<p>PSï¼šæ³¨æ„ Set é›†åˆå†…çš„æ•°æ®æ˜¯æ— åºçš„ã€‚</p>
<h2 id="3-5-IoC-ç›¸å…³æ³¨è§£"><a class="header-anchor" href="#3-5-IoC-ç›¸å…³æ³¨è§£"></a>3.5 IoC ç›¸å…³æ³¨è§£</h2>
<p>è§ã€Spring æ³¨è§£ã€‘ä¸€æ–‡ã€‚</p>
<h2 id="3-6-æ•´åˆ-JUnit5"><a class="header-anchor" href="#3-6-æ•´åˆ-JUnit5"></a>3.6 æ•´åˆ JUnit5</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåº”ç”¨ç¨‹åºçš„å…¥å£æ˜¯ <code>main()</code> æ–¹æ³•ã€‚ä½†æ˜¯åœ¨ JUnit å•å…ƒæµ‹è¯•ä¸­ï¼Œæ²¡æœ‰ <code>main()</code> ä¹Ÿå¯ä»¥æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸º JUnit é›†æˆäº†ä¸€ä¸ª <code>main()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåˆ¤æ–­å½“å‰æµ‹è¯•ç±»ä¸­å“ªäº›æ–¹æ³•æœ‰ <code>@Test</code> æ³¨è§£ï¼ŒJUnit ä¼šè®©æœ‰ <code>@Test</code> æ³¨è§£çš„æ–¹æ³•æ‰§è¡Œã€‚</p>
<p>åŒæ—¶ï¼ŒJUnit ä¸ä¼šå…³å¿ƒæˆ‘ä»¬æ˜¯å¦ä½¿ç”¨äº†æŸä¸ªæ¡†æ¶ï¼ˆæ¯”å¦‚ Spring æ¡†æ¶ï¼‰ï¼Œåœ¨æ‰§è¡Œæµ‹è¯•æ–¹æ³•æ—¶ï¼ŒJUnit æ ¹æœ¬ä¸çŸ¥é“æˆ‘ä»¬æ˜¯å¦ä½¿ç”¨äº† Spring æ¡†æ¶ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šä¸ºæˆ‘ä»¬è¯»å–é…ç½®æ–‡ä»¶ / é…ç½®ç±»åˆ›å»º Spring æ ¸å¿ƒå®¹å™¨ã€‚</p>
<p>ç»¼ä¸Šå¯çŸ¥ï¼Œå½“æµ‹è¯•æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œæ˜¯æ²¡æœ‰ IoC å®¹å™¨çš„ã€‚å› æ­¤å°±ç®—å†™äº† <code>@Autowired</code> æ³¨è§£ï¼Œä¹Ÿæ˜¯æ— æ³•å®ç°æ³¨å…¥çš„ï¼ˆå®¹å™¨éƒ½æ²¡æœ‰ï¼Œæ³¨å…¥ä¸ª ğŸ”¨ï¼‰ã€‚</p>
<p>é‚£å’‹æï¼ŸSpring æ€ä¹ˆæ•´åˆ JUnit å‘¢ï¼Ÿ</p>
<blockquote>
<p>Spring æ•´åˆ JUnit çš„é…ç½®</p>
</blockquote>
<p>1ã€å¯¼å…¥ Spring æ•´åˆ JUnit çš„ä¾èµ–å’Œ JUnit5 çš„ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>ç‰ˆæœ¬å·ä¸å¯¼å…¥çš„ Spring ä¾èµ–ä¸€è‡´<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2ã€ä½¿ç”¨ JUnit5 æä¾›äº†ä¸€ä¸ªæ³¨è§£ <code>@ExtendWith</code> æŠŠåŸæœ‰çš„ <code>main()</code> æ–¹æ³•æ›¿æ¢æˆ Spring æä¾›çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceTest</span> &#123;&#125; <span class="comment">// æµ‹è¯•ç±»</span></span><br></pre></td></tr></table></figure>
<p>3ã€å‘ŠçŸ¥ Spring çš„è¿è¡Œå™¨ï¼ŒSpring å’Œ IoC åˆ›å»ºæ˜¯åŸºäº xml çš„è¿˜æ˜¯æ³¨è§£çš„ï¼Œå¹¶è¯´æ˜ä½ç½®</p>
<p>è¿™é‡Œéœ€è¦ç”¨åˆ°å¦å¤–ä¸€ä¸ªæ³¨è§£ <code>@ContextConfiguration</code>ã€‚</p>
<p>è¿™ä¸ªæ³¨è§£æœ‰ä¸¤ä¸ªä¸»è¦å±æ€§ï¼š</p>
<ul>
<li>locationsï¼šæŒ‡å®š xml æ–‡ä»¶çš„ä½ç½®ï¼ŒåŠ ä¸Š classpath å…³é”®å­—ï¼Œè¡¨ç¤ºåœ¨ç±»è·¯å¾„ä¸‹</li>
<li>classesï¼šæŒ‡å®šæ³¨è§£ç±»æ‰€åœ¨çš„ä½ç½®</li>
</ul>
<p><mark>æ³¨æ„ï¼š</mark> å½“ä½¿ç”¨ Spring 5.x ç‰ˆæœ¬æ—¶ï¼Œè¦æ±‚ JUnit çš„ç‰ˆæœ¬æ˜¯åœ¨ 4.12 åŠä»¥ä¸Šã€‚</p>
<p>æµ‹è¯•ç±»åŠéƒ¨åˆ†æµ‹è¯•æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨junitå•å…ƒæµ‹è¯•ï¼šæµ‹è¯•æˆ‘ä»¬çš„é…ç½®</span></span><br><span class="line"><span class="meta">@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:bean.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">IAccountService</span> <span class="variable">as</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindAll</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Account&gt; accounts = as.findAllAccount();</span><br><span class="line">        <span class="keyword">for</span> (Account account:accounts)&#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="4-åŠ¨æ€ä»£ç†"><a class="header-anchor" href="#4-åŠ¨æ€ä»£ç†"></a>4. åŠ¨æ€ä»£ç†</h1>
<p>åŠ¨æ€ä»£ç†çš„ç‰¹ç‚¹æ˜¯å­—èŠ‚ç ä½¿ç”¨çš„æ—¶å€™æ‰åˆ›å»ºï¼Œä½¿ç”¨çš„æ—¶å€™æ‰åŠ è½½ã€‚ä½¿ç”¨åŠ¨æ€ä»£ç†å¯ä»¥åœ¨ä¸ä¿®æ”¹æºç çš„åŸºç¡€ä¸Šå¯¹æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚</p>
<p>åŠ¨æ€ä»£ç†æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†</li>
<li>åŸºäºå­ç±»çš„åŠ¨æ€ä»£ç†</li>
</ul>
<h2 id="4-1-åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†"><a class="header-anchor" href="#4-1-åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†"></a>4.1 åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†</h2>
<p>æ¶‰åŠåˆ°çš„ç±»ï¼š<code>Proxy</code>ï¼Œæä¾›è€…ï¼šJDK å®˜æ–¹</p>
<p>é‚£ä¹ˆå¦‚ä½•åˆ›å»ºä»£ç†å¯¹è±¡ï¼Ÿä½¿ç”¨ <code>Proxy</code> ç±»çš„ <code>newProxyInstance()</code> æ–¹æ³•</p>
<p><mark>åˆ›å»ºä»£ç†å¯¹è±¡æœ‰ä»€ä¹ˆè¦æ±‚ï¼Ÿ</mark> è¢«ä»£ç†ç±»è‡³å°‘å®ç°ä¸€ä¸ªæ¥å£ï¼Œå¦åˆ™ä¸èƒ½ä½¿ç”¨</p>
<p><code>newProxyInstance()</code> æ–¹æ³•çš„å‚æ•°ï¼š</p>
<ul>
<li>ClassLoaderï¼šç±»åŠ è½½å™¨ï¼Œç”¨äºåŠ è½½ä»£ç†å¯¹è±¡çš„å­—èŠ‚ç ã€‚éœ€è¦å’Œè¢«ä»£ç†å¯¹è±¡ä½¿ç”¨ç›¸åŒçš„ç±»åŠ è½½å™¨ã€‚å›ºå®šå†™æ³•ã€‚</li>
<li>Class[]ï¼šå­—èŠ‚ç æ•°ç»„ï¼Œç”¨äºè®©ä»£ç†å¯¹è±¡å’Œè¢«ä»£ç†å¯¹è±¡æœ‰ç›¸åŒçš„æ–¹æ³•ã€‚å›ºå®šå†™æ³•ã€‚</li>
<li>InvocationHandlerï¼šç”¨äºæä¾›å¢å¼ºçš„ä»£ç ã€‚å®ƒæ˜¯è®©æˆ‘ä»¬å†™å¦‚ä½•ä»£ç†ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯å†™ä¸€ä¸ªè¯¥æ¥å£çš„å®ç°ç±»ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯åŒ¿åå†…éƒ¨ç±»ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ã€‚æ­¤æ¥å£çš„å®ç°ç±»éƒ½æ˜¯è°ç”¨è°å†™ã€‚</li>
</ul>
<blockquote>
<p>ä»£ç æµ‹è¯•</p>
</blockquote>
<p>æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸ªåœºæ™¯ï¼šç”Ÿäº§å‚å®¶ç”Ÿäº§ä¸œè¥¿ï¼Œå¹¶äº¤ç»™ç»é”€å•†å–å‡ºï¼Œæ¶ˆè´¹è€…ä»ç»é”€å•†å¤„è´­ä¹°å•†å“ã€‚ç»é”€å•†ä¹Ÿè¦åƒé¥­ï¼Œå› æ­¤ä»–è¦æ”¶å–å–å‡ºå•†å“å¾—åˆ°çš„é‡‘é¢çš„ 20% ä½œä¸ºåˆ©æ¶¦ï¼Œæœ€åç”Ÿäº§å‚å®¶åªèƒ½æ‹¿åˆ°å–å‡ºé‡‘é¢çš„ 80%ã€‚</p>
<p>å¯¹ç”Ÿäº§å‚å®¶è¦æ±‚çš„æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/20</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å¯¹ç”Ÿäº§å‚å®¶è¦æ±‚çš„æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IProducer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saleProduct</span><span class="params">(<span class="type">float</span> money)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">afterService</span><span class="params">(<span class="type">float</span> money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿäº§å‚å®¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/20</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§å‚å®¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">IProducer</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saleProduct</span><span class="params">(<span class="type">float</span> money)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é”€å”®å•†å“ï¼Œå¹¶æ‹¿åˆ°é’± &quot;</span> + money);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterService</span><span class="params">(<span class="type">float</span> money)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æä¾›å”®åæœåŠ¡ï¼Œå¹¶æ‹¿åˆ°é’± &quot;</span> + money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¨¡æ‹Ÿæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ§åˆ¶å°æ‰“å°ç”Ÿäº§å‚å®¶ä»ç»é”€å•†å¤„è·å–çš„é‡‘é¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/20</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æ¨¡æ‹Ÿä¸€ä¸ªæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">IProducer</span> <span class="variable">proxyProducer</span> <span class="operator">=</span> (IProducer) Proxy.newProxyInstance(producer.getClass().getClassLoader(),</span><br><span class="line">                producer.getClass().getInterfaces(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">                    <span class="comment">/**</span></span><br><span class="line"><span class="comment">                     * æ‰§è¡Œè¢«ä»£ç†å¯¹è±¡çš„ä»»ä½•æ¥å£æ–¹æ³•éƒ½ä¼šç»è¿‡è¯¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">                     * <span class="doctag">@param</span> proxy    ä»£ç†å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line"><span class="comment">                     * <span class="doctag">@param</span> method   å½“å‰æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">                     * <span class="doctag">@param</span> args     å½“å‰æ‰§è¡Œæ–¹æ³•æ‰€éœ€çš„å‚æ•°</span></span><br><span class="line"><span class="comment">                     * <span class="doctag">@return</span> å’Œè¢«ä»£ç†å¯¹è±¡æœ‰ç›¸åŒçš„è¿”å›å€¼</span></span><br><span class="line"><span class="comment">                     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">                     */</span></span><br><span class="line">                    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                        <span class="comment">// æä¾›å¢å¼ºçš„ä»£ç </span></span><br><span class="line">                        <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                        <span class="comment">// 1. è·å–æ–¹æ³•æ‰§è¡Œçš„å‚æ•°</span></span><br><span class="line">                        <span class="type">Float</span> <span class="variable">money</span> <span class="operator">=</span> (Float) args[<span class="number">0</span>];</span><br><span class="line">                        <span class="comment">// 2. åˆ¤æ–­å½“å‰æ–¹æ³•æ˜¯ä¸æ˜¯é”€å”®</span></span><br><span class="line">                        <span class="keyword">if</span> (<span class="string">&quot;saleProduct&quot;</span>.equals(method.getName())) &#123;</span><br><span class="line">                            returnValue = method.invoke(producer, money * <span class="number">0.8f</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> returnValue;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        proxyProducer.saleProduct(<span class="number">10000f</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ§åˆ¶å°è¾“å‡ºç»“æœï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C.png" alt="åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†è¾“å‡ºç»“æœ"></p>
<h2 id="4-2-åŸºäºå­ç±»çš„åŠ¨æ€ä»£ç†"><a class="header-anchor" href="#4-2-åŸºäºå­ç±»çš„åŠ¨æ€ä»£ç†"></a>4.2 åŸºäºå­ç±»çš„åŠ¨æ€ä»£ç†</h2>
<p>é€šè¿‡å‰æ–‡çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†æ˜¯å¦‚ä½•å®ç°çš„äº†ï¼Œä½†æ˜¯è¿™ç§åŠ¨æ€ä»£ç†çš„ç±»å¿…é¡»å®ç°ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœä¸å®ç°ä¸€ä¸ªæ¥å£å°±â‘§è¡Œã€‚</p>
<p>éš¾é“å°±å¿…é¡»å®ç°ä¸€ä¸ªæ¥å£æ‰èƒ½åŠ¨æ€ä»£ç†ï¼Œä¸ç„¶å°±ä¸è¡Œï¼Ÿå°±æ²¡æœ‰å…¶ä»–çš„æ–¹æ³•ï¼Ÿ</p>
<p>é‚£è‚¯å®šä¸æ˜¯ï¼è¿™å°±å¾—è¯´åˆ°åŸºäºå­ç±»çš„åŠ¨æ€ä»£ç†äº†ã€‚</p>
<p>åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†ä½¿ç”¨çš„éƒ½æ˜¯ JDK æä¾›çš„ç±»ï¼Œè¦æƒ³å®ç°åŸºäºå­ç±»çš„åŠ¨æ€ä»£ç†å°±éœ€è¦å¯¼å…¥ç¬¬ä¸‰æ–¹ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¶‰åŠåˆ°çš„ç±»ï¼š<code>Enhancer</code>ï¼Œæä¾›è€…ï¼šç¬¬ä¸‰æ–¹ <code>cglib</code> åº“</p>
<p>é‚£ä¹ˆå¦‚ä½•åˆ›å»ºä»£ç†å¯¹è±¡ï¼Ÿä½¿ç”¨ <code>Enhancer</code> ç±»çš„ <code>create()</code> æ–¹æ³•</p>
<p><mark>åˆ›å»ºä»£ç†å¯¹è±¡æœ‰ä»€ä¹ˆè¦æ±‚ï¼Ÿ</mark> è¢«ä»£ç†ç±»ä¸èƒ½æ˜¯æœ€ç»ˆç±»ï¼ˆè¢« <code>final</code> ä¿®é¥°çš„ç±»ï¼Œè¢« <code>final</code> ä¿®é¥°çš„ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼‰</p>
<p><code>create()</code> æ–¹æ³•çš„å‚æ•°ï¼š</p>
<ul>
<li>Classï¼šå­—èŠ‚ç ã€‚ç”¨äºæŒ‡å®šè¢«ä»£ç†å¯¹è±¡çš„å­—èŠ‚ç ã€‚</li>
<li>Callbackï¼šç”¨äºæä¾›å¢å¼ºçš„ä»£ç ã€‚æˆ‘ä»¬ä¸€èˆ¬å†™çš„éƒ½æ˜¯ <code>Callback</code> çš„å­æ¥å£å®ç°ç±»ï¼š<code>MethodInterceptor</code></li>
</ul>
<blockquote>
<p>ä»£ç æµ‹è¯•</p>
</blockquote>
<p>å’ŒåŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†æ¨¡æ‹Ÿçš„åœºæ™¯ä¸€æ ·ï¼Œé‚£ä¹ˆåˆ™æœ‰ï¼š</p>
<p>ç”Ÿäº§å‚å®¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/20</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ç”Ÿäº§å‚å®¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saleProduct</span><span class="params">(<span class="type">float</span> money)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é”€å”®å•†å“ï¼Œå¹¶æ‹¿åˆ°é’± &quot;</span> + money);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterService</span><span class="params">(<span class="type">float</span> money)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æä¾›å”®åæœåŠ¡ï¼Œå¹¶æ‹¿åˆ°é’± &quot;</span> + money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¨¡æ‹Ÿæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ§åˆ¶å°æ‰“å°ç”Ÿäº§å‚å®¶ä»ç»é”€å•†å¤„è·å–çš„é‡‘é¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/20</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * æ¨¡æ‹Ÿä¸€ä¸ªæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Producer</span> <span class="variable">cglibProducer</span> <span class="operator">=</span> (Producer)Enhancer.create(producer.getClass(), <span class="keyword">new</span> <span class="title class_">MethodInterceptor</span>() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * æ‰§è¡Œè¢«ä»£ç†å¯¹è±¡çš„ä»»ä½•æ–¹æ³•éƒ½ä¼šç»è¿‡è¯¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> o ä»£ç†å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> method å½“å‰æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> objects å½“å‰æ‰§è¡Œæ–¹æ³•æ‰€éœ€çš„å‚æ•°</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> methodProxy å½“å‰æ‰§è¡Œæ–¹æ³•çš„ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> å’Œè¢«ä»£ç†å¯¹è±¡æœ‰ç›¸åŒçš„è¿”å›å€¼</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="comment">// æä¾›å¢å¼ºçš„ä»£ç </span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="comment">// 1. è·å–æ–¹æ³•æ‰§è¡Œçš„å‚æ•°</span></span><br><span class="line">                <span class="type">Float</span> <span class="variable">money</span> <span class="operator">=</span> (Float) objects[<span class="number">0</span>];</span><br><span class="line">                <span class="comment">// 2. åˆ¤æ–­å½“å‰æ–¹æ³•æ˜¯ä¸æ˜¯é”€å”®</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;saleProduct&quot;</span>.equals(method.getName())) &#123;</span><br><span class="line">                    returnValue = method.invoke(producer, money * <span class="number">0.8f</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> returnValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        cglibProducer.saleProduct(<span class="number">10000f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ§åˆ¶å°è¾“å‡ºç»“æœï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C.png" alt="åŸºäºå­ç±»çš„åŠ¨æ€ä»£ç†è¾“å‡ºç»“æœ"></p>
<h1 id="5-Spring-ä¸-AOP"><a class="header-anchor" href="#5-Spring-ä¸-AOP"></a>5. Spring ä¸ AOP</h1>
<h2 id="5-1-AOP-æ¦‚è¿°"><a class="header-anchor" href="#5-1-AOP-æ¦‚è¿°"></a>5.1 AOP æ¦‚è¿°</h2>
<blockquote>
<p>ä»€ä¹ˆæ˜¯ AOP</p>
</blockquote>
<p>AOPï¼šå…¨ç§°æ˜¯ Aspect Oriented Programmingï¼Œå³ï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p>
<p>ç™¾åº¦ç™¾ç§‘æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E7%99%BE%E5%BA%A6%E7%99%BE%E7%A7%91AOP.png" alt="ç™¾åº¦ç™¾ç§‘AOP"></p>
<p>ç®€å•çš„è¯´ï¼Œå°±æ˜¯æŠŠæˆ‘ä»¬ç¨‹åºä¸­é‡å¤çš„ä»£ç æŠ½å–å‡ºæ¥ï¼Œåœ¨éœ€è¦æ‰§è¡Œçš„æ—¶å€™ï¼Œä½¿ç”¨åŠ¨æ€ä»£ç†çš„æŠ€æœ¯ï¼Œåœ¨ä¸ä¿®æ”¹æºç çš„<br>
åŸºç¡€ä¸Šï¼Œå¯¹æˆ‘ä»¬çš„å·²æœ‰æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚</p>
<blockquote>
<p>AOP çš„ä½œç”¨å’Œä¼˜åŠ¿</p>
</blockquote>
<p>ä½œç”¨ï¼šåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œä¸ä¿®æ”¹æºç å¯¹å·²æœ‰æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚</p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å‡å°‘é‡å¤ä»£ç </li>
<li>æé«˜å¼€å‘æ•ˆç‡</li>
<li>ç»´æŠ¤æ–¹ä¾¿</li>
</ul>
<blockquote>
<p>AOP çš„å®ç°æ–¹å¼</p>
</blockquote>
<p>ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯ã€‚å‰æ–‡è¯´äº†ï¼ŒåŠ¨æ€ä»£ç†åˆ†ä¸ºåŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†å’ŒåŸºäºå­ç±»çš„åŠ¨æ€ä»£ç†ï¼Œé‚£ä¹ˆ Spring æ˜¯å¦‚ä½•é€‰æ‹©çš„å‘¢ï¼Ÿ</p>
<p>åœ¨ Spring ä¸­ï¼Œæ¡†æ¶ä¼šæ ¹æ®ç›®æ ‡ç±» <strong>æ˜¯å¦å®ç°äº†æ¥å£</strong> æ¥å†³å®šé‡‡ç”¨å“ªç§åŠ¨æ€ä»£ç†çš„æ–¹å¼ã€‚</p>
<h2 id="5-2-AOP-ç›¸å…³æ¦‚å¿µ"><a class="header-anchor" href="#5-2-AOP-ç›¸å…³æ¦‚å¿µ"></a>5.2 AOP ç›¸å…³æ¦‚å¿µ</h2>
<p><strong>Joinpointï¼ˆè¿æ¥ç‚¹ï¼‰ï¼š</strong> æ‰€è°“è¿æ¥ç‚¹æ˜¯æŒ‡é‚£äº›è¢«æ‹¦æˆªåˆ°çš„ç‚¹ã€‚åœ¨ Spring ä¸­ï¼Œè¿™äº›ç‚¹æŒ‡çš„å°±æ˜¯æ–¹æ³•ï¼Œå› ä¸º Spring åªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ã€‚</p>
<p><strong>Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰ï¼š</strong> æ‰€è°“åˆ‡å…¥ç‚¹æ˜¯æŒ‡æˆ‘ä»¬è¦å¯¹å“ªäº› Joinpoint è¿›è¡Œæ‹¦æˆªçš„å®šä¹‰ã€‚</p>
<p>æ¥å£ä¸­æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯è¿æ¥ç‚¹ï¼Œä½†åªæœ‰çœŸæ­£è¢«å¢å¼ºäº†çš„æ–¹æ³•æ˜¯åˆ‡å…¥ç‚¹ã€‚æ‰€æœ‰åˆ‡å…¥ç‚¹éƒ½æ˜¯è¿æ¥ç‚¹ï¼Œä½†è¿æ¥ç‚¹ä¸ä¸€å®šæ˜¯åˆ‡å…¥ç‚¹ã€‚</p>
<p><strong>Adviceï¼ˆé€šçŸ¥ / å¢å¼ºï¼‰ï¼š</strong> æ‰€è°“é€šçŸ¥æ˜¯æŒ‡æ‹¦æˆªåˆ° Joinpoint ä¹‹åæ‰€è¦åšçš„äº‹æƒ…å°±æ˜¯é€šçŸ¥ã€‚ é€šçŸ¥çš„ç±»å‹ï¼šå‰ç½®é€šçŸ¥ã€åç½®é€šçŸ¥ã€å¼‚å¸¸é€šçŸ¥ã€æœ€ç»ˆé€šçŸ¥ã€ç¯ç»•é€šçŸ¥ã€‚ å¯ä»¥é€šè¿‡ä¸‹é¢è¿™å¼ åŠ¨æ€ä»£ç†çš„å›¾ç¤ºæ¥è§£é‡Šï¼š</p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/é€šçŸ¥çš„ç±»å‹.jpg" alt="é€šçŸ¥çš„ç±»å‹" style="zoom:67%;" />
<p><strong>Introductionï¼ˆå¼•ä»‹ï¼‰ï¼š</strong> å¼•ä»‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„é€šçŸ¥ã€‚åœ¨ä¸ä¿®æ”¹ç±»ä»£ç çš„å‰æä¸‹ï¼ŒIntroduction å¯ä»¥åœ¨è¿è¡ŒæœŸä¸ºç±»åŠ¨æ€åœ°æ·»åŠ ä¸€äº›æ–¹æ³•æˆ– Fieldã€‚</p>
<p><strong>Targetï¼ˆç›®æ ‡å¯¹è±¡ï¼‰ï¼š</strong> ä»£ç†çš„ç›®æ ‡å¯¹è±¡ã€‚</p>
<p><strong>Weavingï¼ˆç»‡å…¥ï¼‰ï¼š</strong> ç»‡å…¥æ˜¯æŒ‡æŠŠå¢å¼ºåº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚ Spring é‡‡ç”¨åŠ¨æ€ä»£ç†ç»‡å…¥ï¼Œè€Œ AspectJ é‡‡ç”¨ç¼–è¯‘æœŸç»‡å…¥å’Œç±»è£…è½½æœŸç»‡å…¥ã€‚</p>
<p><strong>Proxyï¼ˆä»£ç†ï¼‰ï¼š</strong> ä¸€ä¸ªç±»è¢« AOP ç»‡å…¥å¢å¼ºåï¼Œå°±äº§ç”Ÿä¸€ä¸ªç»“æœä»£ç†ç±»ã€‚</p>
<p><strong>Aspectï¼ˆåˆ‡é¢ï¼‰ï¼š</strong> åˆ‡å…¥ç‚¹å’Œé€šçŸ¥ï¼ˆå¼•ä»‹ï¼‰çš„ç»“åˆã€‚</p>
<blockquote>
<p>éœ€è¦æ˜ç¡®çš„äº‹</p>
</blockquote>
<p>å¼€å‘é˜¶æ®µï¼š</p>
<p>1ã€ç¼–å†™æ ¸å¿ƒä¸šåŠ¡ä»£ç ï¼ˆå¼€å‘ä¸»çº¿ï¼‰</p>
<p>2ã€æŠŠå…¬ç”¨ä»£ç æŠ½å–å‡ºæ¥ï¼Œåˆ¶ä½œæˆé€šçŸ¥ã€‚</p>
<p>3ã€åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå£°æ˜åˆ‡å…¥ç‚¹ä¸é€šçŸ¥é—´çš„å…³ç³»ï¼Œå³åˆ‡é¢ã€‚</p>
<p>è¿è¡Œé˜¶æ®µï¼ˆSpringæ¡†æ¶å®Œæˆçš„ï¼‰ ï¼š</p>
<p>Spring æ¡†æ¶ç›‘æ§åˆ‡å…¥ç‚¹æ–¹æ³•çš„æ‰§è¡Œã€‚ä¸€æ—¦ç›‘æ§åˆ°åˆ‡å…¥ç‚¹æ–¹æ³•è¢«è¿è¡Œï¼Œä½¿ç”¨ä»£ç†æœºåˆ¶ï¼ŒåŠ¨æ€åˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œæ ¹æ®é€šçŸ¥ç±»åˆ«ï¼Œåœ¨ä»£ç†å¯¹è±¡çš„å¯¹åº”ä½ç½®ï¼Œå°†é€šçŸ¥å¯¹åº”çš„åŠŸèƒ½ç»‡å…¥ï¼Œå®Œæˆå®Œæ•´çš„ä»£ç é€»è¾‘è¿è¡Œã€‚</p>
<h2 id="5-3-åŸºäº-XML-é…ç½®çš„-AOP"><a class="header-anchor" href="#5-3-åŸºäº-XML-é…ç½®çš„-AOP"></a>5.3 åŸºäº XML é…ç½®çš„ AOP</h2>
<p>æ­å»ºä¸€ä¸ªç®€å•çš„ç¯å¢ƒè¿›è¡Œæµ‹è¯•åŸºäº XML é…ç½®çš„ AOPã€‚</p>
<p>å¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>service æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿä¿å­˜è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿæ›´æ–°è´¦æˆ·</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateAccount</span><span class="params">(<span class="type">int</span> i)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿåˆ é™¤è´¦æˆ·</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteAccount</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>service å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†ä¿å­˜&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAccount</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†æ›´æ–° &quot;</span> + i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteAccount</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†åˆ é™¤&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ—¥å¿—ç±»ï¼Œè¿™ä¸ªç±»ç”¨äºæ‰“å°æ—¥å¿—ï¼Œæ¯æ¬¡æ‰§è¡Œä¸šåŠ¡å±‚çš„æ–¹æ³•å°±æ‰“å°æ—¥å¿—ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/21</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ç”¨äºè®°å½•æ—¥å¿—çš„å·¥å…·ç±»ï¼Œå®ƒé‡Œé¢æä¾›äº†å…¬å…±çš„ä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨äºæ‰“å°æ—¥å¿—ï¼Œè®¡åˆ’è®©å…¶åœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œï¼ˆåˆ‡å…¥ç‚¹æ–¹æ³•å°±æ˜¯ä¸šåŠ¡å±‚æ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printLog</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Loggerç±»ä¸­çš„printLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é…ç½®æ–‡ä»¶å†…å®¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®Springçš„IoCå®¹å™¨ï¼Œå°†Serviceå¯¹è±¡é…ç½®è¿›å»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.service.impl.AccountServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Springä¸­åŸºäºxmlçš„AOPé…ç½®æ­¥éª¤--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®Loggerç±»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;logger&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.util.Logger&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®AOP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é…ç½®åˆ‡é¢--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;logAdvice&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;logger&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®é€šçŸ¥çš„ç±»å‹ï¼Œå¹¶å»ºç«‹é€šçŸ¥æ–¹æ³•å’Œåˆ‡å…¥ç‚¹æ–¹æ³•çš„å…³è”--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;printLog&quot;</span> </span></span><br><span class="line"><span class="tag">                        <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.yang.service.impl.*.*(..))&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AOPTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å®¹å™¨</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–å¯¹è±¡</span></span><br><span class="line">        <span class="type">AccountService</span> <span class="variable">as</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;accountService&quot;</span>, AccountService.class);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        as.saveAccount();</span><br><span class="line">        as.updateAccount(<span class="number">666</span>);</span><br><span class="line">        as.deleteAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•ç±»åçš„æ‰“å°ç»“æœï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E5%9F%BA%E4%BA%8Exml%E9%85%8D%E7%BD%AE%E7%9A%84AOP%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B.png" alt="åŸºäºxmlé…ç½®çš„AOPå…¥é—¨æ¡ˆä¾‹"></p>
<p>æ ¹æ®ä¸Šå›¾çš„æ•°æ®ç»“æœå¯ä»¥çœ‹åˆ°ï¼šæ¯æ¬¡æ‰§è¡Œä¸šåŠ¡å±‚çš„æ–¹æ³•éƒ½ç›¸åº”åœ°æ‰“å°å‡ºäº†æ—¥å¿—ï¼Œæˆ‘ä»¬çš„å…¥é—¨æ¡ˆä¾‹ä¹Ÿå°±æˆåŠŸäº†ã€‚</p>
<blockquote>
<p>æ€»ç»“</p>
</blockquote>
<p>å…¥é—¨æ¡ˆä¾‹å·²ç»æˆåŠŸï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹æµç¨‹ï¼š</p>
<p>1ã€é¦–å…ˆæ˜¯ç¼–å†™æ™®é€šçš„ä¸šåŠ¡ä»£ç ï¼Œç„¶åæ ¹æ®éœ€è¦ç¼–å†™éœ€è¦åˆ‡å…¥çš„æ–¹æ³•</p>
<p>2ã€ç¼–å†™ç›¸åº”çš„ Spring é…ç½®æ–‡ä»¶ï¼š</p>
<ul>
<li>é…ç½® Spring çš„ IoC å®¹å™¨ï¼Œå°† Service å¯¹è±¡é…ç½®è¿›å»</li>
<li>æŠŠé€šçŸ¥çš„ Bean ä¹Ÿäº¤ç»™ Spring ç®¡ç†</li>
<li>ä½¿ç”¨ <code>&lt;aop:config&gt;</code> æ ‡ç­¾è¡¨æ˜å¼€å§‹ AOP çš„é…ç½®</li>
<li>ä½¿ç”¨ <code>&lt;aop:aspect&gt;</code> æ ‡ç­¾è¡¨æ˜é…ç½®åˆ‡é¢</li>
<li>åœ¨ <code>&lt;aop:aspect&gt;</code> å†…éƒ¨ä½¿ç”¨å¯¹åº”çš„æ ‡ç­¾æ¥é…ç½®é€šçŸ¥çš„ç±»å‹ï¼Œå»ºç«‹é€šçŸ¥æ–¹æ³•å’Œåˆ‡å…¥ç‚¹æ–¹æ³•çš„è”ç³»</li>
</ul>
<p>3ã€ç¼–å†™æµ‹è¯•æ–¹æ³•è¿›è¡Œæµ‹è¯•</p>
<blockquote>
<p>æ¶‰åŠçš„æ ‡ç­¾</p>
</blockquote>
<p><code>&lt;aop:config&gt;</code> æ ‡ç­¾ï¼šè¡¨æ˜å¼€å§‹ AOP çš„é…ç½®</p>
<p><code>&lt;aop:aspect&gt;</code> æ ‡ç­¾ï¼šè¡¨æ˜é…ç½®åˆ‡é¢ã€‚è¿™ä¸ªæ ‡ç­¾å†…æœ‰ä¸¤ä¸ªå±æ€§ï¼š</p>
<ul>
<li>id å±æ€§ï¼šç»™åˆ‡é¢æä¾›ä¸€ä¸ªå”¯ä¸€çš„æ ‡å¿—</li>
<li>ref å±æ€§ï¼šæŒ‡å®šé€šçŸ¥ç±»çš„ bean çš„ id</li>
</ul>
<p><code>&lt;aop:before&gt;</code> æ ‡ç­¾ï¼šè¯¥æ ‡ç­¾æ˜¯ <code>&lt;aop:aspect&gt;</code> æ ‡ç­¾å†…éƒ¨çš„æ ‡ç­¾ï¼Œç”¨äºé…ç½®é€šçŸ¥çš„ç±»å‹ã€‚åœ¨ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬è®¡åˆ’è®© <code>printLog()</code> æ–¹æ³•åœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œï¼Œå› æ­¤æ˜¯å‰ç½®é€šçŸ¥ï¼Œä½¿ç”¨ <code>&lt;aop:before&gt;</code> æ ‡ç­¾ã€‚è¿™ä¸ªæ ‡ç­¾ä¸‹æœ‰ä¸¤ä¸ªä¸»è¦å±æ€§ï¼š</p>
<ul>
<li>method å±æ€§ï¼šç”¨äºæŒ‡å®š Logger ç±»ä¸­å“ªä¸ªæ–¹æ³•æ˜¯å‰ç½®é€šçŸ¥</li>
<li>pointcut å±æ€§ï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚è¯¥è¡¨è¾¾å¼çš„å«ä¹‰æŒ‡çš„æ˜¯å¯¹ä¸šåŠ¡å±‚ä¸­å“ªäº›æ–¹æ³•å¢å¼º</li>
</ul>
<p>è¿™é‡Œå°±æ¶‰åŠåˆ° <strong>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</strong> çš„å†™æ³•ï¼Œéœ€è¦ç»†è¯´ä¸€æ‰‹ ~</p>
<h2 id="5-4-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼"><a class="header-anchor" href="#5-4-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼"></a>5.4 åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</h2>
<p>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å†™æ³•æ˜¯ï¼š<code>execution(è¡¨è¾¾å¼)</code>ï¼Œéœ€è¦ä½¿ç”¨åˆ° <code>execution</code> å…³é”®å­—ï¼Œä½†è¿™å¹¶ä¸æ˜¯é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯è¿™ä¸ªå…³é”®å­—åæ‹¬å·åŒ…è£¹çš„è¡¨è¾¾å¼åº”è¯¥æ€ä¹ˆå†™ã€‚</p>
<p><mark>æ³¨æ„ï¼š</mark> <code>execution</code> å…³é”®å­—ä¸æ˜¯æœ¬èŠ‚çš„é‡ç‚¹ï¼Œå®é™…æ“ä½œä¸­åƒä¸‡åˆ«å¿˜è®°ä¹¦å†™äº†ï¼</p>
<p>è¡¨è¾¾å¼çš„æ ‡å‡†å†™æ³•æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è®¿é—®ä¿®é¥°ç¬¦ è¿”å›å€¼ åŒ…å.åŒ…å.åŒ…å...ç±»å.æ–¹æ³•å(å‚æ•°åˆ—è¡¨)</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®ä»¥ä¸Šå†™æ³•ï¼Œåœ¨ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦å¯¹ <code>saveAccount()</code> æ–¹æ³•æ·»åŠ å‰ç½®é€šçŸ¥ï¼Œé‚£ä¹ˆåˆ™æœ‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void com.yang.service.impl.AccountServiceImpl.saveAccount()</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯æ ‡å‡†è¡¨è¾¾å¼çš„å†™æ³•ï¼Œä½†æ˜¯è¿™ç§å†™æ³•åªèƒ½é’ˆå¯¹å•ä¸€çš„æ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œå®é™…æƒ…å†µä¸‹è‚¯å®šä¸å¯èƒ½åªé’ˆå¯¹ä¸€ä¸ªæ–¹æ³•è¿›è¡Œå¢å¼ºã€‚åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¿˜æœ‰ä»¥ä¸‹ç®€æ´å†™æ³•ï¼š</p>
<p>1ã€è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ <strong>çœç•¥</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void com.yang.service.impl.AccountServiceImpl.saveAccount()</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¿®æ”¹åï¼Œè¿˜æ˜¯åªèƒ½å¯¹ <code>saveAccount()</code> æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚</p>
<p>2ã€è¿”å›å€¼å¯ä»¥ä½¿ç”¨é€šé…ç¬¦è¡¨ç¤ºä»»æ„è¿”å›å€¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* com.yang.service.impl.AccountServiceImpl.saveAccount()</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶ä¸šåŠ¡å±‚æœ‰ä¸¤ç§è¿”å›å€¼ç±»å‹ï¼Œ<code>void</code> å’Œ <code>int</code>ï¼Œä½†æ˜¯ç”±äºæ˜ç¡®æŒ‡å®šäº†æ–¹æ³•ï¼Œä¾æ—§åªèƒ½å¯¹ <code>saveAccount()</code> æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚</p>
<p>3ã€åŒ…åå¯ä»¥ä½¿ç”¨é€šé…ç¬¦è¡¨ç¤ºä»»æ„åŒ…ï¼Œä½†æ˜¯æœ‰å‡ çº§åŒ…å°±éœ€è¦å†™å‡ ä¸ª <code>*</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* *.*.*.*.AccountServiceImpl.saveAccount()</span><br></pre></td></tr></table></figure>
<p>åŒæ ·ï¼Œä¾æ—§åªèƒ½å¯¹ <code>saveAccount()</code> æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚ä½†å¦‚æœåŒ…æœ‰å¾ˆå¤šï¼Œå²‚ä¸æ˜¯è¦å†™å¾ˆå¤šé€šé…ç¬¦ï¼Ÿ</p>
<p>4ã€åŒ…åå¯ä»¥ä½¿ç”¨ <code>..</code> è¡¨ç¤ºå½“å‰åŒ…åŠå…¶å­åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* *..AccountServiceImpl.saveAccount()</span><br></pre></td></tr></table></figure>
<p>ç”±äºæ–¹æ³•åè¿˜æ˜¯æ²¡æ”¹å˜ï¼Œè¿˜æ˜¯åªèƒ½å¯¹ <code>saveAccount()</code> æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚</p>
<p>5ã€ç±»åå’Œæ–¹æ³•åéƒ½å¯ä»¥ä½¿ç”¨ <code>*</code> æ¥å®ç°é€šé…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* *..*.*()</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸‹å°±ä¸ä¸€æ ·äº†ï¼Œç”±äºä¸šåŠ¡å±‚ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•éƒ½æ²¡æœ‰å‚æ•°ï¼Œå› æ­¤ä¼šå¯¹ <code>saveAccount()</code> å’Œ <code>deleteAccount()</code> è¿™ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œå¢å¼ºã€‚</p>
<p>6ã€å¯¹åº”æ–¹æ³•çš„å‚æ•°åˆ—è¡¨æ¥è¯´ï¼š</p>
<ul>
<li>å¯ä»¥ç›´æ¥å†™æ•°æ®ç±»å‹ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ç›´æ¥å†™åç§°ï¼Œå¼•ç”¨ç±»å‹å†™<code>åŒ…å.ç±»å</code>çš„æ–¹å¼</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* *..*.*(int)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¹¦å†™åï¼Œä¸šåŠ¡å±‚åªæœ‰ <code>updateAccount(int i)</code> æ–¹æ³•æœ‰ <code>int</code> ç±»å‹çš„å‚æ•°ï¼Œå› æ­¤åªæœ‰å®ƒè¢«å¢å¼ºã€‚</p>
<p>å¯ä»¥åœ¨ <code>()</code> å†…æŒ‡å®šåŒ¹é…æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œå¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œ <code>java.lang</code> åŒ…ä¸‹çš„ç±»å‹å¯ä»¥ä¸ç”¨ä¹¦å†™å…¨ç±»åï¼Œå¦åˆ™éœ€è¦ä¹¦å†™å…¨ç±»åã€‚</p>
<ul>
<li>ç±»å‹å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ <code>*</code> è¡¨ç¤ºä»»æ„ç±»å‹ï¼Œä½† <mark>å¿…é¡»æœ‰å‚æ•°</mark></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* *..*.*(*)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¹¦å†™åï¼Œä¸šåŠ¡å±‚åªæœ‰ <code>updateAccount(int i)</code> æ–¹æ³•æœ‰å‚æ•°ï¼Œå› æ­¤åªæœ‰å®ƒè¢«å¢å¼ºã€‚</p>
<ul>
<li>å¯ä»¥ä½¿ç”¨ <code>..</code> è¡¨ç¤ºæœ‰æ— å‚æ•°å‡å¯ï¼Œæœ‰å‚æ•°å¯ä»¥æ˜¯ä»»æ„ç±»å‹</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* *..*.*(..)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„ä¹¦å†™å±äºå…¨é€šé…ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½ä¼šè¢«å¢å¼ºã€‚</p>
<p>æœ€ç»ˆå¯å¾—å…¨é€šé…å†™æ³•ï¼š<code>* *..*.*(..)</code></p>
<p>è¿™è¡¨ç¤ºä»»æ„åŒ…ä¸‹çš„ä»»æ„ç±»ä¸­ä»»æ„æ–¹æ³•éƒ½ä¼šè¢«å¢å¼ºã€‚</p>
<p>ä½†æ˜¯å®é™…å¼€å‘ä¸­ä¸€èˆ¬ä¸ä¼šä½¿ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å…¨é€šé…å†™æ³•ï¼Œæˆ‘ä»¬ä¼šåˆ‡åˆ°ä¸šåŠ¡å±‚å®ç°ç±»ä¸‹çš„æ‰€æœ‰æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* com.yang.service.impl.*.*(..)</span><br></pre></td></tr></table></figure>
<p>è¡¨æ˜ com åŒ…ä¸‹ yang åŒ…ä¸‹ service åŒ…ä¸‹ impl åŒ…ä¸‹æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•ï¼ˆæ— è®ºæ˜¯å¦æœ‰å‚ï¼‰éƒ½ä¼šè¢«å¢å¼ºã€‚</p>
<p>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å¯ä»¥è¿™æ ·ç®€æ´åœ°ä¹¦å†™ï¼Œå°±æ˜¯å› ä¸ºæˆ‘ä»¬å¯¼å…¥äº†ä»¥ä¸‹ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="5-5-å¸¸è§å››ç§é€šçŸ¥ç±»å‹"><a class="header-anchor" href="#5-5-å¸¸è§å››ç§é€šçŸ¥ç±»å‹"></a>5.5 å¸¸è§å››ç§é€šçŸ¥ç±»å‹</h2>
<p>æˆ‘ä»¬å¯¹åŸºäº XML é…ç½®çš„ AOP æ¡ˆä¾‹ä¸­çš„ä»£ç è¿›è¡Œéƒ¨åˆ†ä¿®æ”¹ï¼Œservice åŒ…ä¸‹çš„ <code>AccountService</code> æ¥å£å’Œ  <code>AccountServiceImpl</code> å®ç°ç±»ä¸åšä»»ä½•æ”¹å˜ã€‚</p>
<p>åœ¨ <code>Logger</code> ç±»ä¸­æ·»åŠ å¦å¤–ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="comment">// å‰ç½®é€šçŸ¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforePrintLog</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰ç½®é€šçŸ¥Loggerç±»ä¸­çš„beforePrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åç½®é€šçŸ¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturningPrintLog</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åç½®é€šçŸ¥Loggerç±»ä¸­çš„afterReturningPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼‚å¸¸é€šçŸ¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowingPrintLog</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼‚å¸¸é€šçŸ¥Loggerç±»ä¸­çš„afterThrowingPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€ç»ˆé€šçŸ¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPrintLog</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ€ç»ˆé€šçŸ¥Loggerç±»ä¸­çš„afterPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ Spring é…ç½®æ–‡ä»¶ï¼Œå¢åŠ ä¸‰ç§é€šçŸ¥çš„é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®Springçš„IoCå®¹å™¨ï¼Œå°†Serviceå¯¹è±¡é…ç½®è¿›å»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.service.impl.AccountServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®Loggerç±»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;logger&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.util.Logger&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®AOP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é…ç½®åˆ‡é¢--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;logAdvice&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;logger&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®å‰ç½®é€šçŸ¥ï¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beforePrintLog&quot;</span> </span></span><br><span class="line"><span class="tag">                        <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.yang.service.impl.*.*(..))&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®åç½®é€šçŸ¥ï¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ­£å¸¸æ‰§è¡Œä¹‹åæ‰§è¡Œï¼Œå®ƒå’Œå¼‚å¸¸é€šçŸ¥æ°¸è¿œåªä¼šæ‰§è¡Œä¸€ä¸ª--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturningPrintLog&quot;</span> </span></span><br><span class="line"><span class="tag">                                 <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.yang.service.impl.*.*(..))&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®å¼‚å¸¸é€šçŸ¥ï¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•äº§ç”Ÿå¼‚å¸¸ä¹‹åæ‰§è¡Œï¼Œå®ƒå’Œåç½®é€šçŸ¥æ°¸è¿œåªä¼šæ‰§è¡Œä¸€ä¸ª--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowingPrintLog&quot;</span> </span></span><br><span class="line"><span class="tag">                                <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.yang.service.impl.*.*(..))&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®æœ€ç»ˆé€šçŸ¥ï¼šæ— è®ºåˆ‡å…¥ç‚¹æ–¹æ³•æ˜¯å¦æ­£å¸¸æ‰§è¡Œå®ƒéƒ½ä¼šåœ¨å…¶åé¢æ‰§è¡Œ--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;afterPrintLog&quot;</span> </span></span><br><span class="line"><span class="tag">                       <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.yang.service.impl.*.*(..))&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AOPTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å®¹å™¨</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–å¯¹è±¡</span></span><br><span class="line">        <span class="type">AccountService</span> <span class="variable">as</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;accountService&quot;</span>, AccountService.class);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        as.saveAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•ç±»ä¸­çš„æµ‹è¯•æ–¹æ³•ï¼Œæ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E5%9B%9B%E7%A7%8D%E9%80%9A%E7%9F%A5%E7%B1%BB%E5%9E%8B%E8%BE%93%E5%87%BA_1.png" alt="å››ç§é€šçŸ¥ç±»å‹è¾“å‡º_1"></p>
<p>ä¸æ˜¯é…ç½®äº†å››ç§é€šçŸ¥å—ï¼Ÿæ€ä¹ˆåªæœ‰ä¸‰ç§è¾“å‡ºï¼Ÿ</p>
<p>ä¿®æ”¹  <code>AccountServiceImpl</code> å®ç°ç±»ä¸­çš„ <code>saveAccount()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ‰§è¡Œäº†ä¿å­˜&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡è¿è¡Œæµ‹è¯•ç±»çš„æµ‹è¯•æ–¹æ³•ï¼Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E5%9B%9B%E7%A7%8D%E9%80%9A%E7%9F%A5%E7%B1%BB%E5%9E%8B%E8%BE%93%E5%87%BA_2.png" alt="å››ç§é€šçŸ¥ç±»å‹è¾“å‡º_2"></p>
<p>ä»£ç è¿è¡Œå‡ºç°å¼‚å¸¸ï¼Œå¼‚å¸¸é€šçŸ¥æˆåŠŸè¾“å‡ºï¼Œä½†æ˜¯åç½®é€šçŸ¥æ¶ˆå¤±ä¸è§ã€‚</p>
<blockquote>
<p>æ€»ç»“</p>
</blockquote>
<p>å¸¸è§å››ç§é€šçŸ¥ç±»å‹åˆ†åˆ«æ˜¯ï¼š</p>
<p>1ã€å‰ç½®é€šçŸ¥ï¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ</p>
<p>2ã€åç½®é€šçŸ¥ï¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ­£å¸¸æ‰§è¡Œä¹‹åæ‰§è¡Œï¼Œå®ƒå’Œå¼‚å¸¸é€šçŸ¥æ°¸è¿œåªä¼šæ‰§è¡Œä¸€ä¸ª</p>
<p>3ã€å¼‚å¸¸é€šçŸ¥ï¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•äº§ç”Ÿå¼‚å¸¸ä¹‹åæ‰§è¡Œï¼Œå®ƒå’Œåç½®é€šçŸ¥æ°¸è¿œåªä¼šæ‰§è¡Œä¸€ä¸ª</p>
<p>4ã€æœ€ç»ˆé€šçŸ¥ï¼šæ— è®ºåˆ‡å…¥ç‚¹æ–¹æ³•æ˜¯å¦æ­£å¸¸æ‰§è¡Œå®ƒéƒ½ä¼šåœ¨å…¶åé¢æ‰§è¡Œ</p>
<blockquote>
<p>é€šç”¨åŒ–åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</p>
</blockquote>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é…ç½®äº†å››ç§é€šçŸ¥ç±»å‹ï¼Œæ¯ç§é€šçŸ¥ç±»å‹éƒ½æœ‰å±äºå…¶æœ¬èº«çš„æ ‡ç­¾ï¼Œæ¯ä¸ªæ ‡ç­¾ä¹Ÿéƒ½æœ‰ä¸€ä¸ª <code>pointcut</code> å±æ€§ï¼Œå› æ­¤æˆ‘ä»¬å†™äº†å››æ¬¡ï¼ˆé•¿é•¿çš„ï¼‰åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™ä¹Ÿå¤ªè ¢äº†ï¼Œä¸èƒ½ç®€åŒ–ä¸€ç‚¹ï¼Ÿä¼˜é›…ä¸€ä¸‹ï¼Ÿ</p>
<p>è¿™å°±æ¶‰åŠåˆ°å¦å¤–ä¸€ä¸ªæ ‡ç­¾ï¼š<code>&lt;aop:pointcut&gt;</code></p>
<p>è§åè¯†æ„ï¼Œæ˜¾ç„¶è¿™ä¸ªæ ‡ç­¾æ˜¯ç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„ã€‚è¿™ä¸ªæ ‡ç­¾æœ‰ä¸¤ä¸ªå±æ€§ï¼š</p>
<ul>
<li>idï¼šç”¨äºæŒ‡å®šè¡¨è¾¾å¼çš„å”¯ä¸€æ ‡è¯†ç¬¦</li>
<li>expressionï¼šç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å†…å®¹</li>
</ul>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¯¹ Spring é…ç½®æ–‡ä»¶ä¸­é…ç½® AOP éƒ¨åˆ†çš„ä»£ç è¿›è¡Œå¦‚ä¸‹ä¼˜åŒ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®AOP--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®åˆ‡é¢--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;logAdvice&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;logger&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beforePrintLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturningPrintLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowingPrintLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;afterPrintLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.yang.service.impl.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ ‡ç­¾å¯ä»¥å†™åœ¨ <code>&lt;aop:aspect&gt;</code> æ ‡ç­¾å†…éƒ¨ï¼Œåªèƒ½å½“å‰åˆ‡é¢ä½¿ç”¨ã€‚</p>
<p>å®ƒè¿˜å¯ä»¥å†™åœ¨ <code>&lt;aop:aspect&gt;</code> æ ‡ç­¾å¤–é¢ï¼Œè®©æ‰€æœ‰åˆ‡é¢éƒ½å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ ¹æ®å¯¼å…¥çš„ xml çº¦æŸï¼Œ<code>&lt;aop:pointcut&gt;</code> æ ‡ç­¾åªèƒ½å†™åœ¨ <code>&lt;aop:aspect&gt;</code> æ ‡ç­¾å‰é¢ï¼Œå†™åé¢å°±ä¼šæŠ¥é”™ï¼Œè¿˜ä¸å¸¦æç¤ºçš„é‚£ç§ï¼</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.yang.service.impl.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®åˆ‡é¢--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;logAdvice&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;logger&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beforePrintLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturningPrintLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowingPrintLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;afterPrintLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="5-6-ç¯ç»•é€šçŸ¥"><a class="header-anchor" href="#5-6-ç¯ç»•é€šçŸ¥"></a>5.6 ç¯ç»•é€šçŸ¥</h2>
<p>æˆ‘ä»¬å¯¹åŸºäº XML é…ç½®çš„ AOP æ¡ˆä¾‹ä¸­çš„ä»£ç è¿›è¡Œéƒ¨åˆ†ä¿®æ”¹ï¼Œservice åŒ…ä¸‹çš„ <code>AccountService</code> æ¥å£å’Œ  <code>AccountServiceImpl</code> å®ç°ç±»ä¸åšä»»ä½•æ”¹å˜ã€‚</p>
<p>åœ¨ <code>Logger</code> ç±»ä¸­æ·»åŠ ç¯ç»•é€šçŸ¥çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aroundPrintLog</span><span class="params">(ProceedingJoinPoint pjp)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Loggerç±»ä¸­çš„aroundPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹ AOP çš„é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.yang.service.impl.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;logAdvice&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;logger&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;aroundPrintLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ–¹æ³•ä¹Ÿä¸å˜ï¼Œç›´æ¥è¿è¡Œï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E7%8E%AF%E7%BB%95%E9%80%9A%E7%9F%A5%E5%88%9D%E4%BD%93%E9%AA%8C.png" alt="ç¯ç»•é€šçŸ¥åˆä½“éªŒ"></p>
<p>è¿™è¾“å‡ºç»“æœæ˜¯ä¸ªå•¥ç©æ„ï¼ŸğŸ˜¤</p>
<p>é€šçŸ¥æ–¹æ³•æ‰§è¡Œäº†ï¼Œä½†æ˜¯åˆ‡å…¥ç‚¹æ–¹æ³•æ²¡æœ‰æ‰§è¡Œï¼Œæä¸ªâ€‹ ğŸ”¨</p>
<p>è¿˜è®°å¾—åŠ¨æ€ä»£ç†çš„ç¯ç»•é€šçŸ¥ä»£ç å—ï¼Ÿ</p>
<img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/é€šçŸ¥çš„ç±»å‹.jpg" alt="é€šçŸ¥çš„ç±»å‹" style="zoom:67%;" />
<p>åŠ¨æ€ä»£ç†çš„ç¯ç»•é€šçŸ¥æœ‰æ˜ç¡®çš„åˆ‡å…¥ç‚¹è°ƒç”¨ï¼Œè€Œæˆ‘ä»¬çš„ä»£ç æ²¡æœ‰ã€‚é‚£æ€ä¹ˆæï¼Ÿ</p>
<p>Spring æ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ¥å£ï¼š<code>ProceedingJoinPoint</code>ï¼Œè¯¥æ¥å£æœ‰ä¸€ä¸ª <code>proceed()</code> æ–¹æ³•ï¼Œæ­¤æ–¹æ³•å°±ç›¸å½“äºæ˜ç¡®è°ƒç”¨åˆ‡å…¥ç‚¹æ–¹æ³•ã€‚</p>
<p><code>ProceedingJoinPoint</code> æ¥å£å¯ä»¥ä½œä¸ºç¯ç»•é€šçŸ¥çš„æ–¹æ³•å‚æ•°ï¼Œåœ¨ç¨‹åºæ‰§è¡Œæ—¶ï¼ŒSpring æ¡†æ¶ä¼šä¸ºæˆ‘ä»¬æä¾›è¯¥æ¥å£çš„å®ç°ç±»ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>proceed()</code> æ–¹æ³•æ‰§è¡Œå‰ç¼–å†™å‰ç½®é€šçŸ¥ï¼Œåœ¨ <code>proceed()</code> æ‰§è¡Œåç¼–å†™åç½®é€šçŸ¥ï¼Œ<code>proceed()</code> æ–¹æ³•éœ€è¦æŠ›å‡º <code>Throwable</code> ç±»å‹çš„å¼‚å¸¸ï¼Œå¯ä»¥åœ¨ <code>catch</code> å—é‡Œç¼–å†™å¼‚å¸¸é€šçŸ¥ï¼Œåœ¨ <code>finally</code> å—é‡Œç¼–å†™æœ€ç»ˆé€šçŸ¥ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">aroundPrintLog</span><span class="params">(ProceedingJoinPoint pjp)</span> &#123;</span><br><span class="line">    Object rtValue;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Object[] args = pjp.getArgs(); <span class="comment">// å¾—åˆ°æ–¹æ³•æ‰§è¡Œæ‰€éœ€çš„å‚æ•°</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Loggerç±»ä¸­çš„aroundPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†...å‰ç½®&quot;</span>);</span><br><span class="line"></span><br><span class="line">        rtValue = pjp.proceed(args); <span class="comment">// æ˜ç¡®è°ƒç”¨ä¸šåŠ¡å±‚ï¼ˆåˆ‡å…¥ç‚¹ï¼‰æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Loggerç±»ä¸­çš„aroundPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†...åç½®&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> rtValue;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable throwable) &#123; <span class="comment">// ä¸èƒ½æŠ›å‡º Exception</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Loggerç±»ä¸­çš„aroundPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†...å¼‚å¸¸&quot;</span>);</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(throwable);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Loggerç±»ä¸­çš„aroundPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†...æœ€ç»ˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•ç±»çš„æµ‹è¯•æ–¹æ³•ï¼Œæ§åˆ¶å°æ‰“å°å¦‚ä¸‹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E7%8E%AF%E7%BB%95%E9%80%9A%E7%9F%A5%E8%BE%93%E5%87%BA_1.png" alt="ç¯ç»•é€šçŸ¥è¾“å‡º_1"></p>
<p>ä¿®æ”¹  <code>AccountServiceImpl</code> å®ç°ç±»ä¸­çš„ <code>saveAccount()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ‰§è¡Œäº†ä¿å­˜&quot;</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡è¿è¡Œæµ‹è¯•ç±»çš„æµ‹è¯•æ–¹æ³•ï¼Œæ§åˆ¶å°æ‰“å°å¦‚ä¸‹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SSMImages/%E7%8E%AF%E7%BB%95%E9%80%9A%E7%9F%A5%E8%BE%93%E5%87%BA_2.png" alt="ç¯ç»•é€šçŸ¥è¾“å‡º_2"></p>
<p>æ§åˆ¶å°çš„è¾“å‡ºéƒ½æ­£ç¡®ï¼æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ç¯ç»•é€šçŸ¥æ²¡æœ‰é—®é¢˜ï¼ ğŸ‰</p>
<p>æ ¹æ®ä¸Šé¢ç¯ç»•é€šçŸ¥çš„ç¼–å†™è¿‡ç¨‹ï¼Œä¸éš¾å¾—å‡ºï¼šSpring ä¸­çš„ç¯ç»•é€šçŸ¥æ˜¯ Spring æ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›çš„ä¸€ç§å¯ä»¥åœ¨ä»£ç ä¸­æ‰‹åŠ¨æ§åˆ¶å¢å¼ºæ–¹æ³•ä½•æ—¶æ‰§è¡Œçš„æ–¹å¼ã€‚</p>
<h2 id="5-7-åŸºäºæ³¨è§£çš„-AOP"><a class="header-anchor" href="#5-7-åŸºäºæ³¨è§£çš„-AOP"></a>5.7 åŸºäºæ³¨è§£çš„ AOP</h2>
<p>è¿˜æ˜¯æ ¹æ®åŸºäº XML é…ç½®çš„ AOP æ¡ˆä¾‹ä¸­çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œå®ŒæˆåŸºäºæ³¨è§£çš„ AOPã€‚</p>
<p><code>AccountService</code> æ¥å£ä¸å˜ï¼Œä½†æˆ‘ä»¬çŸ¥é“éœ€è¦å°† service å¯¹è±¡é…ç½®åˆ° IoC å®¹å™¨ä¸­ï¼Œå› æ­¤éœ€è¦åœ¨  <code>AccountServiceImpl</code> å®ç°ç±»ä¸Šæ·»åŠ  <code>@Service</code> æ³¨è§£ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;accountService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAccount</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†ä¿å­˜&quot;</span>);</span><br><span class="line"><span class="comment">//        int i = 1/0;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAccount</span><span class="params">(<span class="type">int</span> i)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†æ›´æ–°&quot;</span>+i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteAccount</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†åˆ é™¤&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºæ—¥å¿—ç±» <code>Logger</code> ç±»æ¥è¯´ï¼Œä¹Ÿéœ€è¦å°†å…¶æ³¨å…¥ IoC å®¹å™¨ä¸­ï¼Œè¿™ä¸ªç±»ä¸å±äºä»»ä½•ä¸€å±‚ï¼Œå› æ­¤ä½¿ç”¨ <code>@Component</code> æ³¨è§£ã€‚</p>
<p>ç„¶åæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ <code>@Aspect</code> æ³¨è§£è¡¨ç¤º <code>Logger</code> ç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»ã€‚</p>
<p>å¯¹äº <code>Logger</code> ç±»ä¸­çš„æ–¹æ³•ï¼Œéœ€è¦å°†å®ƒä»¬è®¾ç½®æˆé€šçŸ¥æ–¹æ³•ï¼Œä¸ XML ä¸­çš„æ ‡ç­¾ä¸€æ ·ï¼Œè¿™äº›é€šçŸ¥åˆ†åˆ«å¯¹åº”äº†ä¸€äº›æ³¨è§£ï¼š</p>
<ul>
<li><code>@Before</code>ï¼šå‰ç½®é€šçŸ¥</li>
<li><code>@AfterReturning</code>ï¼šåç½®é€šçŸ¥</li>
<li><code>@AfterThrowing</code>ï¼šå¼‚å¸¸é€šçŸ¥</li>
<li><code>@After</code>ï¼šæœ€ç»ˆé€šçŸ¥</li>
<li><code>@Around()</code>ï¼šç¯ç»•é€šçŸ¥</li>
</ul>
<p>ä½¿ç”¨äº†è¿™äº›æ³¨è§£æŒ‡å®šå“ªäº›æ–¹æ³•æ˜¯å“ªäº›é€šçŸ¥ä¹‹å¤–ï¼Œè¿˜éœ€è¦æŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œè¿™æ—¶å€™éœ€è¦ç”¨åˆ° <code>@Pointcut</code> æ³¨è§£ã€‚</p>
<p>æœ€ç»ˆï¼Œ<code>Logger</code> ç±»æ”¹å†™å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;logger&quot;)</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//è¡¨ç¤ºå½“å‰ç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.yang.service.impl.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt1</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">     <span class="comment">// å‰ç½®é€šçŸ¥</span></span><br><span class="line"><span class="comment">//    @Before(&quot;pt1()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforePrintLog</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰ç½®é€šçŸ¥Loggerç±»ä¸­çš„beforePrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">// åç½®é€šçŸ¥</span></span><br><span class="line"><span class="comment">//    @AfterReturning(&quot;pt1()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturningPrintLog</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åç½®é€šçŸ¥Loggerç±»ä¸­çš„afterReturningPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">// å¼‚å¸¸é€šçŸ¥</span></span><br><span class="line"><span class="comment">//    @AfterThrowing(&quot;pt1()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowingPrintLog</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼‚å¸¸é€šçŸ¥Loggerç±»ä¸­çš„afterThrowingPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æœ€ç»ˆé€šçŸ¥</span></span><br><span class="line"><span class="comment">//    @After(&quot;pt1()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPrintLog</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ€ç»ˆé€šçŸ¥Loggerç±»ä¸­çš„afterPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Around(&quot;pt1()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">aroundPrintLog</span><span class="params">(ProceedingJoinPoint pjp)</span>&#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">rtValue</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Object[] args = pjp.getArgs();<span class="comment">//å¾—åˆ°æ–¹æ³•æ‰§è¡Œçš„å‚æ•°</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Loggerç±»ä¸­çš„aroundPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†ã€‚ã€‚ã€‚å‰ç½®&quot;</span>);</span><br><span class="line">            rtValue = pjp.proceed(args);<span class="comment">//æ˜ç¡®è°ƒç”¨ä¸šåŠ¡å±‚æ–¹æ³•ï¼ˆåˆ‡å…¥ç‚¹æ–¹æ³•ï¼‰</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Loggerç±»ä¸­çš„aroundPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†ã€‚ã€‚ã€‚åç½®&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> rtValue;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;Loggerç±»ä¸­çš„aroundPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†ã€‚ã€‚ã€‚å¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Loggerç±»ä¸­çš„aroundPrintLogæ–¹æ³•å¼€å§‹è®°å½•æ—¥å¿—äº†ã€‚ã€‚ã€‚æœ€ç»ˆ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rtValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºé‚£å››ç§å¸¸è§çš„é€šçŸ¥ç±»å‹å’Œç¯ç»•é€šçŸ¥ä¸èƒ½å…±å­˜ï¼Œå› æ­¤æˆ‘ä»¬å°†å…¶ä¸­ä¸€ç§è¿›è¡Œæ³¨é‡Šå¹¶åˆ†åˆ«æµ‹è¯•ã€‚</p>
<p>è¿™ä¸‹å°±çœŸçš„å®Œäº†ï¼Ÿ</p>
<p>æ²¡æœ‰ï¼æˆ‘ä»¬è¿˜æ²¡æœ‰å¼€å¯æ³¨è§£ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ XML çš„æ–¹å¼å¼€å¯æ³¨è§£ä¸æ³¨è§£æ‰«æï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å‘ŠçŸ¥Springåœ¨åˆ›å»ºå®¹å™¨æ—¶éœ€è¦æ‰«æçš„åŒ…--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.yang&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®Springå¼€å¯AOPæ³¨è§£--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥ä½¿ç”¨é…ç½®ç±»çš„æ–¹å¼å¼€å¯æ³¨è§£ä¸æ³¨è§£æ‰«æï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="meta">@ComponentScan(basePackages=&quot;com.yang&quot;)</span> </span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfiguration</span> &#123; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºä½¿ç”¨äº† XML æ–¹å¼å¼€å¯æ³¨è§£å’Œæ³¨è§£æ‰«æçš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AOPTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//1.è·å–å®¹å™¨</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//2.è·å–å¯¹è±¡</span></span><br><span class="line">        <span class="type">IAccountService</span> <span class="variable">as</span> <span class="operator">=</span> (IAccountService) ac.getBean(<span class="string">&quot;accountService&quot;</span>);</span><br><span class="line">        <span class="comment">//3.æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        as.saveAccount();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½¿ç”¨çš„æ˜¯é…ç½®ç±»å¼€å¯æ³¨è§£å’Œæ³¨è§£æ‰«æï¼Œå°±éœ€è¦ä½¿ç”¨ <code>AnnotationConfigApplicationContext</code> æ¥è¯»å–é…ç½®ç±»ã€‚å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ac1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfiguration.class);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„äº‹é¡¹</p>
</blockquote>
<p>1ã€ä½¿ç”¨ <code>@Before</code> ç­‰æ³¨è§£æŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ—¶ï¼Œä¸è¦æ¼æ‰æ‹¬å·ã€‚æ­£ç¡®ç¤ºä¾‹ï¼š<code>@Before(&quot;pt1()&quot;)</code></p>
<p>2ã€åœ¨ä½ç‰ˆæœ¬çš„ Spring 2.x ä¸­ï¼Œä½¿ç”¨åŸºäºæ³¨è§£çš„ AOP æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°æ¶ˆæ¯è¾“å‡ºå¼‚å¸¸çš„é—®é¢˜ï¼ˆç¯ç»•é€šçŸ¥ä¸ä¼šå‡ºç°é—®é¢˜ï¼‰ã€‚å»ºè®®ä½¿ç”¨çš„ Spring ç‰ˆæœ¬ä¸º 5.2.7 åŠå…¶ä»¥ä¸Šï¼</p>
<h1 id="6-JdbcTemplate"><a class="header-anchor" href="#6-JdbcTemplate"></a>6. JdbcTemplate</h1>
<h2 id="6-1-å‡†å¤‡å·¥ä½œ"><a class="header-anchor" href="#6-1-å‡†å¤‡å·¥ä½œ"></a>6.1 å‡†å¤‡å·¥ä½œ</h2>
<p><code>Account</code> å®ä½“ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> money;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çœç•¥ GET / SET æ–¹æ³•ï¼ŒtoString() æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>account æ•°æ®è¡¨å­—æ®µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id | name | money</span><br></pre></td></tr></table></figure>
<p>å¯¼å…¥çš„ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="6-2-åŸºæœ¬ä½¿ç”¨"><a class="header-anchor" href="#6-2-åŸºæœ¬ä½¿ç”¨"></a>6.2 åŸºæœ¬ä½¿ç”¨</h2>
<p>ç›´æ¥åˆ›å»ºä¸€ä¸ªç±»ï¼Œç›´æ¥ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTemplateDemo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//å‡†å¤‡æ•°æ®æºï¼šSpring å†…ç½®çš„æ•°æ®æº</span></span><br><span class="line">        <span class="type">DriverManagerDataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DriverManagerDataSource</span>();</span><br><span class="line"></span><br><span class="line">        ds.setDriverClassName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        ds.setUrl(<span class="string">&quot;jdbc:mysql:///ssm?characterEncoding=utf8&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC&quot;</span>);</span><br><span class="line">        ds.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        ds.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.åˆ›å»ºJdbcTemplateå¯¹è±¡</span></span><br><span class="line">        <span class="type">JdbcTemplate</span> <span class="variable">jt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTemplate</span>();</span><br><span class="line">        <span class="comment">//ç»™jtè®¾ç½®æ•°æ®æº</span></span><br><span class="line">        jt.setDataSource(ds);</span><br><span class="line">        <span class="comment">//2.æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">        jt.execute(<span class="string">&quot;insert into account(name,money)values (&#x27;ddd&#x27;,1000)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–å†™å¥½åï¼Œç›´æ¥ run å°±å®Œäº‹äº†ï¼</p>
<h2 id="6-3-ä¸-Spring-IoC-ç»“åˆ"><a class="header-anchor" href="#6-3-ä¸-Spring-IoC-ç»“åˆ"></a>6.3 ä¸ Spring IoC ç»“åˆ</h2>
<p>é¦–å…ˆå¾—å…ˆç¼–å†™ Spring çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ•°æ®æºã€å°† <code>JdbcTemplate</code> æ³¨å…¥ Spring å®¹å™¨ä¸­ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">   http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®JdbcTemplate--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®æ•°æ®æº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span> = <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span> = <span class="string">&quot;jdbc:mysql:///ssm?zeroDateTimeBehavior=convertToNull<span class="symbol">&amp;amp;</span>serverTimezone=GMT%2b8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span> = <span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span> = <span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTemplateDemo2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–å®¹å™¨</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–å¯¹è±¡</span></span><br><span class="line">        <span class="type">JdbcTemplate</span> <span class="variable">jt</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;jdbcTemplate&quot;</span>,JdbcTemplate.class);</span><br><span class="line">        <span class="comment">//æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">        jt.execute(<span class="string">&quot;insert into account(name,money)values (&#x27;eee&#x27;,1000)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-4-CRUD-æ“ä½œ"><a class="header-anchor" href="#6-4-CRUD-æ“ä½œ"></a>6.4 CRUD æ“ä½œ</h2>
<p>ç»§ç»­ä½¿ç”¨ ã€6.3 ä¸ Spring IoC ç»“åˆã€‘çš„ç¯å¢ƒï¼Œé‚£ä¹ˆ JdbcTemplate ç›¸å…³çš„ CRUD ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTemplateDemo3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–å®¹å™¨</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–å¯¹è±¡</span></span><br><span class="line">        <span class="type">JdbcTemplate</span> <span class="variable">jt</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;jdbcTemplate&quot;</span>,JdbcTemplate.class);</span><br><span class="line">        <span class="comment">//æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">        <span class="comment">//ä¿å­˜</span></span><br><span class="line">        jt.update(<span class="string">&quot;insert into account(name,money)values (?,?)&quot;</span>,<span class="string">&quot;fff&quot;</span>,<span class="number">1200</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ›´æ–°</span></span><br><span class="line">        jt.update(<span class="string">&quot;update account set name=?, money=? where id=?&quot;</span>,<span class="string">&quot;test&quot;</span>,<span class="number">1200</span>,<span class="number">6</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//åˆ é™¤</span></span><br><span class="line">        jt.update(<span class="string">&quot;delete from account where id=?&quot;</span>,<span class="number">7</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æŸ¥è¯¢æ‰€æœ‰</span></span><br><span class="line">        List&lt;Account&gt; accounts = jt.query(<span class="string">&quot;select * from account where money &gt; ?&quot;</span>,<span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;Account&gt;(Account.class),<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">for</span> (Account account:accounts)&#123;</span><br><span class="line">            System.out.println(account);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æŸ¥è¯¢ä¸€ä¸ª</span></span><br><span class="line">        List&lt;Account&gt; accounts = jt.query(<span class="string">&quot;select * from account where id = ?&quot;</span>,<span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;Account&gt;(Account.class),<span class="number">1</span>);</span><br><span class="line">        System.out.println(accounts.isEmpty()?<span class="string">&quot;No values&quot;</span>:accounts.get(<span class="number">0</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ä½¿ç”¨èšåˆå‡½æ•°</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> jt.queryForObject(<span class="string">&quot;select count(*) from account where money &gt; ?&quot;</span>,Long.class,<span class="number">1000</span>);</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-2-ä¸-Dao-ç»“åˆ"><a class="header-anchor" href="#6-2-ä¸-Dao-ç»“åˆ"></a>6.2 ä¸ Dao ç»“åˆ</h2>
<p><code>IAccountDao</code> æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IAccountDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    Account <span class="title function_">findAccountById</span><span class="params">(Integer accountId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®åç§°æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    Account <span class="title function_">findAccountByName</span><span class="params">(String accountName)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›´æ–°ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateAccount</span><span class="params">(Account account)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.support.JdbcDaoSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»§æ‰¿ JdbcDaoSupportï¼Œä½¿ç”¨åŸºäºXMLçš„é…ç½®æ—¶å¯ä»¥å»é™¤å¤šä½™ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountDaoImpl</span> <span class="keyword">extends</span> <span class="title class_">JdbcDaoSupport</span> <span class="keyword">implements</span> <span class="title class_">IAccountDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">findAccountById</span><span class="params">(Integer accountId)</span> &#123;</span><br><span class="line">        List&lt;Account&gt; accounts = <span class="built_in">super</span>.getJdbcTemplate().query(<span class="string">&quot;select * from account where id = ?&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;Account&gt;(Account.class), accountId);</span><br><span class="line">        <span class="keyword">return</span> accounts.isEmpty() ? <span class="literal">null</span> : accounts.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">findAccountByName</span><span class="params">(String accountName)</span> &#123;</span><br><span class="line">        List&lt;Account&gt; accounts = <span class="built_in">super</span>.getJdbcTemplate().query(<span class="string">&quot;select * from account where name = ?&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;Account&gt;(Account.class), accountName);</span><br><span class="line">        <span class="keyword">if</span> (accounts.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (accounts.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç»“æœä¸å”¯ä¸€&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> accounts.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAccount</span><span class="params">(Account account)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.getJdbcTemplate().update(<span class="string">&quot;update account set name = ?,money=? where id = ?&quot;</span>,account.getName(),account.getMoney(),account.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">   http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®è´¦æˆ·çš„æŒä¹…å±‚--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.dao.impl.AccountDaoImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®æ•°æ®æº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span> = <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span> = <span class="string">&quot;jdbc:mysql:///ssm?zeroDateTimeBehavior=convertToNull<span class="symbol">&amp;amp;</span>serverTimezone=GMT%2b8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span> = <span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span> = <span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTemplateDemo4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–å®¹å™¨</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–å¯¹è±¡</span></span><br><span class="line">        <span class="type">IAccountDao</span> <span class="variable">accountDao</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;accountDao&quot;</span>,IAccountDao.class);</span><br><span class="line">        <span class="comment">//æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> accountDao.findAccountById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(account);</span><br><span class="line"></span><br><span class="line">        account.setMoney(<span class="number">66666f</span>);</span><br><span class="line">        accountDao.updateAccount(account);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç›¸å…³è¦ç‚¹</p>
</blockquote>
<p>åœ¨ service çš„å®ç°ç±»ä¸­ï¼Œæˆ‘ä»¬ç»§æ‰¿äº† <code>JdbcDaoSupport</code> ç±»ã€‚å½“ä»£ç ä¸­å­˜åœ¨å¤šä¸ª Dao å¹¶ä½¿ç”¨äº† <code>JdbcTemplate</code> æ—¶ï¼Œåœ¨è¿™äº› Dao æ–‡ä»¶ä¸­ä¼šå¤šæ¬¡ä¹¦å†™ <code>JdbcTemplate</code> åŠå…¶ set æ–¹æ³•ï¼Œç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­æ³¨å…¥ã€‚</p>
<p>è¿™æ ·çš„ä»£ç å±äºå¤šä½™çš„ï¼Œå®Œå…¨å¯ä»¥æ¶ˆé™¤ï¼Œåªéœ€è¦å®ç° <code>JdbcDaoSupport</code> ç±»å³å¯ï¼ˆå…·ä½“åŸå› å¯ä»¥ç‚¹å¼€è¿™ä¸ªç±»çœ‹çœ‹ï¼‰ï¼Œç„¶åæŒ‰ç…§ä¸Šé¢æä¾›çš„ XML é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®å³å¯ã€‚</p>
<p>ä½†æ˜¯è¿™ç§æ–¹å¼å¿…é¡»æ˜¯åŸºäº XML è¿›è¡Œ Spring é…ç½®æ—¶æ‰å¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœæ˜¯ä½¿ç”¨äº†æ³¨è§£ï¼Œå°±ä¸èƒ½ç»§æ‰¿ <code>JdbcDaoSupport</code> ç±»ï¼Œè€Œæ˜¯éœ€è¦åœ¨ Dao ç±»ä¸­æ·»åŠ ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br></pre></td></tr></table></figure>
<p>å› ä¸º <code>JdbcDaoSupport</code> æ˜¯ Spring æä¾›çš„ï¼Œé‡Œé¢çš„ä»£ç ä»…æ˜¯å¯è¯»çš„ï¼Œæˆ‘ä»¬ä¸èƒ½ä¿®æ”¹è¿™é‡Œé¢çš„ä»£ç ã€‚</p>
<h1 id="7-äº‹åŠ¡ç®¡ç†"><a class="header-anchor" href="#7-äº‹åŠ¡ç®¡ç†"></a>7. äº‹åŠ¡ç®¡ç†</h1>
<h2 id="7-1-æ‰‹åŠ¨å®ç°äº‹åŠ¡ç®¡ç†"><a class="header-anchor" href="#7-1-æ‰‹åŠ¨å®ç°äº‹åŠ¡ç®¡ç†"></a>7.1 æ‰‹åŠ¨å®ç°äº‹åŠ¡ç®¡ç†</h2>
<blockquote>
<p>äº‹åŠ¡å›é¡¾</p>
</blockquote>
<p>äº‹åŠ¡ç®¡ç†æ˜¯ä¼ä¸šçº§åº”ç”¨ç¨‹åºå¼€å‘ä¸­å¿…å¤‡æŠ€æœ¯ï¼Œç”¨æ¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</p>
<p>äº‹åŠ¡å°±æ˜¯æŠŠä¸€ç³»åˆ—çš„æ•°æ®åº“æ“ä½œå½“æˆä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œå•å…ƒï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆã€‚</p>
<p>äº‹åŠ¡æœ‰å››ä¸ªå±æ€§ï¼ˆACIDï¼‰ï¼š</p>
<p>1ã€åŸå­æ€§ï¼ˆatomicityï¼‰ï¼šäº‹åŠ¡æ˜¯åŸå­æ€§æ“ä½œï¼Œç”±ä¸€ç³»åˆ—åŠ¨ä½œç»„æˆï¼Œäº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨</p>
<p>2ã€ä¸€è‡´æ€§ï¼ˆconsistencyï¼‰ï¼šä¸€æ—¦æ‰€æœ‰äº‹åŠ¡åŠ¨ä½œå®Œæˆï¼Œäº‹åŠ¡å°±è¦è¢«æäº¤ã€‚æ•°æ®å’Œèµ„æºå¤„äºä¸€ç§æ»¡è¶³ä¸šåŠ¡è§„åˆ™çš„ä¸€è‡´æ€§çŠ¶æ€ä¸­</p>
<p>3ã€éš”ç¦»æ€§ï¼ˆisolationï¼‰ï¼šå¯èƒ½å¤šä¸ªäº‹åŠ¡ä¼šåŒæ—¶å¤„ç†ç›¸åŒçš„æ•°æ®ï¼Œå› æ­¤æ¯ä¸ªäº‹åŠ¡éƒ½åº”è¯¥ä¸å…¶ä»–äº‹åŠ¡éš”ç¦»å¼€æ¥ï¼Œé˜²æ­¢æ•°æ®æŸå</p>
<p>4ã€æŒä¹…æ€§ï¼ˆdurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦å®Œæˆï¼Œæ— è®ºç³»ç»Ÿå‘ç”Ÿä»€ä¹ˆé”™è¯¯ï¼Œç»“æœéƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œäº‹åŠ¡çš„ç»“æœè¢«å†™åˆ°æŒä¹…åŒ–å­˜å‚¨å™¨ä¸­</p>
<blockquote>
<p>æ¡ˆä¾‹æµ‹è¯•</p>
</blockquote>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦å®ç°è½¬è´¦ï¼Œè¦å®ç°è¿™ä¸ªåŠŸèƒ½å°±éœ€è¦æ¶‰åŠåˆ°ä¸¤ç±»ç”¨æˆ·ï¼Œä¸€ä¸ªæ˜¯è½¬å‡ºè´¦æˆ·ï¼Œå¦ä¸€ä¸ªæ˜¯è½¬å…¥è´¦æˆ·ã€‚è½¬å‡ºè´¦æˆ·å‡é’±ï¼Œè½¬å…¥è´¦æˆ·åŠ é’±ã€‚å¦‚æœä¸­é—´å‡ºäº†æ„å¤–ï¼Œåˆ™è½¬è´¦å¤±è´¥ï¼Œè½¬å‡ºç”¨æˆ·ä¸å‡é’±ï¼Œè½¬å…¥ç”¨æˆ·ä¸åŠ é’±ã€‚</p>
<p>è¿™å°±æ¶‰åŠåˆ°äº‹åŠ¡ç®¡ç†ï¼Œäº‹åŠ¡ç®¡ç†çš„ä¸€å¤§æ ¸å¿ƒå°±æ˜¯ï¼šå°†äº‹åŠ¡è‡ªåŠ¨æäº¤æ”¹æˆæ‰‹åŠ¨æäº¤ï¼Œç”¨äºä¿è¯æ•°æ®å®Œæ•´å’Œä¸€è‡´ã€‚</p>
<p>æ ¹æ®å‰æ–‡è®²è¿°çš„ AOP çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ AOP æ¥å®ç°äº‹åŠ¡ç®¡ç†ã€‚ä»¥ä¸‹ä¸ºä¸»è¦ä»£ç ï¼š</p>
<p>è´¦æˆ·å®ä½“ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Float money;</span><br><span class="line">    <span class="comment">// çœç•¥ GET / SET æ–¹æ³•ï¼Œä»¥åŠ toString() æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸šåŠ¡å±‚å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IAccountService</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String sourceName, String targetName, Float money)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;transfer....&quot;</span>);</span><br><span class="line">        <span class="comment">//2.1æ ¹æ®åç§°æŸ¥è¯¢è½¬å‡ºè´¦æˆ·</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">source</span> <span class="operator">=</span> accountDao.findAccountByName(sourceName);</span><br><span class="line">        <span class="comment">//2.2æ ¹æ®åç§°æŸ¥è¯¢è½¬å…¥è´¦æˆ·</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">target</span> <span class="operator">=</span> accountDao.findAccountByName(targetName);</span><br><span class="line">        <span class="comment">//2.3è½¬å‡ºè´¦æˆ·å‡é’±</span></span><br><span class="line">        source.setMoney(source.getMoney()-money);</span><br><span class="line">        <span class="comment">//2.4è½¬å…¥è´¦æˆ·åŠ é’±</span></span><br><span class="line">        target.setMoney(target.getMoney()+money);</span><br><span class="line">        <span class="comment">//2.5æ›´æ–°è½¬å‡ºè´¦æˆ·</span></span><br><span class="line">        accountDao.updateAccount(source);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿè½¬è´¦å‡ºç°æ„å¤–ï¼Œè½¬è´¦å¤±è´¥</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.6æ›´æ–°è½¬å…¥è´¦æˆ·</span></span><br><span class="line">        accountDao.updateAccount(target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dao å±‚æ¥å£å’Œå®ç°ç±»éƒ½æ˜¯æ¶‰åŠçš„æ•°æ®åº“æ“ä½œï¼Œæ¯”è¾ƒç®€å•ï¼Œç¯‡å¹…æ‰€é™å°±ä¸è´´å‡ºäº†ã€‚</p>
<p>æ•°æ®åº“è¿æ¥å·¥å…·ç±» <code>ConnectionUtils</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yang.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥çš„å·¥å…·ç±»ï¼Œå®ƒç”¨äºä»æ•°æ®æºä¸­è·å–ä¸€ä¸ªè¿æ¥ï¼Œå¹¶ä¸”å®ç°å’Œçº¿ç¨‹çš„ç»‘å®š</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConnectionUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ThreadLocal&lt;Connection&gt; tl = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;Connection&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDataSource</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataSource = dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹ä¸Šçš„è¿æ¥</span></span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">getThreadConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//1.å…ˆä»ThreadLocalä¸Šè·å–</span></span><br><span class="line">            <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> tl.get();</span><br><span class="line">            <span class="comment">//2.åˆ¤æ–­å½“å‰çº¿ç¨‹ä¸Šæ˜¯å¦æœ‰è¿æ¥</span></span><br><span class="line">            <span class="keyword">if</span> (conn == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//3.ä»æ•°æ®æºä¸­è·å–ä¸€ä¸ªè¿æ¥ï¼Œå¹¶ä¸”å­˜å…¥ThreadLocalä¸­</span></span><br><span class="line">                conn = dataSource.getConnection();</span><br><span class="line">                tl.set(conn);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//4.è¿”å›å½“å‰çº¿ç¨‹ä¸Šçš„è¿æ¥</span></span><br><span class="line">            <span class="keyword">return</span> conn;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠŠè¿æ¥å’Œçº¿ç¨‹è§£ç»‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeConnection</span><span class="params">()</span>&#123;</span><br><span class="line">        tl.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äº‹åŠ¡ç®¡ç†å·¥å…·ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yang.utils;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å’Œäº‹åŠ¡ç®¡ç†ç›¸å…³çš„å·¥å…·ç±»ï¼Œå®ƒåŒ…å«äº†ï¼Œå¼€å¯äº‹åŠ¡ï¼Œæäº¤äº‹åŠ¡ï¼Œå›æ»šäº‹åŠ¡å’Œé‡Šæ”¾è¿æ¥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ConnectionUtils connectionUtils;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConnectionUtils</span><span class="params">(ConnectionUtils connectionUtils)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.connectionUtils = connectionUtils;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å¯äº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">beginTransaction</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().setAutoCommit(<span class="literal">false</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æäº¤äº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().commit();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å›æ»šäº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().rollback();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾è¿æ¥</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">release</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connectionUtils.getThreadConnection().close();<span class="comment">//è¿˜å›è¿æ¥æ± ä¸­</span></span><br><span class="line">            connectionUtils.removeConnection();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨é…ç½®æ–‡ä»¶å°†è¿™äº› Bean æ³¨å…¥åˆ° Spring IoC å®¹å™¨ä¸­ä½¿ç”¨äº†ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!-- é…ç½®Service --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.service.impl.AccountServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ³¨å…¥dao --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;accountDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®Daoå¯¹è±¡--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.dao.impl.AccountDaoImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ³¨å…¥QueryRunner --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;runner&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;runner&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ³¨å…¥ConnectionUtils --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;connectionUtils&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;connectionUtils&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®QueryRunner--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;runner&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbutils.QueryRunner&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®æ•°æ®æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--è¿æ¥æ•°æ®åº“çš„å¿…å¤‡ä¿¡æ¯--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span> = <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span> = <span class="string">&quot;jdbc:mysql:///ssm?zeroDateTimeBehavior=convertToNull<span class="symbol">&amp;amp;</span>serverTimezone=GMT%2b8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span> = <span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span> = <span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®Connectionçš„å·¥å…·ç±» ConnectionUtils --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;connectionUtils&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.utils.ConnectionUtils&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ³¨å…¥æ•°æ®æº--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;txManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.utils.TransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ³¨å…¥ConnectionUtils --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;connectionUtils&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;connectionUtils&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®AOP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.yang.service.impl.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;txManager&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®å‰ç½®é€šçŸ¥ï¼šå¼€å¯äº‹åŠ¡--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beginTransaction&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®åç½®é€šçŸ¥ï¼šæäº¤äº‹åŠ¡--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;commit&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®å¼‚å¸¸é€šçŸ¥ï¼šå›æ»šäº‹åŠ¡--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;rollback&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--é…ç½®æœ€ç»ˆé€šçŸ¥ï¼šé‡Šæ”¾è¿æ¥--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;release&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç±»æµ‹è¯•ä¸€æ‰‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> é»˜çƒ¦ 2020/10/21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:bean.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IAccountService as;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">testTransfer</span><span class="params">()</span>&#123;</span><br><span class="line">        as.transfer(<span class="string">&quot;aaa&quot;</span>,<span class="string">&quot;bbb&quot;</span>,<span class="number">100f</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç±»ä¸­ï¼Œæˆ‘ä»¬è®©è´¦æˆ·åä¸º aaa çš„ç”¨æˆ·å‘ç”¨æˆ· bbb è½¬è´¦ 100 å…ƒï¼Œä½†æ˜¯ç”±äºä¸šåŠ¡å±‚å®ç°ç±»ä¸­å­˜åœ¨æˆ‘ä»¬äººä¸ºåˆ¶é€ çš„è½¬è´¦æ„å¤–ï¼Œå› æ­¤åº”è¯¥æ˜¯æ— æ³•è½¬è´¦æˆåŠŸçš„ã€‚</p>
<p>è¿è¡Œä»£ç åï¼Œæ§åˆ¶å°ä¼šæ‰“å°å‡ºé™¤æ•°ä¸º 0 çš„å¼‚å¸¸ï¼Œä¹Ÿä¼šæ‰“å°å‡ºåœ¨ä¸šåŠ¡å±‚å®ç°ç±»ä¸­è¾“å‡ºçš„â€œtransferâ€¦â€ï¼Œå¦‚æœå‰å¾€æ•°æ®åº“æŸ¥çœ‹æ•°æ®ï¼Œä¼šå‘ç°ä¸¤ä¸ªè´¦æˆ·çš„ä½™é¢å¹¶æ²¡æœ‰æ”¹å˜ã€‚</p>
<p>è¯æ˜æˆ‘ä»¬è‡ªå·±å®ç°çš„äº‹åŠ¡æ§åˆ¶æ²¡æœ‰é—®é¢˜ï¼</p>
<h2 id="7-2-XML-é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†"><a class="header-anchor" href="#7-2-XML-é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†"></a>7.2 XML é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†</h2>
<p>Spring åœ¨ä¸åŒçš„äº‹åŠ¡ç®¡ç† API ä¹‹ä¸Šå®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œä½¿å¾—å¼€å‘äººå‘˜ä¸å¿…äº†è§£åº•å±‚çš„äº‹åŠ¡ç®¡ç† API å°±å¯ä»¥ä½¿ç”¨ Spring çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶ã€‚Spring æ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†å’Œå£°æ˜å¼çš„äº‹åŠ¡ç®¡ç†ã€‚</p>
<p>å…ˆæ¥è¯´è¯´å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œè¿™ç§äº‹åŠ¡ç®¡ç†åˆåˆ†ä¸ºåŸºäº XML é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†å’ŒåŸºäºæ³¨è§£é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚</p>
<p>å¦‚æœè¦ä½¿ç”¨åŸºäº XML é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­å¯¼å…¥ä»¥ä¸‹çº¦æŸï¼Œåƒä¸‡åˆ«å¯¼é”™äº†ï¼Œä¸ç„¶æ ‡ç­¾æä¾›çš„å±æ€§ä¸å¯¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ä»£ç çš„å®Œæ•´ï¼Œåœ¨æ­¤è´´ä¸Šæ‰€æœ‰ä»£ç ã€‚</p>
<p>è´¦æˆ·å®ä½“ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Float money;</span><br><span class="line">    <span class="comment">// çœç•¥ GET / SET æ–¹æ³•ï¼Œä»¥åŠ toString() æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dao å±‚æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IAccountDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    Account <span class="title function_">findAccountById</span><span class="params">(Integer accountId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ®åç§°æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    Account <span class="title function_">findAccountByName</span><span class="params">(String accountName)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›´æ–°ç”¨æˆ·</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateAccount</span><span class="params">(Account account)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dao å±‚å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»§æ‰¿ JdbcDaoSupportï¼Œä½¿ç”¨åŸºäºXMLçš„é…ç½®æ—¶å¯ä»¥å»é™¤å¤šä½™ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountDaoImpl</span> <span class="keyword">extends</span> <span class="title class_">JdbcDaoSupport</span> <span class="keyword">implements</span> <span class="title class_">IAccountDao</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">findAccountById</span><span class="params">(Integer accountId)</span> &#123;</span><br><span class="line">        List&lt;Account&gt; accounts = <span class="built_in">super</span>.getJdbcTemplate().query(<span class="string">&quot;select * from account where id = ?&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;Account&gt;(Account.class), accountId);</span><br><span class="line">        <span class="keyword">return</span> accounts.isEmpty() ? <span class="literal">null</span> : accounts.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">findAccountByName</span><span class="params">(String accountName)</span> &#123;</span><br><span class="line">        List&lt;Account&gt; accounts = <span class="built_in">super</span>.getJdbcTemplate().query(<span class="string">&quot;select * from account where name = ?&quot;</span>, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;Account&gt;(Account.class), accountName);</span><br><span class="line">        <span class="keyword">if</span> (accounts.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (accounts.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç»“æœä¸å”¯ä¸€&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> accounts.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAccount</span><span class="params">(Account account)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.getJdbcTemplate().update(<span class="string">&quot;update account set name = ?,money=? where id = ?&quot;</span>,account.getName(),account.getMoney(),account.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>service å±‚æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    Account <span class="title function_">findAccountById</span><span class="params">(Integer accountId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è½¬è´¦</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sourceName è½¬å‡ºè´¦æˆ·åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetName è½¬å…¥è´¦æˆ·åç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money è½¬å‡ºé‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String sourceName, String targetName, Float money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>service å±‚å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IAccountDao accountDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAccountDao</span><span class="params">(IAccountDao accountDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Account <span class="title function_">findAccountById</span><span class="params">(Integer accountId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountDao.findAccountById(accountId);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String sourceName, String targetName, Float money)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;transfer....&quot;</span>);</span><br><span class="line">        <span class="comment">//2.1æ ¹æ®åç§°æŸ¥è¯¢è½¬å‡ºè´¦æˆ·</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">source</span> <span class="operator">=</span> accountDao.findAccountByName(sourceName);</span><br><span class="line">        <span class="comment">//2.2æ ¹æ®åç§°æŸ¥è¯¢è½¬å…¥è´¦æˆ·</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">target</span> <span class="operator">=</span> accountDao.findAccountByName(targetName);</span><br><span class="line">        <span class="comment">//2.3è½¬å‡ºè´¦æˆ·å‡é’±</span></span><br><span class="line">        source.setMoney(source.getMoney()-money);</span><br><span class="line">        <span class="comment">//2.4è½¬å…¥è´¦æˆ·åŠ é’±</span></span><br><span class="line">        target.setMoney(target.getMoney()+money);</span><br><span class="line">        <span class="comment">//2.5æ›´æ–°è½¬å‡ºè´¦æˆ·</span></span><br><span class="line">        accountDao.updateAccount(source);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.6æ›´æ–°è½¬å…¥è´¦æˆ·</span></span><br><span class="line">        accountDao.updateAccount(target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å°±æ˜¯é‡å¤´æˆ â€”â€” Spring é…ç½®æ–‡ä»¶ä¸­å…³äºå£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„é…ç½®ï¼Œå…ˆç›´æ¥ä¸Šä»£ç ï¼Œç„¶åå†æ¥ä¸€ä¸€è§£æï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">                           https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®ä¸šåŠ¡å±‚--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.service.impl.AccountServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;accountDao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®è´¦æˆ·çš„æŒä¹…å±‚--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.yang.dao.impl.AccountDaoImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®æ•°æ®æº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///ssm?zeroDateTimeBehavior=convertToNull<span class="symbol">&amp;amp;</span>serverTimezone=GMT%2b8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®äº‹åŠ¡ç®¡ç†å™¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> </span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®äº‹åŠ¡çš„é€šçŸ¥--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;transfer&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®AOP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.yang.service.impl.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å»ºç«‹åˆ‡å…¥ç‚¹å’Œäº‹åŠ¡é€šçŸ¥çš„å¯¹åº”å…³ç³»--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼Œæˆ‘ä»¬å…ˆé…ç½®æ•°æ®æºã€å°†æ•°æ®æºæ³¨å…¥æŒä¹…å±‚ã€å°†æŒä¹…å±‚æ³¨å…¥ä¸šåŠ¡å±‚ï¼Œç„¶åå°±æ˜¯åŸºäº XML çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶ã€‚</p>
<blockquote>
<p>Spring ä¸­åŸºäº XML çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶é…ç½®æ­¥éª¤ï¼š</p>
</blockquote>
<p>1ã€é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2ã€é…ç½®äº‹åŠ¡çš„é€šçŸ¥ï¼Œéœ€è¦å¯¼å…¥äº‹åŠ¡çš„çº¦æŸ tx å’Œ aop çš„åç§°ç©ºé—´å’Œçº¦æŸï¼Œè¿™é‡Œçš„çº¦æŸåƒä¸‡ä¸è¦å¯¼é”™äº†ï¼Œå»ºè®®æ‰‹åŠ¨å¤åˆ¶å¯¼å…¥ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ IDEA çš„è‡ªåŠ¨å¯¼å…¥ã€‚é…ç½®äº‹åŠ¡é€šçŸ¥æ—¶éœ€è¦ä½¿ç”¨åˆ°ä¸€ä¸ªæ–°æ ‡ç­¾ <code>&lt;tx:advice&gt;</code>ï¼Œè¿™ä¸ªæ ‡ç­¾æœ‰ä¸¤ä¸ªå±æ€§ï¼š</p>
<ul>
<li>idï¼šç»™äº‹åŠ¡ç®¡ç†å™¨å–ä¸€ä¸ªå”¯ä¸€æ ‡å¿—</li>
<li>transaction-managerï¼šç»™äº‹åŠ¡é€šçŸ¥æä¾›ä¸€ä¸ªäº‹åŠ¡ç®¡ç†å™¨å¼•ç”¨</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3ã€é…ç½® AOP ä¸­çš„é€šç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œå»ºç«‹äº‹åŠ¡é€šçŸ¥å’Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å¯¹åº”å…³ç³»</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.yang.service.impl.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å»ºç«‹åˆ‡å…¥ç‚¹å’Œäº‹åŠ¡é€šçŸ¥çš„å¯¹åº”å…³ç³»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>4ã€é…ç½®äº‹åŠ¡çš„å±æ€§ï¼Œåœ¨äº‹åŠ¡çš„é€šçŸ¥ <code>&lt;tx:advice&gt;</code> æ ‡ç­¾çš„å†…éƒ¨è¿›è¡Œé…ç½®ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®äº‹åŠ¡çš„å±æ€§--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;transfer&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ ‡ç­¾ <code>&lt;tx:method&gt;</code> ä¸­æœ‰å¤šä¸ªå±æ€§ï¼Œå…¶å·¦å³å¦‚ä¸‹ï¼š</p>
<ul>
<li>nameï¼šæŒ‡å®šæŸä¸€åˆ‡å…¥ç‚¹æ–¹æ³•ï¼Œæ”¯æŒé€šé…ç¬¦ã€‚å¦‚ï¼š<code>find*</code> è¡¨ç¤ºä»¥ find å¼€å¤´çš„åˆ‡å…¥ç‚¹æ–¹æ³•ã€‚ä¼˜å…ˆçº§æ˜¯ï¼šå…¨åŒ¹é… &gt; åŠåŒ¹é…åŠé€šé… &gt; å…¨é€šé…ã€‚</li>
<li>isolationï¼šç”¨äºæŒ‡å®šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œé»˜è®¤å€¼ <code>DEFAULT</code>ï¼Œè¡¨ç¤ºä½¿ç”¨æ•°æ®åº“çš„éš”ç¦»çº§åˆ«</li>
<li>propagationï¼šç”¨äºæŒ‡å®šäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œé»˜è®¤å€¼ <code>REQUIRED</code>ï¼Œè¡¨ç¤ºä¸€å®šä¼šæœ‰äº‹åŠ¡ï¼Œæ˜¯å¢åˆ æ”¹çš„é€‰æ‹©ï¼ŒæŸ¥è¯¢æ–¹æ³•å¯ä»¥é€‰æ‹© <code>SUPPORTS</code></li>
<li>read-onlyï¼šç”¨äºæŒ‡å®šäº‹åŠ¡æ˜¯å¦åªè¯»ã€‚åªæœ‰æŸ¥è¯¢æ–¹æ³•æ‰èƒ½è®¾ç½®ä¸º <code>true</code>ã€‚é»˜è®¤å€¼æ˜¯ <code>false</code>ï¼Œè¡¨ç¤ºè¯»å†™</li>
<li>timeoutï¼šç”¨äºæŒ‡å®šäº‹åŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯ -1ï¼Œè¡¨ç¤ºæ‰€ä½¿ç”¨æ•°æ®åº“çš„é»˜è®¤è¶…æ—¶æ—¶é—´ã€‚å¦‚æœæŒ‡å®šäº†æ•°å€¼ï¼Œä»¥ç§’ä¸ºå•ä½</li>
<li>rollback-forï¼šç”¨äºæŒ‡å®šä¸€ä¸ªå¼‚å¸¸ï¼Œå½“äº§ç”Ÿè¯¥å¼‚å¸¸æ—¶ï¼Œäº‹åŠ¡å›æ»šï¼Œäº§ç”Ÿå…¶ä»–å¼‚å¸¸æ—¶ï¼Œäº‹åŠ¡ä¸ä¼šæ»šã€‚æ²¡æœ‰é»˜è®¤å€¼ï¼Œè¡¨ç¤ºä»»ä½•å¼‚å¸¸éƒ½å›æ»šã€‚</li>
<li>no-rollback-forï¼šç”¨äºæŒ‡å®šä¸€ä¸ªå¼‚å¸¸ï¼Œå½“äº§ç”Ÿè¯¥å¼‚å¸¸æ—¶ï¼Œäº‹åŠ¡ä¸ä¼šæ»šï¼Œäº§ç”Ÿå…¶ä»–å¼‚å¸¸æ—¶ï¼Œäº‹åŠ¡å›æ»šã€‚æ²¡æœ‰é»˜è®¤å€¼ï¼Œè¡¨ç¤ºä»»ä½•å¼‚å¸¸éƒ½å›æ»šã€‚</li>
</ul>
<h2 id="7-3-äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"><a class="header-anchor" href="#7-3-äº‹åŠ¡çš„éš”ç¦»çº§åˆ«"></a>7.3 äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</h2>
<blockquote>
<p>ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</p>
</blockquote>
<p>äº‹åŠ¡éš”ç¦»çº§åæ˜ äº‹åŠ¡æäº¤å¹¶å‘è®¿é—®æ—¶çš„å¤„ç†æ€åº¦ã€‚</p>
<p>è¿™é‡Œæ‰€æŒ‡çš„å¹¶å‘è®¿é—®å°±æ˜¯å¤šä¸ªäº‹åŠ¡ï¼ˆç”¨æˆ·ï¼‰åœ¨åŒä¸€æ—¶é—´è®¿é—®äº†ç›¸åŒçš„æ•°æ®ï¼Œè€ŒåŒä¸€æ—¶é—´å®é™…ä¸Šä¹Ÿæœ‰å¾®å°çš„å·®è·ï¼Œå¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„åŒä¸€æ—¶é—´ã€‚</p>
<p>åœ¨å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä»¥ä¸‹é—®é¢˜ï¼š<strong>è„è¯»</strong>ã€<strong>ä¸å¯é‡å¤è¯»</strong> å’Œ <strong>å¹»å½±è¯»</strong>ã€‚</p>
<p>è¿™äº›é—®é¢˜å¯ä»¥é€šè¿‡ <strong>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</strong> æ¥è§£å†³ï¼Œé€šè¿‡åœ¨éš”ç¦»çº§åˆ«ä¸­è®¾ç½®ä¸åŒçš„å€¼ï¼Œè§£å†³å¹¶å‘å¤„ç†è¿‡ç¨‹ä¸­çš„é—®é¢˜ã€‚</p>
<blockquote>
<p>è„è¯»</p>
</blockquote>
<p>è„è¯»ï¼ˆdirty readï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œè¿›è€Œåœ¨æœ¬äº‹åŠ¡ä¸­äº§ç”Ÿäº†æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡ã€‚</p>
<p>è¦è§£å†³è„è¯»ï¼Œéœ€è¦ä½¿ç”¨ <code>@Transactional(isolation = Isolation.READ_COMMITTED)</code>ã€‚</p>
<p>ã€Šæ•°æ®åº“ç³»ç»Ÿæ¦‚è®ºï¼ˆç¬¬äº”ç‰ˆï¼‰ã€‹ï¼ˆç‹çŠ è¨å¸ˆç…Šè‘—ï¼‰ä¸­æ˜¯è¿™æ ·æè¿°çš„ï¼šäº‹åŠ¡ T<sub>1</sub> ä¿®æ”¹æŸä¸€æ•°æ®å¹¶å°†å…¶å†™å›ç£ç›˜ï¼Œäº‹åŠ¡ T<sub>2</sub> è¯»å–åŒä¸€æ•°æ®åï¼ŒT<sub>1</sub> ç”±äºæŸäº›åŸå› è¢«æ’¤é”€ï¼Œè¿™æ—¶ T<sub>1</sub> ä¿®æ”¹è¿‡çš„æ•°æ®æ¢å¤åŸå€¼ï¼ŒT<sub>2</sub> è¯»åˆ°çš„æ•°æ®å°±ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œåˆ™ T<sub>2</sub> è¯»åˆ°çš„æ•°æ®å°±ä¸ºâ€œè„â€æ•°æ®ï¼Œå³ä¸æ­£ç¡®çš„æ•°æ®ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">T<sub>1</sub></th>
<th style="text-align:center">T<sub>2</sub></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">â‘ </td>
<td style="text-align:center">RÂ© = 100;<br />C = C * 2<br />WÂ© = 200</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">â‘¡</td>
<td style="text-align:center"></td>
<td style="text-align:center">RÂ© = 200</td>
</tr>
<tr>
<td style="text-align:center">â‘¢</td>
<td style="text-align:center">ROLLBACK<br />C æ¢å¤ä¸º 200</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>ä¸å¯é‡å¤è¯»</p>
</blockquote>
<p>ä¸å¯é‡å¤è¯»ï¼ˆnon-repeatable readï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–ç›¸åŒçš„æ•°æ®ï¼Œä½†æ˜¯è¯»å–çš„ç»“æœä¸ä¸€æ ·ã€‚</p>
<p>è¦è§£å†³ä¸å¯é‡å¤è¯»ï¼Œéœ€è¦ä½¿ç”¨ <code>@Transactional(isolation = Isolation.REPEATABLE_READ)</code>ã€‚å…¶æœ¬è´¨å°±æ˜¯è¡Œé”ã€‚</p>
<p>ã€Šæ•°æ®åº“ç³»ç»Ÿæ¦‚è®ºï¼ˆç¬¬äº”ç‰ˆï¼‰ã€‹ï¼ˆç‹çŠ è¨å¸ˆç…Šè‘—ï¼‰ä¸­æ˜¯è¿™æ ·æè¿°çš„ï¼šäº‹åŠ¡ T<sub>1</sub> è¯»å–æ•°æ®åï¼Œäº‹åŠ¡ T<sub>2</sub> æ‰§è¡Œäº†æ›´æ–°æ“ä½œï¼Œä½¿ T<sub>1</sub> æ— æ³•å†ç°å‰ä¸€æ¬¡è¯»å–ç»“æœã€‚å…·ä½“åœ°è®²ï¼Œä¸å¯é‡å¤è¯»åŒ…æ‹¬ä¸‰ç§æƒ…å†µï¼š</p>
<p>1ã€äº‹åŠ¡ T<sub>1</sub> è¯»å–äº†æŸä¸€æ•°æ®åï¼Œäº‹åŠ¡ T<sub>2</sub> å¯¹å…¶è¿›è¡Œäº†ä¿®æ”¹ï¼Œå½“äº‹åŠ¡ T<sub>1</sub> å†æ¬¡è¯»è¯¥æ•°æ®æ—¶ï¼Œå¾—åˆ°ä¸å‰ä¸€æ¬¡ä¸åŒçš„å€¼ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">T<sub>1</sub></th>
<th style="text-align:center">T<sub>2</sub></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">â‘ </td>
<td style="text-align:center">R(A) = 50<br />R(B) = 100<br />æ±‚å’Œ 150</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">â‘¡</td>
<td style="text-align:center"></td>
<td style="text-align:center">R(B) = 100<br />B = B * 2<br />W(B) = 200</td>
</tr>
<tr>
<td style="text-align:center">â‘¢</td>
<td style="text-align:center">R(A) = 50<br />R(B) = 200<br />æ±‚å’Œ 250ï¼ŒéªŒç®—ä¸å¯¹</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>2ã€äº‹åŠ¡ T<sub>1</sub> æŒ‰ä¸€å®šæ¡ä»¶ä»æ•°æ®åº“ä¸­è¯»å–äº†æŸäº›æ•°æ®è®°å½•åï¼Œäº‹åŠ¡ T<sub>2</sub> åˆ é™¤äº†å…¶ä¸­éƒ¨åˆ†è®°å½•ï¼Œå½“ T<sub>1</sub> å†æ¬¡æŒ‰ç›¸åŒæ¡ä»¶è¯»å–æ•°æ®æ—¶ï¼Œå‘ç°æŸäº›è®°å½•ç¥ç§˜åœ°æ¶ˆå¤±äº†ã€‚</p>
<p>3ã€äº‹åŠ¡ T<sub>1</sub> æŒ‰ä¸€å®šæ¡ä»¶ä»æ•°æ®åº“ä¸­è¯»å–æŸäº›æ•°æ®è®°å½•åï¼Œäº‹åŠ¡ T<sub>2</sub> æ’å…¥äº†ä¸€äº›æ•°æ®ï¼Œå½“ T<sub>1</sub> å†æ¬¡æŒ‰ç›¸åŒæ¡ä»¶è¯»å–æ•°æ®æ—¶ï¼Œå‘ç°å¤šäº†ä¸€äº›è®°å½•ã€‚</p>
<p>åä¸¤ç§ä¸å¯é‡å¤è¯»æœ‰æ—¶ä¹Ÿç§°ä¸ºå¹»å½±ï¼ˆphantom rowï¼‰ç°è±¡ã€‚</p>
<blockquote>
<p>å¹»å½±è¯»</p>
</blockquote>
<p>å¹»å½±è¯»ï¼šä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡å¯¹æ•´è¡¨ï¼ˆå¤šæ¡æ•°æ®ï¼‰è¿›è¡ŒæŸ¥è¯¢ç»Ÿè®¡ï¼Œä½†æ˜¯ç»“æœä¸ä¸€è‡´ã€‚</p>
<p>ä¸ã€Šæ•°æ®åº“ç³»ç»Ÿæ¦‚è®ºï¼ˆç¬¬äº”ç‰ˆï¼‰ã€‹ï¼ˆç‹çŠ è¨å¸ˆç…Šè‘—ï¼‰ä¸€ä¹¦ä¸­æåˆ°çš„ <strong>ä¸å¯é‡å¤è¯»çš„åä¸¤ç§æƒ…å†µ</strong> ç±»ä¼¼ã€‚</p>
<p>è¦è§£å†³å¹»å½±è¯»ï¼Œéœ€è¦ä½¿ç”¨ <code>@Transactional(isolation = Isolation.SERIALIZABLE)</code>ã€‚å…¶æœ¬è´¨å°±æ˜¯è¡¨é”ã€‚</p>
<blockquote>
<p>ä¸¢å¤±ä¿®æ”¹</p>
</blockquote>
<p>ã€Šæ•°æ®åº“ç³»ç»Ÿæ¦‚è®ºï¼ˆç¬¬äº”ç‰ˆï¼‰ã€‹ï¼ˆç‹çŠ è¨å¸ˆç…Šè‘—ï¼‰ä¸€ä¹¦ä¸­è®¤ä¸ºå¹¶å‘æ“ä½œå¸¦æ¥çš„æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µæœ‰ä¸¢å¤±ä¿®æ”¹ã€ä¸å¯é‡å¤è¯»å’Œè¯»â€œè„â€æ•°æ®ã€‚</p>
<p>è¿™é‡Œè¡¥å……ä¸€ä¸‹ä¸¢å¤±ä¿®æ”¹ï¼ˆlost updateï¼‰ï¼šä¸¤ä¸ªäº‹åŠ¡ T<sub>1</sub> å’Œ T<sub>2</sub> è¯»å…¥åŒä¸€æ•°æ®å¹¶ä¿®æ”¹ï¼ŒT<sub>2</sub> æäº¤çš„ç»“æœç ´åäº† T<sub>1</sub> æäº¤çš„ç»“æœï¼Œå¯¼è‡´ T<sub>1</sub> çš„ä¿®æ”¹è¢«ä¸¢å¤±ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">T<sub>1</sub></th>
<th style="text-align:center">T<sub>2</sub></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">â‘ </td>
<td style="text-align:center">R(A) = 16</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">â‘¡</td>
<td style="text-align:center"></td>
<td style="text-align:center">R(A) = 16</td>
</tr>
<tr>
<td style="text-align:center">â‘¢</td>
<td style="text-align:center">A = A - 1 <br />W(A) = 15</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">â‘£</td>
<td style="text-align:center"></td>
<td style="text-align:center">A = A - 1 <br />W(A) = 15</td>
</tr>
</tbody>
</table>
<p>SQL92 æ²¡æœ‰å®šä¹‰è¿™ç§ç°è±¡ï¼Œè§£å†³ä¸¢å¤±ä¿®æ”¹çš„åŠæ³•å°±æ˜¯åŠ é”ã€‚</p>
<blockquote>
<p>æ•°æ®åº“å¯¹äºéš”ç¦»çº§åˆ«çš„æ”¯æŒ</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">éš”ç¦»å±æ€§çš„å€¼</th>
<th style="text-align:center">MySQL</th>
<th style="text-align:center">Oracle</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">READ_COMMITTED</td>
<td style="text-align:center">âœ”ï¸</td>
<td style="text-align:center">âœ”ï¸</td>
</tr>
<tr>
<td style="text-align:center">REPEATABLE_READ</td>
<td style="text-align:center">âœ”ï¸</td>
<td style="text-align:center">âŒ</td>
</tr>
<tr>
<td style="text-align:center">SERIALIZABLE</td>
<td style="text-align:center">âœ”ï¸</td>
<td style="text-align:center">âœ”ï¸</td>
</tr>
</tbody>
</table>
<p>Oracle ä¸æ”¯æŒ <code>REPEATABLE_READ</code>ï¼Œé‚£å¦‚ä½•è§£å†³ä¸å¯é‡å¤è¯»å‘¢ï¼Ÿé‡‡ç”¨çš„æ˜¯å¤šç‰ˆæœ¬å¯¹æ¯”çš„æ–¹å¼æ¥è§£å†³ä¸å¯é‡å¤è¯»ã€‚</p>
<blockquote>
<p>Spring ä¸­äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</p>
</blockquote>
<p>åœ¨ Spring ä¸­ï¼Œäº‹åŠ¡æœ‰å¦‚ä¸‹äº”ç§éš”ç¦»çº§åˆ«ï¼š</p>
<p><code>DEFAULT</code>ï¼š<strong>é»˜è®¤çº§åˆ«</strong>ï¼Œä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚å¦‚ MySQL é»˜è®¤é‡‡ç”¨ <code>REPEATABLE_READ</code>ï¼ŒOracle é»˜è®¤é‡‡ç”¨ <code>READ_COMMITTED</code>ï¼›</p>
<p><code>READ_UNCOMMITTED</code>ï¼šæœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸å¯ä»¥è¯»å–æœªæäº¤æ•°æ®ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»ã€ä¸å¯é‡å¤è¯»ï¼›</p>
<p><code>READ_COMMITTED</code>ï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥è§£å†³è„è¯»ï¼Œä½†å¹»è¯»ã€ä¸å¯é‡å¤è¯»ä»å¯èƒ½å‘ç”Ÿï¼›</p>
<p><code>REPEATABLE_READ</code>ï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥è§£å†³è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»å¯èƒ½å‘ç”Ÿï¼›</p>
<p><code>SERIALIZABLE</code>ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œäº‹åŠ¡ä¹‹é—´ä¸ä¼šäº§ç”Ÿå¹²æ‰°ï¼Œ<strong>è¯¥çº§åˆ«å¯ä»¥è§£å†³è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»</strong>ã€‚è¿™ç§çº§åˆ«ä¸‹å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸ä¼šä½¿ç”¨è¯¥çº§åˆ«ã€‚</p>
<p>ä»å¹¶å‘å®‰å…¨çš„è§’åº¦æ¥è®²ï¼šSERIALIZABLE å¤§äº REPEATABLE_READ å¤§äº READ_COMMITTEDï¼›</p>
<p>ä»è¿è¡Œæ•ˆç‡çš„è§’åº¦æ¥è®²ï¼šREAD_COMMITTED å¤§äº REPEATABLE_READ å¤§äº SERIALIZABLEã€‚</p>
<p>MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§æ˜¯ <strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</strong>ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@tx_isolation</span>; # MySQL <span class="number">8.0</span> ä¹‹å‰</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@transaction_isolation</span>; # MySQL <span class="number">8.0</span> ä»¥å</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å®æˆ˜ä¸­çš„å»ºè®®</p>
</blockquote>
<p>æ¨èä½¿ç”¨ Spring æŒ‡å®šçš„é»˜è®¤éš”ç¦»çº§åˆ« <code>DEFAULT</code> å³å¯ï¼Œå®ƒå°†ä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚</p>
<p>åœ¨æœªæ¥çš„å®æˆ˜ä¸­ï¼Œå®é™…çš„å¹¶å‘è®¿é—®æƒ…å†µå¾ˆä½ï¼Œå¦‚æœçœŸçš„é‡åˆ°äº†å¹¶å‘é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä¹è§‚é”æ¥è§£å†³ã€‚å¦‚æœä½¿ç”¨ Hibernateï¼ˆJPAï¼‰å¯ä»¥ä½¿ç”¨ Versionï¼Œå¦‚æœä½¿ç”¨ Mybatisï¼Œå°±éœ€è¦é€šè¿‡æ‹¦æˆªå™¨è‡ªå®šä¹‰å¼€å‘ã€‚</p>
<h2 id="7-4-äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º"><a class="header-anchor" href="#7-4-äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º"></a>7.4 äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</h2>
<p>äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºæè¿°äº†äº‹åŠ¡è§£å†³åµŒå¥—é—®é¢˜çš„ç‰¹å¾ã€‚Service åœ¨è°ƒç”¨ Service æ—¶ï¼Œææœ‰å¯èƒ½å‡ºç°äº‹åŠ¡çš„åµŒå¥—ã€‚æ‰€è°“äº‹åŠ¡çš„åµŒå¥—ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªå¤§äº‹åŠ¡ä¸­åŒ…å«äº†è‹¥å¹²ä¸ªå°äº‹åŠ¡ï¼Œå®ƒä»¬å½¼æ­¤å½±å“ï¼Œæœ€ç»ˆå°±ä¼šå¯¼è‡´å¤–éƒ¨å¤§çš„äº‹åŠ¡ä¸§å¤±äº†äº‹åŠ¡çš„åŸå­æ€§ã€‚åœ¨ Spring ä¸­ï¼Œå…±æœ‰ä»¥ä¸‹ 7 ä¸ªä¼ æ’­è¡Œä¸ºï¼š</p>
<p><code>REQUIRED</code>ï¼šå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒåŠ å…¥åˆ°è¿™ä¸ªäº‹åŠ¡ä¸­ï¼Œä¸€èˆ¬çš„é€‰æ‹©ï¼ˆé»˜è®¤å€¼ï¼‰</p>
<p><code>SUPPORTS</code>ï¼šä½¿ç”¨å½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ</p>
<p><code>REQUERS_NEW</code>ï¼šæ–°å»ºäº‹åŠ¡ï¼Œå¦‚æœå½“å‰åœ¨äº‹åŠ¡ä¸­ï¼ŒæŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·</p>
<p><code>NOT_SUPPORTED</code>ï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·</p>
<p><code>NEVER</code>ï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŠ›å‡ºå¼‚å¸¸</p>
<p><code>MANDATORY</code>ï¼šä½¿ç”¨å½“å‰çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</p>
<p><code>NESTED</code>ï¼šå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ‰§è¡Œ REQUIRED ç±»ä¼¼çš„æ“ä½œã€‚å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œï¼Œä½œä¸ºå­äº‹åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šå¦‚æœå¤–éƒ¨å­˜åœ¨äº‹åŠ¡ï¼Œ<code>NESTED</code> ä¿®é¥°çš„å†…éƒ¨æ–¹æ³•å±äºå¤–éƒ¨äº‹åŠ¡çš„å­äº‹åŠ¡ï¼Œå¤–éƒ¨ä¸»äº‹åŠ¡å›æ»šæ—¶ï¼Œå­äº‹åŠ¡ä¹Ÿä¼šå›æ»šï¼Œè€Œå†…éƒ¨å­äº‹åŠ¡å¯ä»¥å•ç‹¬å›æ»šä½†ä¸å½±å“å¤–éƒ¨ä¸»äº‹åŠ¡å’Œå…¶ä»–å­äº‹åŠ¡ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">å€¼</th>
<th style="text-align:center">å¤–éƒ¨ä¸å­˜åœ¨äº‹åŠ¡</th>
<th style="text-align:center">å¤–éƒ¨å­˜åœ¨äº‹åŠ¡</th>
<th style="text-align:center">ç”¨æ³•</th>
<th style="text-align:center">å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">REQUIRED</td>
<td style="text-align:center">å¼€å¯æ–°çš„äº‹åŠ¡</td>
<td style="text-align:center">èåˆåˆ°å¤–éƒ¨äº‹åŠ¡ä¸­</td>
<td style="text-align:center">@Transactional(propagation = Propagation.REQUIRED)</td>
<td style="text-align:center">å¢åˆ æ”¹æ–¹æ³•</td>
</tr>
<tr>
<td style="text-align:center">SUPPORTS</td>
<td style="text-align:center">ä¸å¼€å¯äº‹åŠ¡</td>
<td style="text-align:center">èåˆåˆ°å¤–éƒ¨äº‹åŠ¡ä¸­</td>
<td style="text-align:center">@Transactional(propagation = Propagation.SUPPORTS)</td>
<td style="text-align:center">æŸ¥è¯¢æ–¹æ³•</td>
</tr>
<tr>
<td style="text-align:center">REQUERS_NEW</td>
<td style="text-align:center">å¼€å¯æ–°çš„äº‹åŠ¡</td>
<td style="text-align:center">æŒ‚èµ·å¤–éƒ¨äº‹åŠ¡ï¼Œåˆ›å»ºæ–°çš„äº‹åŠ¡</td>
<td style="text-align:center">@Transactional(propagation = Propagation.REQUERS_NEW)</td>
<td style="text-align:center">æ—¥å¿—è®°å½•æ–¹æ³•</td>
</tr>
<tr>
<td style="text-align:center">NOT_SUPPORTED</td>
<td style="text-align:center">ä¸å¼€å¯äº‹åŠ¡</td>
<td style="text-align:center">æŒ‚èµ·å¤–éƒ¨äº‹åŠ¡</td>
<td style="text-align:center">@Transactional(propagation = Propagation.NOT_SUPPORTED)</td>
<td style="text-align:center">æå…¶ä¸å¸¸ç”¨</td>
</tr>
<tr>
<td style="text-align:center">NEVER</td>
<td style="text-align:center">ä¸å¼€å¯äº‹åŠ¡</td>
<td style="text-align:center">æŠ›å‡ºå¼‚å¸¸</td>
<td style="text-align:center">@Transactional(propagation = Propagation.NEVER)</td>
<td style="text-align:center">æå…¶ä¸å¸¸ç”¨</td>
</tr>
<tr>
<td style="text-align:center">MANDATORY</td>
<td style="text-align:center">æŠ›å‡ºå¼‚å¸¸</td>
<td style="text-align:center">èåˆåˆ°å¤–éƒ¨äº‹åŠ¡ä¸­</td>
<td style="text-align:center">@Transactional(propagation = Propagation.MANDATORY)</td>
<td style="text-align:center">æå…¶ä¸å¸¸ç”¨</td>
</tr>
<tr>
<td style="text-align:center">NESTED</td>
<td style="text-align:center">å¼€å¯æ–°çš„äº‹åŠ¡</td>
<td style="text-align:center">ä½œä¸ºå¤–éƒ¨äº‹åŠ¡çš„å­äº‹åŠ¡</td>
<td style="text-align:center">@Transactional(propagation = Propagation.NESTED)</td>
<td style="text-align:center">æå…¶ä¸å¸¸ç”¨</td>
</tr>
</tbody>
</table>
<h2 id="7-5-æ³¨è§£é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†"><a class="header-anchor" href="#7-5-æ³¨è§£é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†"></a>7.5 æ³¨è§£é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†</h2>
<p>è™½ç„¶æ˜¯åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶ï¼Œä½†å¹¶ä¸æ˜¯å…¨æ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶ï¼Œæˆ‘ä»¬ä¾æ—§éœ€è¦åœ¨ XML ä¸­è¿›è¡Œä¸€äº›é…ç½®ã€‚</p>
<p>ä½¿ç”¨æ³¨è§£é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œéœ€è¦åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„çº¦æŸï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot; </span></span></span><br><span class="line"><span class="string"><span class="tag">                  http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">                  http://www.springframework.org/schema/beans/spring-beans.xsd </span></span></span><br><span class="line"><span class="string"><span class="tag">                  http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">                  http://www.springframework.org/schema/aop/spring-aop.xsd </span></span></span><br><span class="line"><span class="string"><span class="tag">                  http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">                  http://www.springframework.org/schema/tx/spring-tx.xsd </span></span></span><br><span class="line"><span class="string"><span class="tag">                  http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">                  http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é…ç½® Spring åˆ›å»ºå®¹å™¨æ—¶è¦æ‰«æçš„åŒ…ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.yang&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çš„ Dao å®ç°ç±»ç»§æ‰¿äº† <code>JdbcDaoSupport</code>ï¼Œä½¿ç”¨åŸºäºXMLçš„é…ç½®æ—¶å¯ä»¥å»é™¤å¤šä½™ä»£ç ï¼Œä½†ç°åœ¨è¦ä½¿ç”¨æ³¨è§£ï¼Œå› æ­¤å°±ä¸èƒ½ç»§æ‰¿ <code>JdbcDaoSupport</code> ç±»ï¼Œåœ°è€è€å®å®æ³¨å…¥ JdbcTemplateã€‚</p>
<p>Dao å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;accountDao&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">IAccountDao</span> &#123; </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> </span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate; </span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…¶ä½™ä»£ç å’ŒåŸºäº XML çš„é…ç½®ç›¸åŒ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶æ³¨å…¥äº† JdbcTemplateï¼Œä½† Spring å®¹å™¨ä¸­å¹¶æ²¡æœ‰å•Šï¼Œå› æ­¤éœ€è¦åœ¨ Spring å®¹å™¨ä¸­æ·»åŠ  JdbcTemplateï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br></pre></td></tr></table></figure>
<p>æ·»åŠ  JdbcTemplate æ—¶ï¼Œéœ€è¦æ³¨å…¥æ•°æ®æºï¼Œæ•°æ®æºä¸åŸºäº XML çš„é…ç½®ç›¸åŒï¼Œè¿™é‡Œå°±ä¸åˆ—ä¸¾äº†ã€‚</p>
<p>è‡³äºå‘å®¹å™¨ä¸­æ·»åŠ ä¸šåŠ¡å±‚å®ç°ç±»ã€Dao æˆå®ç°ç±»ï¼Œä»¥åŠæ•°æ®çš„æ³¨å…¥ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ç›¸å…³æ³¨è§£åœ¨ä»£ç ä¸­å®ç°ã€‚</p>
<blockquote>
<p>Spring ä¸­åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†é…ç½®æ­¥éª¤ï¼š</p>
</blockquote>
<p>1ã€é…ç½®äº‹åŠ¡ç®¡ç†å™¨å¹¶æ³¨å…¥æ•°æ®æº</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br></pre></td></tr></table></figure>
<p>2ã€å¼€å¯ Spring å¯¹æ³¨è§£äº‹åŠ¡çš„æ”¯æŒ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼€å¯ spring å¯¹æ³¨è§£äº‹åŠ¡çš„æ”¯æŒ --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span> </span><br></pre></td></tr></table></figure>
<p>3ã€åœ¨éœ€è¦äº‹åŠ¡æ”¯æŒçš„åœ°æ–¹ä½¿ç”¨ <code>@Transactional</code> æ³¨è§£ï¼ˆä¸€èˆ¬åœ¨ä¸šåŠ¡å±‚å®ç°ç±»æ·»åŠ ï¼‰</p>
<p>ä½¿ç”¨äº† <code>@Transactional</code> æ³¨è§£åï¼ŒXML ä¸­é…ç½®äº‹åŠ¡é€šçŸ¥çš„ <code>&lt;tx:advice&gt;</code> æ ‡ç­¾å’Œé…ç½® AOPçš„ <code>&lt;aop:config&gt;</code> æ ‡ç­¾å°±å¯ä»¥çœç•¥äº†ï¼</p>
<p><code>@Transactional</code> æ³¨è§£çš„å±æ€§å’Œ XML ä¸­ <code>&lt;tx:method&gt;</code> æ ‡ç­¾çš„å±æ€§å«ä¹‰ä¸€è‡´ï¼ˆä¸æ˜ç™½å¯ä»¥è¿›å…¥è¯¥æ³¨è§£æŸ¥çœ‹ï¼‰ã€‚</p>
<p>è¯¥æ³¨è§£å¯ä»¥å‡ºç°åœ¨æ¥å£ä¸Šï¼Œç±»ä¸Šå’Œæ–¹æ³•ä¸Šã€‚</p>
<ul>
<li>
<p>å‡ºç°æ¥å£ä¸Šï¼Œè¡¨ç¤ºè¯¥æ¥å£çš„æ‰€æœ‰å®ç°ç±»éƒ½æœ‰äº‹åŠ¡æ”¯æŒã€‚</p>
</li>
<li>
<p>å‡ºç°åœ¨ç±»ä¸Šï¼Œè¡¨ç¤ºç±»ä¸­æ‰€æœ‰æ–¹æ³•æœ‰äº‹åŠ¡æ”¯æŒ</p>
</li>
<li>
<p>å‡ºç°åœ¨æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºæ–¹æ³•æœ‰äº‹åŠ¡æ”¯æŒã€‚</p>
</li>
</ul>
<p>ä»¥ä¸Šä¸‰ä¸ªä½ç½®çš„ä¼˜å…ˆçº§ï¼šæ–¹æ³• &gt; ç±» &gt; æ¥å£</p>
<hr>
<p>å¦‚æœä¸æƒ³ä½¿ç”¨ XML é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¨æ³¨è§£é…ç½®ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="meta">@ComponentScan(basePackages=&quot;com.yang&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;JdbcConfig.class, TransactionConfig.class&#125;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;jdbcConfig.properties&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringTxConfiguration</span> &#123; </span><br><span class="line">  <span class="comment">//é…ç½®æ•°æ®æºã€é…ç½® JdbcTemplateã€é…ç½®äº‹åŠ¡ç®¡ç†å™¨ã€‚</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h2 id="7-6-ä¸ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„å¯¹æ¯”"><a class="header-anchor" href="#7-6-ä¸ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„å¯¹æ¯”"></a>7.6 ä¸ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„å¯¹æ¯”</h2>
<p>æœ€å¼€å§‹å°±è¯´äº† Spring æ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†å’Œå£°æ˜å¼çš„äº‹åŠ¡ç®¡ç†ï¼Œä½†æ˜¯åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ã€‚å¯¹äºä¸€ä¸‹å£°æ˜å¼äº‹åŠ¡ç®¡ç†å’Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ï¼š</p>
<p><strong>ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ï¼š</strong></p>
<p>å°†äº‹åŠ¡ç®¡ç†ä»£ç åµŒåˆ°ä¸šåŠ¡æ–¹æ³•ä¸­æ¥æ§åˆ¶äº‹åŠ¡çš„æäº¤å’Œå›æ»š</p>
<p>ç¼ºç‚¹ï¼šå¿…é¡»åœ¨æ¯ä¸ªäº‹åŠ¡æ“ä½œä¸šåŠ¡é€»è¾‘ä¸­åŒ…å«é¢å¤–çš„äº‹åŠ¡ç®¡ç†ä»£ç </p>
<p>PSï¼šåœ¨ SpringBoot ä¸­ï¼Œç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„ä½¿ç”¨è¢«å¤§å¤§ç®€åŒ–ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†æ¥é¿å…æäº¤å¤§äº‹åŠ¡ã€‚</p>
<p><strong>å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼š</strong></p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹æ¯”ç¼–ç¨‹å¼äº‹åŠ¡å¥½ç”¨ã€‚</p>
<p>å°†äº‹åŠ¡ç®¡ç†ä»£ç ä»ä¸šåŠ¡æ–¹æ³•ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»¥å£°æ˜çš„æ–¹å¼æ¥å®ç°äº‹åŠ¡ç®¡ç†ã€‚</p>
<p>å°†äº‹åŠ¡ç®¡ç†ä½œä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œé€šè¿‡ AOP æ–¹æ³•æ¨¡å—åŒ–ã€‚Spring ä¸­é€šè¿‡ Spring AOP æ¡†æ¶æ”¯æŒå£°æ˜å¼äº‹åŠ¡<br>
ç®¡ç†ã€‚</p>
<hr>
<p>å¦‚æœæƒ³äº†è§£ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹è§†é¢‘ï¼š<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Sb411s7vP?p=80">Springæ•™ç¨‹IDEAç‰ˆ-4å¤©-2018é»‘é©¬SSM-02 P80</a></p>
<p>æœ¬æ–‡ä¹Ÿæ˜¯æ ¹æ®æ­¤è§†é¢‘ç¼–å†™çš„ï¼Œæ„Ÿè°¢é»‘é©¬ç¨‹åºå‘˜çš„å¼ é˜³è€å¸ˆï¼ ğŸ‘</p>
<hr>
<p><span style="text-align: center;display:block;">Spring åŸºç¡€å®Œ</span></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://mofan212.github.io">é»˜çƒ¦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://mofan212.github.io/posts/Learning-Spring-From-0/">https://mofan212.github.io/posts/Learning-Spring-From-0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://mofan212.github.io" target="_blank">Mofan</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring/">Spring</a></div><div class="post-share"><div class="social-share" data-image="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/61.jpg" data-sites="wechat,qq,weibo,facebook,x"></div><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" target="_blank"><img class="post-qr-code-img" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" target="_blank"><img class="post-qr-code-img" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/Java-Socket/" title="Java ç½‘ç»œç¼–ç¨‹åŸºç¡€"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/60.jpg" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">Java ç½‘ç»œç¼–ç¨‹åŸºç¡€</div></div><div class="info-2"><div class="info-item-1">æœ¬æ–‡ä»‹ç»äº† Java ä¸­ç½‘ç»œç¼–ç¨‹åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬ TCP ç½‘ç»œç¼–ç¨‹ã€UDP ç½‘ç»œç¼–ç¨‹å’Œ URL ç¼–ç¨‹ã€‚</div></div></div></a><a class="pagination-related" href="/posts/Something-About-Base64/" title="Base64 ç¼–ç çš„é‚£äº›äº‹"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/62.jpg" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">Base64 ç¼–ç çš„é‚£äº›äº‹</div></div><div class="info-2"><div class="info-item-1">Base64 ç¼–ç çš„åŸç†å’Œç®€å•åº”ç”¨ã€‚</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/SpringIoC/" title="Spring IoC å·©å›ºç†è§£"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/14.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-29</div><div class="info-item-2">Spring IoC å·©å›ºç†è§£</div></div><div class="info-2"><div class="info-item-1">åˆ°åº•ä»€ä¹ˆæ˜¯ Iocï¼Ÿ</div></div></div></a><a class="pagination-related" href="/posts/Simple-Use-Of-BeanCopier/" title="BeanCopier çš„ç®€å•ä½¿ç”¨"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/84.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-19</div><div class="info-item-2">BeanCopier çš„ç®€å•ä½¿ç”¨</div></div><div class="info-2"><div class="info-item-1">åˆ©ç”¨ MapStruct å®ç° Bean æ‹·è´å¤ªè‡ƒè‚¿ï¼Ÿè¯•è¯• BeanCopierã€‚</div></div></div></a><a class="pagination-related" href="/posts/Supplementary-Content-For-Spring/" title="Spring è¡¥å……"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/99.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-07</div><div class="info-item-2">Spring è¡¥å……</div></div><div class="info-2"><div class="info-item-1">å¯¹ Spring ä¸­çš„åˆ›å»ºå¤æ‚å¯¹è±¡ã€å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ã€åç½®å¤„ç† bean ç­‰å†…å®¹è¿›è¡Œè¡¥å……ã€‚</div></div></div></a><a class="pagination-related" href="/posts/Spring's-Enhancements-To-Java-Annotation/" title="Spring å¯¹ Java æ³¨è§£çš„å¢å¼º"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/133.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-15</div><div class="info-item-2">Spring å¯¹ Java æ³¨è§£çš„å¢å¼º</div></div><div class="info-2"><div class="info-item-1">æœ¬æ–‡ä»‹ç»äº† Spring ä¸­ @AliasFor æ³¨è§£çš„ä½¿ç”¨æ–¹å¼å’ŒJDK ä¸­ä¸€äº›å…ƒæ³¨è§£çš„ä½¿ç”¨ã€‚</div></div></div></a><a class="pagination-related" href="/posts/Annotation-Of-Spring/" title="Spring æ³¨è§£"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/13.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-29</div><div class="info-item-2">Spring æ³¨è§£</div></div><div class="info-2"><div class="info-item-1">æœ¬èŠ‚ä»‹ç»äº† Springã€SpringBoot ä¸­ä¸€äº›æ³¨è§£çš„ä½¿ç”¨æ–¹å¼ã€‚</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">é»˜çƒ¦</div><div class="author-info-description">å½©ç¬”çš„æ‰“æ€ªå‡çº§ä¹‹è·¯...</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">174</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">54</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">37</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mofan212"><i class="fab fa-github"></i><span>follow me</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:cy.mofan@foxmail.com" target="_blank" title="é‚®ç®±"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æœ¬ç«™æ‰€æœ‰åšæ–‡å‡æ˜¯åšä¸»çš„å­¦ä¹ ç¬”è®°ä¸ä¸ªäººç†è§£ã€‚<strong><font style="color:red">é™¤ç‰¹åˆ«æ³¨æ˜å¤–ï¼Œ</font>å¦‚éœ€è½¬è½½ï¼Œè¯·åœ¨æ–‡ç« å¤´éƒ¨é†’ç›®å¤„é™„å¸¦åŸæ–‡é“¾æ¥å¹¶<a href="./mine/" style="color:#49B1F5;text-decoration:underline">å‘ŠçŸ¥æˆ‘</a></strong>ä½ å°†è½¬è½½ã€‚ğŸ˜Š</br><strong><font style="color:red">ä¸¥ç¦æœªéµå¾ªè§„èŒƒçš„è½¬è½½ã€‚</font></strong>ğŸ˜¡</br><strong>æ­»å»çš„è¯„è®ºç³»ç»Ÿå¤æ´»å•¦ï¼æ¬¢è¿åˆ°ç•™è¨€æ¿ç•…æ‰€æ¬²è¨€ï¼</strong>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´é«˜æ•ˆçš„<a target="_blank" href="https://space.bilibili.com/23658864/dynamic" style="color:#49B1F5;text-decoration:underline"> å“”å“©å“”å“©ç§ä¿¡ </a>æˆ–<a href="mailto:cy.mofan@foxmail.com" style="color:#49B1F5;text-decoration:underline" target="_blank">é‚®ç®±</a>ã€‚ ğŸ˜‰</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Spring-%E6%A6%82%E8%BF%B0"><span class="toc-text">1. Spring æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Spring-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">1.1 Spring æ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Spring-%E5%8F%91%E5%B1%95%E6%A6%82%E8%BF%B0"><span class="toc-text">1.2 Spring å‘å±•æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-Spring-%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-text">1.3 Spring çš„ä¼˜åŠ¿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-Spring-%E7%9A%84%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-text">1.4 Spring çš„ä½“ç³»ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E7%A8%8B%E5%BA%8F%E7%9A%84%E8%80%A6%E5%90%88"><span class="toc-text">2. ç¨‹åºçš„è€¦åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E8%80%A6%E5%90%88%E4%B8%8E%E8%A7%A3%E8%80%A6%E7%9A%84%E5%88%86%E6%9E%90"><span class="toc-text">2.1 è€¦åˆä¸è§£è€¦çš„åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E4%BB%A3%E7%A0%81%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-text">2.2 ä»£ç é—®é¢˜åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E8%A7%A3%E8%80%A6"><span class="toc-text">2.3 å·¥å‚æ¨¡å¼è§£è€¦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%8E%E6%94%B9%E8%BF%9B"><span class="toc-text">2.4 å­˜åœ¨çš„é—®é¢˜ä¸æ”¹è¿›</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC-IoC"><span class="toc-text">2.5 æ§åˆ¶åè½¬ - IoC</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Spring-%E4%B8%8E-IoC"><span class="toc-text">3. Spring ä¸ IoC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E4%BD%BF%E7%94%A8-Spring-%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1"><span class="toc-text">3.1 ä½¿ç”¨ Spring åˆ›å»ºå¯¹è±¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-ApplicationContext"><span class="toc-text">3.2 ApplicationContext</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Spring-%E4%B8%AD-Bean-%E7%9A%84%E7%BB%86%E8%8A%82"><span class="toc-text">3.3 Spring ä¸­ Bean çš„ç»†èŠ‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-text">3.4 ä¾èµ–æ³¨å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-IoC-%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3"><span class="toc-text">3.5 IoC ç›¸å…³æ³¨è§£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E6%95%B4%E5%90%88-JUnit5"><span class="toc-text">3.6 æ•´åˆ JUnit5</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-text">4. åŠ¨æ€ä»£ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%9F%BA%E4%BA%8E%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-text">4.1 åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%9F%BA%E4%BA%8E%E5%AD%90%E7%B1%BB%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-text">4.2 åŸºäºå­ç±»çš„åŠ¨æ€ä»£ç†</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Spring-%E4%B8%8E-AOP"><span class="toc-text">5. Spring ä¸ AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-AOP-%E6%A6%82%E8%BF%B0"><span class="toc-text">5.1 AOP æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-AOP-%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-text">5.2 AOP ç›¸å…³æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E5%9F%BA%E4%BA%8E-XML-%E9%85%8D%E7%BD%AE%E7%9A%84-AOP"><span class="toc-text">5.3 åŸºäº XML é…ç½®çš„ AOP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">5.4 åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-%E5%B8%B8%E8%A7%81%E5%9B%9B%E7%A7%8D%E9%80%9A%E7%9F%A5%E7%B1%BB%E5%9E%8B"><span class="toc-text">5.5 å¸¸è§å››ç§é€šçŸ¥ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6-%E7%8E%AF%E7%BB%95%E9%80%9A%E7%9F%A5"><span class="toc-text">5.6 ç¯ç»•é€šçŸ¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-7-%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84-AOP"><span class="toc-text">5.7 åŸºäºæ³¨è§£çš„ AOP</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-JdbcTemplate"><span class="toc-text">6. JdbcTemplate</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">6.1 å‡†å¤‡å·¥ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">6.2 åŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E4%B8%8E-Spring-IoC-%E7%BB%93%E5%90%88"><span class="toc-text">6.3 ä¸ Spring IoC ç»“åˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-CRUD-%E6%93%8D%E4%BD%9C"><span class="toc-text">6.4 CRUD æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E4%B8%8E-Dao-%E7%BB%93%E5%90%88"><span class="toc-text">6.2 ä¸ Dao ç»“åˆ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-text">7. äº‹åŠ¡ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-text">7.1 æ‰‹åŠ¨å®ç°äº‹åŠ¡ç®¡ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-XML-%E9%85%8D%E7%BD%AE%E7%9A%84%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-text">7.2 XML é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-text">7.3 äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA"><span class="toc-text">7.4 äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E7%9A%84%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-text">7.5 æ³¨è§£é…ç½®çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-6-%E4%B8%8E%E7%BC%96%E7%A8%8B%E5%BC%8F%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-text">7.6 ä¸ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†çš„å¯¹æ¯”</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Something-About-Blog/" title="åšå®¢æ­å»ºä¸ç»´æŠ¤"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/42.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="åšå®¢æ­å»ºä¸ç»´æŠ¤"/></a><div class="content"><a class="title" href="/posts/Something-About-Blog/" title="åšå®¢æ­å»ºä¸ç»´æŠ¤">åšå®¢æ­å»ºä¸ç»´æŠ¤</a><time datetime="2026-01-24T16:00:00.000Z" title="æ›´æ–°äº 2026-01-25 00:00:00">2026-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Memory-Model/" title="Java å†…å­˜æ¨¡å‹"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/174.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java å†…å­˜æ¨¡å‹"/></a><div class="content"><a class="title" href="/posts/Java-Memory-Model/" title="Java å†…å­˜æ¨¡å‹">Java å†…å­˜æ¨¡å‹</a><time datetime="2026-01-02T16:00:00.000Z" title="æ›´æ–°äº 2026-01-03 00:00:00">2026-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Bytecode-And-Class-Loading/" title="å­—èŠ‚ç ä¸ç±»åŠ è½½"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/173.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="å­—èŠ‚ç ä¸ç±»åŠ è½½"/></a><div class="content"><a class="title" href="/posts/Java-Bytecode-And-Class-Loading/" title="å­—èŠ‚ç ä¸ç±»åŠ è½½">å­—èŠ‚ç ä¸ç±»åŠ è½½</a><time datetime="2026-01-01T16:00:00.000Z" title="æ›´æ–°äº 2026-01-02 00:00:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Class-Resource-Loading-In-Java/" title="Java çš„ç±»èµ„æºåŠ è½½"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/103.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java çš„ç±»èµ„æºåŠ è½½"/></a><div class="content"><a class="title" href="/posts/Class-Resource-Loading-In-Java/" title="Java çš„ç±»èµ„æºåŠ è½½">Java çš„ç±»èµ„æºåŠ è½½</a><time datetime="2026-01-01T16:00:00.000Z" title="æ›´æ–°äº 2026-01-02 00:00:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Annotation-And-Reflection/" title="æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/20.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„"/></a><div class="content"><a class="title" href="/posts/Annotation-And-Reflection/" title="æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„">æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„</a><time datetime="2026-01-01T16:00:00.000Z" title="æ›´æ–°äº 2026-01-02 00:00:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ren-zhi-jue-xing/" title="è®¤çŸ¥è§‰é†’"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/172.webp" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="è®¤çŸ¥è§‰é†’"/></a><div class="content"><a class="title" href="/posts/ren-zhi-jue-xing/" title="è®¤çŸ¥è§‰é†’">è®¤çŸ¥è§‰é†’</a><time datetime="2025-12-28T16:00:00.000Z" title="æ›´æ–°äº 2025-12-29 00:00:00">2025-12-29</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2020 - 2026 By é»˜çƒ¦</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><script src="https://testingcf.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://testingcf.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://testingcf.jsdelivr.net/npm/vanilla-lazyload@latest/dist/lazyload.iife.min.js"></script><script src="https://testingcf.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://gcore.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources@master/js/mine.min.js"></script><script src="/js/tip_portal.js"></script><script defer="defer" id="ribbon" src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="click-show-text" src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Azathoth,Yog-Sothoth,Shub-Niggurath,Nyarlathotep,Cthulhu,Hastur,Abhoth,Ghroth,Tsathoggua,Cthugha,Deep Ones,Dagon,Chaugnar Faugn,Mordiggian,Shoggoth,Old One,Mi-Go,Great Race of Yith,Flying Polyp,Hounds of Tindalos,Dhole" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@docsearch/css/dist/style.min.css"/><script src="https://testingcf.jsdelivr.net/npm/@docsearch/js/dist/umd/index.min.js"></script><script>(() => {
  docsearch(Object.assign({
    appId: 'BAFEL7A6K1',
    apiKey: '89fcb5961984c5c054bf04149f345f38',
    indexName: 'mofan212io',
    container: '#docsearch',
    placeholder: 'è¾“å…¥å…³é”®å­—è¿›è¡Œæœç´¢',
  }, null))

  const handleClick = () => {
    document.querySelector('.DocSearch-Button').click()
  }

  const searchClickFn = () => {
    btf.addEventListenerPjax(document.querySelector('#search-button > .search'), 'click', handleClick)
  }

  searchClickFn()
  window.addEventListener('pjax:complete', searchClickFn)
})()</script></div></div></body></html>