<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【MySQL 一】DQL | Mofan</title><meta name="author" content="默烦,cy.mofan@foxmail.com"><meta name="copyright" content="默烦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文介绍了 MySQL 中查询语句的用法与示例，包括多表查询、单行函数、聚合函数、子查询等内容。">
<meta property="og:type" content="article">
<meta property="og:title" content="【MySQL 一】DQL">
<meta property="og:url" content="https://mofan212.github.io/posts/DQL-Of-MySQL/index.html">
<meta property="og:site_name" content="Mofan">
<meta property="og:description" content="本文介绍了 MySQL 中查询语句的用法与示例，包括多表查询、单行函数、聚合函数、子查询等内容。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/105.png">
<meta property="article:published_time" content="2022-08-27T16:00:00.000Z">
<meta property="article:modified_time" content="2024-01-07T16:00:00.000Z">
<meta property="article:author" content="默烦">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/105.png"><link rel="shortcut icon" href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/favicon.png"><link rel="canonical" href="https://mofan212.github.io/posts/DQL-Of-MySQL/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"距离本文上次更新已经过去","messageNext":"天，请注意时效性。"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 默烦","link":"链接: ","source":"来源: Mofan","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【MySQL 一】DQL',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-08 00:00:00'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="https://jsd.proxy.aks.moe/gh/mofan212/blog-static-resources@master/css/myStyle.min.css"><link rel="stylesheet" href="https://cdn.staticfile.net/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css" /><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="Mofan" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="https://jsd.proxy.aks.moe/gh/mofan212/blog-static-resources/css/fill-left.min.css"/><script src="https://jsd.proxy.aks.moe/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">150</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/post_top_img.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Mofan"><span class="site-name">Mofan</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【MySQL 一】DQL</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-27T16:00:00.000Z" title="发表于 2022-08-28 00:00:00">2022-08-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-07T16:00:00.000Z" title="更新于 2024-01-08 00:00:00">2024-01-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL/">MySQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">22.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>83分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="【MySQL 一】DQL"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>封面来源：本文封面来源于 MySQL 官网，如有侵权，请联系删除。</p>
<p>本文参考：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1iq4y1u7vj">MySQL数据库教程天花板，mysql安装到mysql高级，强！硬！</a></p>
<h1 id="1-SQL-的概述"><a class="header-anchor" href="#1-SQL-的概述"></a>1. SQL 的概述</h1>
<h2 id="1-1-SQL-的背景知识"><a class="header-anchor" href="#1-1-SQL-的背景知识"></a>1.1 SQL 的背景知识</h2>
<p>1974 年，IBM 研究员发布了一篇揭开数据库技术的论文《SEQUEL：一门结构化的英语查询语言》，直到今天这门结构化的查询语言并没有太大的变化，相比于其他语言， SQL 的半衰期可以说是非常长了。</p>
<p>SQL（Structured Query Language，结构化查询语言）是使用关系模型的数据库应用语言，与数据直 接打交道。后来美国国家标准局（ANSI）开始着手制定 SQL 标准， 先后有 SQL-86 、SQL-89、SQL-92、SQL-99 等标准。 SQL 有两个重要的标准，分别是 SQL-92 和 SQL-99，它们分别代表了 92 年和 99 年颁布的 SQL 标准，我们今天使用的 SQL 语言依然遵循这些标准。</p>
<p>不同数据库厂商生成的 RDBMS（Relational Database Management System，关系数据库管理系统）应用软件都会遵循这些标准，但它们之间也有自己的特点，比如像 MySQL 与 Oracle。</p>
<h2 id="1-2-SQL-的分类"><a class="header-anchor" href="#1-2-SQL-的分类"></a>1.2 SQL 的分类</h2>
<p>SQL 语言在功能上主要分为如下 3 大类：</p>
<p>DDL（Data Definition Languages，数据定义语言），这些语句定义了不同的数据库、表、视图、索 引等数据库对象，还可以用来创建、删除、修改数据库和数据表的结构。 主要的语句关键字包括 <code>CREATE</code>、<code>DROP</code>、<code>ALTER</code> 等。</p>
<p>DML（Data Manipulation Language，数据操作语言），用于添加、删除、更新和查询数据库记录，并检查数据完整性。 主要的语句关键字包括 <code>INSERT</code>、<code>DELETE</code>、<code>UPDATE</code>、<code>SELECT</code> 等。 SELECT 是 SQL 语言的基础，最为重要。</p>
<p>DCL（Data Control Language，数据控制语言），用于定义数据库、表、字段、用户的访问权限和安全级别。主要的语句关键字包括 <code>GRANT</code>、<code>REVOKE</code>、<code>COMMIT</code>、<code>ROLLBACK</code>、<code>SAVEPOINT</code> 等。</p>
<p>因为查询语句使用的非常的频繁，有些人又把查询语句单独分成一类：DQL（数据查询语言）。 还有单独将 <code>COMMIT</code>、<code>ROLLBACK</code> 取出来称为 TCL（Transaction Control Language，事务控制语言）。</p>
<h2 id="1-3-SQL-语言的规则与规范"><a class="header-anchor" href="#1-3-SQL-语言的规则与规范"></a>1.3 SQL 语言的规则与规范</h2>
<p>1、SQL 语句可以写在一行或者多行。为了提高可读性，各子句分行写，必要时使用缩进；</p>
<p>2、每条命令以 <code>;</code> 或 <code>\g</code> 或 <code>\G</code> 结束；</p>
<p>3、关键字不能被缩写也不能分行；</p>
<p>4、关于标点符号：</p>
<ul>
<li>必须保证所有的 <code>()</code>、单引号、双引号是成对结束的</li>
<li>必须使用英文状态下的半角输入方式</li>
<li>字符串型和日期时间类型的数据可以使用单引号 <code>''</code> 表示</li>
<li>列的别名，尽量使用双引号 <code>&quot;&quot;</code>，而且不建议省略 <code>as</code></li>
</ul>
<h2 id="1-4-SQL-的大小写规范"><a class="header-anchor" href="#1-4-SQL-的大小写规范"></a>1.4 SQL 的大小写规范</h2>
<p>1、MySQL 在 Windows 环境下是大小写不敏感的；</p>
<p>2、MySQL 在 Linux 环境下是大小写敏感的</p>
<ul>
<li>
<p>数据库名、表名、表的别名、变量名是严格区分大小写的</p>
</li>
<li>
<p>关键字、函数名、列名（或字段名）、列的别名（字段的别名）是忽略大小写的</p>
</li>
</ul>
<p>3、 推荐采用统一的书写规范：</p>
<ul>
<li>数据库名、表名、表别名、字段名、字段别名等都小写</li>
<li>SQL 关键字、函数名、绑定变量等都大写</li>
</ul>
<h2 id="1-5-SQL-的注释"><a class="header-anchor" href="#1-5-SQL-的注释"></a>1.5 SQL 的注释</h2>
<p>单行注释：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 注释文字（MySQL 特有）</span><br><span class="line"><span class="comment">-- 注释文字（--后面必须有一个空格）</span></span><br></pre></td></tr></table></figure>
<p>多行注释：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  注释文字</span></span><br><span class="line"><span class="comment">  注释文字</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h2 id="1-6-命名规则"><a class="header-anchor" href="#1-6-命名规则"></a>1.6 命名规则</h2>
<p>1、数据库、表名不得超过 30 个字符，变量名限制为 29 个</p>
<p>2、只能包含 <code>A–Z</code>、<code>a–z</code>、<code>0–9</code>、<code>_</code> 共 63 个字符</p>
<p>3、数据库名、表名、字段名等对象名中间不要包含空格</p>
<p>4、同一个 MySQL 软件中，数据库不能同名；同一个库中，表不能重名；同一个表中，字段不能重名</p>
<p>5、必须保证你的字段没有和保留字、数据库系统或常用方法冲突。如果坚持使用，需要在 SQL 语句中使用 <code>`</code> （反引号）引起来</p>
<p>6、保持字段名和类型的一致性，在命名字段并为其指定数据类型的时候一定要保证一致性。例如某个字段的数据类型在一个表里是整数，但在另一个表里变成了字符型，这样会增加理解成本</p>
<h2 id="1-7-数据导入指令"><a class="header-anchor" href="#1-7-数据导入指令"></a>1.7 数据导入指令</h2>
<p>在命令行客户端登录 MySQL（在图形化界面内输入指令是无效的），使用 <code>source</code> 指令导入。比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source d:\mysqldb.sql</span><br></pre></td></tr></table></figure>
<p>查看某个表的表结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">desc</span> employees; # 查看 employees 表的结构</span><br></pre></td></tr></table></figure>
<h1 id="2-基本的-SELECT"><a class="header-anchor" href="#2-基本的-SELECT"></a>2. 基本的 SELECT</h1>
<h2 id="2-1-简单的使用"><a class="header-anchor" href="#2-1-简单的使用"></a>2.1 简单的使用</h2>
<blockquote>
<p>没有子句的 SELECT</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>; # 没有任何子句</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">9</span><span class="operator">/</span><span class="number">2</span>; # 没有任何子句</span><br><span class="line"># 等效于</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> DUAL; # DUAL 是伪表</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">9</span><span class="operator">/</span><span class="number">2</span> <span class="keyword">FROM</span> DUAL; </span><br></pre></td></tr></table></figure>
<blockquote>
<p>SELECT … FROM</p>
</blockquote>
<p>查询部门表中的所有信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> departments;</span><br></pre></td></tr></table></figure>
<p>除非需要使用表中所有的字段数据，否则不建议使用 <code>*</code> 通配符，使用 <code>*</code> 通配符获取不需要的列数据通常会降低查询和所使用的应用程序的效率。因此在生产环境下，不建议直接使用 <code>SELECT *</code> 来查询数据。</p>
<p>查询部门表中的部门 ID 和位置 ID：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, location_id <span class="keyword">FROM</span> departments;</span><br></pre></td></tr></table></figure>
<p>MySQL 中的 SQL 语句是不区分带小写的，因此 <code>SELECT</code> 和 <code>select</code> 的含义与作用是一样的，只不过大多数开发人员习惯将关键词大写、将列名和表名小写，这也是一个良好的编程习惯。</p>
<h2 id="2-2-列的别名"><a class="header-anchor" href="#2-2-列的别名"></a>2.2 列的别名</h2>
<p>在查询某些列的数据时， 可以对这些列进行重命名，也就是取一个别名，以方便后续计算。</p>
<p>别名需要紧跟列名，以空格隔开。也可以在列名和别名之间加入关键字 <code>AS</code>，并对别名使用双引号，以便在别名中包含空格或其他特殊字符并区分大小写。</p>
<p>比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name <span class="keyword">AS</span> name, commission_pct comm <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> last_name &quot;Name&quot;, salary<span class="operator">*</span><span class="number">12</span> &quot;Annual Salary&quot; <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<p>使用建议： <strong>不省略 <code>AS</code> 关键字，别名使用双引号引上。</strong></p>
<h2 id="2-3-去除重复行"><a class="header-anchor" href="#2-3-去除重复行"></a>2.3 去除重复行</h2>
<p>使用 <code>DISTINCT</code> 去除重复行：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id, salary <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<p><mark>注意：</mark> 上述 SQL 语句的查询结果是 <code>department_id</code> 和 <code>salary</code> 列的组合去重。</p>
<p>如果只想查看员工分布在哪些部门中，那么需要：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<h2 id="2-4-空值参与运算"><a class="header-anchor" href="#2-4-空值参与运算"></a>2.4 空值参与运算</h2>
<p>运算符或列值遇到 <code>NULL</code> 值时，其运算结果都是 <code>NULL</code>。比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, salary, commission_pct,</span><br><span class="line">	<span class="number">12</span> <span class="operator">*</span> salary <span class="operator">*</span> (<span class="number">1</span> <span class="operator">+</span> commission_pct) &quot;annual_sal&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<p><mark>注意：</mark> 在 MySQL 里，空值不等于空字符串。一个空字符串的长度是 0，而一个空值的长度是空。不仅如此，MySQL 里的空值也会占用空间。</p>
<h2 id="2-5-反引号的使用"><a class="header-anchor" href="#2-5-反引号的使用"></a>2.5 反引号的使用</h2>
<p>有一订单表名为 <code>ORDER</code>，需要查询该表中的所有数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">ORDER</span>;</span><br></pre></td></tr></table></figure>
<p>但运行这条 SQL 语句时会报错，因为 <code>ORDER</code> 是 MySQL 中的一个关键词，因此需要使用反引号将其引上：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> `<span class="keyword">ORDER</span>`;</span><br></pre></td></tr></table></figure>
<h2 id="2-6-对常数进行查询"><a class="header-anchor" href="#2-6-对常数进行查询"></a>2.6 对常数进行查询</h2>
<p><code>SELECT</code> 还支持对常数进行查询。比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;默烦&#x27;</span> <span class="keyword">as</span> corporation, last_name <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<p>执行上述语句后将会在查询结果中增加一列固定的常数列，这列的取值是由我们指定的，而不是从数据库表中动态取出的。</p>
<p>那对常数进行查询有什么意义呢？</p>
<p>当想要整合不同的数据源时，可以用常数列作为这个表的标记，这时就需要查询常数。</p>
<h2 id="2-7-显示表结构"><a class="header-anchor" href="#2-7-显示表结构"></a>2.7 显示表结构</h2>
<p>可以在命令行里执行以下语句显示表结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> employees;</span><br><span class="line"># 或</span><br><span class="line"><span class="keyword">DESC</span> employees;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/employees%E8%A1%A8%E7%BB%93%E6%9E%84.png" alt="employees表结构"></p>
<p>各个字段的含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">字段名</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Field</td>
<td style="text-align:center">字段名称</td>
</tr>
<tr>
<td style="text-align:center">Type</td>
<td style="text-align:center">字段类型</td>
</tr>
<tr>
<td style="text-align:center">Null</td>
<td style="text-align:center">是否能存储 <code>NULL</code> 值</td>
</tr>
<tr>
<td style="text-align:center">Key</td>
<td style="text-align:center">是否已编制索引。PRI 表示该列是表主键的一部分；UNI 表示该列是 UNIQUE 索引的一 部分；MUL 表示在列中某个给定值允许出现多次</td>
</tr>
<tr>
<td style="text-align:center">Default</td>
<td style="text-align:center">默认值</td>
</tr>
<tr>
<td style="text-align:center">Extra</td>
<td style="text-align:center">可以获取的与给定列有关的附加信息，如 <code>AUTO_INCREMENT</code></td>
</tr>
</tbody>
</table>
<h2 id="2-8-简单的条件查询"><a class="header-anchor" href="#2-8-简单的条件查询"></a>2.8 简单的条件查询</h2>
<p>返回在 90 号部门工作的所有员工信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">90</span>;</span><br></pre></td></tr></table></figure>
<p>在 <code>FROM</code> 子句后紧随 <code>WHERE</code> 子句，使用 <code>WHERE</code> 子句获取符合条件的行。</p>
<h1 id="3-运算符"><a class="header-anchor" href="#3-运算符"></a>3. 运算符</h1>
<h2 id="3-1-算术运算符"><a class="header-anchor" href="#3-1-算术运算符"></a>3.1 算术运算符</h2>
<p>算术运算符主要用来数学运算，其可以连接运算符前后的两个数值或表达式，对数值或表达式进行加（+）、减（-）、乘（*）、除（/）和取模（%）运算。</p>
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">+</td>
<td style="text-align:center">加法</td>
<td style="text-align:center">计算两个值或表达式的和</td>
</tr>
<tr>
<td style="text-align:center">-</td>
<td style="text-align:center">减法</td>
<td style="text-align:center">计算两个值或表达式的差</td>
</tr>
<tr>
<td style="text-align:center">*</td>
<td style="text-align:center">乘法</td>
<td style="text-align:center">计算两个值或表达式的乘积</td>
</tr>
<tr>
<td style="text-align:center">/ 或 DIV</td>
<td style="text-align:center">除法</td>
<td style="text-align:center">计算两个值或表达式的商</td>
</tr>
<tr>
<td style="text-align:center">% 或 MOD</td>
<td style="text-align:center">求模（求余）</td>
<td style="text-align:center">计算两个值或表达式的余数</td>
</tr>
</tbody>
</table>
<blockquote>
<p>加法与减法运算符</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">100</span>, <span class="number">100</span> <span class="operator">+</span> <span class="number">0</span>, <span class="number">100</span> <span class="operator">-</span> <span class="number">0</span>, <span class="number">100</span> <span class="operator">+</span> <span class="number">50</span>, <span class="number">100</span> <span class="operator">+</span> <span class="number">50</span> <span class="number">-30</span>, <span class="number">100</span> <span class="operator">+</span> <span class="number">35.5</span>, <span class="number">100</span> <span class="operator">-</span> <span class="number">35.5</span> </span><br><span class="line"><span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E5%8A%A0%E6%B3%95%E4%B8%8E%E5%87%8F%E6%B3%95%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="加法与减法运算符的使用"></p>
<p>根据运算结果，可以得出：</p>
<p>1、一个整数类型的值对整数进行加法和减法操作，结果还是一个整数；</p>
<p>2、一个整数类型的值对浮点数进行加法和减法操作，结果是一个浮点数；</p>
<p>3、加法和减法的优先级相同，进行先加后减操作与进行先减后加操作的结果是一样的；</p>
<p>4、在 Java 中，<code>+</code> 的左右两边如果有字符串，将会进行字符串的拼接。但是在 MySQL 中 <code>+</code> 只表示数值相加。如果遇到非数值类型，先尝试转成数值，如果转换失败，就按 <code>0</code> 计算（MySQL 中字符串拼接要使用字符串函数 <code>CONCAT()</code> 实现）。</p>
<blockquote>
<p>乘法与除法运算符</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">100</span>, <span class="number">100</span> <span class="operator">*</span> <span class="number">1</span>, <span class="number">100</span> <span class="operator">*</span> <span class="number">1.0</span>, <span class="number">100</span> <span class="operator">/</span> <span class="number">1.0</span>, <span class="number">100</span> <span class="operator">/</span> <span class="number">2</span>,<span class="number">100</span> <span class="operator">+</span> <span class="number">2</span> <span class="operator">*</span> <span class="number">5</span> <span class="operator">/</span> <span class="number">2</span>,<span class="number">100</span> <span class="operator">/</span><span class="number">3</span>, <span class="number">100</span> </span><br><span class="line">DIV <span class="number">0</span> <span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E4%B9%98%E6%B3%95%E4%B8%8E%E9%99%A4%E6%B3%95%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="乘法与除法运算符的使用"></p>
<p>根据运算结果，可以得出：</p>
<p>1、一个数乘以整数 1 和除以整数 1 后仍得原数；</p>
<p>2、一个数乘以浮点数 1 和除以浮点数 1 后变成浮点数，数值与原数相等；</p>
<p>3、一个数除以整数后，不管是否能除尽，结果都为一个浮点数；</p>
<p>4、一个数除以另一个数，除不尽时，结果为一个浮点数，并保留到小数点后 4 位；</p>
<p>5、乘法和除法的优先级相同，进行先乘后除操作与先除后乘操作，得出的结果相同。</p>
<p>6、在数学运算中，0 不能用作除数，在 MySQL 中，一个数除以 0 为 <code>NULL</code>。</p>
<blockquote>
<p>求模运算符</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">12</span> <span class="operator">%</span> <span class="number">3</span>, <span class="number">12</span> MOD <span class="number">5</span> <span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E5%8F%96%E6%A8%A1%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="取模运算符的使用"></p>
<p>求模，即：求余。12 除以 3 的余数是 0，因此 12 模 3 得到的结果也是 0；12 除以 5 的余数是 2，因此 12 模 5 的结果也是 2。</p>
<h2 id="3-2-比较运算符"><a class="header-anchor" href="#3-2-比较运算符"></a>3.2 比较运算符</h2>
<p>比较运算符用来对表达式左、右两边的操作数进行比较，比较结果为真时返回 1，为假时返回 0，其它情况返回 <code>NULL</code>。比较运算符常被用来作为 <code>SELECT</code> 查询语句的查询条件。</p>
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">=</td>
<td style="text-align:center">等于</td>
<td style="text-align:center">判断两个值、字符串或表达式是否相等</td>
</tr>
<tr>
<td style="text-align:center">&lt;=&gt;</td>
<td style="text-align:center">安全等于</td>
<td style="text-align:center">安全地判断两个值、字符串或表达式是否相等</td>
</tr>
<tr>
<td style="text-align:center">&lt;&gt; 或 !=</td>
<td style="text-align:center">不等于</td>
<td style="text-align:center">判断两个值、字符串或表达式是否不相等</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:center">小于</td>
<td style="text-align:center">判断前面的值、字符串或表达式是否小于后面的值、字符串或表达式</td>
</tr>
<tr>
<td style="text-align:center">&lt;=</td>
<td style="text-align:center">小于等于</td>
<td style="text-align:center">判断前面的值、字符串或表达式是否小于等于后面的值、字符串或表达式</td>
</tr>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:center">大于</td>
<td style="text-align:center">判断前面的值、字符串或表达式是否大于后面的值、字符串或表达式</td>
</tr>
<tr>
<td style="text-align:center">&gt;=</td>
<td style="text-align:center">大于等于</td>
<td style="text-align:center">判断前面的值、字符串或表达式是否大于等于后面的值、字符串或表达式</td>
</tr>
</tbody>
</table>
<blockquote>
<p>等号运算符</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Java 中的等于是 `<span class="operator">=</span><span class="operator">=</span>`，<span class="keyword">SQL</span> 中的赋值符号使用 `:<span class="operator">=</span>`</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span>, <span class="number">1</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>, <span class="number">1</span> <span class="operator">=</span> <span class="number">0</span>, <span class="string">&#x27;a&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>, (<span class="number">5</span> <span class="operator">+</span> <span class="number">3</span>) <span class="operator">=</span> (<span class="number">2</span> <span class="operator">+</span> <span class="number">6</span>), <span class="string">&#x27;&#x27;</span> <span class="operator">=</span> <span class="keyword">NULL</span>, <span class="keyword">NULL</span> <span class="operator">=</span> <span class="keyword">NULL</span>; </span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E7%AD%89%E4%BA%8E%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8-1.png" alt="等于运算符的使用-1"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">2</span>, <span class="number">0</span> <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span>, <span class="number">1</span> <span class="operator">=</span> <span class="string">&#x27;abc&#x27;</span> <span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E7%AD%89%E4%BA%8E%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8-2.png" alt="等于运算符的使用-2"><br>
在使用等号运算符时，遵循如下规则：</p>
<p>1、如果等号两边的值、字符串或表达式都为字符串，则 MySQL 会按照字符串进行比较，其比较的<br>
是每个字符串中字符的 ANSI 编码是否相等；</p>
<p>2、如果等号两边的值都是整数，则 MySQL 会按照整数来比较两个值的大小；</p>
<p>3、如果等号两边的值一个是整数，另一个是字符串，则 MySQL 会将字符串转化为数字进行比较；</p>
<p>4、如果等号两边的值、字符串或表达式中有一个为 <code>NULL</code>，则比较结果为 <code>NULL</code>。</p>
<blockquote>
<p>安全等于运算符</p>
</blockquote>
<p>安全等于运算符 <code>&lt;=&gt;</code> 与等于运算符 <code>=</code> 的作用是相似的，只是 <code>&lt;=&gt;</code> 可以用来对 <code>NULL</code>进行判断。在两个操作数均为 <code>NULL</code> 时，其返回值为 1，而不是 <code>NULL</code>；其他返回结果与等于运算符相同。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">&lt;=&gt;</span> <span class="string">&#x27;1&#x27;</span>, <span class="number">1</span> <span class="operator">&lt;=&gt;</span> <span class="number">0</span>, <span class="string">&#x27;a&#x27;</span> <span class="operator">&lt;=&gt;</span> <span class="string">&#x27;a&#x27;</span>, (<span class="number">5</span> <span class="operator">+</span> <span class="number">3</span>) <span class="operator">&lt;=&gt;</span> (<span class="number">2</span> <span class="operator">+</span> <span class="number">6</span>), <span class="string">&#x27;&#x27;</span> <span class="operator">&lt;=&gt;</span> <span class="keyword">NULL</span>,<span class="keyword">NULL</span> <span class="operator">&lt;=&gt;</span> <span class="keyword">NULL</span> <span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E5%AE%89%E5%85%A8%E7%AD%89%E4%BA%8E%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="安全等于运算符的使用"></p>
<blockquote>
<p>不等于运算符</p>
</blockquote>
<p>不等于运算符 <code>&lt;&gt;</code> 或 <code>!=</code> 不能判断 <code>NULL</code> 值。如果两边的值有任意一个为 <code>NULL</code>，或两边都为 <code>NULL</code>，结果都为 <code>NULL</code>。</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E4%B8%8D%E7%AD%89%E4%BA%8E%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="不等于运算符的使用"></p>
<h2 id="3-3-非符号类型运算符"><a class="header-anchor" href="#3-3-非符号类型运算符"></a>3.3 非符号类型运算符</h2>
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">名称</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IS NULL</td>
<td style="text-align:center">为空</td>
<td style="text-align:center">判断值、字符串或表达式是否为空</td>
</tr>
<tr>
<td style="text-align:center">IS NOTNULL</td>
<td style="text-align:center">不为空</td>
<td style="text-align:center">判断值、字符串或表达式是否不为空</td>
</tr>
<tr>
<td style="text-align:center">LEAST</td>
<td style="text-align:center">最小值</td>
<td style="text-align:center">在多个值中返回最小值</td>
</tr>
<tr>
<td style="text-align:center">GREATEST</td>
<td style="text-align:center">最大值</td>
<td style="text-align:center">在多个值中返回最大值</td>
</tr>
<tr>
<td style="text-align:center">BETWEEN AND</td>
<td style="text-align:center">两值之间</td>
<td style="text-align:center">判断一个值是否在两个值之间</td>
</tr>
<tr>
<td style="text-align:center">ISNULL</td>
<td style="text-align:center">为空</td>
<td style="text-align:center">判断值、字符串或表达式是否为空</td>
</tr>
<tr>
<td style="text-align:center">IN</td>
<td style="text-align:center">属于</td>
<td style="text-align:center">判断一个值是否为列表中的任意一个值</td>
</tr>
<tr>
<td style="text-align:center">NOT IN</td>
<td style="text-align:center">不属于</td>
<td style="text-align:center">判断一个值是否不为列表中的任意一个值</td>
</tr>
<tr>
<td style="text-align:center">LIKE</td>
<td style="text-align:center">模糊匹配</td>
<td style="text-align:center">判断一个值是否符合模糊匹配规则</td>
</tr>
<tr>
<td style="text-align:center">REGEXP</td>
<td style="text-align:center">正则表达式</td>
<td style="text-align:center">判断一个值是否符合正则表达式的规则</td>
</tr>
<tr>
<td style="text-align:center">RLIKE</td>
<td style="text-align:center">正则表达式</td>
<td style="text-align:center">判断一个值是否符合正则表达式的规则</td>
</tr>
</tbody>
</table>
<blockquote>
<p>为空运算符</p>
</blockquote>
<p>空运算符 <code>IS NULL</code> 或者 <code>ISNULL</code> 判断一个值是否为 <code>NULL</code>，如果为 <code>NULL</code> 返回 1，否则返回 0。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NULL</span> <span class="keyword">IS</span> <span class="keyword">NULL</span>, ISNULL(<span class="keyword">NULL</span>), ISNULL(<span class="string">&#x27;a&#x27;</span>), <span class="number">1</span> <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E4%B8%BA%E7%A9%BA%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="为空运算符的使用"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询 commission_pct 等于 <span class="keyword">NULL</span>，有以下四种写法：</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, commission_pct <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, commission_pct <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> commission_pct <span class="operator">&lt;=&gt;</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, commission_pct <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> ISNULL(commission_pct);</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, commission_pct <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> commission_pct <span class="operator">=</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>非空运算符</p>
</blockquote>
<p>非空运算符 <code>IS NOT NULL</code> 判断一个值是否不为 <code>NULL</code>，如果不为 <code>NULL</code> 则返回 1，否则返回 0。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NULL</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="string">&#x27;a&#x27;</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="number">1</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E9%9D%9E%E7%A9%BA%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="非空运算符的使用"></p>
<p>在 Navicat 15 中执行上述语句会报错，显示 <code>Unknown column ' 1' in 'field list'</code>，但在命令行中执行不会出现错误。</p>
<blockquote>
<p>最小值运算符</p>
</blockquote>
<p>语法格式为：<code>LEAST(值1，值2，...，值n)</code>。其中，“值n”表示参数列表中第 n 个值。在有两个或多个参数的情况下，返回最小值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LEAST (<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>), LEAST(<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>), LEAST(<span class="number">1</span>,<span class="keyword">NULL</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%9C%80%E5%B0%8F%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="最小值运算符的使用"></p>
<p>当参数是整数或者浮点数时，<code>LEAST</code> 将返回其中最小的值；当参数为字符串时，返回字母表中顺序最靠前的字符；当比较值列表中有 <code>NULL</code> 时，不能判断大小，返回值为 <code>NULL</code>。</p>
<blockquote>
<p>最大值运算符</p>
</blockquote>
<p>语法格式为：<code>GREATEST(值1，值2，...，值n)</code>。其中，“值n”表示参数列表中第 n 个值。在有两个或多个参数的情况下，返回最大值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> GREATEST(<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>), GREATEST(<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>), GREATEST(<span class="number">1</span>,<span class="keyword">NULL</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%9C%80%E5%A4%A7%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="最大值运算符的使用"></p>
<p>当参数中是整数或者浮点数时，<code>GREATEST</code> 将返回其中最大的值；当参数为字符串时，返回字母表中顺序最靠后的字符；当比较值列表中有 <code>NULL</code> 时，不能判断大小，返回值为 <code>NULL</code>。</p>
<blockquote>
<p>BETWEEN AND运算符</p>
</blockquote>
<p>语法格式为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> D <span class="keyword">FROM</span> <span class="keyword">TABLE</span> <span class="keyword">WHERE</span> C <span class="keyword">BETWEEN</span> A <span class="keyword">AND</span> B;</span><br></pre></td></tr></table></figure>
<p>当 C 大于或等于 A、并且小于或等于 B 时，结果返回1，否则返回 0。</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/BETWEEN...AND%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="BETWEEN...AND运算符的使用"></p>
<blockquote>
<p>IN 运算符</p>
</blockquote>
<p><code>IN</code> 运算符用于判断给定的值是否是给定列表中的一个值，如果是则返回 1，否则返回 0。如果给<br>
定的值为 <code>NULL</code>，或者给定列表中存在 <code>NULL</code>，则结果为 <code>NULL</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">IN</span> (<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>), <span class="number">1</span> <span class="keyword">IN</span> (<span class="number">2</span>,<span class="number">3</span>), <span class="keyword">NULL</span> <span class="keyword">IN</span> (<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>), <span class="string">&#x27;a&#x27;</span> <span class="keyword">IN</span> (<span class="string">&#x27;a&#x27;</span>, <span class="keyword">NULL</span>), <span class="keyword">NULL</span> <span class="keyword">IN</span> (<span class="string">&#x27;a&#x27;</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/IN%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="IN运算符的使用"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary, manager_id</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  manager_id <span class="keyword">IN</span> (<span class="number">100</span>, <span class="number">101</span>, <span class="number">201</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>NOT IN 运算符</p>
</blockquote>
<p><code>NOT IN</code> 运算符与 <code>IN</code> 运算符的效果相反：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>), <span class="number">1</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">2</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/NOT...IN%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="NOT...IN运算符的使用"></p>
<blockquote>
<p>LIKE 运算符</p>
</blockquote>
<p><code>LIKE</code> 运算符主要用来匹配字符串，通常用于模糊匹配，如果满足条件则返回 1，否则返回 0。如果给定的值或者匹配条件为 <code>NULL</code>，返回结果为 <code>NULL</code>。</p>
<p>常用的通配符：</p>
<p><code>%</code>：匹配 0 个或多个字符；</p>
<p><code>_</code>：仅匹配一个字符。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NULL</span> <span class="keyword">LIKE</span> <span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;abc&#x27;</span> <span class="keyword">LIKE</span> <span class="keyword">NULL</span>, <span class="string">&#x27;abc&#x27;</span> <span class="keyword">LIKE</span> &quot;abc&quot;, &quot;abc&quot; <span class="keyword">LIKE</span> &quot;ab_&quot;, &quot;abc&quot; <span class="keyword">LIKE</span> &quot;a%&quot;;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/LIKE%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="LIKE运算符的使用"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查询以 S 开头的名</span><br><span class="line"><span class="keyword">SELECT</span>  first_name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> first_name <span class="keyword">LIKE</span> <span class="string">&#x27;S%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 查询第二个字母是 o 的姓</span><br><span class="line"><span class="keyword">SELECT</span> last_name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;_o%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><code>%</code> 和 <code>_</code> 作为常用的通配符，如果就是要查询存在这两个符号的内容呢？可以使用 <code>\</code> 作为转义符。</p>
<p>比如查询 <code>job_id</code> 中以 <code>IT_</code> 开头的内容：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> job_id <span class="keyword">FROM</span> jobs <span class="keyword">WHERE</span> job_id <span class="keyword">LIKE</span> <span class="string">&#x27;IT\_%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>还可以使用 <code>ESCAPE</code> 自定义转义符，比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询 job_id 以 IT_ 开头的信息</span><br><span class="line"><span class="keyword">SELECT</span> job_id <span class="keyword">FROM</span> jobs <span class="keyword">WHERE</span> job_id <span class="keyword">LIKE</span> <span class="string">&#x27;IT$_%&#x27;</span> <span class="keyword">ESCAPE</span> <span class="string">&#x27;$&#x27;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>REGEXP 运算符</p>
</blockquote>
<p><code>REGEXP</code> 运算符用来匹配字符串，语法格式为：<code>expr REGEXP 匹配条件</code>。如果 <code>expr</code> 满足匹配条件，返回 1；否则返回 0。若 expr 或匹配条件任意一个为 <code>NULL</code>，则结果为 <code>NULL</code>。</p>
<p><code>REGEXP</code> 运算符在进行匹配时，常用的有下面几种通配符：</p>
<p>1、<code>^</code> 匹配以该字符后面的字符开头的字符串；</p>
<p>2、<code>$</code> 匹配以该字符前面的字符结尾的字符串；</p>
<p>3、<code>.</code> 匹配任何一个单字符；</p>
<p>4、<code>[...]</code> 匹配在方括号内的任何字符。例如，<code>[abc]</code> 可以匹配 <code>a</code> 或 <code>b</code> 或 <code>c</code>。为了命名字符的范围，可以使用一个<code>-</code>。比如 <code>[a-z]</code> 匹配任何字母，而 <code>[0-9]</code> 匹配任何数字；</p>
<p>5、<code>*</code> 匹配零个或多个在它前面的字符。例如，<code>x*</code> 匹配任意个 x 字符，<code>[0-9]*</code> 匹配任意个数字，而 <code>*</code> 匹配任意个任何字符；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;mofan&#x27;</span> REGEXP <span class="string">&#x27;^m&#x27;</span>, <span class="string">&#x27;mofan&#x27;</span> REGEXP <span class="string">&#x27;n$&#x27;</span>, <span class="string">&#x27;mofan&#x27;</span> REGEXP <span class="string">&#x27;of&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/REGEXP%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8-1.png" alt="REGEXP运算符的使用-1"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;mofanmofan&#x27;</span> REGEXP <span class="string">&#x27;an.of&#x27;</span>, <span class="string">&#x27;mofan&#x27;</span> REGEXP <span class="string">&#x27;[mz]&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/REGEXP%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8-2.png" alt="REGEXP运算符的使用-2"></p>
<h2 id="3-4-逻辑运算符"><a class="header-anchor" href="#3-4-逻辑运算符"></a>3.4 逻辑运算符</h2>
<p>逻辑运算符主要用来判断表达式的真假，在 MySQL 中，逻辑运算符的返回结果为 1、0 或者 <code>NULL</code>。</p>
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">NOT 或 !</td>
<td style="text-align:center">逻辑非</td>
</tr>
<tr>
<td style="text-align:center">AND 或 &amp;&amp;</td>
<td style="text-align:center">逻辑与</td>
</tr>
<tr>
<td style="text-align:center">OR 或 ||</td>
<td style="text-align:center">逻辑或</td>
</tr>
<tr>
<td style="text-align:center">XOR</td>
<td style="text-align:center">逻辑异或</td>
</tr>
</tbody>
</table>
<blockquote>
<p>逻辑非运算符</p>
</blockquote>
<p>逻辑非 <code>NOT</code> 或 <code>!</code> 运算符表示当给定的值为 0 时返回 1，给定的值为非 0 值时返回 0，给定的值为 <code>NULL</code> 时，返回 <code>NULL</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NOT</span> <span class="number">1</span>, <span class="keyword">NOT</span> <span class="number">0</span>, <span class="keyword">NOT</span>(<span class="number">1</span><span class="operator">+</span><span class="number">1</span>), <span class="keyword">NOT</span> <span class="operator">!</span><span class="number">1</span>, <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E9%80%BB%E8%BE%91%E9%9D%9E%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="逻辑非运算符的使用"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id </span><br><span class="line"><span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;IT_PROG&#x27;</span>, <span class="string">&#x27;ST_CLERK&#x27;</span>, <span class="string">&#x27;SA_REP&#x27;</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>逻辑与运算符</p>
</blockquote>
<p>逻辑与 <code>AND</code> 或 <code>&amp;&amp;</code> 运算符是当给定的所有值均为非 0 值，并且不为 <code>NULL</code> 时，返回 1；当给定的一个值或者多个值为 0 时则返回 0；否则返回 <code>NULL</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="number">-1</span>, <span class="number">0</span> <span class="keyword">AND</span> <span class="number">1</span>, <span class="number">0</span> <span class="keyword">AND</span> <span class="keyword">NULL</span>, <span class="number">1</span> <span class="keyword">AND</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E9%80%BB%E8%BE%91%E4%B8%8E%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="逻辑与运算符的使用"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, salary </span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;=</span><span class="number">10000</span></span><br><span class="line"><span class="keyword">AND</span> job_id <span class="keyword">LIKE</span> <span class="string">&#x27;%MAN%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>逻辑或运算符</p>
</blockquote>
<p>逻辑或 <code>OR</code> 或 <code>||</code> 运算符是当给定的值都不为 <code>NULL</code>，并且任何一个值为非 0 值时，返回 1，否则返回 0；当一个值为 <code>NULL</code>，并且另一个值为非 0 值时，返回 1，否则返回 <code>NULL</code>；当两个值都为 <code>NULL</code> 时，返回 <code>NULL</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">OR</span> <span class="number">-1</span>, <span class="number">1</span> <span class="keyword">OR</span> <span class="number">0</span>, <span class="number">1</span> <span class="keyword">OR</span> <span class="keyword">NULL</span>, <span class="number">0</span> <span class="operator">||</span> <span class="keyword">NULL</span>, <span class="keyword">NULL</span> <span class="operator">||</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E9%80%BB%E8%BE%91%E6%88%96%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="逻辑或运算符的使用"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 查询基本薪资不在 <span class="number">9000</span><span class="number">-12000</span> 之间的员工编号和基本薪资</span><br><span class="line"><span class="keyword">SELECT</span> employee_id,salary <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> (salary <span class="operator">&gt;=</span> <span class="number">9000</span> <span class="keyword">AND</span> salary <span class="operator">&lt;=</span> <span class="number">12000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id,salary <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&lt;</span><span class="number">9000</span> <span class="keyword">OR</span> salary <span class="operator">&gt;</span> <span class="number">12000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id,salary <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="number">9000</span> <span class="keyword">AND</span> <span class="number">12000</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;=</span> <span class="number">10000</span></span><br><span class="line"><span class="keyword">OR</span> job_id <span class="keyword">LIKE</span> <span class="string">&#x27;%MAN%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><mark>注意：</mark> <code>OR</code> 可以和 <code>AND</code> 一起使用，但是在使用时要注意两者的优先级，由于 <code>AND</code> 的优先级高于 <code>OR</code>，因此会先对 <code>AND</code> 两边的操作数进行操作，再与 <code>OR</code> 中的操作数结合。</p>
<blockquote>
<p>逻辑异或运算符</p>
</blockquote>
<p>逻辑异或 <code>XOR</code> 运算符是当给定的值中任意一个值为 <code>NULL</code> 时，返回 <code>NULL</code>；如果两个非 <code>NULL</code> 的值都是 0 或者都不等于 0 时，则返回 0；如果一个值为 0，另一个值不为 0 时，则返回 1。</p>
<p>区别于数学中的异或，数学中的异或只对 0 和 1 进行运算，因此常有“相同取 1，不同取 0”的口诀，而在 MySQL 中 <code>1 XOR -1</code> 的值是 0，而不是 1。数学中的异或更像下面讲到的按位异或运算符。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> XOR <span class="number">-1</span>, <span class="number">1</span> XOR <span class="number">0</span>, <span class="number">0</span> XOR <span class="number">0</span>, <span class="number">1</span> XOR <span class="keyword">NULL</span>, <span class="number">1</span> XOR <span class="number">1</span> XOR <span class="number">1</span>, <span class="number">0</span> XOR <span class="number">0</span> XOR <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E9%80%BB%E8%BE%91%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="逻辑异或运算符的使用"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> last_name,department_id,salary </span><br><span class="line"><span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">where</span> department_id <span class="keyword">in</span> (<span class="number">10</span>,<span class="number">20</span>) XOR salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br></pre></td></tr></table></figure>
<h2 id="3-5-位运算符"><a class="header-anchor" href="#3-5-位运算符"></a>3.5 位运算符</h2>
<p>位运算符是在二进制数上进行计算的运算符。 <strong>位运算符会先将操作数变成二进制数，然后进行位运算，最后将计算结果从二进制变回十进制数。</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">运算符</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&amp;</td>
<td style="text-align:center">按位与</td>
</tr>
<tr>
<td style="text-align:center">|</td>
<td style="text-align:center">按位或</td>
</tr>
<tr>
<td style="text-align:center">^</td>
<td style="text-align:center">按位异或</td>
</tr>
<tr>
<td style="text-align:center">~</td>
<td style="text-align:center">按位取反</td>
</tr>
<tr>
<td style="text-align:center">&gt;&gt;</td>
<td style="text-align:center">按位右移</td>
</tr>
<tr>
<td style="text-align:center">&lt;&lt;</td>
<td style="text-align:center">按位左移</td>
</tr>
</tbody>
</table>
<blockquote>
<p>按位与运算符</p>
</blockquote>
<p>按位与 <code>&amp;</code> 运算符将给定值对应的二进制数逐位进行逻辑与运算。当给定值对应的二进制位的数值都为 1 时，则该位返回 1，否则返回 0。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">&amp;</span> <span class="number">10</span>, <span class="number">20</span> <span class="operator">&amp;</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%8C%89%E4%BD%8D%E4%B8%8E%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="按位与运算符的使用"></p>
<p>解析：1 的二进制数为 0001，10 的二进制数为 1010，所以 <code>1 &amp; 10</code> 的结果为 0000，对应的十进制数为 0。20 的二进制数为 10100，30 的二进制数为 11110，所以 <code>20 &amp; 30</code> 的结果为10100，对应的十进制数为 20。</p>
<blockquote>
<p>按位或运算符</p>
</blockquote>
<p>按位或 <code>|</code> 运算符将给定的值对应的二进制数逐位进行逻辑或运算。当给定值对应的二进制位的数值有一个或两个都为 1 时，则该位返回 1，否则返回 0。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">|</span> <span class="number">10</span>, <span class="number">20</span> <span class="operator">|</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%8C%89%E4%BD%8D%E6%88%96%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="按位或运算符的使用"></p>
<p>解析：1 的二进制数为 0001，10 的二进制数为 1010，所以 <code>1 | 10</code> 的结果为 1011，对应的十进制数为 11。20 的二进制数为 10100，30 的二进制数为 11110，所以 <code>20 | 30</code> 的结果为 11110，对应的十进制数为 30。</p>
<blockquote>
<p>按位异或运算符</p>
</blockquote>
<p>按位异或 <code>^</code> 运算符将给定的值对应的二进制数逐位进行逻辑异或运算。当给定值对应的二进制位的数值不同时，则该位返回 1，否则返回 0。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">^</span> <span class="number">10</span>, <span class="number">20</span> <span class="operator">^</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%8C%89%E4%BD%8D%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="按位异或运算符的使用"></p>
<p>解析：1 的二进制数为 0001，10 的二进制数为 1010，所以 <code>1 ^ 10</code> 的结果为 1011，对应的十进制数为 11。20 的二进制数为 10100，30 的二进制数为 11110，所以 <code>20 ^ 30</code> 的结果为 01010，对应的十进制数为 10。</p>
<blockquote>
<p>按位取反运算符</p>
</blockquote>
<p>按位取反 <code>~</code> 运算符将给定的值的二进制数逐位进行取反操作，即将 1 变为 0，将 0 变为 1。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">10</span> <span class="operator">&amp;</span> <span class="operator">~</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%8C%89%E4%BD%8D%E5%8F%96%E5%8F%8D%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="按位取反运算符的使用"></p>
<p>解析：由于按位取反 <code>~</code> 运算符的优先级高于按位与 <code>&amp;</code> 运算符的优先级，所以 <code>10 &amp; ~1</code> 会首先对数字 1 进行按位取反操作，结果除了最低位为 0，其他位都为 1，然后与 10 进行按位与操作，结果为 10。</p>
<blockquote>
<p>按位右移运算符</p>
</blockquote>
<p>按位右移 <code>&gt;&gt;</code> 运算符将给定的值的二进制数的所有位右移指定的位数。右移指定的位数后，右边低位的数值被移出并丢弃，左边高位空出的位置用 0 补齐。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">&gt;&gt;</span> <span class="number">2</span>, <span class="number">4</span> <span class="operator">&gt;&gt;</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%8C%89%E4%BD%8D%E5%8F%B3%E7%A7%BB%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="按位右移运算符的使用"></p>
<p>解析：1 的二进制数为 <code>0000 0001</code>，右移 2 位为 <code>0000 0000</code>，对应的十进制数为 0。4 的二进制数为 <code>0000 0100</code>，右移 2 位为 <code>0000 0001</code>，对应的十进制数为 1。</p>
<blockquote>
<p>按位左移运算符</p>
</blockquote>
<p>按位左移 <code>&lt;&lt;</code> 运算符将给定的值的二进制数的所有位左移指定的位数。左移指定的位数后，左边高位的数值被移出并丢弃，右边低位空出的位置用 0 补齐。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">&lt;&lt;</span> <span class="number">2</span>, <span class="number">4</span> <span class="operator">&lt;&lt;</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%8C%89%E4%BD%8D%E5%B7%A6%E7%A7%BB%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="按位左移运算符的使用"></p>
<p>解析：1 的二进制数为 <code>0000 0001</code>，左移两位为 <code>0000 0100</code>，对应的十进制数为 4。4 的二进制数为 <code>0000 0100</code>，左移两位为 <code>0001 0000</code>，对应的十进制数为 16。</p>
<h2 id="3-6-运算符的优先级"><a class="header-anchor" href="#3-6-运算符的优先级"></a>3.6 运算符的优先级</h2>
<table>
<thead>
<tr>
<th style="text-align:center">优先级</th>
<th style="text-align:center">运算符</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center"><code>:=</code> <code>=（赋值）</code></td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">`</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center"><code>&amp;&amp;</code> <code>AND</code></td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center"><code>NOT</code></td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center"><code>BETWEEN</code> <code>CASE</code> <code>WHEN</code> <code>THEN</code> <code>ELSE</code></td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center"><code>=（比较运算符）</code> <code>&lt;=&gt;</code> <code>&gt;=</code> <code>&gt;</code> <code>&lt;=</code> <code>&lt;</code> <code>&lt;&gt;</code> <code>!=</code> <code>IS</code> <code>LIKE</code> <code>REGEXP</code> <code>IN</code></td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">`</td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center"><code>&amp;</code></td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td style="text-align:center"><code>&lt;&lt;</code> <code>&gt;&gt;</code></td>
</tr>
<tr>
<td style="text-align:center">10</td>
<td style="text-align:center"><code>-</code> <code>+</code></td>
</tr>
<tr>
<td style="text-align:center">11</td>
<td style="text-align:center"><code>*</code> <code>/</code> <code>DIV</code> <code>%</code> <code>MOD</code></td>
</tr>
<tr>
<td style="text-align:center">12</td>
<td style="text-align:center"><code>^</code></td>
</tr>
<tr>
<td style="text-align:center">13</td>
<td style="text-align:center"><code>-（负号）</code> <code>~</code></td>
</tr>
<tr>
<td style="text-align:center">14</td>
<td style="text-align:center"><code>!</code></td>
</tr>
<tr>
<td style="text-align:center">15</td>
<td style="text-align:center"><code>0</code></td>
</tr>
</tbody>
</table>
<p>数字编号越大，优先级越高，优先级高的运算符先进行计算。可以看到，赋值运算符的优先级最低，使用 <code>()</code> 括起来的表达式的优先级最高。</p>
<h2 id="3-7-使用正则表达式查询"><a class="header-anchor" href="#3-7-使用正则表达式查询"></a>3.7 使用正则表达式查询</h2>
<p>正则表达式通常被用来检索或替换那些符合某个模式的文本内容，根据指定的匹配模式匹配文本中符合要求的特殊字符串。例如，从一个文本文件中提取电话号码、查找一篇文章中重复的单词或者替换用户输入的某些敏感词语等。正则表达式强大而且灵活，可以应用于非常复杂的查询。</p>
<p>MySQL 中使用 <code>REGEXP</code> 关键字指定正则表达式的字符匹配模式。下表列出了常用的字符匹配：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/MySQL%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D%E7%AC%A6.png" alt="MySQL中常用的正则表达式匹配符"></p>
<blockquote>
<p>查询以特定字符或字符串开头的记录</p>
</blockquote>
<p><code>^</code> 匹配以特定字符或者字符串开头的文本。比如，查询 fruits 表中 f_name 字段以字母 <code>b</code> 开头的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name REGEXP <span class="string">&#x27;^b&#x27;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查询以特定字符或字符串结尾的记录</p>
</blockquote>
<p><code>$</code> 匹配以特定字符或者字符串结尾的文本。比如，查询 fruits 表中 f_name 字段以字母 <code>y</code> 结尾的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name REGEXP <span class="string">&#x27;y$&#x27;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>替代字符串中的任意一个字符</p>
</blockquote>
<p><code>.</code> 匹配任意一个字符。比如，查询 fruits 表中 f_name 字段值包含字母 <code>a</code> 与 <code>g</code> 且两个字母之间只有一个字母的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name REGEXP <span class="string">&#x27;a.g&#x27;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>多个字符的匹配</p>
</blockquote>
<p><code>*</code> 匹配前面的字符任意多次，也包括 0 次，而 <code>+</code> 可以匹配前面的字符至少一次。</p>
<p>查询 fruits 表中 f_name 字段值以字母 <code>b</code> 开头且 <code>b</code> 后面 <strong>可能</strong> 出现字母 <code>a</code> 的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name REGEXP <span class="string">&#x27;^ba*&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>查询 fruits 表中 f_name 字段值以字母 <code>b</code> 开头且 <code>b</code> 后面 <strong>至少出现一次</strong> 字母 <code>a</code> 的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name REGEXP <span class="string">&#x27;^ba+&#x27;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>匹配指定字符串</p>
</blockquote>
<p>正则表达式可以匹配指定字符串，只要这个字符串在查询文本中即可，如要匹配多个字符串，字符串之间使用 <code>|</code> 隔开即可。</p>
<p>查询 fruits 表中 f_name 字段值包含字符串 <code>on</code> 的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name REGEXP <span class="string">&#x27;on&#x27;</span>;</span><br><span class="line"># 等效于</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name <span class="keyword">like</span> <span class="string">&#x27;%on%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>查询 fruits 表中 f_name 字段值包含字符串 <code>on</code> 或 <code>ap</code> 的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name REGEXP <span class="string">&#x27;on|ap&#x27;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>匹配指定字符中的任意一个</p>
</blockquote>
<p><code>[]</code> 指定一个字符集合， <strong>只匹配其中任何一个字符，</strong> 即为所查找的文本。比如，查找 fruits 表中 f_name 字段中包含字母 <code>o</code> 或者 <code>t</code> 的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name REGEXP <span class="string">&#x27;[ot]&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>在比如，查询 fruits 表中 s_id 字段中包含 4、5 或 6 的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> s_id REGEXP <span class="string">&#x27;[456]&#x27;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>匹配指定字符以外的字符</p>
</blockquote>
<p><code>[^ ]</code> 匹配不在指定集合中的任何字符。比如，查询 fruits 表中 f_id 字段中包含字母 a 到 e 和数字 1 到 2 以外字符的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_id REGEXP <span class="string">&#x27;[^a-e1-2]&#x27;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>匹配出现指定次数的字符串</p>
</blockquote>
<p><code>字符串&#123;n,&#125;</code> 表示至少匹配 n 次前面的字符；<code>字符串&#123;n,m&#125;</code> 表示匹配前面的字符串不少于 n 次，不多于 m 次。例如，<code>a&#123;2,&#125;</code> 表示字母 a 连续出现至少 2 次，<code>a&#123;2,4&#125;</code> 表示字母 a 连续出现最少 2 次，但不超过4次。</p>
<p>查询 fruits 表中 f_name 字段值出现字母 <code>x</code> 至少 2 次的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name REGEXP <span class="string">&#x27;x&#123;2,&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>查询 fruits 表中 f_name 字段值出现字符串 ba 最少 1 次、最多 3 次的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name REGEXP <span class="string">&#x27;ba&#123;1,3&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h1 id="4-排序与分页"><a class="header-anchor" href="#4-排序与分页"></a>4. 排序与分页</h1>
<h2 id="4-1-数据的排序"><a class="header-anchor" href="#4-1-数据的排序"></a>4.1 数据的排序</h2>
<blockquote>
<p>排序规则</p>
</blockquote>
<p>使用 <code>ORDER BY</code> 子句排序，<code>ORDER BY</code> 子句要在 <code>SELECT</code> 语句的结尾。有以下两种排序规则：</p>
<p>1、ASC（ascend）：升序<br>
2、DESC（descend）：降序</p>
<p>默认排序规则是升序。</p>
<blockquote>
<p>单列排序</p>
</blockquote>
<p>比如按入职时间对员工进行升序排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, department_id, hire_date</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> hire_date;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%8C%89%E5%85%A5%E8%81%8C%E6%97%B6%E9%97%B4%E5%8D%87%E5%BA%8F%E6%8E%92%E5%BA%8F.png" alt="按入职时间升序排序"></p>
<p>再比如按入职时间降序排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, department_id, hire_date</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> hire_date <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%8C%89%E5%85%A5%E8%81%8C%E6%97%B6%E9%97%B4%E9%99%8D%E5%BA%8F%E6%8E%92%E5%BA%8F.png" alt="按入职时间降序排序"></p>
<blockquote>
<p>多列排序</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> department_id, salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E5%A4%9A%E5%88%97%E6%8E%92%E5%BA%8F.png" alt="多列排序"></p>
<p>可以对不在 <code>SELECT</code> 列表中的列排序。</p>
<p>在进行多列进行排序时，如果排序的第一列有相同的列值，才会对第二列进行排序。如果第一列数据中的所有值都是唯一的，那么不会对第二列进行排序。</p>
<h2 id="4-2-分页"><a class="header-anchor" href="#4-2-分页"></a>4.2 分页</h2>
<p>当查询返回的数据过多时，或者表中有 4 条数据，但只想显示第 2、3 条数据时，就可以使用分页查询。</p>
<p>MySQL 中使用 <code>LIMIT</code> 关键词实现分页，基本语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIMIT [位置偏移量,] 行数</span><br></pre></td></tr></table></figure>
<p>其中位置偏移量是可省略的，省略时按照 0 进行处理。</p>
<p>比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 前 10 条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 表名 LIMIT <span class="number">0</span>,<span class="number">10</span>;</span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 表名 LIMIT <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第 11 至 20 条记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 表名 LIMIT <span class="number">10</span>,<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 第 21 至 30 条记录：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> 表名 LIMIT <span class="number">20</span>,<span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p>MySQL 8.0 中可以使用 <code>LIMIT 3 OFFSET 4</code> 获取从第 5 条记录开始后面的 3 条记录，和  <code>LIMIT4,3</code> 返回的结果相同。</p>
<p>分页显示公式：<code>(当前页数 - 1) * 每页条数, 每页条数</code>，即：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> </span><br><span class="line">LIMIT (PageNo <span class="operator">-</span> <span class="number">1</span>) <span class="operator">*</span> PageSize, PageSize;</span><br></pre></td></tr></table></figure>
<p><mark>注意：</mark> <code>LIMIT</code> 子句必须放在整个 <code>SELECT</code> 语句的最后。</p>
<p>使用分页可以约束返回结果的数量，以减少数据表的网络传输量，并提升查询效率。如果我们知道返回结果只有 1 条，可以直接使用 <code>LIMIT 1</code>，告诉 <code>SELECT</code> 语句只返回一条记录即可。这样 SELECT 就不用扫描完整的表，只需要检索到一条符合条件的记录即可返回。</p>
<h2 id="4-3-不同数据库下的分页"><a class="header-anchor" href="#4-3-不同数据库下的分页"></a>4.3 不同数据库下的分页</h2>
<p>在不同的 DBMS 中使用的分页关键字可能不同。在 MySQL、PostgreSQL、MariaDB 和 SQLite 中使用 <code>LIMIT</code> 关键字，而且需要放到 <code>SELECT</code> 语句的最后面。</p>
<p>如果是 SQL Server 和 Access，需要使用 <code>TOP</code> 关键字，比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">5</span> name, hp_max <span class="keyword">FROM</span> heros <span class="keyword">ORDER</span> <span class="keyword">BY</span> hp_max <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<p>如果是 DB2，使用 <code>FETCH FIRST 5 ROWS ONLY</code> 这样的关键字：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, hp_max <span class="keyword">FROM</span> heros <span class="keyword">ORDER</span> <span class="keyword">BY</span> hp_max <span class="keyword">DESC</span> <span class="keyword">FETCH</span> <span class="keyword">FIRST</span> <span class="number">5</span> <span class="keyword">ROWS</span> <span class="keyword">ONLY</span>;</span><br></pre></td></tr></table></figure>
<p>如果是 Oracle，需要基于 <code>ROWNUM</code> 来统计行数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> rownum, last_name, salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> rownum <span class="operator">&lt;</span> <span class="number">5</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<p>需要说明的是，这条语句是先取出来前 5 条数据行，然后再按照 hp_max 从高到低的顺序进行排序,但这样产生的结果和上述方法的并不一样。可以使用以下语句达到相同的效果：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> rownum, last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> last_name,salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>)</span><br><span class="line"><span class="keyword">WHERE</span> rownum <span class="operator">&lt;</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<h2 id="4-4-一起使用时的坑"><a class="header-anchor" href="#4-4-一起使用时的坑"></a>4.4 一起使用时的坑</h2>
<p>参考链接：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/r1QC0UDkwtLUhPszr1tFpQ">麻了啊！一个烂分页，踩了三个坑！</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/limit-optimization.html">LIMIT Query Optimization</a></li>
</ul>
<p>如果 <code>LIMIT row_count</code> 和 <code>ORDER BY</code> 组合使用，MySQL 在找到排序结果的第一行时就会停止排序，而不是对整个结果进行排序。</p>
<p>如果多条记录的 <code>ORDER BY</code> 列中有相同的值，服务器可以自由地按任何顺序返回这些记录，并可能根据整体执行计划的不同而采取不同的方式。</p>
<blockquote>
<p>官方的案例说明</p>
</blockquote>
<p>目标排序列有相同的值，只使用 <code>ORDER BY</code> 查询时：</p>
<pre>
mysql> SELECT * FROM ratings ORDER BY category;
<font>+----+----------+--------+</font>
| id | category | rating |
<font>+----+----------+--------+</font>
|  1 |        1 |    4.5 |
|  5 |        1 |    3.2 |
|  3 |        2 |    3.7 |
|  4 |        2 |    3.5 |
|  6 |        2 |    3.5 |
|  2 |        3 |    5.0 |
|  7 |        3 |    2.7 |
<font>+----+----------+--------+</font>
</pre>
<p>此时前五条数据的 id 是 <code>[1, 5, 3, 4, 6]</code>。</p>
<p>如果追加 <code>LIMIT 5</code> 条件，在排序的基础上只查询前五条数据：</p>
<pre>
mysql> SELECT * FROM ratings ORDER BY category LIMIT 5;
<font>+----+----------+--------+</font>
| id | category | rating |
<font>+----+----------+--------+</font>
|  1 |        1 |    4.5 |
|  5 |        1 |    3.2 |
|  4 |        2 |    3.5 |
|  3 |        2 |    3.7 |
|  6 |        2 |    3.5 |
<font>+----+----------+--------+</font>
</pre>
<p>此时前五条数据的 id 发生了变化，变成了 <code>[1, 5, 4, 3, 6]</code>。</p>
<p>两次查询结果不一样： <strong>对具有相同值的列进行 <code>ORDER BY</code> 时，得到的结果拥有不确定性。</strong></p>
<p>如果对顺序十分敏感，可以增加具有唯一性的列进行排序。比如 id 一般来说都是唯一的，因此可以再 <code>ORDER BY</code> 一个 id，比如：</p>
<pre>
mysql> SELECT * FROM ratings ORDER BY category, id;
<font>+----+----------+--------+</font>
| id | category | rating |
<font>+----+----------+--------+</font>
|  1 |        1 |    4.5 |
|  5 |        1 |    3.2 |
|  3 |        2 |    3.7 |
|  4 |        2 |    3.5 |
|  6 |        2 |    3.5 |
|  2 |        3 |    5.0 |
|  7 |        3 |    2.7 |
<font>+----+----------+--------+</font><br/>
mysql> SELECT * FROM ratings ORDER BY category, id LIMIT 5;
<font>+----+----------+--------+</font>
| id | category | rating |
<font>+----+----------+--------+</font>
|  1 |        1 |    4.5 |
|  5 |        1 |    3.2 |
|  3 |        2 |    3.7 |
|  4 |        2 |    3.5 |
|  6 |        2 |    3.5 |
<font>+----+----------+--------+</font>
</pre>
<p>对于 <code>LIMIT</code> 中的一些细节，可以参考：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/ZVY-oDl8A9Be6ixT1c16Ng">我试图扯掉这条 SQL 的底裤。只能扯一点点，不能扯多了~</a></p>
<h1 id="5-多表查询"><a class="header-anchor" href="#5-多表查询"></a>5. 多表查询</h1>
<p>多表查询，也称为关联查询，指两个或多个表一起完成查询操作。</p>
<p>这些一起查询的表之间是有关系的（比如：一对一、一对多），因此它们之间一定是有关联字段的，这些关联字段可能建立了外键，也可能没有建立外键。</p>
<h2 id="5-1-笛卡尔积（或交叉连接）的理解"><a class="header-anchor" href="#5-1-笛卡尔积（或交叉连接）的理解"></a>5.1 笛卡尔积（或交叉连接）的理解</h2>
<p>现在需要查询员工的姓名及其部门名称，根据现有知识得：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_name <span class="keyword">FROM</span> employees, departments;</span><br></pre></td></tr></table></figure>
<p>这样会查询到多少数据呢？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(employee_id) <span class="keyword">FROM</span> employees;</span><br><span class="line"># 输出 <span class="number">107</span> 行</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(department_id)<span class="keyword">FROM</span> departments;</span><br><span class="line"># 输出 <span class="number">27</span> 行</span><br></pre></td></tr></table></figure>
<p>那么最终输出的数据条数有 <code>107 * 27 = 2889</code>。</p>
<p>我们把上述多表查询中出现的问题成为：笛卡尔积的错误。</p>
<p>笛卡尔乘积是一个数学运算。假设有两个集合 X 和 Y，那么 X 和 Y 的笛卡尔积就是 X 和 Y 的所有可能组合。即：第一个对象来自于 X，第二个对象来自于 Y 的所有可能。组合的个数即为两个集合中元素个数的乘积数。</p>
<p>SQL92 中，笛卡尔积也称为交叉连接，英文是 <code>CROSS JOIN</code>。在 SQL99 中也是使用 <code>CROSS JOIN</code> 表示交叉连接。它的作用就是可以把任意表进行连接，即使这两张表不相关。</p>
<p>在 MySQL 中，像下面这样查询员工姓名和所在部门名称就会出现笛卡尔积：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_name <span class="keyword">FROM</span> employees,departments;</span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name <span class="keyword">FROM</span> employees <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> departments;</span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name <span class="keyword">FROM</span> employees <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments;</span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name <span class="keyword">FROM</span> employees <span class="keyword">JOIN</span> departments;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>笛卡尔积产生的条件</p>
</blockquote>
<p>1、省略多个表的连接条件（或关联条件）</p>
<p>2、连接条件（或关联条件）无效</p>
<p>3、所有表中的所有行互相连接</p>
<blockquote>
<p>如何避免产生笛卡尔积</p>
</blockquote>
<p>在 <code>WHERE</code> 子句后加入有效的连接条件即可有效地避免笛卡尔积的产生。比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  table1.column, table2.column</span><br><span class="line"><span class="keyword">FROM</span> table1, table2</span><br><span class="line"><span class="keyword">WHERE</span> table1.column1 <span class="operator">=</span> table2.column2;  # 连接条件</span><br></pre></td></tr></table></figure>
<p><strong>当某个字段的名称在多个表中出现时，需要在列名前加上表名后缀。</strong> 比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees, departments</span><br><span class="line"><span class="keyword">WHERE</span> employees.department_id <span class="operator">=</span> departments.department_id;</span><br></pre></td></tr></table></figure>
<h2 id="5-2-多表查询的分类讲解"><a class="header-anchor" href="#5-2-多表查询的分类讲解"></a>5.2 多表查询的分类讲解</h2>
<blockquote>
<p>等值连接 VS 非等值链接</p>
</blockquote>
<p>【等值连接】查询员工的姓名与所在部门信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employees.employee_id, employees.last_name, </span><br><span class="line">	employees.department_id, departments.department_id, </span><br><span class="line">	departments.location_id</span><br><span class="line"><span class="keyword">FROM</span> employees, departments</span><br><span class="line"><span class="keyword">WHERE</span> employees.department_id <span class="operator">=</span> departments.department_id;</span><br></pre></td></tr></table></figure>
<p>当多个表中有相同的列名时，<strong>必须</strong> 在列名前加上表名对列名进行区分。否则会出现以下错误：</p>
<pre>
Column 'xxx' in field list is ambiguous
</pre>
<p>阿里巴巴开发规范中也提及到：</p>
<pre>
【强制】对于数据库中表记录的查询和变更，只要涉及多个表，都需要在列名前加表的别名（或
表名）进行限定。
</pre>
<p>为了对查询语句进行简化，可以对表名使用别名。如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, e.last_name, </span><br><span class="line">	e.department_id, d.department_id, d.location_id</span><br><span class="line"><span class="keyword">FROM</span> employees e , departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure>
<p><mark>注意：</mark> 如果在 SQL 语句里使用了表的别名，那么在查询字段中、过滤条件中就只能使用别名，不能使用原有的表名。</p>
<p>【非等值链接】查询员工的工资等级：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name, e.salary, j.grade_level</span><br><span class="line"><span class="keyword">FROM</span> employees e, job_grades j</span><br><span class="line"><span class="keyword">WHERE</span> e.salary <span class="keyword">BETWEEN</span> j.lowest_sal <span class="keyword">AND</span> j.highest_sal;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>自连接 VS 非自连接</p>
</blockquote>
<p>【自连接】以 <code>xxx works for xxx</code> 输出员工姓名及其经理姓名。</p>
<p>分析：在员工表 <code>employees</code> 中存在 <code>manager_id</code> 字段表示某一员工的经理的 <code>employee_id</code>，因此需要让 <code>employees</code> 表自己连接自己，并用取别名的方式虚拟成两张表以代表不同的意义。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(worker.last_name,<span class="string">&#x27; works for &#x27;</span>, manager.last_name)</span><br><span class="line"><span class="keyword">FROM</span> employees worker, employees manager</span><br><span class="line"><span class="keyword">WHERE</span> worker.manager_id <span class="operator">=</span> manager.employee_id;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>内连接 VS 外连接</p>
</blockquote>
<p>除了查询满足条件的记录以外，外连接还可以查询某一方不满足条件的记录。</p>
<p>内连接：合并具有同一列的两个以上的表的行，结果集中不包含一个表与另一个表不匹配的行。</p>
<p>外连接：两个表在连接过程中除了返回满足连接条件的行以外，还返回左（或右）表中不满足条件的行 ，这种连接称为左（或右） 外连接。没有匹配的行时，结果表中相应的列为空 <code>NULL</code>。</p>
<p>如果是左外连接，则连接条件中左边的表也称为主表，右边的表称为从表。</p>
<p>如果是右外连接，则连接条件中右边的表也称为主表，左边的表称为从表。</p>
<blockquote>
<p>SQL92：使用 <code>+</code> 创建连接</p>
</blockquote>
<p>在 SQL92 中采用 <code>+</code> 代表从表所在的位置。即左或右外连接中，<code>+</code> 所标识的表就是从表。</p>
<p>Oracle 对 SQL92 支持较好，而 MySQL 不支持 SQL92 的外连接。</p>
<p>在 SQL92 中，只有左外连接和右外连接，没有满（或全）外连接。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 左外连接</span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name</span><br><span class="line"><span class="keyword">FROM</span> employees ,departments</span><br><span class="line"><span class="keyword">WHERE</span> employees.department_id <span class="operator">=</span> departments.department_id(<span class="operator">+</span>);</span><br><span class="line"></span><br><span class="line"># 右外连接</span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name</span><br><span class="line"><span class="keyword">FROM</span> employees ,departments</span><br><span class="line"><span class="keyword">WHERE</span> employees.department_id(<span class="operator">+</span>) <span class="operator">=</span> departments.department_id;</span><br></pre></td></tr></table></figure>
<h2 id="5-3-SQL99-语法实现多表查询"><a class="header-anchor" href="#5-3-SQL99-语法实现多表查询"></a>5.3 SQL99 语法实现多表查询</h2>
<blockquote>
<p>基本语法</p>
</blockquote>
<p>使用 <code>JOIN...ON</code> 子句创建连接的语法结构，比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> table1.column, table2.column,table3.column</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line">	<span class="keyword">JOIN</span> table2 <span class="keyword">ON</span> table1 和 table2 的连接条件</span><br><span class="line">		<span class="keyword">JOIN</span> table3 <span class="keyword">ON</span> table2 和 table3 的连接条件</span><br></pre></td></tr></table></figure>
<p>它的嵌套逻辑类似使用的 FOR 循环：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> t1 <span class="keyword">in</span> table1:</span><br><span class="line">    <span class="keyword">for</span> t2 <span class="keyword">in</span> table2:</span><br><span class="line">       if condition1:</span><br><span class="line">           <span class="keyword">for</span> t3 <span class="keyword">in</span> table3:</span><br><span class="line">              if condition2:</span><br><span class="line">                  output t1 <span class="operator">+</span> t2 <span class="operator">+</span> t3</span><br></pre></td></tr></table></figure>
<p>SQL99 采用的这种嵌套结构清爽、层次性强、可读性强，即使再多的表进行连接也都清晰可见。如果采用 SQL92，可读性将会大打折扣。</p>
<p>语法说明：</p>
<p>1、可以使用 <code>ON</code> 子句指定额外的连接条件</p>
<p>2、连接条件是与其它条件分开的</p>
<p>3、<code>ON</code> 子句使语句具有更高的易读性</p>
<p>4、关键字 <code>JOIN</code>、<code>INNER JOIN</code>、<code>CROSS JOIN</code> 的含义是一样的，都表示内连接</p>
<blockquote>
<p>内连接（INNER JOIN）的实现</p>
</blockquote>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表</span><br><span class="line"><span class="keyword">FROM</span> A表 <span class="keyword">INNER</span> <span class="keyword">JOIN</span> B表</span><br><span class="line"><span class="keyword">ON</span> 关联条件</span><br><span class="line"><span class="keyword">WHERE</span> 等其他子句;</span><br></pre></td></tr></table></figure>
<p>查询员工及其所在部门信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, e.last_name, e.department_id, </span><br><span class="line">	d.department_id, d.location_id</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> (e.department_id <span class="operator">=</span> d.department_id);</span><br></pre></td></tr></table></figure>
<p>查询员工部门所在的城市：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, city, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> d.department_id <span class="operator">=</span> e.department_id</span><br><span class="line"><span class="keyword">JOIN</span> locations l</span><br><span class="line"><span class="keyword">ON</span> d.location_id <span class="operator">=</span> l.location_id;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>左外连接（LEFT OUTER JOIN）的实现</p>
</blockquote>
<p><code>LEFT OUTER JOIN</code> 可以简写成 <code>LEFT JOIN</code>。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表</span><br><span class="line"><span class="keyword">FROM</span> A表 <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> B表</span><br><span class="line"><span class="keyword">ON</span> 关联条件</span><br><span class="line"><span class="keyword">WHERE</span> 等其他子句;</span><br></pre></td></tr></table></figure>
<p>使用左外连接查询所有员工及其所在部门：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name, e.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> (e.department_id <span class="operator">=</span> d.department_id);</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/SQL99%E8%AF%AD%E6%B3%95%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E7%A4%BA%E4%BE%8B.png" alt="SQL99语法左外连接查询结果示例"></p>
<blockquote>
<p>右外连接（RIGHT OUTER JOIN）的实现</p>
</blockquote>
<p><code>RIGHT OUTER JOIN</code> 也可以简写成 <code>RIGHT JOIN</code>。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 字段列表</span><br><span class="line"><span class="keyword">FROM</span> A表 <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> B表</span><br><span class="line"><span class="keyword">ON</span> 关联条件</span><br><span class="line"><span class="keyword">WHERE</span> 等其他子句;</span><br></pre></td></tr></table></figure>
<p>使用右外连接查询所有员工及其所在部门：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name, e.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> (e.department_id <span class="operator">=</span> d.department_id);</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/SQL99%E8%AF%AD%E6%B3%95%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E7%A4%BA%E4%BE%8B.png" alt="SQL99语法右外连接查询结果示例"></p>
<p>使用 <code>LEFT JOIN</code> 也可以实现 <code>RIGHT JOIN</code> 的功能，反过来也是一样，只需要交换 FROM 和 JOIN 的表即可：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name, e.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> employees e</span><br><span class="line"><span class="keyword">ON</span> (e.department_id <span class="operator">=</span> d.department_id);</span><br></pre></td></tr></table></figure>
<p><mark>注意：</mark> <code>LEFT JOIN</code> 和 <code>RIGHT JOIN</code> 只存在于 SQL99 及以后的标准中，在 SQL92 中不存在，SQL92 中只能用 <code>+</code> 表示外连接。</p>
<blockquote>
<p>满外连接（FULL OUTER JOIN）的实现</p>
</blockquote>
<p>满外连接的结果 = 左右表匹配的数据 + 左表没有匹配到的数据 + 右表没有匹配到的数据</p>
<p>SQL99 支持满外连接，使用 <code>FULL JOIN</code> 或 <code>FULL OUTER JOIN</code> 即可实现。</p>
<p>MySQL 并不支持 <code>FULL JOIN</code>，但可以用 <code>LEFT JOIN UNION RIGHT JOIN</code> 来代替。</p>
<h2 id="5-4-UNION-的使用"><a class="header-anchor" href="#5-4-UNION-的使用"></a>5.4 UNION 的使用</h2>
<blockquote>
<p>合并查询结果</p>
</blockquote>
<p>利用 UNION 关键字，可以给出多条 <code>SELECT</code> 语句，并将它们的结果组合成单个结果集。合并时两个表对应的列数和数据类型必须相同，并且相互对应。各个 <code>SELECT</code> 语句之间使用 <code>UNION</code> 或 <code>UNION ALL</code> 关键字分隔。</p>
<p>语法格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ... <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">UNION</span> [<span class="keyword">ALL</span>]</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, ... <span class="keyword">FROM</span> table2</span><br></pre></td></tr></table></figure>
<blockquote>
<p>UNION 操作符</p>
</blockquote>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/UNION%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%9B%BE%E8%A7%A3.png" alt="UNION操作符图解"></p>
<p><code>UNION</code> 操作符返回两个查询的结果集的并集，去除重复记录。</p>
<blockquote>
<p>UNION ALL 操作符</p>
</blockquote>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/UNION-ALL%E6%93%8D%E4%BD%9C%E7%AC%A6%E5%9B%BE%E8%A7%A3.png" alt="UNION-ALL操作符图解"></p>
<p>UNION ALL 操作符返回两个查询的结果集的并集。对于两个结果集的重复部分不会去重。</p>
<p><mark>注意：</mark> 执行 <code>UNION ALL</code> 语句时所需要的资源比 <code>UNION</code> 语句少。如果明确知道合并数据后的结果数据不存在重复数据，或者不需要去除重复的数据，尽量使用 <code>UNION ALL</code> 语句，以提高数据查询的效率。</p>
<blockquote>
<p>具体实例</p>
</blockquote>
<p>查询部门编号大于 90 或邮箱包含 <code>a</code> 字符的员工信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 方式 <span class="number">1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">&#x27;%a%&#x27;</span> <span class="keyword">OR</span> department_id <span class="operator">&gt;</span> <span class="number">90</span>;</span><br><span class="line"># 方式 <span class="number">2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">&#x27;%a%&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id <span class="operator">&gt;</span> <span class="number">90</span>;</span><br></pre></td></tr></table></figure>
<p>查询中国用户中男性的信息以及美国用户中年男性的用户信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,cname <span class="keyword">FROM</span> t_chinamale <span class="keyword">WHERE</span> csex<span class="operator">=</span><span class="string">&#x27;男&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> id,tname <span class="keyword">FROM</span> t_usmale <span class="keyword">WHERE</span> tGender<span class="operator">=</span><span class="string">&#x27;male&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="5-5-7-种-SQL-JOINS-的实现"><a class="header-anchor" href="#5-5-7-种-SQL-JOINS-的实现"></a>5.5 7 种 SQL JOINS 的实现</h2>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/SQL-Join.png" alt="SQL-Join"></p>
<p>中图，内连接：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br></pre></td></tr></table></figure>
<p>左上图，左外连接：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br></pre></td></tr></table></figure>
<p>右上图，右外连接：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br></pre></td></tr></table></figure>
<p>左中图，A - A ∩ B：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> d.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<p>右中图，B -  A ∩ B：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<p>左下图，满外连接：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> d.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> # 没有去重操作，效率高</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`;</span><br></pre></td></tr></table></figure>
<p>右下图，A ∪ B - A ∩ B 或者 (A - A ∩ B) ∪B - (A ∩ B)：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> d.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">WHERE</span> e.`department_id` <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<h2 id="5-6-SQL99-语法新特性"><a class="header-anchor" href="#5-6-SQL99-语法新特性"></a>5.6 SQL99 语法新特性</h2>
<blockquote>
<p>自然连接</p>
</blockquote>
<p>SQL99 在 SQL92 的基础上提供了一些特殊语法，比如使用 <code>NATURAL JOIN</code> 用来表示自然连接。自然连接理解为 SQL92 中的等值连接，它会帮你自动查询两张连接表中所有相同的字段，然后进行等值连接。</p>
<p>在 SQL92 标准中：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line"><span class="keyword">AND</span> e.`manager_id` <span class="operator">=</span> d.`manager_id`;</span><br></pre></td></tr></table></figure>
<p>而在 SQL99 中，你可以写成：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> departments d;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>USING 连接</p>
</blockquote>
<p>当我们进行连接的时候，SQL99 还支持使用 <code>USING</code> 指定数据表里的 <strong>同名字段</strong> 进行等值连接，但 <strong>只能配合 <code>JOIN</code> 一起使用。</strong> 比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">USING</span> (department_id);</span><br></pre></td></tr></table></figure>
<p>它等效于：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure>
<p>与自然连接 <code>NATURAL JOIN</code> 不同的是，<code>USING</code> 指定了具体的相同的字段名称，需要在 <code>USING</code> 的括号 <code>()</code> 中填入要指定的同名字段。</p>
<p>相比于 <code>JOIN ON</code> 的等值链接，使用 <code>JOIN USING</code> 更加简洁。</p>
<h2 id="5-7-多表查询小结"><a class="header-anchor" href="#5-7-多表查询小结"></a>5.7 多表查询小结</h2>
<p>表连接的约束条件有三种方式，分别是 <code>WHERE</code>、<code>ON</code> 和 <code>USING</code>。其中：</p>
<p><code>WHERE</code>：适用于所有关联查询</p>
<p><code>ON</code>：只能和 <code>JOIN</code> 一起使用，只能写关联条件。虽然关联条件可以并到 <code>WHERE</code> 中和其他条件一起写，但分开写可读性更好。</p>
<p><code>USING</code>：只能和 <code>JOIN</code>一起使用，而且要求 <strong>两个</strong> 关联字段在关联表中名称一致，而且只能表示关联 <strong>字段值相等</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">WHERE</span> 使用示例</span><br><span class="line"><span class="keyword">SELECT</span> last_name, department_name </span><br><span class="line"><span class="keyword">FROM</span> employees, departments </span><br><span class="line"><span class="keyword">WHERE</span> employees.department_id <span class="operator">=</span> departments.department_id;</span><br><span class="line"></span><br><span class="line"># <span class="keyword">ON</span> 使用示例</span><br><span class="line"><span class="keyword">SELECT</span> last_name, department_name </span><br><span class="line"><span class="keyword">FROM</span> employees <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments </span><br><span class="line"><span class="keyword">ON</span> employees.department_id <span class="operator">=</span> departments.department_id;</span><br><span class="line"></span><br><span class="line"># <span class="keyword">USING</span> 使用示例</span><br><span class="line"><span class="keyword">SELECT</span> last_name, department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">USING</span> (department_id);</span><br></pre></td></tr></table></figure>
<p><mark>注意：</mark> 要控制连接表的数量。多表连接就相当于嵌套 for 循环一样，非常消耗资源，严重降低 SQL 查询性能，因此不要连接不必要的表，而在许多 DBMS 中，都会有最大连接表的限制。</p>
<p>阿里巴巴开发手册有言：超过三个表禁止 JOIN。需要 JOIN 的字段，数据类型保持绝对一致；多表关联查询时， 保证被关联的字段有索引。</p>
<h1 id="6-单行函数"><a class="header-anchor" href="#6-单行函数"></a>6. 单行函数</h1>
<h2 id="6-1-函数的理解"><a class="header-anchor" href="#6-1-函数的理解"></a>6.1 函数的理解</h2>
<blockquote>
<p>什么是函数</p>
</blockquote>
<p>我们可以将经常使用的代码封装起来，在需要的时候进行调用即可，这个封装就是一个函数。在 SQL 中我们也可以使用函数对检索出来的数据进行函数操作。使用这些函数，可以极大地提高用户对数据库的管理效率。</p>
<p>从函数定义的角度出发，可以将函数分为 <strong>内置函数</strong> 和 <strong>自定义函数</strong>，在 SQL 中也是这样的。内置函数是系统内置的通用函数，自定义函数则是用户根据自己的需求编写的函数。</p>
<blockquote>
<p>不同 DBMS 中的函数差异</p>
</blockquote>
<p>在使用 SQL 语言时，不是直接和这门语言打交道，而是使用不同的数据库软件，即 DBMS。DBMS 之间的差异性很大，远大于同一个语言不同版本之间的差异。实际上，只有很少的函数是被 DBMS 同时支持的。</p>
<p>比如，大多数 DBMS 使用 <code>||</code> 或者 <code>+</code> 来做拼接符，而在 MySQL 中的字符串拼接函数为 <code>CONCAT()</code>。大部分  DBMS 会有自己特定的函数，这就意味着采用 SQL 函数的代码可移植性是很差的，因此在使用函数的时候需要特别注意。</p>
<blockquote>
<p>拓展：MySQL 与 Oracle 下的字符串拼接</p>
</blockquote>
<p>在 Oracle 下可以使用 <code>||</code> 进行字符串拼接，但在 MySQL 中 <code>||</code> 表示逻辑或。</p>
<p>比如 Oracle 中可以这样拼接字符串：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;Hello &#x27;</span> <span class="operator">||</span> <span class="string">&#x27;World&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>在 MySQL 中更推荐使用 <code>CONCAT()</code> 函数完成字符串拼接。比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;Hello&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;World&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>虽然 Oracle 也支持 <code>CONCAT()</code> 函数，但是它每次只能拼接两个值，对于多个值的拼接则需要嵌套，比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;Hello&#x27;</span>, CONCAT(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;World&#x27;</span>));</span><br><span class="line"><span class="comment">-- 如果拼接的字符串中有中文，可能会出现乱码，可以使用 TO_CHAR() 函数</span></span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(TO_CHAR(<span class="string">&#x27;默&#x27;</span>)， TO_CHAR(<span class="string">&#x27;烦&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p><code>TO_CHAR()</code> 用于将其他类型数据类型转换成字符类型的函数。对于 <code>TO_CHAR('默')</code> 来说，<code>默</code> 本身就是字符类型，所以这一步没有实际变化。其实使用 <code>CONCAT()</code> 函数或 <code>||</code> 进行字符串拼接时，Oracle 会将字符串按照当前数据库的字符集进行处理，从而避免中文乱码的问题，如果还有中文乱码，就需要检查数据库的字符集设置或者调整应用程序的字符编码设置。</p>
<p>在 Oracle 中使用 <code>||</code> 拼接字符串时就不受每次只能拼接两个字符串的限制：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> (tb_person.first_name <span class="operator">||</span> tb_person.last_name) full_name  <span class="keyword">FROM</span> t1;</span><br><span class="line"><span class="comment">-- 除此之外，这还常用于模糊查询中</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1 <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%&#x27;</span> <span class="operator">||</span> <span class="string">&#x27;默烦&#x27;</span> <span class="operator">||</span> <span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>再补充一点：在 MySQL 中使用 <code>CONCAT()</code> 函数拼接多个字符串时，如果其中一个是 <code>NULL</code>，那么最终的值也是 <code>NULL</code>，解决这个问题可以使用 <code>CONCAT_WS()</code> 函数进行字符串拼接。</p>
<blockquote>
<p>MySQL 的内置函数与分类</p>
</blockquote>
<p>MySQL 提供了丰富的内置函数，其提供的内置函数从实现的功能角度可以分为数值函数、字符串函数、日期和时间函数、流程控制函数、加密与解密函数、获取MySQL信息函数、聚合函数等。</p>
<p>这些丰富的内置函数可以再分为两类：单行函数、聚合函数（或分组函数）。</p>
<p>其中单行函数：</p>
<p>1、操作数据对象</p>
<p>2、接受参数并返回一个结果</p>
<p>3、只对一行进行变换</p>
<p>4、每行返回一个结果</p>
<p>5、可以嵌套</p>
<p>6、参数可以是一列或一个值</p>
<h2 id="6-2-数值函数"><a class="header-anchor" href="#6-2-数值函数"></a>6.2 数值函数</h2>
<blockquote>
<p>基本函数</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ABS(x)</td>
<td style="text-align:center">x 的绝对值</td>
</tr>
<tr>
<td style="text-align:center">SIGN(x)</td>
<td style="text-align:center">x 的符号。正数返回 1，负数返回 -1，0 返回 0</td>
</tr>
<tr>
<td style="text-align:center">PI()</td>
<td style="text-align:center">圆周率的值</td>
</tr>
<tr>
<td style="text-align:center">CEIL(x)，CEILING(x)</td>
<td style="text-align:center">大于或等于某个值的最小整数</td>
</tr>
<tr>
<td style="text-align:center">FLOOR(x)</td>
<td style="text-align:center">小于或等于某个值的最大整数</td>
</tr>
<tr>
<td style="text-align:center">LEAST(e1, e2, e3…)</td>
<td style="text-align:center">列表中的最小值</td>
</tr>
<tr>
<td style="text-align:center">GREATEST(e1, e2, e3…)</td>
<td style="text-align:center">列表中的最大值</td>
</tr>
<tr>
<td style="text-align:center">MOD(x, y)</td>
<td style="text-align:center">x 除以 y 后的余数</td>
</tr>
<tr>
<td style="text-align:center">RAND()</td>
<td style="text-align:center">0~1 的随机值</td>
</tr>
<tr>
<td style="text-align:center">RAND(x)</td>
<td style="text-align:center">0~1 的随机值，其中 x 的值用作种子值，相同的 x 值会产生相同的随机数</td>
</tr>
<tr>
<td style="text-align:center">ROUND(x)</td>
<td style="text-align:center">对 x 进行四舍五入后，最接近于 x 的整数</td>
</tr>
<tr>
<td style="text-align:center">ROUND(x, y)</td>
<td style="text-align:center">对 x 进行四舍五入后最接近 x 的值，并保留到小数点后面 y 位</td>
</tr>
<tr>
<td style="text-align:center">TRUNCATE(x, y)</td>
<td style="text-align:center">数字 x 截断为 y 位小数的结果</td>
</tr>
<tr>
<td style="text-align:center">SQRT(x)</td>
<td style="text-align:center">x 的平方根，负数时，返回 <code>NULL</code></td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	<span class="built_in">ABS</span>(<span class="number">-123</span>), <span class="built_in">ABS</span>(<span class="number">32</span>), SIGN(<span class="number">-23</span>), SIGN(<span class="number">43</span>), PI(), <span class="built_in">CEIL</span>(<span class="number">32.32</span>), <span class="built_in">CEILING</span>(<span class="number">-43.23</span>), <span class="built_in">FLOOR</span>(<span class="number">32.32</span>),</span><br><span class="line">	<span class="built_in">FLOOR</span>(<span class="number">-43.23</span>), <span class="built_in">MOD</span>(<span class="number">12</span>,<span class="number">5</span>)</span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%95%B0%E5%80%BC%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8-1.png" alt="数值基本函数的使用-1"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> RAND(), RAND(), RAND(<span class="number">10</span>), RAND(<span class="number">10</span>), RAND(<span class="number">-1</span>), RAND(<span class="number">-1</span>) <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%95%B0%E5%80%BC%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8-2.png" alt="数值基本函数的使用-2"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	ROUND(<span class="number">12.33</span>), ROUND(<span class="number">12.343</span>, <span class="number">2</span>), ROUND(<span class="number">12.324</span>, <span class="number">-1</span>), <span class="keyword">TRUNCATE</span>(<span class="number">12.66</span>, <span class="number">1</span>), <span class="keyword">TRUNCATE</span>(<span class="number">12.66</span>, <span class="number">-1</span>)</span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%95%B0%E5%80%BC%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8-3.png" alt="数值基本函数的使用-3"></p>
<blockquote>
<p>角度与弧度互换函数</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">RADIANS(x)</td>
<td style="text-align:center">将角度转化为弧度，x 为角度值</td>
</tr>
<tr>
<td style="text-align:center">DEGREES(x)</td>
<td style="text-align:center">将弧度转化为角度，x 为弧度值</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> RADIANS(<span class="number">30</span>), RADIANS(<span class="number">60</span>), RADIANS(<span class="number">90</span>), DEGREES(<span class="number">2</span> <span class="operator">*</span> PI()), DEGREES(RADIANS(<span class="number">90</span>)) <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E8%A7%92%E5%BA%A6%E4%B8%8E%E5%BC%A7%E5%BA%A6%E4%BA%92%E6%8D%A2%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="角度与弧度互换函数的使用"></p>
<blockquote>
<p>三角函数</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">SIN(x)</td>
<td style="text-align:center">x 的正弦值，x 为弧度值</td>
</tr>
<tr>
<td style="text-align:center">ASIN(x)</td>
<td style="text-align:center">x 的反正弦值，即获取正弦为 x 的值。若 x 的值不在 -1 到 1 之间，返回 <code>NULL</code></td>
</tr>
<tr>
<td style="text-align:center">COS(x)</td>
<td style="text-align:center">x 的余弦值，x 为弧度值</td>
</tr>
<tr>
<td style="text-align:center">ACOS(x)</td>
<td style="text-align:center">x 的反余弦值，即获取余弦为 x 的值。若 x 的值不在 -1 到 1 之间，返回 <code>NULL</code></td>
</tr>
<tr>
<td style="text-align:center">TAN(x)</td>
<td style="text-align:center">x 的正切值，x 为弧度值</td>
</tr>
<tr>
<td style="text-align:center">ATAN(x)</td>
<td style="text-align:center">x 的反正切值，即获取正切值为 x 的值</td>
</tr>
<tr>
<td style="text-align:center">ATAN2(m, n)</td>
<td style="text-align:center">两个参数的反正切值</td>
</tr>
<tr>
<td style="text-align:center">COT(x)</td>
<td style="text-align:center">x 的余切值，x 为弧度值</td>
</tr>
</tbody>
</table>
<p><code>ATAN2(M, N)</code> 函数返回两个参数的反正切值。 与 <code>ATAN(x)</code> 函数相比，<code>ATAN2(M, N)</code> 需要两个参数。例如有两个点 <code>point(x1, y1)</code> 和 <code>point(x2, y2)</code>，使用 <code>ATAN(x)</code> 函数计算反正切值为 <code>ATAN((y2 - y1) / (x2 - x1))</code>，使用 <code>ATAN2(m, n)</code> 计算反正切值则为 <code>ATAN2(y2 - y1, x2 - x1)</code>。由使用方式可以看出，当 <code>x2 - x1</code> 等于 0 时，<code>ATAN(x)</code> 函数会报错，而 <code>ATAN2(m, n)</code> 函数则仍然可以计算。</p>
<p><code>ATAN2(m, n)</code> 函数的使用示例如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	<span class="built_in">SIN</span>(RADIANS(<span class="number">30</span>)), DEGREES(<span class="built_in">ASIN</span>(<span class="number">1</span>)), <span class="built_in">TAN</span>(RADIANS(<span class="number">45</span>)), DEGREES(<span class="built_in">ATAN</span>(<span class="number">1</span>)), DEGREES(ATAN2(<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E4%B8%89%E8%A7%92%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="三角函数的使用"></p>
<blockquote>
<p>指数与对数</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">POW(x, y)、POWER(x, y)</td>
<td style="text-align:center">x 的 y 次方</td>
</tr>
<tr>
<td style="text-align:center">EXP(x)</td>
<td style="text-align:center">自然对数 e 的 x 次方</td>
</tr>
<tr>
<td style="text-align:center">LN(x)、LOG(x)</td>
<td style="text-align:center">以自然对数 e 为底的 x 的对数，<code>x &lt;=  0</code> 时，返回的结果为 <code>NULL</code></td>
</tr>
<tr>
<td style="text-align:center">LOG10(x)</td>
<td style="text-align:center">以 10 为底的 x 的对数，<code>x  &lt;= 0</code> 时，返回的结果为 <code>NULL</code></td>
</tr>
<tr>
<td style="text-align:center">LOG2(x)</td>
<td style="text-align:center">以 2 为底的 x 的对数，<code>x  &lt;=  0</code> 时，返回 <code>NULL</code></td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> POW(<span class="number">2</span>, <span class="number">5</span>), <span class="built_in">POWER</span>(<span class="number">2</span>, <span class="number">4</span>), <span class="built_in">EXP</span>(<span class="number">2</span>), <span class="built_in">LN</span>(<span class="number">10</span>), <span class="built_in">LOG10</span>(<span class="number">10</span>), LOG2(<span class="number">4</span>) <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%8C%87%E6%95%B0%E4%B8%8E%E5%AF%B9%E6%95%B0%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="指数与对数函数的使用"></p>
<blockquote>
<p>进制间的转换</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">BIN(x)</td>
<td style="text-align:center">x 的二进制编码，x 是十进制数</td>
</tr>
<tr>
<td style="text-align:center">HEX(x)</td>
<td style="text-align:center">x 的十六进制编码，x 是十进制数</td>
</tr>
<tr>
<td style="text-align:center">OCT(x)</td>
<td style="text-align:center">x 的八进制编码，x 是十进制数</td>
</tr>
<tr>
<td style="text-align:center">CONV(x, f1, f2)</td>
<td style="text-align:center">f1 进制数变成 f2 进制数</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> BIN(<span class="number">10</span>), HEX(<span class="number">10</span>), OCT(<span class="number">10</span>), CONV(<span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>) <span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E8%BF%9B%E5%88%B6%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="进制函数的使用"></p>
<h2 id="6-3-字符串函数"><a class="header-anchor" href="#6-3-字符串函数"></a>6.3 字符串函数</h2>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ASCII(s)</td>
<td style="text-align:center">返回字符串 s 中的第一个字符的 ASCII 码值</td>
</tr>
<tr>
<td style="text-align:center">CHAR_LENGTH(s)</td>
<td style="text-align:center">返回字符串 s 的字符数。作用与 <code>CHARACTER_LENGTH(s)</code> 相同</td>
</tr>
<tr>
<td style="text-align:center">LENGTH(s)</td>
<td style="text-align:center">返回字符串 s 的字节数，和字符集有关</td>
</tr>
<tr>
<td style="text-align:center">CONCAT(s1, s2, …, sn)</td>
<td style="text-align:center">连接 s1, s2, …, sn 为一个字符串</td>
</tr>
<tr>
<td style="text-align:center">CONCAT_WS(x, s1, s2, …, sn)</td>
<td style="text-align:center">同 <code>CONCAT(s1, s2, ...)</code> 函数，但是每个字符串之间要加上 x</td>
</tr>
<tr>
<td style="text-align:center">INSERT(str,  idx,  len,  replacestr)</td>
<td style="text-align:center">将字符串 str 从第 idx 位置开始，len 个字符长的子串替换为字符串 replacestr</td>
</tr>
<tr>
<td style="text-align:center">REPLACE(str,  a, b)</td>
<td style="text-align:center">用字符串 b 替换字符串 str 中所有出现的字符串 a</td>
</tr>
<tr>
<td style="text-align:center">UPPER(s) 或 UCASE(s)</td>
<td style="text-align:center">将字符串 s 的所有字母转成大写字母</td>
</tr>
<tr>
<td style="text-align:center">LOWER(s) 或 LCASE(s)</td>
<td style="text-align:center">将字符串 s 的所有字母转成小写字母</td>
</tr>
<tr>
<td style="text-align:center">LEFT(str, n)</td>
<td style="text-align:center">返回字符串 str 最左边的 n 个字符</td>
</tr>
<tr>
<td style="text-align:center">RIGHT(str, n)</td>
<td style="text-align:center">返回字符串 str 最右边的 n 个字符</td>
</tr>
<tr>
<td style="text-align:center">LPAD(str, len, pad)</td>
<td style="text-align:center">用字符串 pad 对 str 最左边进行填充，直到 str 的长度为 len 个字符</td>
</tr>
<tr>
<td style="text-align:center">RPAD(str, len, pad)</td>
<td style="text-align:center">用字符串 pad 对 str 最右边进行填充，直到 str 的长度为 len 个字符</td>
</tr>
<tr>
<td style="text-align:center">LTRIM(s)</td>
<td style="text-align:center">去掉字符串 s 左侧的空格</td>
</tr>
<tr>
<td style="text-align:center">RTRIM(s)</td>
<td style="text-align:center">去掉字符串 s 右侧的空格</td>
</tr>
<tr>
<td style="text-align:center">TRIM(s)</td>
<td style="text-align:center">去掉字符串 s 开始与结尾的空格</td>
</tr>
<tr>
<td style="text-align:center">TRIM(s1 FROM s)</td>
<td style="text-align:center">去掉字符串 s 开始与结尾的 s1</td>
</tr>
<tr>
<td style="text-align:center">TRIM(LEADING s1 FROM s)</td>
<td style="text-align:center">去掉字符串 s 开始处的 s1</td>
</tr>
<tr>
<td style="text-align:center">TRIM(TRAILING s1 FROM s)</td>
<td style="text-align:center">去掉字符串 s 结尾处的 s1</td>
</tr>
<tr>
<td style="text-align:center">REPEAT(str, n)</td>
<td style="text-align:center">返回 str 重复 n 次的结果</td>
</tr>
<tr>
<td style="text-align:center">SPACE(n)</td>
<td style="text-align:center">返回 n 个空格</td>
</tr>
<tr>
<td style="text-align:center">STRCMP(s1, s2)</td>
<td style="text-align:center">比较字符串 s1, s2 的 ASCII 码值的大小</td>
</tr>
<tr>
<td style="text-align:center">SUBSTR(s, index, len)</td>
<td style="text-align:center">返回从字符串 s 的 index 位置其 len 个字符，作用与 <code>SUBSTRING(s, n, len)</code>、<code>MID(s, n, len)</code> 相同</td>
</tr>
<tr>
<td style="text-align:center">LOCATE(substr, str)</td>
<td style="text-align:center">返回字符串 substr 在字符串 str 中首次出现的位置，作用与 <code>POSITION(substr IN str)</code>、<code>INSTR(str, substr)</code>相同。未找到，返回 0</td>
</tr>
<tr>
<td style="text-align:center">ELT(m, s1, s2, …, sn)</td>
<td style="text-align:center">返回指定位置的字符串，如果 m = 1，则返回 s1，如果 m = 2，则返回 s2，如果 m = n，则返回 sn</td>
</tr>
<tr>
<td style="text-align:center">FIELD(s, s1, s2, …, sn)</td>
<td style="text-align:center">返回字符串 s 在字符串列表中第一次出现的位置</td>
</tr>
<tr>
<td style="text-align:center">FIND_IN_SET(s1,s2)</td>
<td style="text-align:center">返回字符串 s1 在字符串 s2 中出现的位置。其中，字符串 s2 是一个以逗号分隔的字符串</td>
</tr>
<tr>
<td style="text-align:center">REVERSE(s)</td>
<td style="text-align:center">返回 s 反转后的字符串</td>
</tr>
<tr>
<td style="text-align:center">NULLIF(value1, value2)</td>
<td style="text-align:center">比较两个字符串，如果 value1 与 value2 相等，则返回 <code>NULL</code>，否则返回 value1</td>
</tr>
</tbody>
</table>
<p><mark>注意：</mark> MySQL 中，字符串的位置是从 1 开始的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> FIELD(<span class="string">&#x27;mm&#x27;</span>, <span class="string">&#x27;hello&#x27;</span>, <span class="string">&#x27;msm&#x27;</span>, <span class="string">&#x27;amma&#x27;</span>),FIND_IN_SET(<span class="string">&#x27;mm&#x27;</span>, <span class="string">&#x27;hello,mm,amma&#x27;</span>) <span class="keyword">FROM</span> DUAL; </span><br><span class="line"><span class="comment">-- 0 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">NULLIF</span>(<span class="string">&#x27;mysql&#x27;</span>, <span class="string">&#x27;mysql&#x27;</span>), <span class="built_in">NULLIF</span>(<span class="string">&#x27;mysql&#x27;</span>, <span class="string">&#x27;&#x27;</span>); </span><br><span class="line"><span class="comment">-- NULL mysql</span></span><br></pre></td></tr></table></figure>
<p>有时或许需要在模糊搜索时忽略查询条件的大小写，比如在忽略大小写的情况下查询 user_info 表中 name 包含 Mofan 的信息，查询语句可以这么写：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_info <span class="keyword">WHERE</span> <span class="built_in">UPPER</span>(name) <span class="keyword">LIKE</span> <span class="string">&#x27;%MOFAN%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_info <span class="keyword">WHERE</span> <span class="built_in">LOWER</span>(name) <span class="keyword">LIKE</span> <span class="string">&#x27;%mofan%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="6-4-日期和时间函数"><a class="header-anchor" href="#6-4-日期和时间函数"></a>6.4 日期和时间函数</h2>
<blockquote>
<p>获取日期、时间</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CURDATE()、CURRENT_DATE()</td>
<td style="text-align:center">返回当前日期，只包含年、月、日</td>
</tr>
<tr>
<td style="text-align:center">CURTIME()、CURRENT_TIME()</td>
<td style="text-align:center">返回当前时间，只包含时、分、秒</td>
</tr>
<tr>
<td style="text-align:center">NOW()、SYSDATE()、CURRENT_TIMESTAMP()、LOCALTIME()、LOCALTIMESTAMP()</td>
<td style="text-align:center">返回当前系统日期和时间</td>
</tr>
<tr>
<td style="text-align:center">UTC_DATE()</td>
<td style="text-align:center">返回UTC（世界标准时间）日期</td>
</tr>
<tr>
<td style="text-align:center">UTC_TIME()</td>
<td style="text-align:center">返回UTC（世界标准时间）时间</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CURDATE(), CURTIME(), NOW(), SYSDATE() <span class="operator">+</span> <span class="number">0</span>, UTC_DATE(), UTC_DATE() <span class="operator">+</span> <span class="number">0</span>, UTC_TIME(), UTC_TIME() <span class="operator">+</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E8%8E%B7%E5%8F%96%E6%97%B6%E9%97%B4%E5%92%8C%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="获取时间和日期函数的使用"></p>
<blockquote>
<p>日期与时间戳的转换</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">UNIX_TIMESTAMP()</td>
<td style="text-align:center">以 UNIX 时间戳的形式返回当前时间</td>
</tr>
<tr>
<td style="text-align:center">UNIX_TIMESTAMP(date)</td>
<td style="text-align:center">将时间 date 以 UNIX 时间戳的形式返回</td>
</tr>
<tr>
<td style="text-align:center">FROM_UNIXTIME(timestamp)</td>
<td style="text-align:center">将 UNIX 时间戳的时间转换为普通格式的时间</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	UNIX_TIMESTAMP(now()), </span><br><span class="line">	UNIX_TIMESTAMP(CURDATE()), </span><br><span class="line">	UNIX_TIMESTAMP(CURTIME()), </span><br><span class="line">	UNIX_TIMESTAMP(<span class="string">&#x27;2011-11-11 11:11:11&#x27;</span>), </span><br><span class="line">	FROM_UNIXTIME(<span class="number">1320981071</span>);</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E6%97%A5%E6%9C%9F%E4%B8%8E%E6%97%B6%E9%97%B4%E6%88%B3%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="日期与时间戳转换函数的使用"></p>
<blockquote>
<p>获取月份、星期、星期数、天数</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">YEAR(date)、MONTH(date)、DAY(date)</td>
<td style="text-align:center">返回具体的日期值</td>
</tr>
<tr>
<td style="text-align:center">HOUR(time)、MINUTE(time)、SECOND(time)</td>
<td style="text-align:center">返回具体的时间值</td>
</tr>
<tr>
<td style="text-align:center">MONTHNAME(date)</td>
<td style="text-align:center">返回月份，如 January</td>
</tr>
<tr>
<td style="text-align:center">DAYNAME(date)</td>
<td style="text-align:center">返回星期几，如 MONDAY</td>
</tr>
<tr>
<td style="text-align:center">WEEKDAY(date)</td>
<td style="text-align:center">返回周几，如周一表示 0</td>
</tr>
<tr>
<td style="text-align:center">QUARTER(date)</td>
<td style="text-align:center">返回日期对应的季度，范围 1 到 4</td>
</tr>
<tr>
<td style="text-align:center">WEEK(date)、WEEKOFYEAR(date)</td>
<td style="text-align:center">返回一年中的第几周</td>
</tr>
<tr>
<td style="text-align:center">DAYOFYEAR(date)</td>
<td style="text-align:center">返回日期是一年中的第几天</td>
</tr>
<tr>
<td style="text-align:center">DAYOFMONTH(date)</td>
<td style="text-align:center">返回日期位于所在月份的第几天</td>
</tr>
<tr>
<td style="text-align:center">DAYOFWEEK(date)</td>
<td style="text-align:center">返回周几，如周日表示 1</td>
</tr>
</tbody>
</table>
<blockquote>
<p>日期的操作函数</p>
</blockquote>
<table>
<thead>
<tr>
<th>函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td>EXTRACT(type FROM date)</td>
<td style="text-align:center">返回指定日期中特定的部分，type 指定返回的值</td>
</tr>
</tbody>
</table>
<p><code>type</code> 的取值与含义：</p>
<table>
<thead>
<tr>
<th style="text-align:center">type 取值</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">MICROSECOND</td>
<td style="text-align:center">毫秒数</td>
</tr>
<tr>
<td style="text-align:center">SECOND</td>
<td style="text-align:center">秒数</td>
</tr>
<tr>
<td style="text-align:center">MINUTE</td>
<td style="text-align:center">分钟数</td>
</tr>
<tr>
<td style="text-align:center">HOUR</td>
<td style="text-align:center">小时数</td>
</tr>
<tr>
<td style="text-align:center">DAY</td>
<td style="text-align:center">天数</td>
</tr>
<tr>
<td style="text-align:center">WEEK</td>
<td style="text-align:center">日期在一年中的第几个星期</td>
</tr>
<tr>
<td style="text-align:center">MONTH</td>
<td style="text-align:center">日期在一年中的第几个月</td>
</tr>
<tr>
<td style="text-align:center">QUARTER</td>
<td style="text-align:center">日期在一年中的第几个季度</td>
</tr>
<tr>
<td style="text-align:center">YEAR</td>
<td style="text-align:center">日期的年份</td>
</tr>
</tbody>
</table>
<p>除上述的基本取值外，它们之间还可以两两组合成以下值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SECOND_MICROSECOND</span><br><span class="line">MINUTE_MICROSECOND</span><br><span class="line">MINUTE_SECOND</span><br><span class="line">HOUR_MICROSECOND</span><br><span class="line">HOUR_SECOND</span><br><span class="line">HOUR_MINUTE</span><br><span class="line">DAY_MICROSECOND</span><br><span class="line">DAY_SECOND</span><br><span class="line">DAY_MINUTE</span><br><span class="line">DAY_HOUR</span><br><span class="line">YEAR_MONTH</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	<span class="built_in">EXTRACT</span>(<span class="keyword">MINUTE</span> <span class="keyword">FROM</span> NOW()), <span class="built_in">EXTRACT</span>( WEEK <span class="keyword">FROM</span> NOW()),</span><br><span class="line">	<span class="built_in">EXTRACT</span>(QUARTER <span class="keyword">FROM</span> NOW()), <span class="built_in">EXTRACT</span>( MINUTE_SECOND <span class="keyword">FROM</span> NOW())</span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>时间和秒数的转换</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TIME_TO_SEC(time)</td>
<td style="text-align:center">将 time 转化为秒并返回结果值。转化的公式为：<code>小时 * 3600 + 分钟 * 60 + 秒</code>。</td>
</tr>
<tr>
<td style="text-align:center">SEC_TO_TIME(seconds)</td>
<td style="text-align:center">将 seconds 描述转化为包含小时、分钟和秒的时间</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TIME_TO_SEC(&quot;11:11:11&quot;), SEC_TO_TIME(<span class="number">40271</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>计算日期和时间的函数</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DATE_ADD(datetime, INTERVAL expr type)、ADDDATE(date,INTERVAL expr type)</td>
<td style="text-align:center">返回与给定日期时间相差 INTERVAL 时间段的日期时间</td>
</tr>
<tr>
<td style="text-align:center">DATE_SUB(date,INTERVAL expr type)、SUBDATE(date,INTERVAL expr type)</td>
<td style="text-align:center">返回与 date 相差 INTERVAL 时间间隔的日期</td>
</tr>
</tbody>
</table>
<p><code>type</code> 的取值：</p>
<table>
<thead>
<tr>
<th style="text-align:center">type 取值</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">HOUR</td>
<td style="text-align:center">小时</td>
</tr>
<tr>
<td style="text-align:center">MINUTE</td>
<td style="text-align:center">分钟</td>
</tr>
<tr>
<td style="text-align:center">SECOND</td>
<td style="text-align:center">秒</td>
</tr>
<tr>
<td style="text-align:center">YEAR</td>
<td style="text-align:center">年</td>
</tr>
<tr>
<td style="text-align:center">MONTH</td>
<td style="text-align:center">月</td>
</tr>
<tr>
<td style="text-align:center">DAY</td>
<td style="text-align:center">日</td>
</tr>
<tr>
<td style="text-align:center">YEAR_MONTH</td>
<td style="text-align:center">年和月</td>
</tr>
<tr>
<td style="text-align:center">DAY_HOUR</td>
<td style="text-align:center">日和小时</td>
</tr>
<tr>
<td style="text-align:center">DAY_MINUTE</td>
<td style="text-align:center">日和分钟</td>
</tr>
<tr>
<td style="text-align:center">DAY_SECOND</td>
<td style="text-align:center">日和秒</td>
</tr>
<tr>
<td style="text-align:center">HOUR_MINUTE</td>
<td style="text-align:center">小时和分钟</td>
</tr>
<tr>
<td style="text-align:center">HOUR_SECOND</td>
<td style="text-align:center">小时和秒</td>
</tr>
<tr>
<td style="text-align:center">MINUTE_SECOND</td>
<td style="text-align:center">分钟和秒</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> col1,</span><br><span class="line">	DATE_ADD(<span class="string">&#x27;2011-11-11 11:11:11&#x27;</span>, <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">SECOND</span>) <span class="keyword">AS</span> col2,</span><br><span class="line">	ADDDATE(<span class="string">&#x27;2011-11-11 11:11:11&#x27;</span>, <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">SECOND</span>) <span class="keyword">AS</span> col3,</span><br><span class="line">	DATE_ADD(<span class="string">&#x27;2011-11-11 11:11:11&#x27;</span>, <span class="type">INTERVAL</span> <span class="string">&#x27;1_1&#x27;</span> MINUTE_SECOND) <span class="keyword">AS</span> col4,</span><br><span class="line">	DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">YEAR</span>) <span class="keyword">AS</span> col5, #可以是负数</span><br><span class="line">	DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="string">&#x27;1_1&#x27;</span> YEAR_MONTH) <span class="keyword">AS</span> col6 #需要单引号</span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">	DATE_SUB(<span class="string">&#x27;2011-11-11&#x27;</span>, <span class="type">INTERVAL</span> <span class="number">31</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> col1,</span><br><span class="line">	SUBDATE(<span class="string">&#x27;2011-11-11&#x27;</span>, <span class="type">INTERVAL</span> <span class="number">31</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> col2,</span><br><span class="line">	DATE_SUB(<span class="string">&#x27;2011-11-11 11:11:11&#x27;</span>, <span class="type">INTERVAL</span> <span class="string">&#x27;1 1&#x27;</span> DAY_HOUR) <span class="keyword">AS</span> col3</span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ADDTIME(time1, time2)</td>
<td style="text-align:center">返回 time1 加上 time2 的时间。当 time2 为一个数字时，代表的是秒，可以为负数</td>
</tr>
<tr>
<td style="text-align:center">SUBTIME(time1, time2)</td>
<td style="text-align:center">返回 time1 减去 time2 后的时间。当 time2 为一个数字时，代表的是秒，可以为负数</td>
</tr>
<tr>
<td style="text-align:center">DATEDIFF(date1, date2)</td>
<td style="text-align:center">返回 date1 - date2 的日期间隔天数</td>
</tr>
<tr>
<td style="text-align:center">TIMEDIFF(time1, time2)</td>
<td style="text-align:center">返回 time1 - time2 的时间间隔</td>
</tr>
<tr>
<td style="text-align:center">FROM_DAYS(n)</td>
<td style="text-align:center">返回从 0000 年 1 月 1 日起，n 天以后的日期</td>
</tr>
<tr>
<td style="text-align:center">TO_DAYS(date)</td>
<td style="text-align:center">返回日期 date 距离 0000 年 1 月 1 日的天数</td>
</tr>
<tr>
<td style="text-align:center">LAST_DAY(date)</td>
<td style="text-align:center">返回 date 所在月份的最后一天的日期</td>
</tr>
<tr>
<td style="text-align:center">MAKEDATE(year, n)</td>
<td style="text-align:center">针对给定年份与所在年份中的天数返回一个日期</td>
</tr>
<tr>
<td style="text-align:center">MAKETIME(hour, minute, second)</td>
<td style="text-align:center">将给定的小时、分钟和秒组合成时间并返回</td>
</tr>
<tr>
<td style="text-align:center">PERIOD_ADD(time, n)</td>
<td style="text-align:center">返回 time 加上 n（月数） 后的时间，time 格式 yyyyMM</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	ADDTIME(NOW(), <span class="number">20</span>), SUBTIME(NOW(), <span class="number">30</span>), SUBTIME(NOW(), <span class="string">&#x27;1:1:3&#x27;</span>), DATEDIFF(NOW(), <span class="string">&#x27;2011-11-11&#x27;</span>),</span><br><span class="line">	TIMEDIFF(NOW(), <span class="string">&#x27;2011-11-11 11:11:11&#x27;</span>), FROM_DAYS(<span class="number">366</span>), TO_DAYS(<span class="string">&#x27;0000-12-25&#x27;</span>),</span><br><span class="line">	LAST_DAY(NOW()), MAKEDATE(<span class="keyword">YEAR</span>(NOW()), <span class="number">12</span>), MAKETIME(<span class="number">10</span>, <span class="number">21</span>, <span class="number">23</span>), PERIOD_ADD(<span class="number">201111</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>日期的格式化和解析</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DATE_FORMAT(date, fmt)</td>
<td style="text-align:center">按照字符串 fmt 格式化日期 date 值</td>
</tr>
<tr>
<td style="text-align:center">TIME_FORMAT(time, fmt)</td>
<td style="text-align:center">按照字符串 fmt 格式化时间 time 值</td>
</tr>
<tr>
<td style="text-align:center">GET_FORMAT(date_type, format_type)</td>
<td style="text-align:center">返回日期字符串的显示格式</td>
</tr>
<tr>
<td style="text-align:center">STR_TO_DATE(str, fmt)</td>
<td style="text-align:center">按照字符串 fmt 对 str 进行解析，解析为一个日期</td>
</tr>
</tbody>
</table>
<p>上表中 <code>fmt</code> 参数常用的格式符：</p>
<table>
<thead>
<tr>
<th style="text-align:center">格式符</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">格式符</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%Y</td>
<td style="text-align:center">4 位数字，表示年份</td>
<td style="text-align:center">%y</td>
<td style="text-align:center">两位数字，表示年份</td>
</tr>
<tr>
<td style="text-align:center">%M</td>
<td style="text-align:center">月名表示月份，如 January</td>
<td style="text-align:center">%m</td>
<td style="text-align:center">两位数字表示月份，如 01、02 等</td>
</tr>
<tr>
<td style="text-align:center">%b</td>
<td style="text-align:center">缩写的月名，如 Jan</td>
<td style="text-align:center">%c</td>
<td style="text-align:center">数字，表示月份，如 1、2 等</td>
</tr>
<tr>
<td style="text-align:center">%D</td>
<td style="text-align:center">英文后缀表示月中的天数，如 1st</td>
<td style="text-align:center">%d</td>
<td style="text-align:center">两位数字，表示月中的天数，如 01</td>
</tr>
<tr>
<td style="text-align:center">%e</td>
<td style="text-align:center">数字形式，表示月中的天数，如 1</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">%H</td>
<td style="text-align:center">两位数字表示 24 小时制，如 01</td>
<td style="text-align:center">%h、%I</td>
<td style="text-align:center">两位数字表示 12 小时制，如 01</td>
</tr>
<tr>
<td style="text-align:center">%k</td>
<td style="text-align:center">数字形式的 24 小时制，如 1</td>
<td style="text-align:center">%l</td>
<td style="text-align:center">数字形式的 12 小时制，如 1</td>
</tr>
<tr>
<td style="text-align:center">%i</td>
<td style="text-align:center">两位数字，表示分钟，如 00、01</td>
<td style="text-align:center">%S、%s</td>
<td style="text-align:center">两位数字表示秒，如 00、01</td>
</tr>
<tr>
<td style="text-align:center">%W</td>
<td style="text-align:center">一周中的星期名称，如 Sunday</td>
<td style="text-align:center">%a</td>
<td style="text-align:center">一周中的星期缩写，如 Sun、Mon</td>
</tr>
<tr>
<td style="text-align:center">%w</td>
<td style="text-align:center">以数字表示周中的天数，如 0 表示周日</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">%j</td>
<td style="text-align:center">以三位数字表示年中的天数，如 001</td>
<td style="text-align:center">%U</td>
<td style="text-align:center">以数字表示年中的第几周，如 1</td>
</tr>
<tr>
<td style="text-align:center">%u</td>
<td style="text-align:center">以数字表示年中的第几周，如 1</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">%T</td>
<td style="text-align:center">24 小时制</td>
<td style="text-align:center">%r</td>
<td style="text-align:center">12 小时制</td>
</tr>
<tr>
<td style="text-align:center">%p</td>
<td style="text-align:center">AM 或 PM</td>
<td style="text-align:center">%%</td>
<td style="text-align:center">表示 %</td>
</tr>
</tbody>
</table>
<p><code>GET_FORMAT</code> 函数中 <code>date_type</code> 和 <code>format_type</code> 参数取值如下：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/GET_FORMAT%E5%87%BD%E6%95%B0%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0%E4%BF%A1%E6%81%AF.png" alt="GET_FORMAT函数中的参数信息"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_FORMAT(NOW(), <span class="string">&#x27;%H:%i:%s&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;11/11/2011&#x27;</span>,<span class="string">&#x27;%m/%d/%Y&#x27;</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;20111111111111&#x27;</span>,<span class="string">&#x27;%Y%m%d%H%i%s&#x27;</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;2011-11-11 11:11:11&#x27;</span>,<span class="string">&#x27;%Y-%m-%d %H:%i:%s&#x27;</span>) <span class="keyword">FROM</span> DUAL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> GET_FORMAT(<span class="type">DATE</span>, <span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> STR_TO_DATE(<span class="string">&#x27;2011-11-11 00:00:00&#x27;</span>,<span class="string">&#x27;%Y-%m-%d&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="6-5-流程控制函数"><a class="header-anchor" href="#6-5-流程控制函数"></a>6.5 流程控制函数</h2>
<p>流程处理函数可以根据不同的条件，执行不同的处理流程，可以在 SQL 语句中实现不同的条件选择。MySQL 中的流程处理函数主要包括 <code>IF()</code>、<code>IFNULL()</code> 和 <code>CASE()</code> 函数。</p>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IF(value, value1, value2)</td>
<td style="text-align:center">如果 value 的值为 TRUE，返回 value1，否则返回 value2</td>
</tr>
<tr>
<td style="text-align:center">IFNULL(value1, value2)</td>
<td style="text-align:center">如果 value1 不为 NULL，返回 value1，否则返回 value2</td>
</tr>
<tr>
<td style="text-align:center">CASE WHEN 条件1 THEN 结果1 WHEN 条件2 THEN 结果2… [ELSE 结果n] END</td>
<td style="text-align:center">类似 if…else if…else…</td>
</tr>
<tr>
<td style="text-align:center">CASE expr WHEN 常量值1 THEN 值1 WHEN 常量值1 THEN 值1 … [ELSE 结果n] END</td>
<td style="text-align:center">类似 switch…case…</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">1</span> <span class="operator">&gt;</span> <span class="number">0</span>, <span class="string">&#x27;正确&#x27;</span>, <span class="string">&#x27;错误&#x27;</span>); <span class="comment">-- 正确</span></span><br><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="keyword">null</span>, <span class="string">&#x27;Hello Word&#x27;</span>); <span class="comment">-- Hello Word</span></span><br><span class="line"><span class="comment">-- 1 &gt; 0</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> </span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">1</span> <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;1 &gt; 0&#x27;</span> </span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">2</span> <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;2 &gt; 0&#x27;</span></span><br><span class="line">	<span class="keyword">ELSE</span> <span class="string">&#x27;3 &gt; 0&#x27;</span> </span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="comment">-- yes</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="number">1</span> <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;yes&#x27;</span> <span class="keyword">WHEN</span> <span class="number">1</span> <span class="operator">&lt;=</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;no&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;unknown&#x27;</span> <span class="keyword">END</span>;</span><br><span class="line"><span class="comment">-- unknown</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="number">1</span> <span class="operator">&lt;</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;yes&#x27;</span> <span class="keyword">WHEN</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="string">&#x27;no&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;unknown&#x27;</span> <span class="keyword">END</span>;</span><br><span class="line"><span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="number">1</span> <span class="keyword">WHEN</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="number">0</span> <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">-1</span> <span class="keyword">END</span>;</span><br><span class="line"><span class="comment">-- -1</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="number">-1</span> <span class="keyword">WHEN</span> <span class="number">0</span> <span class="keyword">THEN</span> <span class="number">0</span> <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">-1</span> <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p>实际使用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,<span class="number">12</span> <span class="operator">*</span> salary <span class="operator">*</span> (<span class="number">1</span> <span class="operator">+</span> IFNULL(commission_pct,<span class="number">0</span>)) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary, </span><br><span class="line">	<span class="keyword">CASE</span> job_id </span><br><span class="line">	<span class="keyword">WHEN</span> <span class="string">&#x27;IT_PROG&#x27;</span> <span class="keyword">THEN</span> <span class="number">1.10</span> <span class="operator">*</span> salary </span><br><span class="line">	<span class="keyword">WHEN</span> <span class="string">&#x27;ST_CLERK&#x27;</span> <span class="keyword">THEN</span> <span class="number">1.15</span> <span class="operator">*</span> salary</span><br><span class="line">	<span class="keyword">WHEN</span> <span class="string">&#x27;SA_REP&#x27;</span> <span class="keyword">THEN</span> <span class="number">1.20</span> <span class="operator">*</span> salary</span><br><span class="line">	<span class="keyword">ELSE</span> salary <span class="keyword">END</span> &quot;REVISED_SALARY&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<h2 id="6-6-加密与解密函数"><a class="header-anchor" href="#6-6-加密与解密函数"></a>6.6 加密与解密函数</h2>
<p>加密与解密函数主要用于对数据库中的数据进行加密和解密处理，以防止数据被他人窃取。这些函数在保证数据库安全时非常有用。</p>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">PASSWORD(str)</td>
<td style="text-align:center">返回字符串 str 的加密版本，41 位长的字符串。加密结果不可逆，常用于用户的密码加密</td>
</tr>
<tr>
<td style="text-align:center">MD5(str)</td>
<td style="text-align:center">返回字符串 str 的 md5 加密后的值，也是一种加密方式。若参数为 NULL，则会返回 NULL</td>
</tr>
<tr>
<td style="text-align:center">SHA(str)</td>
<td style="text-align:center">从原明文密码 str 计算并返回加密后的密码字符串，当参数为 NULL 时，返回 NULL。比 MD5 更安全。</td>
</tr>
<tr>
<td style="text-align:center">ENCODE(value, password_seed)</td>
<td style="text-align:center">返回使用 password_seed 作为加密密码加密 value</td>
</tr>
<tr>
<td style="text-align:center">DECODE(value, password_seed)</td>
<td style="text-align:center">返回使用 password_seed 作为加密密码解密 value</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MySQL8 中已经移除 PASSWORD 函数，可以使用 SHA1、SHA2 等函数代替</span></span><br><span class="line"><span class="keyword">SELECT</span> PASSWORD(<span class="string">&#x27;mysql&#x27;</span>), PASSWORD(<span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">SELECT</span> MD5(<span class="string">&#x27;mofan&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> SHA(<span class="string">&#x27;mofan&#x27;</span>);</span><br><span class="line"><span class="comment">-- MySQL8 中已经移除 ENCODE 和 DECODE 函数，可以使用以下函数代替</span></span><br><span class="line"><span class="keyword">SELECT</span> AES_ENCRYPT(<span class="string">&#x27;mysql&#x27;</span>, <span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> AES_DECRYPT(AES_ENCRYPT(<span class="string">&#x27;mysql&#x27;</span>,<span class="string">&#x27;mysql&#x27;</span>),<span class="string">&#x27;mysql&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h2 id="6-7-MySQL-信息函数"><a class="header-anchor" href="#6-7-MySQL-信息函数"></a>6.7 MySQL 信息函数</h2>
<p>MySQL 中内置了一些可以查询 MySQL 信息的函数，这些函数主要用于帮助数据库开发或运维人员更好地对数据库进行维护工作。</p>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">VERSION()</td>
<td style="text-align:center">当前 MySQL 的版本号</td>
</tr>
<tr>
<td style="text-align:center">CONNECTION_ID()</td>
<td style="text-align:center">当前 MySQL 服务器的连接数</td>
</tr>
<tr>
<td style="text-align:center">DATABASE()，SCHEMA()</td>
<td style="text-align:center">MySQL 命令行当前所在的数据库</td>
</tr>
<tr>
<td style="text-align:center">USER()，CURRENT_USER()、SYSTEM_USER()，SESSION_USER()</td>
<td style="text-align:center">当前连接 MySQL 的用户名，返回结果格式为“主机名@用户名”</td>
</tr>
<tr>
<td style="text-align:center">CHARSET(value)</td>
<td style="text-align:center">字符串 value 自变量的字符集</td>
</tr>
<tr>
<td style="text-align:center">COLLATION(value)</td>
<td style="text-align:center">字符串 value 的比较规则</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> VERSION();</span><br><span class="line"><span class="keyword">SELECT</span> DATABASE();</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>(), <span class="built_in">CURRENT_USER</span>(), <span class="built_in">SYSTEM_USER</span>(),<span class="built_in">SESSION_USER</span>();</span><br><span class="line"><span class="keyword">SELECT</span> CHARSET(<span class="string">&#x27;mofan&#x27;</span>); <span class="comment">-- utf8mb4</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COLLATION</span>(<span class="string">&#x27;mofan&#x27;</span>); <span class="comment">-- utf8mb4_0900_ai_ci</span></span><br></pre></td></tr></table></figure>
<h2 id="6-8-其他函数"><a class="header-anchor" href="#6-8-其他函数"></a>6.8 其他函数</h2>
<p>还有一些无法进行具体分类的函数，但在日常开发和运维过程中也是不容忽视的。</p>
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">FORMAT(value, n)</td>
<td style="text-align:center">返回对数字 value 进行格式化后的结果数据。n 表示四舍五入后保留到小数点后 n 位</td>
</tr>
<tr>
<td style="text-align:center">CONV(value, from, to)</td>
<td style="text-align:center">将 value 的值进行不同进制之间的转换</td>
</tr>
<tr>
<td style="text-align:center">INET_ATON(ipvalue)</td>
<td style="text-align:center">将以点分隔的 IP 地址转化为一个数字</td>
</tr>
<tr>
<td style="text-align:center">INET_NTOA(value)</td>
<td style="text-align:center">将数字形式的 IP 地址转化为以点分隔的 IP 地址</td>
</tr>
<tr>
<td style="text-align:center">BENCHMARK(n, expr)</td>
<td style="text-align:center">将表达式 expr 重复执行 n 次。用于测试 MySQL 处理 expr 表达式所耗费的时间</td>
</tr>
<tr>
<td style="text-align:center">CONVERT(value USING char_code)</td>
<td style="text-align:center">将 value 所使用的字符编码修改为 char_code</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 123.12 124 123</span></span><br><span class="line"><span class="keyword">SELECT</span> FORMAT(<span class="number">123.123</span>, <span class="number">2</span>), FORMAT(<span class="number">123.523</span>, <span class="number">0</span>), FORMAT(<span class="number">123.123</span>, <span class="number">-2</span>);</span><br><span class="line"><span class="comment">-- 10000 22B8 NULL</span></span><br><span class="line"><span class="keyword">SELECT</span> CONV(<span class="number">16</span>, <span class="number">10</span>, <span class="number">2</span>), CONV(<span class="number">8888</span>,<span class="number">10</span>,<span class="number">16</span>), CONV(<span class="keyword">NULL</span>, <span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">-- 2130706433</span></span><br><span class="line"><span class="keyword">SELECT</span> INET_ATON(<span class="string">&#x27;127.0.0.1&#x27;</span>);</span><br><span class="line"><span class="comment">-- 127.0.0.1</span></span><br><span class="line"><span class="keyword">SELECT</span> INET_NTOA(<span class="number">2130706433</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> BENCHMARK(<span class="number">1000000</span>, MD5(<span class="string">&#x27;mysql&#x27;</span>));</span><br><span class="line"><span class="comment">-- utf8mb4 utf8</span></span><br><span class="line"><span class="keyword">SELECT</span> CHARSET(<span class="string">&#x27;mysql&#x27;</span>), CHARSET(<span class="keyword">CONVERT</span>(<span class="string">&#x27;mysql&#x27;</span> <span class="keyword">USING</span> <span class="string">&#x27;utf8&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>对 <code>FORMAT(value, n)</code> 函数来说，如果 n 的值小于或等于 0，则只保留整数部分。</p>
<p><code>INET_ATON(ipvalue)</code> 函数的计算方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2130706433 = 127 * 256^3 + 0 * 256^2 + 0 * 256^1 + 1 * 256^0</span><br></pre></td></tr></table></figure>
<h1 id="7-聚合函数"><a class="header-anchor" href="#7-聚合函数"></a>7. 聚合函数</h1>
<h2 id="7-1-什么是聚合函数"><a class="header-anchor" href="#7-1-什么是聚合函数"></a>7.1 什么是聚合函数</h2>
<p>聚合函数作用于一组数据，并对这组数据进行计算后返回一个值。比如：<code>AVG()</code>、<code>SUM()</code>、<code>MAX()</code>、<code>MIN()</code>、<code>COUNT()</code> 等函数都是聚合函数。</p>
<p>聚合函数的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>		[column1, ] group_function(column2), ....</span><br><span class="line"><span class="keyword">FROM</span>		<span class="keyword">table</span></span><br><span class="line">[<span class="keyword">WHERE</span>		<span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span>	column3]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span>	column4];</span><br></pre></td></tr></table></figure>
<p><mark>聚合函数不能嵌套调用，</mark> 因此不能出现类似 <code>AVG(SUM(字段名称))</code> 的调用。</p>
<h2 id="7-2-简单的聚合函数"><a class="header-anchor" href="#7-2-简单的聚合函数"></a>7.2 简单的聚合函数</h2>
<blockquote>
<p>AVG() 和 SUM()</p>
</blockquote>
<p>可以对 <mark>数值型数据</mark> 使用AVG 和 SUM 函数。前者表示求平均值，后者表示求和。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary), <span class="built_in">SUM</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span>	employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="keyword">LIKE</span> <span class="string">&#x27;%REP%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MIN() 和 MAX()</p>
</blockquote>
<p>可以对 <mark>任意数据类型</mark> 的数据使用 MIN 和 MAX 函数。前者表示求最小值，后者表示求最大值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(hire_date), <span class="built_in">MAX</span>(hire_date) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>COUNT()</p>
</blockquote>
<p><code>COUNT(*)</code> 返回表中记录总数，适用于 <mark>任意数据类型。</mark></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>
<p><code>COUNT(expr)</code> 返回 <mark>expr 不为空</mark> 的记录总数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(commission_pct)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>有关 COUNT() 的经典问题</p>
</blockquote>
<p>1、使用 <code>COUNT(*)</code>、<code>COUNT(1)</code>、<code>COUNT(columnName)</code> 中的哪一种更好？</p>
<p>答：对于 MyISAM 引擎的表来说是没有区别的，这种引擎内部有一个计数器在维护着行数。对于 Innodb 引擎的表来说，用 <code>COUNT(*)</code> 和 <code>COUNT(1)</code> 会直接读行数，复杂度是O(n)，因为它真的会去数一遍，但这两种都好于具体的 <code>COUNT(columnName)</code>。</p>
<p>2、能不能使用 <code>COUNT(columnName)</code> 替换 <code>COUNT(*)</code>？</p>
<p>答：不能使用 <code>COUNT(columnName)</code> 替代 <code>COUNT(*)</code>，<code>COUNT(*)</code> 是 SQL92 定义的标准统计行数的语法，跟数据库无关，跟 NULL 或非 NULL 无关，它会统计值为 NULL 的行，而 <code>COUNT(columnName)</code> 不会统计列值为 NULL 的行。</p>
<h2 id="7-3-GROUP-BY"><a class="header-anchor" href="#7-3-GROUP-BY"></a>7.3 GROUP BY</h2>
<p>顾名思义，就是分组。使用 <code>GROUP BY</code> 可以将拥有相同值的某些列进行合并以达到分组的效果。</p>
<blockquote>
<p>基本使用</p>
</blockquote>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, group_function(<span class="keyword">column</span>)</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line">[<span class="keyword">WHERE</span>  <span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span>   group_by_expression]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span>   column1];</span><br></pre></td></tr></table></figure>
<p><mark>注意：</mark> 在 <code>SELECT</code> 列表中所有未包含在聚合函数中的列都应该包含在 <code>GROUP BY</code> 子句中。</p>
<p>比如，根据部门 ID 求出该部门的平均工资：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>
<p>但是反过来就不一定了，包含在 <code>GROUP BY</code> 子句中的列 <strong>不必</strong> 包含在 <code>SELECT</code> 列表中。</p>
<p>同样是求出部门的平均工资：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用多个列进行分组</p>
</blockquote>
<p>除了对某一列进行分组，还可以对多个列进行分组，在这种情况下，分组的列值组合唯一。</p>
<p>比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id dept_id, job_id, <span class="built_in">SUM</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id, job_id;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>GROUP BY 中使用 WITH ROOLUP</p>
</blockquote>
<p>使用 <code>WITH ROLLUP</code> 关键字之后，在所有查询出的分组记录之后会增加 <strong>一条记录（是一条记录，不是一列）</strong>，该记录计算查询出的所有记录的总和，即统计记录数量。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">&gt;</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/GROUP-BY%E4%B8%AD%E4%BD%BF%E7%94%A8WITH-ROLLUP.png" alt="GROUP-BY中使用WITH-ROLLUP"></p>
<p>针对新增的这一行数据，可以使用 <code>COALESCE</code> 让其可读性提高：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COALESCE</span>(department_id, <span class="string">&#x27;平均总工资&#x27;</span>), <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">&gt;</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span>;</span><br></pre></td></tr></table></figure>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/COALESCE%E7%9A%84%E4%BD%BF%E7%94%A8.png" alt="COALESCE的使用"></p>
<p><mark>注意：</mark> 当使用 <code>ROLL UP</code>时，不能再使用 <code>ORDER BY</code>子句对结果进行排序，它们是互斥的。</p>
<blockquote>
<p>补充：<code>WITH</code> 子句（MySQL 8.0 新增）</p>
</blockquote>
<p>使用 <code>WITH</code> 子句可以为子查询的数据集建立内存临时表（CTEs），数据在内存中解析，执行效率更高，并且能提高 SQL 的可读性，临时表用完即销毁。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> </span><br><span class="line">	sub_table1 <span class="keyword">AS</span> (<span class="keyword">SELECT</span> A ...),</span><br><span class="line">	sub_table2 <span class="keyword">AS</span> (<span class="keyword">SELECT</span> B ...)</span><br><span class="line"><span class="keyword">SELECT</span> ...	</span><br></pre></td></tr></table></figure>
<p>使用 <code>WITH</code> 子句可以让子查询重用相同的 <code>WITH</code> 查询块，<code>WITH</code> 子句只能被 <code>SELECT</code> 查询块引用。<code>WITH</code> 子句在引用的 <code>SELECT</code> 语句前定义，同级的 <code>WITH</code> 关键字只能使用一次，<code>WITH</code> 子句中可以建立多个内存临时表，它们用逗号分割。</p>
<p>如果定义的内存临时表未被使用，则会报错。这个使用不一定非要在主查询中使用，也可以在其他当前 <code>WITH</code> 子句的其他临时表中使用。</p>
<p>一个 <code>WITH</code> 子句内部不能嵌套 <code>WITH</code> 子句。</p>
<p><code>WITH</code> 子句定义的内存临时表一旦被 <code>SELECT</code> 语句使用，这些临时表就会被销毁。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> temp_table <span class="keyword">as</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> CONCAT_WS(<span class="string">&#x27; &#x27;</span>, first_name, last_name) `name`, salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">15000</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> `name`, salary</span><br><span class="line"><span class="keyword">FROM</span> temp_table;</span><br></pre></td></tr></table></figure>
<p>如果再查询 <code>temp_table</code> 则会提示 <code>table or view does not exist</code>。</p>
<h2 id="7-4-HAVING"><a class="header-anchor" href="#7-4-HAVING"></a>7.4 HAVING</h2>
<p>针对使用 <code>GROUP BY</code> 进行分组后的数据，还可以使用 <code>HAVING</code> 进行过滤。</p>
<p>要点：</p>
<p>1、数据已被分组；</p>
<p>2、使用了聚合函数；</p>
<p>3、满足 <code>HAVING</code> 子句中条件的分组都将被显示；</p>
<p>4、<code>HAVING</code> 不能单独使用，必须要跟 <code>GROUP BY</code> 一起使用。</p>
<p>比如：查询部门最高工资比 10000 高的部门。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">MAX</span>(salary) <span class="operator">&gt;</span> <span class="number">10000</span>;</span><br></pre></td></tr></table></figure>
<p><mark>注意：</mark> 不能在 <code>WHERE</code> 子句中使用聚合函数。比如下面这样的 SQL 语句就是错误的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="built_in">AVG</span>(salary) <span class="operator">&gt;</span> <span class="number">8000</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>WHERE 与 HAVING 的对比</p>
</blockquote>
<p><strong>区别一：</strong> <code>WHERE</code> 可以直接使用表中的字段作为筛选条件，但不能使用分组中的计算函数作为筛选条件；<code>HAVING</code> 必须要与 <code>GROUP BY</code> 配合使用，可以把分组计算的函数和分组字段作为筛选条件。</p>
<p>这决定了，在需要对数据进行分组统计时，<code>HAVING</code> 可以完成 <code>WHERE</code> 不能完成的任务。这是因为在查询语法结构中，<code>WHERE</code> 在 <code>GROUP BY</code> 之前，所以无法对分组结果进行筛选。<code>HAVING</code> 在 <code>GROUP BY</code> 之后，可以使用分组字段和分组中的计算函数，对分组的结果集进行筛选，这个功能是 <code>WHERE</code> 无法完成的。另外，<code>WHERE</code> 排除的记录不再包括在分组中。</p>
<p><strong>区别二：</strong> 如果需要通过连接从关联表中获取需要的数据，<code>WHERE</code> 是先筛选后连接，而 <code>HAVING</code> 是先连接后筛选。 在关联查询中，<code>WHERE</code> 比 <code>HAVING</code> 更高效。</p>
<p>因为 <code>WHERE</code> 可以在筛选后用一个较小数据集和关联表进行连接，占用资源少，执行效率高。<code>HAVING</code> 则需要先把结果集准备好，即用未被筛选的数据集进行关联，并对这个大的数据集进行筛选，相应地占用的资源更多，执行效率也更低。</p>
<p><strong>小结：</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">优点</th>
<th style="text-align:center">缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">WHERE</td>
<td style="text-align:center">先筛选再关联，执行效率高</td>
<td style="text-align:center">不能使用分组中的计算函数进行筛选</td>
</tr>
<tr>
<td style="text-align:center">HAVING</td>
<td style="text-align:center">可以使用分组中的计算函数</td>
<td style="text-align:center">先关联再筛选，执行效率较低</td>
</tr>
</tbody>
</table>
<p><strong>怎么选择：</strong></p>
<p><code>WHERE</code> 和 <code>HAVING</code> 也不是互相排斥的，我们可以在一个查询里面同时使用 <code>WHERE</code> 和 <code>HAVING</code>。包含分组统计函数的条件用 <code>HAVING</code>，普通条件用 <code>WHERE</code>。当数据量特别大的时候，运行效率会有很大的差别。</p>
<h2 id="7-5-SELECT-的执行过程"><a class="header-anchor" href="#7-5-SELECT-的执行过程"></a>7.5 SELECT 的执行过程</h2>
<blockquote>
<p>查询的结构</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#方式<span class="number">1</span>：</span><br><span class="line"><span class="keyword">SELECT</span> ..., ...., ...</span><br><span class="line"><span class="keyword">FROM</span> ..., ..., ....</span><br><span class="line"><span class="keyword">WHERE</span> 多表的连接条件</span><br><span class="line"><span class="keyword">AND</span> 不包含组函数的过滤条件</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ...,...</span><br><span class="line"><span class="keyword">HAVING</span> 包含组函数的过滤条件</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> ... <span class="keyword">ASC</span> <span class="operator">/</span> <span class="keyword">DESC</span></span><br><span class="line">LIMIT ...,...</span><br><span class="line"></span><br><span class="line">#方式<span class="number">2</span>：</span><br><span class="line"><span class="keyword">SELECT</span> ..., ...., ...</span><br><span class="line"><span class="keyword">FROM</span> ... <span class="keyword">JOIN</span> ... </span><br><span class="line"><span class="keyword">ON</span> 多表的连接条件</span><br><span class="line"><span class="keyword">JOIN</span> ...</span><br><span class="line"><span class="keyword">ON</span> ...</span><br><span class="line"><span class="keyword">WHERE</span> 不包含组函数的过滤条件</span><br><span class="line"><span class="keyword">AND</span> <span class="operator">/</span> <span class="keyword">OR</span> 不包含组函数的过滤条件</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ...,...</span><br><span class="line"><span class="keyword">HAVING</span> 包含组函数的过滤条件</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> ... <span class="keyword">ASC</span><span class="operator">/</span><span class="keyword">DESC</span></span><br><span class="line">LIMIT ..., ...</span><br><span class="line"></span><br><span class="line"># 其中：</span><br><span class="line">#（<span class="number">1</span>）<span class="keyword">from</span>：从哪些表中筛选</span><br><span class="line">#（<span class="number">2</span>）<span class="keyword">on</span>：关联多表查询时，去除笛卡尔积</span><br><span class="line">#（<span class="number">3</span>）<span class="keyword">where</span>：从表中筛选的条件</span><br><span class="line">#（<span class="number">4</span>）<span class="keyword">group</span> <span class="keyword">by</span>：分组依据</span><br><span class="line">#（<span class="number">5</span>）<span class="keyword">having</span>：在统计结果中再次筛选</span><br><span class="line">#（<span class="number">6</span>）<span class="keyword">order</span> <span class="keyword">by</span>：排序</span><br><span class="line">#（<span class="number">7</span>）limit：分页</span><br></pre></td></tr></table></figure>
<blockquote>
<p>SELECT 执行顺序</p>
</blockquote>
<p><mark>1、编写 SQL 语句时使用的关键词顺序不能颠倒。</mark></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> ... <span class="keyword">WHERE</span> ... <span class="keyword">GROUP</span> <span class="keyword">BY</span> ... <span class="keyword">HAVING</span> ... <span class="keyword">ORDER</span> <span class="keyword">BY</span> ... LIMIT...</span><br></pre></td></tr></table></figure>
<p><strong>2、SELECT 语句的执行顺序（MySQL 与 Oracle 基本相同）：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM -&gt; WHERE -&gt; GROUP BY -&gt; HAVING -&gt; SELECT 的字段 -&gt; DISTINCT -&gt; ORDER BY -&gt; LIMIT</span><br></pre></td></tr></table></figure>
<p>比如下面这条 SQL 语句的执行顺序是这样的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> player_id, player_name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> num # 顺序 <span class="number">5</span></span><br><span class="line"><span class="keyword">FROM</span> player <span class="keyword">JOIN</span> team <span class="keyword">ON</span> player.team_id <span class="operator">=</span> team.team_id # 顺序 <span class="number">1</span></span><br><span class="line"><span class="keyword">WHERE</span> height <span class="operator">&gt;</span> <span class="number">1.80</span> # 顺序 <span class="number">2</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> player.team_id # 顺序 <span class="number">3</span></span><br><span class="line"><span class="keyword">HAVING</span> num <span class="operator">&gt;</span> <span class="number">2</span> # 顺序 <span class="number">4</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> num <span class="keyword">DESC</span> # 顺序 <span class="number">6</span></span><br><span class="line">LIMIT <span class="number">2</span> # 顺序 <span class="number">7</span></span><br></pre></td></tr></table></figure>
<p>在 <code>SELECT</code> 语句执行这些步骤的时候，每个步骤都会产生一个虚拟表，然后将这个虚拟表作为输入传入下一个步骤中。这些步骤隐含在 SQL 的执行过程中，我们是不可见的。</p>
<blockquote>
<p>SQL 的执行原理</p>
</blockquote>
<p>首先执行 <code>FROM</code>。在这个阶段，如果是多张表联查，还会经历下面的几个步骤：</p>
<p>1、首先通过 <code>CROSS JOIN</code> 求笛卡尔积，相当于得到虚拟表 vt（virtual table）1-1；</p>
<p>2、通过 <code>ON</code> 进行筛选，在虚拟表 vt1-1 的基础上进行筛选，得到虚拟表 vt1-2；</p>
<p>3、添加外部行。如果我们使用的是左连接、右链接或者全连接，就会涉及到外部行，也就是在虚拟表 vt1-2 的基础上增加外部行，得到虚拟表 vt1-3。</p>
<p>如果操作的是两张以上的表，还会重复上面的步骤，直到所有表都被处理完为止，这个过程得到就是原始数据。</p>
<p>拿到查询数据表的原始数据（也就是最终的虚拟表 vt1）后，在此基础上再进行 <code>WHERE</code> 阶段。在这个阶段中，会根据 vt1 表的结果进行筛选过滤，得到虚拟表 vt2。</p>
<p>然后进入第三步和第四步，即 <code>GROUP</code> 和 <code>HAVING</code> 阶段。在这个阶段中，会在虚拟表 vt2 的基础上进行分组和分组过滤，得到中间的虚拟表 vt3 和 vt4。</p>
<p>当完成了条件筛选部分之后，就可以筛选表中提取的字段，进入到 <code>SELECT</code> 和 <code>DISTINCT</code> 阶段。先在 <code>SELECT</code> 阶段会提取想要的字段，再在 <code>DISTINCT</code> 阶段过滤掉重复的行，得到中间的虚拟表 vt5-1 和 vt5-2。</p>
<p>当提取了想要的字段数据之后，就可以按照指定的字段进行排序，即 <code>ORDER BY</code> 阶段，得到虚拟表 vt6。</p>
<p>最后在 vt6 的基础上，取出指定行的记录，即 LIMIT 阶段，并得到最终的结果，对应虚拟表 vt7。</p>
<p>书写的 SELECT 语句未包含某些关键字时，对应的阶段会被省略。</p>
<h1 id="8-子查询"><a class="header-anchor" href="#8-子查询"></a>8. 子查询</h1>
<h2 id="8-1-子查询概括"><a class="header-anchor" href="#8-1-子查询概括"></a>8.1 子查询概括</h2>
<p>子查询从 MySQL 4.1 引入，指的是一个查询语句嵌套在另一个查询语句内部的查询。在很多时候查询需要从结果集中获取数据，或者需要从同一个表中先计算出一个结果，然后使用这个结果作为另一个查询语句的条件，那么这是就可以用到子查询。</p>
<blockquote>
<p>实际问题</p>
</blockquote>
<p>假设需要查询出工资比 Abel 高的员工信息，那么首先肯定得先查询出 Abel 的工资才行。现有如下三种解决方案：</p>
<p>1、分步查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 先查询出 Abel 的工资</span></span><br><span class="line"><span class="keyword">SELECT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span>;</span><br><span class="line"><span class="comment">-- 使用上一步的查询结果作为查询条件，获取符合条件的员工信息</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">11000</span>;</span><br></pre></td></tr></table></figure>
<p>2、自连接：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e2.last_name, e2.salary</span><br><span class="line"><span class="keyword">FROM</span> employees e1, employees e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> e1.`salary` <span class="operator">&lt;</span> e2.`salary`;</span><br></pre></td></tr></table></figure>
<p>3、子查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>子查询的基本使用</p>
</blockquote>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> select_list</span><br><span class="line"><span class="keyword">FROM</span> tableName</span><br><span class="line"><span class="keyword">WHERE</span> expr opereator (</span><br><span class="line">    <span class="keyword">SELECT</span> select_list <span class="keyword">FROM</span> tableName</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>内查询在外查询之前一次执行完成，内查询的查询结果被外查询使用。</p>
<p><mark>注意：</mark></p>
<ul>
<li>内查询要被括号包裹；</li>
<li>将内查询放在比较条件的右侧；</li>
<li>单行操作符对应单行子查询，多行操作符对应多行子查询。</li>
</ul>
<blockquote>
<p>子查询的分类</p>
</blockquote>
<p>分类方式一：根据内查询的返回结果数量可以将子查询分为单行子查询和多行子查询。</p>
<p>分类方式二：根据内查询是否被执行多次可以将子查询分为相关（或关联）子查询和不相关（非关联）子查询。</p>
<p>不相关子查询：只执行一次内查询就从数据表中查询出结果数据，并将结果数据作为外查询的条件执行外查询。</p>
<p>相关子查询：如果内查询需要执行多次，即采用循环的方式，先从外查询开始，每次都传入子查询进行查询，然后再将结果返回给外部。</p>
<h2 id="8-2-单行子查询"><a class="header-anchor" href="#8-2-单行子查询"></a>8.2 单行子查询</h2>
<blockquote>
<p>单行比较操作符</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">操作符</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">=</td>
</tr>
<tr>
<td style="text-align:center">&gt;</td>
</tr>
<tr>
<td style="text-align:center">&gt;=</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
</tr>
<tr>
<td style="text-align:center">&lt;=</td>
</tr>
<tr>
<td style="text-align:center">&lt;&gt;</td>
</tr>
</tbody>
</table>
<blockquote>
<p>查询示例</p>
</blockquote>
<p>查询工资大于 149 号员工工资的员工信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary           </span><br><span class="line">    <span class="keyword">FROM</span> employees    </span><br><span class="line">    <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">149</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>返回 job_id 与 141 号员工相同，但工资比 143 号员工多的员工姓名、job_id 和工资：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">=</span>  (</span><br><span class="line">    <span class="keyword">SELECT</span> job_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">141</span> </span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">143</span></span><br><span class="line">);               </span><br></pre></td></tr></table></figure>
<p>查询出工资最少的员工的 last_name、job_id 和 salary：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> ( </span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>查询与 141 号或 174 号员工的 manager_id 和 department_id 相同的其他员工的 employee_id、manager_id、department_id：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不成对比较</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, manager_id, department_id </span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> manager_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> manager_id </span><br><span class="line">    <span class="keyword">FROM</span> employees </span><br><span class="line">    <span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (<span class="number">174</span>, <span class="number">141</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> department_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> department_id </span><br><span class="line">    <span class="keyword">FROM</span> employees </span><br><span class="line">    <span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (<span class="number">174</span>, <span class="number">141</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> employee_id <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="number">174</span>, <span class="number">141</span>);</span><br><span class="line"><span class="comment">-- 成对比较</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, manager_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (manager_id, department_id) <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> manager_id, department_id </span><br><span class="line">    <span class="keyword">FROM</span> employees </span><br><span class="line">    <span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (<span class="number">141</span>, <span class="number">174</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> employee_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">141</span>, <span class="number">174</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>HAVING 中的子查询</p>
</blockquote>
<p>查询最低工资大于 50 号部门最低工资的部门 id 和其最低工资：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">MIN</span>(salary) <span class="operator">&gt;</span> ( </span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary) </span><br><span class="line">    <span class="keyword">FROM</span> employees </span><br><span class="line">    <span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">50</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>CASE 中的子查询</p>
</blockquote>
<p>查询员工的 employee_id、last_name 和 location。若员工 department_id 与 location_id 为 1800 的 department_id 相同，则 location 为 <code>Canada</code>，反之为 <code>USA</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, (</span><br><span class="line">    <span class="keyword">CASE</span> department_id </span><br><span class="line">    <span class="keyword">WHEN</span> (<span class="keyword">SELECT</span> department_id <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> location_id <span class="operator">=</span> <span class="number">1800</span>) </span><br><span class="line">    <span class="keyword">THEN</span> <span class="string">&#x27;Canada&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;USA&#x27;</span> <span class="keyword">END</span></span><br><span class="line">) location</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>子查询中的空值</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="operator">=</span> (<span class="keyword">SELECT</span> job_id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> last_name <span class="operator">=</span> <span class="string">&#x27;Haas&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>其中，内查询不会得到任何查询结果，那么整个查询语句也不会返回任何行。</p>
<blockquote>
<p>非法使用子查询</p>
</blockquote>
<p>如果像下面这样在多行子查询中使用单行比较符，那么就会报错：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary) </span><br><span class="line">    <span class="keyword">FROM</span> employees </span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>报错内容如下：</p>
<pre>
Subquery returns more than 1 row
</pre>
<h2 id="8-3-多行子查询"><a class="header-anchor" href="#8-3-多行子查询"></a>8.3 多行子查询</h2>
<p>多行子查询也称为集合比较子查询，内查询返回多行，使用多行比较操作符。</p>
<blockquote>
<p>多行比较操作符</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">操作符</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IN</td>
<td style="text-align:center">等于列表中的 <strong>任意一个</strong></td>
</tr>
<tr>
<td style="text-align:center">ANY</td>
<td style="text-align:center">需要和单行比较操作符一起使用，和内查询返回的 <strong>某一个</strong> 值比较</td>
</tr>
<tr>
<td style="text-align:center">ALL</td>
<td style="text-align:center">需要和单行比较操作符一起使用，和内查询返回的 <strong>所有</strong> 值比较</td>
</tr>
<tr>
<td style="text-align:center">SOME</td>
<td style="text-align:center">ANY 的别名，但常使用 ANY</td>
</tr>
</tbody>
</table>
<blockquote>
<p>使用示例</p>
</blockquote>
<p>查询比任一 job_id 为 <code>IT_PROG</code> 的员工工资低的员工号、姓名、job_id 以及 salary：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="keyword">ANY</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="string">&#x27;IT_PROG&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> job_id <span class="operator">&lt;&gt;</span> <span class="string">&#x27;IT_PROG&#x27;</span>;                     </span><br></pre></td></tr></table></figure>
<p>查询比所有 job_id 为 <code>IT_PROG</code> 的员工工资低的员工号、姓名、job_id 以及 salary：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="keyword">ALL</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="string">&#x27;IT_PROG&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> job_id <span class="operator">&lt;&gt;</span> <span class="string">&#x27;IT_PROG&#x27;</span>;  </span><br></pre></td></tr></table></figure>
<p>查询平均工资最低的部门 id：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方式一</span></span><br><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(avg_sal)</span><br><span class="line">    <span class="keyword">FROM</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">    ) dept_avg_sal</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 方式二</span></span><br><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">AVG</span>(salary) <span class="operator">&lt;=</span> <span class="keyword">ALL</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) avg_sal</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>空值处理</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> manager_id <span class="keyword">FROM</span> employees);</span><br></pre></td></tr></table></figure>
<p>与单行子查询一样，内查询未得到任何查询结果时，整个查询语句也不会返回任何行。</p>
<h2 id="8-4-相关子查询"><a class="header-anchor" href="#8-4-相关子查询"></a>8.4 相关子查询</h2>
<p>如果子查询的执行依赖于外部查询，通常情况下都是因为子查询中的表用到了外部的表，并进行了条件关联，因此每执行一次外部查询，子查询都要重新计算一次，这样的子查询就称之为关联子查询。</p>
<p>相关子查询按照一行接一行的顺序执行，主查询的每一行都执行一次子查询。</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt="相关子查询执行流程"></p>
<p>基本语法：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95.png" alt="相关子查询的基本语法"></p>
<blockquote>
<p>使用示例</p>
</blockquote>
<p>查询员工中工资大于本部门平均工资的员工的 last_name、salary 和 department_id：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 相关子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> department_id <span class="operator">=</span> e.department_id</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 在 FROM 中使用子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, salary, e1.department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1, (<span class="keyword">SELECT</span> department_id, <span class="built_in">AVG</span>(salary) dept_avg_sal <span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id) e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.`department_id` <span class="operator">=</span> e2.department_id</span><br><span class="line"><span class="keyword">AND</span> e2.dept_avg_sal <span class="operator">&lt;</span> e1.`salary`;</span><br></pre></td></tr></table></figure>
<p>备注：FROM 型的子查询中，子查询是作为 FROM 的一部分，子查询需要使用 <code>()</code> 引起来，并且要给整个子查询取别名，把它的查询结果当成一张临时的虚拟表来使用。</p>
<p>查询员工的 id 和 salary，并按照 department_name 排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id,salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> department_name </span><br><span class="line">    <span class="keyword">FROM</span> departments d </span><br><span class="line">    <span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 使用外连接（这也是我们首先能想到的）</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> d.department_name;</span><br></pre></td></tr></table></figure>
<p>若 employees 表中 employee_id 与 job_history 表中 employee_id 相同的数目不小于 2，那么输出这些相同 id 的员工的 employee_id、last_name 和 job_id：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, last_name, e.job_id</span><br><span class="line"><span class="keyword">FROM</span> employees e </span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">2</span> <span class="operator">&lt;=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) </span><br><span class="line">    <span class="keyword">FROM</span> job_history </span><br><span class="line">    <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> e.employee_id</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 同样可以使用外连接</span></span><br><span class="line"><span class="keyword">SELECT</span> e.employee_id, last_name, e.job_id</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> job_history j</span><br><span class="line"><span class="keyword">ON</span> e.employee_id <span class="operator">=</span> j.employee_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> e.employee_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(j.employee_id) <span class="operator">&gt;=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>到此不难看出在 SELECT 查询语句中，除了 <code>GROUP BY</code> 和 <code>LIMIT</code> 之外，其他位置都可以声明子查询。</p>
<blockquote>
<p>EXISTS  和 NOT EXISTS 关键字</p>
</blockquote>
<p>关联子查询通常也会和 <code>EXISTS</code> 关键词一起使用，用来检查在子查询中是否存在满足条件的行。</p>
<p>如果在子查询中不存在满足条件的行，条件返回 <code>FALSE</code>，并继续在子查询中寻找；如果在子查询中存在满足条件的行，条件返回 <code>TRUE</code>，并终止在子查询中的寻找。</p>
<p>比如：查询公司管理者的 employee_id、last_name、job_id 和 department_id 信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span> employees e2</span><br><span class="line">    <span class="keyword">WHERE</span> e2.manager_id <span class="operator">=</span> e1.employee_id</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 另一种子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager_id</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 使用自连接                     </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> e1.employee_id, e1.last_name, e1.job_id, e1.department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1 <span class="keyword">JOIN</span> employees e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.employee_id <span class="operator">=</span> e2.manager_id;</span><br></pre></td></tr></table></figure>
<p>再比如：查询 departments 表中，不存在于 employees 表中的部门的 department_id 和 department_name。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 子查询</span></span><br><span class="line"><span class="keyword">SELECT</span> department_id, department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> department_id <span class="operator">=</span> d.department_id</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 左外连接</span></span><br><span class="line"><span class="keyword">SELECT</span> d.department_id, department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e</span><br><span class="line"><span class="keyword">ON</span> d.department_id <span class="operator">=</span> e.department_id</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>相关更新</p>
</blockquote>
<p>在更新表中数据时，也可以使用相关子查询依据一个表中的数据去更新另一个表中的数据。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> table1 alias1</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">column</span> <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> expression </span><br><span class="line">    <span class="keyword">FROM</span> table2 alias2 </span><br><span class="line">    <span class="keyword">WHERE</span> alias1.column <span class="operator">=</span> alias2.column</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>比如：在 employees 表中增加一个 department_name 字段，其值为员工对应的部门名称。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1. 先增加一个列</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employees <span class="keyword">ADD</span>(department_name VARCHAR2(<span class="number">14</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 更新列值</span></span><br><span class="line"><span class="keyword">UPDATE</span> employees e</span><br><span class="line"><span class="keyword">SET</span> department_name <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> department_name </span><br><span class="line">    <span class="keyword">FROM</span> departments d </span><br><span class="line">    <span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>相关删除</p>
</blockquote>
<p>在删除表中数据时，也可以使用相关子查询依据一个表中的数据去删除另一个表中的数据。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table1 alias1</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">column</span> operator (</span><br><span class="line">    <span class="keyword">SELECT</span> expression </span><br><span class="line">    <span class="keyword">FROM</span> table2 alias2 </span><br><span class="line">    <span class="keyword">WHERE</span> alias1.column <span class="operator">=</span> alias2.column</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>比如：删除表 employees 中与 emp_history 表皆有的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> employee_id </span><br><span class="line">    <span class="keyword">FROM</span> emp_history </span><br><span class="line">    <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> e.employee_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="8-5-最后的问题"><a class="header-anchor" href="#8-5-最后的问题"></a>8.5 最后的问题</h2>
<p>在本节开篇就抛出了一个实际问题，即查询出工资比 Abel 高的员工信息，而后使用自连接和子查询的方式求出结果。不仅如此，在本篇很多的示例中用到子查询的地方也都可以使用连接的方式求得结果，那么自连接和子查询哪一种更好呢？</p>
<p>答案是 <strong>自连接更好。</strong></p>
<p>在许多 DBMS 的处理过程中，对于自连接的处理速度要比子查询快得多。</p>
<p>子查询实际上是通过未知表进行查询后的条件判断，而自连接是通过已知的自身数据表进行条件判断，因此在大部分 DBMS 中都对自连接处理进行了优化。</p>
<h1 id="9-【补充】隐式转换"><a class="header-anchor" href="#9-【补充】隐式转换"></a>9. 【补充】隐式转换</h1>
<p>以 MySQL 8.0 为例：</p>
<p>当操作符与不同类型的操作数一起使用时，就会发生隐式转换。</p>
<p>比如 <code>SELECT '5a' + 1;</code> 的结果是 <code>6</code>，其原因就是 <code>5a</code> 经过隐式转换变成了 <code>5</code>。</p>
<p>字符串到数字的隐式转换规则是：</p>
<ol>
<li>从字符串的左侧开始向右转换，遇到非数字就停止；</li>
<li>如果第一个字符就是非数字，最后的结果是 <code>0</code>。</li>
</ol>
<blockquote>
<p>MySQL  官方文档关于隐式转换的几条规则</p>
</blockquote>
<ul>
<li>
<p>两个参数中至少有一个是 <code>NULL</code> 时，比较的结果总是 <code>NULL</code>；使用 <code>&lt;=&gt;</code> 对两个为 <code>NULL</code> 的参数进行比较时，结果返回 <code>1</code>；</p>
</li>
<li>
<p>对都是字符串或整数的参数进行比较时，不进行隐式转换，按照原本类型进行比较；</p>
</li>
<li>
<p>十六进制的值和非数字做比较时，十六进制的值会被当成二进制字符串，比如 <code>SELECT 0x61;</code> 的结果是 <code>a</code>；</p>
</li>
<li>
<p>有一个参数类型是 <code>TIMESTAMP</code> 或 <code>DATETIME</code>，另外一个参数是常量时，常量会被转换为时间戳；</p>
</li>
<li>
<p><code>DECIMAL</code> 和整数进行比较时，会将整数转换为 <code>DECIMAL</code>；<code>DECIMAL</code> 和浮点数 <code>DOUBLE</code> 进行比较时，会将 <code>DECIMAL</code> 转换为浮点数，也就是说，不同数值类型之间的比较总是会向精度要求更高的那一个进行类型转换。MySQL 中浮点数的精度只有 53 bit， 超过 53 bit 后，如果后面 1 位是 1 则进位，是 0 则舍弃，所以超大浮点数在比较时只是取的近似值。</p>
</li>
<li>
<p>其他情况下，两个参数会被转换为浮点数再进行比较；</p>
</li>
</ul>
<blockquote>
<p>应该尽量避免隐式转换</p>
</blockquote>
<p><strong>日常开发过程中，应该尽量避免隐式转换。</strong></p>
<p>如果在一个字段上添加了索引，但在经过隐式转换后，这个索引会失效，走全表扫描，导致查询性能下降。</p>
<p>除此之外，还可能出现不期望的结果，甚至导致数据库崩溃。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mofan212.github.io">默烦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mofan212.github.io/posts/DQL-Of-MySQL/">https://mofan212.github.io/posts/DQL-Of-MySQL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mofan212.github.io" target="_blank">Mofan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/105.png" data-sites="wechat,qq,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://jsd.proxy.aks.moe/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" target="_blank"><img class="post-qr-code-img" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" target="_blank"><img class="post-qr-code-img" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/DDL-And-DML-Of-MySQL/" title="【MySQL 二】DDL 与 DML"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/106.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【MySQL 二】DDL 与 DML</div></div></a></div><div class="next-post pull-right"><a href="/posts/Lambda-And-Serialization/" title="Lambda 与序列化"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/104.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Lambda 与序列化</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/DDL-And-DML-Of-MySQL/" title="【MySQL 二】DDL 与 DML"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/106.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-11</div><div class="title">【MySQL 二】DDL 与 DML</div></div></a></div><div><a href="/posts/New-Features-Of-MySQL-8/" title="【MySQL 七】MySQL 8.0 的新特性"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/111.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-03</div><div class="title">【MySQL 七】MySQL 8.0 的新特性</div></div></a></div><div><a href="/posts/Variable-Process-Control-Cursor-And-Trigger-Of-MySQL/" title="【MySQL 六】变量、流程控制、游标与触发器"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/110.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-02</div><div class="title">【MySQL 六】变量、流程控制、游标与触发器</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">默烦</div><div class="author-info__description">彩笔的打怪升级之路...</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">150</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/23658864/dynamic"><i class="fas fa-running"></i><span>关注我的B站</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mofan212" target="_blank" title="GitHub"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:cy.mofan@foxmail.com" target="_blank" title="邮箱"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS链接"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本站所有博文均是博主的学习笔记与个人理解。<strong><font style="color:red">除特别注明外，</font>如需转载，请在文章头部醒目处附带原文链接并<a target="_blank" rel="noopener" href="https://mofan212.gitee.io/mine/" style="color:#49B1F5;text-decoration:underline">告知我</a></strong>你将转载。😊</br><strong><font style="color:red">严禁未遵循规范的转载。</font></strong>😡</br><strong>死去的评论系统复活啦！欢迎到留言板畅所欲言！</strong>当然也可以使用更高效的<a target="_blank" href="https://space.bilibili.com/23658864/dynamic" style="color:#49B1F5;text-decoration:underline"> 哔哩哔哩私信 </a>或<a href="mailto:cy.mofan@foxmail.com" style="color:#49B1F5;text-decoration:underline" target="_blank">邮箱</a>。 😉</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-SQL-%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="toc-text">1. SQL 的概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-SQL-%E7%9A%84%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86"><span class="toc-text">1.1 SQL 的背景知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-SQL-%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">1.2 SQL 的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-SQL-%E8%AF%AD%E8%A8%80%E7%9A%84%E8%A7%84%E5%88%99%E4%B8%8E%E8%A7%84%E8%8C%83"><span class="toc-text">1.3 SQL 语言的规则与规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-SQL-%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%86%99%E8%A7%84%E8%8C%83"><span class="toc-text">1.4 SQL 的大小写规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-SQL-%E7%9A%84%E6%B3%A8%E9%87%8A"><span class="toc-text">1.5 SQL 的注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-text">1.6 命名规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E6%8C%87%E4%BB%A4"><span class="toc-text">1.7 数据导入指令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%9F%BA%E6%9C%AC%E7%9A%84-SELECT"><span class="toc-text">2. 基本的 SELECT</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%AE%80%E5%8D%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2.1 简单的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%88%97%E7%9A%84%E5%88%AB%E5%90%8D"><span class="toc-text">2.2 列的别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%8E%BB%E9%99%A4%E9%87%8D%E5%A4%8D%E8%A1%8C"><span class="toc-text">2.3 去除重复行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E7%A9%BA%E5%80%BC%E5%8F%82%E4%B8%8E%E8%BF%90%E7%AE%97"><span class="toc-text">2.4 空值参与运算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E5%8F%8D%E5%BC%95%E5%8F%B7%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2.5 反引号的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E5%AF%B9%E5%B8%B8%E6%95%B0%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.6 对常数进行查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-%E6%98%BE%E7%A4%BA%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-text">2.7 显示表结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-8-%E7%AE%80%E5%8D%95%E7%9A%84%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.8 简单的条件查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">3. 运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">3.1 算术运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">3.2 比较运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E9%9D%9E%E7%AC%A6%E5%8F%B7%E7%B1%BB%E5%9E%8B%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">3.3 非符号类型运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">3.4 逻辑运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">3.5 位运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-text">3.6 运算符的优先级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.7 使用正则表达式查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%8E%92%E5%BA%8F%E4%B8%8E%E5%88%86%E9%A1%B5"><span class="toc-text">4. 排序与分页</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8E%92%E5%BA%8F"><span class="toc-text">4.1 数据的排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%88%86%E9%A1%B5"><span class="toc-text">4.2 分页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8B%E7%9A%84%E5%88%86%E9%A1%B5"><span class="toc-text">4.3 不同数据库下的分页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8%E6%97%B6%E7%9A%84%E5%9D%91"><span class="toc-text">4.4 一起使用时的坑</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">5. 多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%EF%BC%88%E6%88%96%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5%EF%BC%89%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-text">5.1 笛卡尔积（或交叉连接）的理解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%88%86%E7%B1%BB%E8%AE%B2%E8%A7%A3"><span class="toc-text">5.2 多表查询的分类讲解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-SQL99-%E8%AF%AD%E6%B3%95%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">5.3 SQL99 语法实现多表查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-UNION-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">5.4 UNION 的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-7-%E7%A7%8D-SQL-JOINS-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">5.5 7 种 SQL JOINS 的实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6-SQL99-%E8%AF%AD%E6%B3%95%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-text">5.6 SQL99 语法新特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-7-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E5%B0%8F%E7%BB%93"><span class="toc-text">5.7 多表查询小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%8D%95%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-text">6. 单行函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%87%BD%E6%95%B0%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-text">6.1 函数的理解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-text">6.2 数值函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-text">6.3 字符串函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="toc-text">6.4 日期和时间函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%87%BD%E6%95%B0"><span class="toc-text">6.5 流程控制函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-6-%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86%E5%87%BD%E6%95%B0"><span class="toc-text">6.6 加密与解密函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-7-MySQL-%E4%BF%A1%E6%81%AF%E5%87%BD%E6%95%B0"><span class="toc-text">6.7 MySQL 信息函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-8-%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="toc-text">6.8 其他函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-text">7. 聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E4%BB%80%E4%B9%88%E6%98%AF%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-text">7.1 什么是聚合函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E7%AE%80%E5%8D%95%E7%9A%84%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-text">7.2 简单的聚合函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-GROUP-BY"><span class="toc-text">7.3 GROUP BY</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-HAVING"><span class="toc-text">7.4 HAVING</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-SELECT-%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-text">7.5 SELECT 的执行过程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">8. 子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%A6%82%E6%8B%AC"><span class="toc-text">8.1 子查询概括</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E5%8D%95%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">8.2 单行子查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E5%A4%9A%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">8.3 多行子查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">8.4 相关子查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-%E6%9C%80%E5%90%8E%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">8.5 最后的问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E3%80%90%E8%A1%A5%E5%85%85%E3%80%91%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2"><span class="toc-text">9. 【补充】隐式转换</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/The-Basis-Of-Java-Multithreading/" title="学毛线（Thread）的 Java"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/57.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="学毛线（Thread）的 Java"/></a><div class="content"><a class="title" href="/posts/The-Basis-Of-Java-Multithreading/" title="学毛线（Thread）的 Java">学毛线（Thread）的 Java</a><time datetime="2024-07-10T16:00:00.000Z" title="更新于 2024-07-11 00:00:00">2024-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/SpringBoot-Shutdown-Hook/" title="SpringBoot Shutdown Hook"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/141.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="SpringBoot Shutdown Hook"/></a><div class="content"><a class="title" href="/posts/SpringBoot-Shutdown-Hook/" title="SpringBoot Shutdown Hook">SpringBoot Shutdown Hook</a><time datetime="2024-07-10T16:00:00.000Z" title="更新于 2024-07-11 00:00:00">2024-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/LinkedHashMap-In-JDK21/" title="JDK21 中的 LinkedHashMap"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/150.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="JDK21 中的 LinkedHashMap"/></a><div class="content"><a class="title" href="/posts/LinkedHashMap-In-JDK21/" title="JDK21 中的 LinkedHashMap">JDK21 中的 LinkedHashMap</a><time datetime="2024-07-06T16:00:00.000Z" title="更新于 2024-07-07 00:00:00">2024-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/The-Basics-Of-Linux-Part-One/" title="【上篇】Linux 基础"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/96.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="【上篇】Linux 基础"/></a><div class="content"><a class="title" href="/posts/The-Basics-Of-Linux-Part-One/" title="【上篇】Linux 基础">【上篇】Linux 基础</a><time datetime="2024-07-04T16:00:00.000Z" title="更新于 2024-07-05 00:00:00">2024-07-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Quick-Start-To-Arthas/" title="Arthas 快速入门"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/127.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Arthas 快速入门"/></a><div class="content"><a class="title" href="/posts/Quick-Start-To-Arthas/" title="Arthas 快速入门">Arthas 快速入门</a><time datetime="2024-07-01T16:00:00.000Z" title="更新于 2024-07-02 00:00:00">2024-07-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Commonly-Used-Classes-In-Java/" title="Java 常用类"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/65.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java 常用类"/></a><div class="content"><a class="title" href="/posts/Commonly-Used-Classes-In-Java/" title="Java 常用类">Java 常用类</a><time datetime="2024-06-28T16:00:00.000Z" title="更新于 2024-06-29 00:00:00">2024-06-29</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 默烦</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://jsd.proxy.aks.moe/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://jsd.proxy.aks.moe/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://jsd.proxy.aks.moe/npm/vanilla-lazyload@latest/dist/lazyload.iife.min.js"></script><script src="https://jsd.proxy.aks.moe/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://jsd.proxy.aks.moe/npm/mermaid@10.9.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://jsd.proxy.aks.moe/gh/mofan212/blog-static-resources@master/js/mine.min.js"></script><script src="https://npm.elemecdn.com/mermaid/dist/mermaid.min.js"></script><script defer="defer" id="ribbon" src="https://jsd.proxy.aks.moe/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="click-show-text" src="https://jsd.proxy.aks.moe/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Azathoth,Yog-Sothoth,Shub-Niggurath,Nyarlathotep,Cthulhu,Hastur,Abhoth,Ghroth,Tsathoggua,Cthugha,Deep Ones,Dagon,Chaugnar Faugn,Mordiggian,Shoggoth,Old One,Mi-Go,Great Race of Yith,Flying Polyp,Hounds of Tindalos,Dhole" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://jsd.proxy.aks.moe/npm/@docsearch/css/dist/style.min.css"/><script src="https://jsd.proxy.aks.moe/npm/@docsearch/js/dist/umd/index.min.js"></script><script>(() => {
  docsearch(Object.assign({
    appId: 'BAFEL7A6K1',
    apiKey: '89fcb5961984c5c054bf04149f345f38',
    indexName: 'mofan212io',
    container: '#docsearch',
  }, null))

  const handleClick = () => {
    document.querySelector('.DocSearch-Button').click()
  }

  const searchClickFn = () => {
    btf.addEventListenerPjax(document.querySelector('#search-button > .search'), 'click', handleClick)
  }

  searchClickFn()
  window.addEventListener('pjax:complete', searchClickFn)
})()</script></div></div></body></html>