<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Jackson 的基本使用 | Mofan</title><meta name="author" content="默烦,cy.mofan@foxmail.com"><meta name="copyright" content="默烦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Jackson 是一个用来处理 JSON 格式数据的 Java 类库，但又不仅仅是 JSON。">
<meta property="og:type" content="article">
<meta property="og:title" content="Jackson 的基本使用">
<meta property="og:url" content="https://mofan212.github.io/posts/Java-Class-Library-Jackson/index.html">
<meta property="og:site_name" content="Mofan">
<meta property="og:description" content="Jackson 是一个用来处理 JSON 格式数据的 Java 类库，但又不仅仅是 JSON。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/74.jpg">
<meta property="article:published_time" content="2020-12-14T16:00:00.000Z">
<meta property="article:modified_time" content="2023-11-05T16:00:00.000Z">
<meta property="article:author" content="默烦">
<meta property="article:tag" content="Jackson">
<meta property="article:tag" content="JSON">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/74.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://mofan212.github.io/posts/Java-Class-Library-Jackson/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"距离本文上次更新已经过去","messageNext":"天，请注意时效性。"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 默烦","link":"链接: ","source":"来源: Mofan","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Jackson 的基本使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-06 00:00:00'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/gh/mofan212/blog-static-resources@master/css/myStyle.min.css"><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/lxgw-wenkai-screen-webfont@1.7.0/style.css" /><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css" /><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="Mofan" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/gh/mofan212/blog-static-resources/css/fill-left.min.css"/><script src="https://jsd.onmicrosoft.cn/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">150</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/post_top_img.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Mofan"><span class="site-name">Mofan</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Jackson 的基本使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-12-14T16:00:00.000Z" title="发表于 2020-12-15 00:00:00">2020-12-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-05T16:00:00.000Z" title="更新于 2023-11-06 00:00:00">2023-11-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">14.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>65分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Jackson 的基本使用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>封面来源：碧蓝航线 箱庭疗法 活动CG</p>
<p>本文涉及的代码：<a target="_blank" rel="noopener" href="https://github.com/mofan212/jackson-study">mofan212/jackson-study</a></p>
<p>Jackson 源码仓库：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson">GitHub FasterXML jackson</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson-databind">GitHub FasterXML / jackson-databind</a></li>
</ul>
<h1 id="1-Jackson-概述"><a class="header-anchor" href="#1-Jackson-概述"></a>1. Jackson 概述</h1>
<h2 id="1-1-什么是-Jackson"><a class="header-anchor" href="#1-1-什么是-Jackson"></a>1.1 什么是 Jackson</h2>
<p>Jackson 是一个用来处理 JSON 格式数据的 Java 类库，一个用来序列化和反序列化 JSON 的 Java 开源框架。从 GitHub 中的统计来看，Jackson 是最流行的 JSON 解析器之一。SpringMVC 的默认 JSON 解析器就是 Jackson。</p>
<p>GitHub 仓库对 Jackson 的介绍：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/What-is-Jackson.png" alt="What-is-Jackson"></p>
<p><strong>Jackson 作为 Java 中用来处理 JSON 数据的类库而熟知，但它并不局限于 JSON。</strong></p>
<h2 id="1-2-Jackson-核心模块"><a class="header-anchor" href="#1-2-Jackson-核心模块"></a>1.2 Jackson 核心模块</h2>
<p>Jackson 的核心模块是扩展（模块）所基于的基础。从 Jackson 2.x 开始，核心模块主要由三部分组成：</p>
<ol>
<li><code>jackson-core</code> 核心包，提供基于“流模式”解析的相关 API，它包括 JsonPaser 和 JsonGenerator。 Jackson 内部实现正是通过高性能的流模式 API 的 JsonGenerator 和 JsonParser 来生成和解析 JSON。</li>
<li><code>jackson-annotations</code> 注解包，提供标准注解功能。</li>
<li><code>jackson-databind</code> 数据绑定包， 提供基于“对象绑定”解析的相关 API（ObjectMapper）和“树模型”解析的相关 API（JsonNode）。基于“对象绑定”解析的 API 和“树模型”解析的 API 依赖基于“流模式”解析的 API。</li>
</ol>
<p>关于核心模块，GitHub 上是这么说的：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/Jackson-Core-modules.png" alt="Jackson-Core-modules"></p>
<p><code>jackson-databind</code> 依赖 <code>jackson-core</code> 和 <code>jackson-annotations</code>，添加 <code>jackson-databind</code> 之后， <code>jackson-core</code> 和 <code>jackson-annotations</code> 也随之添加到项目工程中了。</p>
<p>因此，在 Maven 工程中导入依赖时，导入 <code>jackson-databind</code> 即可。</p>
<h1 id="2-快速开始"><a class="header-anchor" href="#2-快速开始"></a>2. 快速开始</h1>
<h2 id="2-1-ObjectMapper-的使用"><a class="header-anchor" href="#2-1-ObjectMapper-的使用"></a>2.1 ObjectMapper 的使用</h2>
<p>创建 Maven 项目，引入 Jackson 的依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jackson.version</span>&gt;</span>2.15.2<span class="tag">&lt;/<span class="name">jackson.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>编写一个简单的 Java 实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2020/12/14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Entity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> height;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用 Jackson 对实体进行序列化，或者反序列化成实体，需要实体中有无参构造方法、Getter 和 Setter 方法。Getter 方法用于序列化，Setter 方法用于反序列化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testObjectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().enable(SerializationFeature.INDENT_OUTPUT);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;mofan&quot;</span>, <span class="number">18</span>, <span class="number">177</span>);</span><br><span class="line">    <span class="comment">// 实体类解析成 JSON 数据</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> mapper.writerWithDefaultPrettyPrinter().writeValueAsString(user);</span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot; : &quot;mofan&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot; : 18,</span></span><br><span class="line"><span class="string">              &quot;height&quot; : 177.0</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(string).isEqualTo(expectJson);</span><br><span class="line">    <span class="comment">// 从字符串中读取 JSON 数据</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">readValue</span> <span class="operator">=</span> mapper.readValue(string, User.class);</span><br><span class="line">    assertThat(readValue).extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;mofan&quot;</span>, <span class="number">18</span>, <span class="number">177.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>writerWithDefaultPrettyPrinter()</code> 方法的作用是 <strong>格式化</strong> 输出的 JSON 字符串。如果想要全局启用，可以在 <code>ObjectMapper</code> 类上进行设置，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().enable(SerializationFeature.INDENT_OUTPUT);</span><br></pre></td></tr></table></figure>
<h2 id="2-2-JSON-来源"><a class="header-anchor" href="#2-2-JSON-来源"></a>2.2 JSON 来源</h2>
<p>使用 <code>ObjectMapper</code> 对象对 JSON 进行序列化和反序列时，JSON 来源有很多种，<code>readValue()</code> 重载的方法参数有以下七种：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String | File | URL | InputStream | byte[] | DataInput | JsonParser</span><br></pre></td></tr></table></figure>
<h2 id="2-3-简单-JSON-串的读取"><a class="header-anchor" href="#2-3-简单-JSON-串的读取"></a>2.3 简单 JSON 串的读取</h2>
<blockquote>
<p>简单的反序列化</p>
</blockquote>
<p>存在名为 <code>/json/user.json</code> 的文件，其内容为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;mofan&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;height&quot;</span> <span class="punctuation">:</span> <span class="number">178.1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>尝试将不同来源的 JSON 信息序列化为 Java 对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeserialization_1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().enable(SerializationFeature.INDENT_OUTPUT);</span><br><span class="line">    <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> getClass().getClassLoader().getResource(<span class="string">&quot;./json/user.json&quot;</span>);</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(url.getFile());</span><br><span class="line">    <span class="comment">// 从 File 中读取对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> mapper.readValue(file, User.class);</span><br><span class="line">    assertThat(user1).extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;mofan&quot;</span>, <span class="number">18</span>, <span class="number">178.1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot;: 20,</span></span><br><span class="line"><span class="string">              &quot;height&quot;: 177.5</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// 从 String 中读取对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> mapper.readValue(userJson, User.class);</span><br><span class="line">    assertThat(user2).extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;默烦&quot;</span>, <span class="number">20</span>, <span class="number">177.5</span>);</span><br><span class="line">    <span class="comment">// 从 Reader 中读取对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> mapper.readValue(<span class="keyword">new</span> <span class="title class_">StringReader</span>(userJson), User.class);</span><br><span class="line">    assertThat(user3).extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;默烦&quot;</span>, <span class="number">20</span>, <span class="number">177.5</span>);</span><br><span class="line">    <span class="comment">// 从 InputStream 中读取对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user4</span> <span class="operator">=</span> mapper.readValue(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file), User.class);</span><br><span class="line">    assertThat(user4).extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;mofan&quot;</span>, <span class="number">18</span>, <span class="number">178.1</span>);</span><br><span class="line">    <span class="comment">// 从字节数组中读取对象</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user5</span> <span class="operator">=</span> mapper.readValue(userJson.getBytes(StandardCharsets.UTF_8), User.class);</span><br><span class="line">    assertThat(user5).extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;默烦&quot;</span>, <span class="number">20</span>, <span class="number">177.5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>解析成对象数组、列表、映射</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeserialization_2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().enable(SerializationFeature.INDENT_OUTPUT);</span><br><span class="line">    <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot;: 20,</span></span><br><span class="line"><span class="string">              &quot;height&quot;: 177.5</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            [</span></span><br><span class="line"><span class="string">              &#123;</span></span><br><span class="line"><span class="string">                &quot;name&quot;: &quot;mofan&quot;</span></span><br><span class="line"><span class="string">              &#125;,</span></span><br><span class="line"><span class="string">              &#123;</span></span><br><span class="line"><span class="string">                &quot;name&quot;: &quot;默烦&quot;</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            ]</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从 JSON 数组字符串中读取对象数组</span></span><br><span class="line">    User[] users1 = mapper.readValue(jsonArray, User[].class);</span><br><span class="line">    assertThat(users1).extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(tuple(<span class="string">&quot;mofan&quot;</span>, <span class="number">0</span>, <span class="number">0.0</span>), tuple(<span class="string">&quot;默烦&quot;</span>, <span class="number">0</span>, <span class="number">0.0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从 JSON 数组字符串中读取对象列表</span></span><br><span class="line">    List&lt;User&gt; userList = mapper.readValue(jsonArray, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;&gt;() &#123;</span><br><span class="line">    &#125;);</span><br><span class="line">    assertThat(userList).extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(tuple(<span class="string">&quot;mofan&quot;</span>, <span class="number">0</span>, <span class="number">0.0</span>), tuple(<span class="string">&quot;默烦&quot;</span>, <span class="number">0</span>, <span class="number">0.0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从 JSON 数组字符串中读取对象列表</span></span><br><span class="line">    Map&lt;String, Object&gt; map = mapper.readValue(userJson, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;&gt;() &#123;</span><br><span class="line">    &#125;);</span><br><span class="line">    assertThat(map).containsAllEntriesOf(Map.of(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;默烦&quot;</span>, <span class="string">&quot;height&quot;</span>, <span class="number">177.5</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-4-树模型"><a class="header-anchor" href="#2-4-树模型"></a>2.4 树模型</h2>
<p>前面介绍了简单 JSON 串的读取，如果一个 JSON 串比较复杂，内部还有数组，或者嵌套了其他 JSON 串，这个时候使用前面的方式就无法解析了。为了解决这种复杂情况（开发中经常经常出现的情况），Jackson 引入了树模型的概念，涉及的类有 <code>JsonNode</code>、<code>ObjectNode</code> 等等。</p>
<blockquote>
<p>解析成 JsonNode</p>
</blockquote>
<p>将 JSON 字符串解析成 JsonNode 有两种方式，可以使用 <code>readValue()</code> 指定第二个参数为 <code>JsonNode.class</code>，也可以使用 <code>readTree()</code> 方法，这个方法总是会返回一个 JsonNode 对象。</p>
<p>在 <code>ObjectMapper</code> 类中 <code>readTree()</code> 方法有多种重载，能将多种格式的 JSON 数据解析成 JsonNode：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/readTree%E7%9A%84%E5%90%84%E7%A7%8D%E9%87%8D%E8%BD%BD.png" alt="readTree的各种重载"></p>
<p>示例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testParseJSONIntoJsonNode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot;: 20,</span></span><br><span class="line"><span class="string">              &quot;height&quot;: 177.5</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">jsonNode1</span> <span class="operator">=</span> mapper.readValue(userJson, JsonNode.class);</span><br><span class="line">    assertThat(jsonNode1.get(<span class="string">&quot;name&quot;</span>).asText()).isEqualTo(<span class="string">&quot;默烦&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">jsonNode2</span> <span class="operator">=</span> mapper.readTree(userJson);</span><br><span class="line">    assertThat(jsonNode2.get(<span class="string">&quot;age&quot;</span>).asInt()).isEqualTo(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectNode</span> <span class="variable">objectNode</span> <span class="operator">=</span> ((ObjectNode) mapper.readTree(userJson));</span><br><span class="line">    objectNode.withObject(<span class="string">&quot;/other&quot;</span>).put(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;Student&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> mapper.writerWithDefaultPrettyPrinter().writeValueAsString(objectNode);</span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot; : &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot; : 20,</span></span><br><span class="line"><span class="string">              &quot;height&quot; : 177.5,</span></span><br><span class="line"><span class="string">              &quot;other&quot; : &#123;</span></span><br><span class="line"><span class="string">                &quot;type&quot; : &quot;Student&quot;</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(string).isEqualTo(expectJson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>JsonNode 的基本操作</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJsonNodeOperation</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;mofan&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot;: 20,</span></span><br><span class="line"><span class="string">              &quot;hobby&quot;: [</span></span><br><span class="line"><span class="string">                &quot;music&quot;,</span></span><br><span class="line"><span class="string">                &quot;game&quot;,</span></span><br><span class="line"><span class="string">                &quot;study&quot;</span></span><br><span class="line"><span class="string">              ],</span></span><br><span class="line"><span class="string">              &quot;other&quot;: &#123;</span></span><br><span class="line"><span class="string">                &quot;type&quot;: &quot;Student&quot;</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">                            &quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">jsonNode</span> <span class="operator">=</span> mapper.readTree(userJson);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 name 的字段值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> jsonNode.get(<span class="string">&quot;name&quot;</span>).asText();</span><br><span class="line">    assertThat(name).isEqualTo(<span class="string">&quot;mofan&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 age 的字段值</span></span><br><span class="line">    assertThat(jsonNode.get(<span class="string">&quot;age&quot;</span>).asInt()).isEqualTo(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 hobby 数组中第一个值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">firstHobby</span> <span class="operator">=</span> jsonNode.get(<span class="string">&quot;hobby&quot;</span>).get(<span class="number">0</span>).asText();</span><br><span class="line">    assertThat(firstHobby).isEqualTo(<span class="string">&quot;music&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取嵌套的 JSON 串中 type 的值</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> jsonNode.get(<span class="string">&quot;other&quot;</span>).get(<span class="string">&quot;type&quot;</span>).asText();</span><br><span class="line">    assertThat(type).isEqualTo(<span class="string">&quot;Student&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>添加与删除</p>
</blockquote>
<p>使用树模型，甚至还可以向原 JSON 串中添加或删除数据，只不过这个时候不能用 <code>JsonNode</code> 来操作了，得使用它的子类 <code>ObjectNode</code>，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAddDataToJSON</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot;: 20,</span></span><br><span class="line"><span class="string">              &quot;height&quot;: 177.5</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().enable(SerializationFeature.INDENT_OUTPUT);</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectNode</span> <span class="variable">objectNode</span> <span class="operator">=</span> mapper.readValue(userJson, ObjectNode.class);</span><br><span class="line">    <span class="comment">// 添加普通字段</span></span><br><span class="line">    objectNode.put(<span class="string">&quot;weight&quot;</span>, <span class="number">65</span>);</span><br><span class="line">    <span class="comment">// 再嵌套一个 JSON</span></span><br><span class="line">    objectNode.withObject(<span class="string">&quot;/other&quot;</span>).put(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;Student&quot;</span>);</span><br><span class="line">    <span class="comment">// 添加一个数组</span></span><br><span class="line">    objectNode.withArray(<span class="string">&quot;hobby&quot;</span>).add(<span class="string">&quot;music&quot;</span>).add(<span class="string">&quot;game&quot;</span>).add(<span class="string">&quot;study&quot;</span>);</span><br><span class="line">    <span class="comment">// 向数组指定位置添加一个值</span></span><br><span class="line">    objectNode.withArray(<span class="string">&quot;hobby&quot;</span>).insert(<span class="number">1</span>, <span class="string">&quot;write&quot;</span>);</span><br><span class="line">    <span class="comment">// 向数组中嵌套一段 JSON</span></span><br><span class="line">    objectNode.withArray(<span class="string">&quot;jsonArray&quot;</span>).add(mapper.readValue(userJson, ObjectNode.class));</span><br><span class="line">    <span class="comment">// 向数组中添加一个 Object 节点</span></span><br><span class="line">    objectNode.withArray(<span class="string">&quot;objectArray&quot;</span>).addObject().putObject(<span class="string">&quot;Test&quot;</span>).put(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot; : &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot; : 20,</span></span><br><span class="line"><span class="string">              &quot;height&quot; : 177.5,</span></span><br><span class="line"><span class="string">              &quot;weight&quot; : 65,</span></span><br><span class="line"><span class="string">              &quot;other&quot; : &#123;</span></span><br><span class="line"><span class="string">                &quot;type&quot; : &quot;Student&quot;</span></span><br><span class="line"><span class="string">              &#125;,</span></span><br><span class="line"><span class="string">              &quot;hobby&quot; : [ &quot;music&quot;, &quot;write&quot;, &quot;game&quot;, &quot;study&quot; ],</span></span><br><span class="line"><span class="string">              &quot;jsonArray&quot; : [ &#123;</span></span><br><span class="line"><span class="string">                &quot;name&quot; : &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">                &quot;age&quot; : 20,</span></span><br><span class="line"><span class="string">                &quot;height&quot; : 177.5</span></span><br><span class="line"><span class="string">              &#125; ],</span></span><br><span class="line"><span class="string">              &quot;objectArray&quot; : [ &#123;</span></span><br><span class="line"><span class="string">                &quot;Test&quot; : &#123;</span></span><br><span class="line"><span class="string">                  &quot;test&quot; : &quot;test&quot;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">              &#125; ]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(mapper.writeValueAsString(objectNode)).isEqualTo(expectJson);</span><br><span class="line"></span><br><span class="line">    assertThat(objectNode.get(<span class="string">&quot;objectArray&quot;</span>).get(<span class="number">0</span>).isObject()).isTrue();</span><br><span class="line">    assertThat(objectNode.get(<span class="string">&quot;weight&quot;</span>).asInt()).isEqualTo(<span class="number">65</span>);</span><br><span class="line">    assertThat(objectNode.get(<span class="string">&quot;other&quot;</span>).isObject()).isTrue();</span><br><span class="line">    assertThat(objectNode.get(<span class="string">&quot;other&quot;</span>).get(<span class="string">&quot;type&quot;</span>).asText()).isEqualTo(<span class="string">&quot;Student&quot;</span>);</span><br><span class="line">    assertThat(objectNode.get(<span class="string">&quot;hobby&quot;</span>).get(<span class="number">0</span>).asText()).isEqualTo(<span class="string">&quot;music&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除普通字段</span></span><br><span class="line">    objectNode.without(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">    <span class="comment">// 删除嵌套 JSON 中的字段</span></span><br><span class="line">    objectNode.withObject(<span class="string">&quot;/other&quot;</span>).without(<span class="string">&quot;type&quot;</span>);</span><br><span class="line">    <span class="comment">// 删除嵌套的 JSON，无论内部是否有字段</span></span><br><span class="line">    objectNode.without(<span class="string">&quot;other&quot;</span>);</span><br><span class="line">    <span class="comment">// 删除数组中某个值</span></span><br><span class="line">    objectNode.withArray(<span class="string">&quot;hobby&quot;</span>).remove(<span class="number">0</span>);</span><br><span class="line">    objectNode.withArray(<span class="string">&quot;jsonArray&quot;</span>).removeAll();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 向数组中添加一个 Object</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;mofan&quot;</span>, <span class="number">19</span>, <span class="number">177.5</span>);</span><br><span class="line">    objectNode.withArray(<span class="string">&quot;addPojo&quot;</span>).addPOJO(user);</span><br><span class="line">    <span class="comment">// 向数组中添加带字段的 Object</span></span><br><span class="line">    objectNode.withArray(<span class="string">&quot;addPojoWithField&quot;</span>).addObject().putPOJO(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line">    expectJson = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot; : &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;height&quot; : 177.5,</span></span><br><span class="line"><span class="string">              &quot;weight&quot; : 65,</span></span><br><span class="line"><span class="string">              &quot;hobby&quot; : [ &quot;write&quot;, &quot;game&quot;, &quot;study&quot; ],</span></span><br><span class="line"><span class="string">              &quot;jsonArray&quot; : [ ],</span></span><br><span class="line"><span class="string">              &quot;objectArray&quot; : [ &#123;</span></span><br><span class="line"><span class="string">                &quot;Test&quot; : &#123;</span></span><br><span class="line"><span class="string">                  &quot;test&quot; : &quot;test&quot;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">              &#125; ],</span></span><br><span class="line"><span class="string">              &quot;addPojo&quot; : [ &#123;</span></span><br><span class="line"><span class="string">                &quot;name&quot; : &quot;mofan&quot;,</span></span><br><span class="line"><span class="string">                &quot;age&quot; : 19,</span></span><br><span class="line"><span class="string">                &quot;height&quot; : 177.5</span></span><br><span class="line"><span class="string">              &#125; ],</span></span><br><span class="line"><span class="string">              &quot;addPojoWithField&quot; : [ &#123;</span></span><br><span class="line"><span class="string">                &quot;user&quot; : &#123;</span></span><br><span class="line"><span class="string">                  &quot;name&quot; : &quot;mofan&quot;,</span></span><br><span class="line"><span class="string">                  &quot;age&quot; : 19,</span></span><br><span class="line"><span class="string">                  &quot;height&quot; : 177.5</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">              &#125; ]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(mapper.writeValueAsString(objectNode)).isEqualTo(expectJson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有关 <code>ArrayNode</code> 的方法还有很多，查看源码可以发现，其底层就是 <code>List&lt;JsonNode&gt;</code>，所以使用方式也和动态数组差不多。</p>
<p>比如，可以使用 <code>set()</code> 方法修改某个索引位置的数据，还可以使用 <code>insert()</code> 方法来给某个索引位置添加数据。</p>
<blockquote>
<p>JsonNode 与 Object 的转换</p>
</blockquote>
<p>JsonNode 与 Object 之间是可以进行转换的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTransform</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot;: 20,</span></span><br><span class="line"><span class="string">              &quot;height&quot;: 177.5</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().enable(SerializationFeature.INDENT_OUTPUT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JsonNode 转 Object</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> mapper.readValue(userJson, User.class);</span><br><span class="line">    assertThat(user).extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;默烦&quot;</span>, <span class="number">20</span>, <span class="number">177.5</span>);</span><br><span class="line">    <span class="comment">// 或者</span></span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">jsonNode1</span> <span class="operator">=</span> mapper.readTree(userJson);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> mapper.treeToValue(jsonNode1, User.class);</span><br><span class="line">    assertThat(user1).extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;默烦&quot;</span>, <span class="number">20</span>, <span class="number">177.5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Object 转 JsonNode</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;mofan&quot;</span>, <span class="number">18</span>, <span class="number">178.1</span>);</span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">jsonNode2</span> <span class="operator">=</span> mapper.valueToTree(user2);</span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot; : &quot;mofan&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot; : 18,</span></span><br><span class="line"><span class="string">              &quot;height&quot; : 178.1</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(mapper.writeValueAsString(jsonNode2)).isEqualTo(expectJson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-5-转换成-JSON-串"><a class="header-anchor" href="#2-5-转换成-JSON-串"></a>2.5 转换成 JSON 串</h2>
<blockquote>
<p>简单的序列化</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSerialization_1</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;默烦&quot;</span>, <span class="number">19</span>, <span class="number">178.2</span>);</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().enable(SerializationFeature.INDENT_OUTPUT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写为字符串</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> mapper.writeValueAsString(user);</span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot; : &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot; : 19,</span></span><br><span class="line"><span class="string">              &quot;height&quot; : 178.2</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(str).isEqualTo(expectJson);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写为文件</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;test.json&quot;</span>);</span><br><span class="line">    mapper.writeValue(file, user);</span><br><span class="line">    assertThat(file).exists();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写为字节流并读取</span></span><br><span class="line">    <span class="type">byte</span>[] bytes = mapper.writeValueAsBytes(user);</span><br><span class="line">    assertThat(mapper.readValue(bytes, User.class))</span><br><span class="line">            .extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;默烦&quot;</span>, <span class="number">19</span>, <span class="number">178.2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在当前 Module 目录下，可以看到一个生成的名为 <code>test.json</code> 的文件，文件内容为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;默烦&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span> <span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;height&quot;</span> <span class="punctuation">:</span> <span class="number">178.2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>映射转换成 JSON</p>
</blockquote>
<p>除了可以将实体类序列化成 JSON 字符串外，还可以将 Map 映射转换成 JSON 字符串，JSON 字符串是一种键值关系，而 Map 也是一种键值关系，因此能够相互转换也是情理之中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSerialization_2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().enable(SerializationFeature.INDENT_OUTPUT);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">8</span>);</span><br><span class="line">    map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;mofan&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    map.put(<span class="string">&quot;hobby&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;code&quot;</span>, <span class="string">&quot;game&quot;</span>, <span class="string">&quot;study&quot;</span>&#125;);</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="string">&quot;book_1&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;book_2&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;book_3&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;book&quot;</span>, list);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> mapper.writeValueAsString(map);</span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot; : &quot;mofan&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot; : 18,</span></span><br><span class="line"><span class="string">              &quot;hobby&quot; : [ &quot;code&quot;, &quot;game&quot;, &quot;study&quot; ],</span></span><br><span class="line"><span class="string">              &quot;book&quot; : [ &quot;book_1&quot;, &quot;book_2&quot;, &quot;book_3&quot; ]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(str).isEqualTo(expectJson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="3-流解析器"><a class="header-anchor" href="#3-流解析器"></a>3. 流解析器</h1>
<h2 id="3-1-流解析器的概述"><a class="header-anchor" href="#3-1-流解析器的概述"></a>3.1 流解析器的概述</h2>
<p>在 GitHub 上，关于 Jackson 的流解析器：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/Streaming-parser.png" alt="Streaming-parser"></p>
<p>翻译一下就是：</p>
<p>使用数据绑定（实体与 JSON 之间的转换）很方便，树模型也很灵活，但是还有一种更规范的处理模型：增量（流）模型。 <strong>它是数据绑定和树模型的基础处理模型</strong>，它暴露给那些希望获得最高性能、控制解析或生成细节的用户。</p>
<h2 id="3-2-基本使用"><a class="header-anchor" href="#3-2-基本使用"></a>3.2 基本使用</h2>
<p>流解析器在使用时就像编写 XML 标签或者 HTML 标签一样，开头一个标识，结尾一个标识，中间书写内容，虽然书写起来很繁琐，但是操作 JSON 的性能和细节都能被编码者所掌握。</p>
<p>先来个 Quick Start：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testStreamingParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">JsonFactory</span> <span class="variable">factory</span> <span class="operator">=</span> mapper.getFactory();</span><br><span class="line"></span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;simpleJSON.json&quot;</span>);</span><br><span class="line">    <span class="type">JsonGenerator</span> <span class="variable">generator</span> <span class="operator">=</span> factory.createGenerator(file, JsonEncoding.UTF8);</span><br><span class="line"></span><br><span class="line">    generator.writeStartObject();</span><br><span class="line">    generator.writeStringField(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Hello Jackson&quot;</span>);</span><br><span class="line">    generator.writeEndObject();</span><br><span class="line">    generator.close();</span><br><span class="line"></span><br><span class="line">    <span class="type">JsonParser</span> <span class="variable">parser</span> <span class="operator">=</span> factory.createParser(file);</span><br><span class="line">    <span class="type">JsonToken</span> <span class="variable">jsonToken</span> <span class="operator">=</span> parser.nextToken();</span><br><span class="line"></span><br><span class="line">    jsonToken = parser.nextToken();</span><br><span class="line">    assertThat(parser.getCurrentName()).isEqualTo(<span class="string">&quot;msg&quot;</span>);</span><br><span class="line">    assertThat(jsonToken).isEqualTo(JsonToken.FIELD_NAME);</span><br><span class="line"></span><br><span class="line">    jsonToken = parser.nextToken();</span><br><span class="line">    assertThat(jsonToken).isEqualTo(JsonToken.VALUE_STRING);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> parser.getText();</span><br><span class="line">    assertThat(msg).isEqualTo(<span class="string">&quot;Hello Jackson&quot;</span>);</span><br><span class="line">    parser.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时也能在当前 Module 下看到生成的名为 <code>simpleJSON.json</code> 的文件，其内容为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;Hello Jackson&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-3-写入-JSON-数据"><a class="header-anchor" href="#3-3-写入-JSON-数据"></a>3.3 写入 JSON 数据</h2>
<p>如果需要写入 JSON 数据，那么需要使用到 <code>JsonGenerator</code> 类，它是定义公共 API 编写的 JSON 内容的基类。也就是说，要写入 JSON 数据，就需要创建一个 <code>JsonGenerator</code> 对象，然后使用这个对象来写入数据。</p>
<p>要创建 <code>JsonGenerator</code> 实例，需要使用 <code>JsonFactory</code> 实例的 <code>createGenerator()</code> 工厂方法来创建实例。这个方法有很多重载，各种重载指定了数据写入的位置和写入的方式：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/createGenerator%E6%96%B9%E6%B3%95%E7%9A%84%E5%90%84%E7%A7%8D%E9%87%8D%E8%BD%BD.png" alt="createGenerator方法的各种重载"></p>
<p>成功得到 <code>JsonGenerator</code> 实例后，使用实例的各种 <code>writexxxxx()</code> 方法就可以写入数据了。</p>
<p><mark>数据写入完成后，记得调用 <code>close()</code> 方法。当然，更推荐使用 <code>try-with-resources</code> 自动关闭资源。</mark></p>
<p>来写入一些比 Quick Start 案例中要复杂一些的 JSON 数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJsonGenerator</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">JsonFactory</span> <span class="variable">factory</span> <span class="operator">=</span> mapper.getFactory();</span><br><span class="line"></span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;testJsonGenerator.json&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> (<span class="type">JsonGenerator</span> <span class="variable">generator</span> <span class="operator">=</span> factory.createGenerator(file, JsonEncoding.UTF8)) &#123;</span><br><span class="line">        <span class="comment">// start &#123;</span></span><br><span class="line">        generator.writeStartObject();</span><br><span class="line">        <span class="comment">// &quot;name&quot; : &quot;默烦&quot;</span></span><br><span class="line">        generator.writeStringField(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;默烦&quot;</span>);</span><br><span class="line">        <span class="comment">// &quot;age&quot; : 18</span></span><br><span class="line">        generator.writeNumberField(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="comment">// &quot;isGirl&quot; : false</span></span><br><span class="line">        generator.writeBooleanField(<span class="string">&quot;isGirl&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// &quot;hobby&quot; : [&quot;code&quot;, &quot;study&quot;]</span></span><br><span class="line">        generator.writeFieldName(<span class="string">&quot;hobby&quot;</span>);</span><br><span class="line">        <span class="comment">// [</span></span><br><span class="line">        generator.writeStartArray();</span><br><span class="line">        <span class="comment">// code, study</span></span><br><span class="line">        generator.writeString(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">        generator.writeString(<span class="string">&quot;study&quot;</span>);</span><br><span class="line">        <span class="comment">// ]</span></span><br><span class="line">        generator.writeEndArray();</span><br><span class="line">        <span class="comment">// end &#125;</span></span><br><span class="line">        generator.writeEndObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据写入结束，来读取一下</span></span><br><span class="line">    Map&lt;String, Object&gt; map = mapper.readValue(file, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;&gt;() &#123;</span><br><span class="line">    &#125;);</span><br><span class="line">    assertThat(map).containsAllEntriesOf(Map.of(</span><br><span class="line">        <span class="string">&quot;age&quot;</span>, <span class="number">18</span>,</span><br><span class="line">        <span class="string">&quot;hobby&quot;</span>, List.of(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;study&quot;</span>),</span><br><span class="line">        <span class="string">&quot;isGirl&quot;</span>, <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>, <span class="string">&quot;默烦&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在当前 Module 下，还会生成名为 <code>testJsonGenerator.json</code> 的文件，格式化后其内容为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;默烦&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;isGirl&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hobby&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;code&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;study&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>小总结</p>
</blockquote>
<p>总的来说，写入数据并不难，编写代码时类似于写 XML 或 HTML 标签，有开始标志，有结束标志，中间写内容，最后记得关闭资源。</p>
<h2 id="3-4-读取-JSON-数据"><a class="header-anchor" href="#3-4-读取-JSON-数据"></a>3.4 读取 JSON 数据</h2>
<p>参考链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/neweastsun/article/details/104862861/">介绍Jackson JsonParser解析json</a> | <a target="_blank" rel="noopener" href="https://www.jb51.net/article/77970.htm">解析Java的Jackson库中Streaming API的使用</a></p>
<p>读取 JSON 数据时，需要使用到 <code>JsonParser</code> 类，它是定义公共 API 用于读取的 JSON 内容的基类。这个类的实例的创建方式和 <code>JsonGenerator</code> 类的实例的创建方式一样，都需要使用 <code>JsonFactory</code> 实例的 <code>createParser()</code> 工厂方法来创建。这个方法也有很多重载，实现了解析不同来源的 JOSN 数据：</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/createParser%E6%96%B9%E6%B3%95%E7%9A%84%E5%90%84%E7%A7%8D%E9%87%8D%E8%BD%BD.png" alt="createParser方法的各种重载"></p>
<p>创建完 JsonParser 实例后，可以用其解析 JOSN 数据。JsonParser 工作方式是将 JSON 分解成一系列标记（token），逐个迭代遍历标记并进行解析。</p>
<p>试试通过循环所有标记并输出，JSON 数据用前一步生成的 <code>testJsonGenerator.json</code> 文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetToken</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">JsonFactory</span> <span class="variable">jsonFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JsonFactory</span>();</span><br><span class="line">    <span class="comment">// 先执行 testJsonGenerator() 测试方法，确保存在 testJsonGenerator.json 文件</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;testJsonGenerator.json&quot;</span>);</span><br><span class="line">    <span class="type">JsonParser</span> <span class="variable">parser</span> <span class="operator">=</span> jsonFactory.createParser(file);</span><br><span class="line"></span><br><span class="line">    List&lt;JsonToken&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (!parser.isClosed()) &#123;</span><br><span class="line">        list.add(parser.nextToken());</span><br><span class="line">    &#125;</span><br><span class="line">    assertThat(list).containsExactly(</span><br><span class="line">            JsonToken.START_OBJECT,</span><br><span class="line">            JsonToken.FIELD_NAME,</span><br><span class="line">            JsonToken.VALUE_STRING,</span><br><span class="line">            JsonToken.FIELD_NAME,</span><br><span class="line">            JsonToken.VALUE_NUMBER_INT,</span><br><span class="line">            JsonToken.FIELD_NAME,</span><br><span class="line">            JsonToken.VALUE_FALSE,</span><br><span class="line">            JsonToken.FIELD_NAME,</span><br><span class="line">            JsonToken.START_ARRAY,</span><br><span class="line">            JsonToken.VALUE_STRING,</span><br><span class="line">            JsonToken.VALUE_STRING,</span><br><span class="line">            JsonToken.END_ARRAY,</span><br><span class="line">            JsonToken.END_OBJECT,</span><br><span class="line">            <span class="literal">null</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对比 <code>list</code> 与原 JSON 信息：</p>
<img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/Token标记与JSON数据的对比.png" alt="Token标记与JSON数据的对比" style="zoom:50%;" />
<p>这样一对比后，那不是直接清楚明了了？😎</p>
<p>既然如此，来试试读取数据，依旧是读取 <code>testJsonGenerator.json</code> 文件中的数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Order(3)</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJsonParser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">JsonFactory</span> <span class="variable">factory</span> <span class="operator">=</span> mapper.getFactory();</span><br><span class="line"></span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;testJsonGenerator.json&quot;</span>);</span><br><span class="line">    <span class="type">JsonParser</span> <span class="variable">parser</span> <span class="operator">=</span> factory.createParser(file);</span><br><span class="line">    <span class="keyword">while</span> (!parser.isClosed()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (JsonToken.FIELD_NAME.equals(parser.nextToken())) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">fieldName</span> <span class="operator">=</span> parser.getCurrentName();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 移动到下一标记处</span></span><br><span class="line">            parser.nextToken();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;name&quot;</span>.equals(fieldName)) &#123;</span><br><span class="line">                assertThat(parser.getValueAsString()).isEqualTo(<span class="string">&quot;默烦&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;age&quot;</span>.equals(fieldName)) &#123;</span><br><span class="line">                assertThat(parser.getValueAsInt()).isEqualTo(<span class="number">18</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;isGirl&quot;</span>.equals(fieldName)) &#123;</span><br><span class="line">                assertThat(parser.getValueAsBoolean()).isFalse();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;hobby&quot;</span>.equals(fieldName)) &#123;</span><br><span class="line">                List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">                <span class="keyword">while</span> (parser.nextToken() != JsonToken.END_ARRAY) &#123;</span><br><span class="line">                    list.add(parser.getValueAsString());</span><br><span class="line">                &#125;</span><br><span class="line">                assertThat(list).containsExactly(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;study&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果标记指针指向的是字段，JsonParser 的 <code>getCurrentName()</code> 方法返回当前字段名称。</p>
<p>JsonParser 的 <code>getValueAsString()</code> 返回当前标记值的字符串类型，同理 <code>getValueAsInt()</code> 返回整型值，同样还有 Boolean、Double、Long 三种类型可以选择。</p>
<h1 id="4-Jackson-的配置"><a class="header-anchor" href="#4-Jackson-的配置"></a>4. Jackson 的配置</h1>
<h2 id="4-1-配置前言"><a class="header-anchor" href="#4-1-配置前言"></a>4.1 配置前言</h2>
<p>Jackson 有两种入门级配置机制，分别是：Features 和 Annotations，前者可以翻译成特征，比如在最开始使用的 <code>enable(SerializationFeature.INDENT_OUTPUT)</code> 就属于 Features，后者是注解的意思，可以在某些地方添加注解，达到想要的目标。</p>
<p><mark>注意：</mark> Jackson 遵循 <strong>configure-first-then-use</strong>，即“先配置再使用”，也就是说在进行了 <strong>首次</strong> 序列化或反序列化操作后，再对 Jackson 进行的配置都不会生效，尽管这些配置在运行过程中并不会抛出异常。</p>
<h2 id="4-2-常用的-Features"><a class="header-anchor" href="#4-2-常用的-Features"></a>4.2 常用的 Features</h2>
<p>在 Jackson 的 GitHub 上，关于 <code>Commonly used Features</code> 有这些内容：</p>
<blockquote>
<p>高级别的数据绑定配置</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// to enable standard indentation (&quot;pretty-printing&quot;):</span></span><br><span class="line"><span class="comment">// 翻译: 格式化输出 JSON</span></span><br><span class="line">mapper.enable(SerializationFeature.INDENT_OUTPUT);</span><br><span class="line"><span class="comment">// to allow serialization of &quot;empty&quot; POJOs (no properties to serialize)</span></span><br><span class="line"><span class="comment">// (without this setting, an exception is thrown in those cases)</span></span><br><span class="line"><span class="comment">// 翻译: 允许序列化为空的 POJO，否则会抛出异常</span></span><br><span class="line">mapper.disable(SerializationFeature.FAIL_ON_EMPTY_BEANS);</span><br><span class="line"><span class="comment">// to write java.util.Date, Calendar as number (timestamp):</span></span><br><span class="line"><span class="comment">// 翻译: 把 java.util.Date, Calendar 输出为数字（时间戳）</span></span><br><span class="line">mapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);</span><br><span class="line"></span><br><span class="line"><span class="comment">// DeserializationFeature for changing how JSON is read as POJOs:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// to prevent exception when encountering unknown property:</span></span><br><span class="line"><span class="comment">// 翻译: 在反序列化时，忽略在 JSON 中存在但在 Java 对象中不存在的属性</span></span><br><span class="line">mapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line"><span class="comment">// to allow coercion of JSON empty String (&quot;&quot;) to null Object value:</span></span><br><span class="line"><span class="comment">// 翻译: 强制JSON 空字符串(&quot;&quot;)转换为 null 对象值:</span></span><br><span class="line">mapper.enable(DeserializationFeature.ACCEPT_EMPTY_STRING_AS_NULL_OBJECT);</span><br><span class="line"><span class="comment">// 在序列化时日期格式默认为 yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSSZ </span></span><br><span class="line">mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS,<span class="literal">false</span>) </span><br><span class="line"><span class="comment">// 在序列化时忽略值为 null 的属性 </span></span><br><span class="line">mapper.setSerializationInclusion(Include.NON_NULL); </span><br><span class="line"><span class="comment">// 忽略值为默认值的属性 </span></span><br><span class="line">mapper.setDefaultPropertyInclusion(Include.NON_DEFAULT);</span><br><span class="line"><span class="comment">// 将 null 值反序列化为基本类型时，不抛出异常</span></span><br><span class="line">mapper.configure(DeserializationFeature.FAIL_ON_NULL_FOR_PRIMITIVES, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// 是否允许将枚举序列化或反序列化为数字，下述配置是允许</span></span><br><span class="line">mapper.configure(DeserializationFeature.FAIL_ON_NUMBERS_FOR_ENUMS, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>低级别的 JSON 解析、生成细节配置</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// to allow C/C++ style comments in JSON (non-standard, disabled by default)</span></span><br><span class="line"><span class="comment">// (note: with Jackson 2.5, there is also `mapper.enable(feature)` / `mapper.disable(feature)`)</span></span><br><span class="line"><span class="comment">// 翻译: 在JSON中允许C/C++ 样式的注释(非标准，默认禁用)</span></span><br><span class="line">mapper.configure(JsonParser.Feature.ALLOW_COMMENTS, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// to allow (non-standard) unquoted field names in JSON:</span></span><br><span class="line"><span class="comment">// 翻译 : 允许没有引号的字段名(非标准)</span></span><br><span class="line">mapper.configure(JsonParser.Feature.ALLOW_UNQUOTED_FIELD_NAMES, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// to allow use of apostrophes (single quotes), non standard</span></span><br><span class="line"><span class="comment">// 翻译: 允许单引号(非标准)</span></span><br><span class="line">mapper.configure(JsonParser.Feature.ALLOW_SINGLE_QUOTES, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// JsonGenerator.Feature for configuring low-level JSON generation:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// to force escaping of non-ASCII characters:</span></span><br><span class="line"><span class="comment">// 翻译: 强制转义非 ASCII 字符</span></span><br><span class="line">mapper.configure(JsonGenerator.Feature.ESCAPE_NON_ASCII, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 将内容包裹为一个 JSON 属性，属性名由 @JsonRootName 注解指定</span></span><br><span class="line">mapper.configure(SerializationFeature.WRAP_ROOT_VALUE, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 不序列化被 transient 修饰的字段</span></span><br><span class="line">mapper.configure(MapperFeature.PROPAGATE_TRANSIENT_MARKER, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p><s>在 Jackson 2.5 版本以后，新增了 <code>enable()</code> 和 <code>disable()</code> 方法可以直接启用或禁用相应的 Feature，推荐使用这种方式。</s></p>
<p>在 Jackson 2.13 版本以后，<code>ObjectMapper</code> 中的 <code>enable()</code>、<code>disable()</code> 和 <code>configure()</code> 都被标记为过时，并且这些方法将在 Jackson 3.0 中被移除，推荐使用 <code>JsonMapper</code> 中的同名方法。</p>
<p>如果想要查看全部的 Features，可以查看 <a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson-databind/wiki/JacksonFeatures">Jackson Features</a></p>
<h2 id="4-3-常用的-Annotations"><a class="header-anchor" href="#4-3-常用的-Annotations"></a>4.3 常用的 Annotations</h2>
<p>Jackson 会根据其默认方式对 Java 对象进行序列化和反序列化，如果需要，可以灵活的调整它的默认方式，可以使用 Jackson 的注解。常用的注解及用法如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">注解</th>
<th style="text-align:center">用法</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">@JsonProperty</td>
<td style="text-align:center">作用于属性，把属性的名称序列化时转换为另外一个名称。</td>
</tr>
<tr>
<td style="text-align:center">@JsonFormat</td>
<td style="text-align:center">作用于属性或者方法，让属性的格式在序列化时转换成指定的格式。</td>
</tr>
<tr>
<td style="text-align:center">@JsonPropertyOrder</td>
<td style="text-align:center">作用于类， 指定属性在序列化时 JSON 中的顺序。</td>
</tr>
<tr>
<td style="text-align:center">@JsonCreator</td>
<td style="text-align:center">作用于构造方法，和 @JsonProperty 配合使用，适用有参数的构造方法。</td>
</tr>
<tr>
<td style="text-align:center">@JsonAnySetter</td>
<td style="text-align:center">作用于属性或者方法，设置未反序列化的属性名和值作为键值存储到 Map 中。</td>
</tr>
<tr>
<td style="text-align:center">@JsonAnyGetter</td>
<td style="text-align:center">作用于方法 ，获取所有未序列化的属性。</td>
</tr>
</tbody>
</table>
<p><code>@JsonFormat</code> 注解很常用，尤其是在前后端分离的情况下（前后端分离下都是传递 JSON 数据），一般使用它来格式化日期格式与设置时区：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFormat(timezone = &quot;GMT+8&quot;, pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Date birth;</span><br></pre></td></tr></table></figure>
<p>在使用 <code>@JsonFormat</code> 注解后，当前端提交类似 <code>yyyy-MM-dd</code> 的字符串时，Jackson 能够将其反序列化为 <code>Date</code> 类型的数据。注意，如果提交的是字符串类型的时间戳，则会反序列化失败，但数值类型的时间戳能够序列化成功。</p>
<blockquote>
<p>改变属性名</p>
</blockquote>
<p>给 <code>Employee</code> 实体的属性添加 <code>@JsonProperty</code> 注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="meta">@JsonProperty(value = &quot;employeeName&quot;, index = 2)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@JsonProperty(index = 1)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="meta">@JsonProperty(index = 0)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> height;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@JsonProperty</code> 注解的 value 属性用于指定生成的 JSON 字符串字段名，如果不设置，字段名与属性名相同。index 属性可以指定生成的 JSON 字符串字段的顺序，从 0 开始。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAnnotation</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;mofan&quot;</span>, <span class="number">19</span>, <span class="number">178.2</span>);</span><br><span class="line">    <span class="comment">// 序列化</span></span><br><span class="line">    LinkedHashMap&lt;String, Object&gt; map = mapper.convertValue(employee, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;&gt;() &#123;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 转成 LinkedHashMap 进行比较</span></span><br><span class="line">    Map&lt;String, Object&gt; expectMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">    expectMap.put(<span class="string">&quot;height&quot;</span>, <span class="number">178.2</span>);</span><br><span class="line">    expectMap.put(<span class="string">&quot;age&quot;</span>, <span class="number">19</span>);</span><br><span class="line">    expectMap.put(<span class="string">&quot;employeeName&quot;</span>, <span class="string">&quot;mofan&quot;</span>);</span><br><span class="line">    assertThat(map).containsExactlyEntriesOf(expectMap);</span><br><span class="line">    <span class="comment">// 反序列化</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> mapper.writerWithDefaultPrettyPrinter().writeValueAsString(map);</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">readValue</span> <span class="operator">=</span> mapper.readValue(str, Employee.class);</span><br><span class="line">    assertThat(readValue).extracting(Employee::getName, Employee::getAge, Employee::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;mofan&quot;</span>, <span class="number">19</span>, <span class="number">178.2</span>);</span><br><span class="line">    <span class="comment">//language=JSON</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;employeeName&quot;: &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot;: 20,</span></span><br><span class="line"><span class="string">              &quot;height&quot;: 177.5</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">value</span> <span class="operator">=</span> mapper.readValue(userJson, Employee.class);</span><br><span class="line">    assertThat(value).extracting(Employee::getName, Employee::getAge, Employee::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;默烦&quot;</span>, <span class="number">20</span>, <span class="number">177.5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>属性的忽略</p>
</blockquote>
<p>如果想管理在映射 JSON 的时候包含或排除某些属性，可以用到以下几个注解：</p>
<ol>
<li><code>@JsonIgnore </code> 作用于属性、方法、构造方法和注解类，用于排除某个属性，这样该属性就不会被 Jackson 序列化和反序列化。</li>
<li><code>@JsonIgnoreProperties</code> 是类注解。在序列化为 JSON 的时候，<code>@JsonIgnoreProperties(&#123;&quot;prop1&quot;, &quot;prop2&quot;&#125;)</code>会忽略 pro1 和 pro2 两个属性。在从 JSON 反序列化为 Java 实体类的时候，<code>@JsonIgnoreProperties(ignoreUnknown=true)</code> 会忽略所有没有 Getter 和 Setter 的属性。该注解在 Java 类和 JSON 不完全匹配的时候很有用。</li>
<li><code>@JsonIgnoreType</code> 也是类注解，被注解的类作为别的类的属性时忽略序列化与反序列化。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJsonIgnoreProperties</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">JsonIgnorePropertiesObj</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JsonIgnorePropertiesObj</span>();</span><br><span class="line">    obj.setIgnore(<span class="string">&quot;ignore&quot;</span>);</span><br><span class="line">    obj.setInteger(<span class="number">212</span>);</span><br><span class="line">    obj.setStr(<span class="string">&quot;str&quot;</span>);</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(obj);</span><br><span class="line">    JsonAssert.with(json).assertNotDefined(<span class="string">&quot;ignore&quot;</span>).assertNotDefined(<span class="string">&quot;integer&quot;</span>);</span><br><span class="line">    assertThat(mapper.readValue(json, JsonIgnorePropertiesObj.class))</span><br><span class="line">        .isNotNull()</span><br><span class="line">        .hasAllNullFieldsOrPropertiesExcept(<span class="string">&quot;str&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(&#123;&quot;ignore&quot;, &quot;integer&quot;&#125;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">JsonIgnorePropertiesObj</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String str;</span><br><span class="line">    <span class="comment">// @JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String ignore;</span><br><span class="line">    <span class="comment">// @JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> Integer integer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>@JsonIgnore 与 @JsonProperty 的联合使用</p>
</blockquote>
<p><code>@JsonIgnore</code> 可以作用于方法上，当其作用于某个属性的 Getter 方法时，这个属性在序列化和反序列化时都会被忽略。</p>
<p>现在有一个需求，一个实体中有一名为 <code>pwd</code> 的属性，该属性表示密码，希望在序列化时忽略这个属性，但反序列化的 JSON 字符串中如果有 <code>pwd</code> 字段，则不被忽略。</p>
<p>很容易想到在 <code>pwd</code> 属性的 Getter 方法上添加 <code>@JsonIgnore</code> 注解，但是这样做是不行的，<code>@JsonIgnore</code> 在匹配字段时，Getter 和 Setter 方法之间是共享的，如果只有一个方法具有<code>@JsonIgnore</code>，另一个方法也会被影响。</p>
<p>可以使用“拆分”注释（一般使用 <code>@JsonProperty</code>）来解决这个问题，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJsonIgnore</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">JsonIgnoreObject</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JsonIgnoreObject</span>();</span><br><span class="line">    object.setPwd(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    object.setStr(<span class="string">&quot;str&quot;</span>);</span><br><span class="line">    object.setInteger(<span class="number">212</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(object);</span><br><span class="line">    <span class="comment">// 序列化的 JSON 中没有 pwd</span></span><br><span class="line">    JsonAssert.with(json).assertNotDefined(<span class="string">&quot;$.pwd&quot;</span>);</span><br><span class="line">    assertThat(mapper.readValue(json, JsonIgnoreObject.class))</span><br><span class="line">            .isNotNull()</span><br><span class="line">            .extracting(JsonIgnoreObject::getStr, JsonIgnoreObject::getInteger, JsonIgnoreObject::getPwd)</span><br><span class="line">            .containsExactly(<span class="string">&quot;str&quot;</span>, <span class="number">212</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//language=JSON</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">newJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;str&quot;: &quot;str&quot;,</span></span><br><span class="line"><span class="string">              &quot;integer&quot;: 212,</span></span><br><span class="line"><span class="string">              &quot;password&quot;: &quot;987654321&quot;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    assertThat(mapper.readValue(newJson, JsonIgnoreObject.class))</span><br><span class="line">            .extracting(JsonIgnoreObject::getPwd)</span><br><span class="line">            .isEqualTo(<span class="string">&quot;987654321&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">JsonIgnoreObject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String str;</span><br><span class="line">    <span class="keyword">private</span> Integer integer;</span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPwd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;password&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPwd</span><span class="params">(String pwd)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.pwd = pwd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，对 <code>JsonIgnoreObject</code> 对象进行序列化时忽略了 <code>pwd</code> 属性，但反序列化 JSON 字符串时，如果字符串中有 <code>password</code> 字段，它的值会被设置到 JsonIgnoreObject 的 <code>pwd</code> 属性上。</p>
<blockquote>
<p>序列化相关注解</p>
</blockquote>
<ul>
<li><code>@JsonPropertyOrder</code> 作用于类，用于指定属性序列化时的顺序。<code>@JsonProperty</code> 的 <code>index</code> 属性也有类似功能，数字越小越靠前。</li>
<li><code>@JsonRootName</code> 作用于类，用于指定 JSON 根属性的名称。使用这个注解时，必须启用 <code>SerializationFeature.WRAP_ROOT_VALUE</code> 特性。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@JsonRootName(&quot;root&quot;)</span></span><br><span class="line"><span class="meta">@JsonPropertyOrder(&#123;&quot;decimal&quot;, &quot;string&quot;, &quot;integer&quot;&#125;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Root</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line">    <span class="keyword">private</span> Integer integer;</span><br><span class="line">    <span class="keyword">private</span> Double decimal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSerializationAnnotation</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 @JsonRootName 注解后，必须启用 SerializationFeature.WRAP_ROOT_VALUE</span></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().enable(SerializationFeature.WRAP_ROOT_VALUE);</span><br><span class="line">    <span class="type">Root</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Root</span>(<span class="string">&quot;str&quot;</span>, <span class="number">212</span>, <span class="number">3.14</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(root);</span><br><span class="line">    <span class="comment">//language=JSON</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;root&quot;: &#123;</span></span><br><span class="line"><span class="string">                &quot;decimal&quot;: 3.14,</span></span><br><span class="line"><span class="string">                &quot;string&quot;: &quot;str&quot;,</span></span><br><span class="line"><span class="string">                &quot;integer&quot;: 212</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(json).isEqualTo(expectJson);</span><br><span class="line">    <span class="comment">// 转成 LinkedHashMap 方便比较顺序（此时最外层不再有 root 根属性）</span></span><br><span class="line">    LinkedHashMap&lt;String, Object&gt; map = mapper.convertValue(root, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;&gt;() &#123;</span><br><span class="line">    &#125;);</span><br><span class="line">    Map&lt;String, Object&gt; expectMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">    expectMap.put(<span class="string">&quot;decimal&quot;</span>, <span class="number">3.14</span>);</span><br><span class="line">    expectMap.put(<span class="string">&quot;string&quot;</span>, <span class="string">&quot;str&quot;</span>);</span><br><span class="line">    expectMap.put(<span class="string">&quot;integer&quot;</span>, <span class="number">212</span>);</span><br><span class="line">    assertThat(map).asInstanceOf(MAP)</span><br><span class="line">            .doesNotContainKey(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">            .hasSize(<span class="number">3</span>)</span><br><span class="line">            .containsExactlyEntriesOf(expectMap);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>自定义构造函数</p>
</blockquote>
<p>参考链接：<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/70143308/cannot-construct-instance-of-com-domain-user-no-creators-like-default-constr">java - Cannot construct instance of <code>com.domain.User</code> (no Creators, like default constructor, exist): cannot deserialize from Object value - Stack Overflow</a></p>
<p>在反序列化时，Jackson 会 <strong>默认</strong> 使用对象的无参构造方法和对应的 Setter 方法。如果 <strong>只</strong> 定义了有参构造方法，没有显式声明无参构造方法，则会在反序列化时抛出 <code>MismatchedInputException</code> 异常，提示没有可用的无参构造方法。</p>
<p>如果想要使用非无参构造方法进行反序列化，可以使用 <code>@JsonCreator</code> 注解指定反序列化时使用的构造方法或者静态工厂方法。</p>
<p>比如要求构造的对象是不可变的，因此在对象所在的类中 <strong>只</strong> 提供了全参构造方法，此时就可以使用 <code>@JsonCreator</code> 注解。</p>
<p><mark>注意：</mark> <code>@JsonCreator</code> 只能作用在静态方法或构造方法，不能在实例方法上使用，因为那时还没构造出对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FieldNameConstants</span></span><br><span class="line"><span class="keyword">record</span> <span class="title class_">Student</span><span class="params">(String stuName, <span class="type">int</span> age, <span class="type">double</span> height, JacksonBasicTest.Student.School school)</span> &#123;</span><br><span class="line">    <span class="meta">@JsonCreator</span></span><br><span class="line">    Student(<span class="meta">@JsonProperty(Fields.stuName)</span> String stuName,</span><br><span class="line">            <span class="meta">@JsonProperty(Fields.age)</span> <span class="type">int</span> age,</span><br><span class="line">            <span class="meta">@JsonProperty(Fields.height)</span> <span class="type">double</span> height,</span><br><span class="line">            <span class="meta">@JsonProperty(Fields.school)</span> School school) &#123;</span><br><span class="line">        <span class="built_in">this</span>.stuName = stuName;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">        <span class="built_in">this</span>.school = school;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@FieldNameConstants</span></span><br><span class="line">    <span class="keyword">record</span> <span class="title class_">School</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="meta">@JsonCreator</span></span><br><span class="line">        School(<span class="meta">@JsonProperty(Fields.name)</span> String name) &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>类中的字段都是不可变的，没有提供无参构造方法，但是有 <code>@JsonCreator</code> 注解的有参构造方法。</p>
<p><mark>注意：</mark> <code>@JsonCreator</code> 需要和 <code>@JsonProperty</code> 注解搭配使用，且 <code>@JsonProperty</code> 注解必须指定 value 属性值。<code>@JsonProperty</code> 注解搭配 Lombok 的 <code>@FieldNameConstants</code> 注解一起“食用”更佳。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJsonCreator</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;stuName&quot;: &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot;: 20,</span></span><br><span class="line"><span class="string">              &quot;height&quot;: 177.5,</span></span><br><span class="line"><span class="string">              &quot;school&quot;: &#123;</span></span><br><span class="line"><span class="string">                &quot;name&quot;: &quot;Test&quot;</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> mapper.readValue(json, Student.class);</span><br><span class="line">    assertThat(student).extracting(</span><br><span class="line">            Student::stuName, Student::age,</span><br><span class="line">            Student::height, i -&gt; i.school().name()</span><br><span class="line">    ).containsExactly(<span class="string">&quot;默烦&quot;</span>, <span class="number">20</span>, <span class="number">177.5</span>, <span class="string">&quot;Test&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外，类似的还有一个 <code>@java.beans.ConstructorProperties</code> 注解（由 JDK 提供），不过只能用在构造方法里，但该注解可以单独使用，无需搭配 <code>@JsonProperty</code> 注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConstructorProperties</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;mofan&quot;,</span></span><br><span class="line"><span class="string">              &quot;personAge&quot;: 20</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> mapper.readValue(json, Person.class);</span><br><span class="line">    assertThat(person).extracting(Person::getPersonName, Person::getPersonAge)</span><br><span class="line">            .containsExactly(<span class="string">&quot;mofan&quot;</span>, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String personName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> personAge;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConstructorProperties(&#123;&quot;name&quot;, &quot;personAge&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> personAge)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.personName = name;</span><br><span class="line">        <span class="built_in">this</span>.personAge = personAge;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@ConstructorProperties</code> 注解的指定的字符串数组与构造方法参数列表一一对应。</p>
<p>比如，<code>@ConstructorProperties(&#123;&quot;name&quot;, &quot;personAge&quot;&#125;)</code> 中的 <code>name</code> 表示将 JSON 中的 <code>name</code> 属性值反序列化为 <code>Person</code> 构造方法中的第一个参数值。</p>
<p>修改构造方法为如下形式，运行测试方法也能得到相同的结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConstructorProperties(&#123;&quot;name&quot;, &quot;personAge&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String personName, <span class="type">int</span> personAge)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.personName = personName;</span><br><span class="line">    <span class="built_in">this</span>.personAge = personAge;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="5-数据类型转换"><a class="header-anchor" href="#5-数据类型转换"></a>5. 数据类型转换</h1>
<h2 id="5-1-类型转换"><a class="header-anchor" href="#5-1-类型转换"></a>5.1 类型转换</h2>
<p>Jackson 有一项很流弊（但并不出名）的功能，就是能够进行任意的 POJO 到 POJO 的转换，其底层实现逻辑是现将原对象转换成 JSON 信息，然后再将 JSON 信息绑定到另一个对象上。</p>
<p>这样的转换有两个步骤：</p>
<ol>
<li>将 POJO 写为 JSON</li>
<li>将 JSON 绑定到另一种 POJO 中。</li>
</ol>
<p>只需：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ResultType</span> <span class="variable">result</span> <span class="operator">=</span> mapper.convertValue(sourceObject, ResultType.class);</span><br></pre></td></tr></table></figure>
<p>尝试一下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConversions</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="comment">// List&lt;Integer&gt; to int[]</span></span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="number">1</span>);</span><br><span class="line">    list.add(<span class="number">2</span>);</span><br><span class="line">    list.add(<span class="number">3</span>);</span><br><span class="line">    assertThat(list).containsExactly(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="type">int</span>[] ints = mapper.convertValue(list, <span class="type">int</span>[].class);</span><br><span class="line">    assertThat(ints).containsExactly(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="comment">// POJO to Map</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;mofan&quot;</span>, <span class="number">19</span>, <span class="number">178.3</span>);</span><br><span class="line">    Map&lt;String, Object&gt; map = mapper.convertValue(user, <span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;&gt;() &#123;</span><br><span class="line">    &#125;);</span><br><span class="line">    assertThat(map).containsExactlyInAnyOrderEntriesOf(Map.of(</span><br><span class="line">            <span class="string">&quot;age&quot;</span>, <span class="number">19</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>, <span class="string">&quot;mofan&quot;</span>,</span><br><span class="line">            <span class="string">&quot;height&quot;</span>, <span class="number">178.3</span></span><br><span class="line">    ));</span><br><span class="line">    <span class="comment">// Map to POJO</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">pojo</span> <span class="operator">=</span> mapper.convertValue(map, User.class);</span><br><span class="line">    assertThat(pojo).extracting(User::getName, User::getAge, User::getHeight)</span><br><span class="line">            .containsExactly(<span class="string">&quot;mofan&quot;</span>, <span class="number">19</span>, <span class="number">178.3</span>);</span><br><span class="line">    <span class="comment">// decode Base64</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">base64</span> <span class="operator">=</span> <span class="string">&quot;bW9mYW4=&quot;</span>;</span><br><span class="line">    <span class="type">byte</span>[] bytes = mapper.convertValue(base64, <span class="type">byte</span>[].class);</span><br><span class="line">    <span class="type">String</span> <span class="variable">decode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytes, StandardCharsets.UTF_8);</span><br><span class="line">    assertThat(decode).isEqualTo(<span class="string">&quot;mofan&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// POJO 转 JsonNode</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">people</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;默烦&quot;</span>, <span class="number">19</span>, <span class="number">177.5</span>);</span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">jsonNode</span> <span class="operator">=</span> mapper.convertValue(people, JsonNode.class);</span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot;: 19,</span></span><br><span class="line"><span class="string">              &quot;height&quot;: 177.5</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(mapper.writeValueAsString(jsonNode)).isEqualTo(expectJson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>🐮 大了，有没有？</p>
<p>甚至还能解码 Base64，如果不知道什么是 Base64，可以在本站搜索【Base64 编码的那些事】查看。</p>
<h2 id="5-2-解析为-Long-类型"><a class="header-anchor" href="#5-2-解析为-Long-类型"></a>5.2 解析为 Long 类型</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLongValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">withLong</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;id1&quot;: &quot;98765432112345&quot;,</span></span><br><span class="line"><span class="string">              &quot;id2&quot;: &quot;98765432112345L&quot;,</span></span><br><span class="line"><span class="string">              &quot;id3&quot;: 98765432112345,</span></span><br><span class="line"><span class="string">              &quot;id4&quot;: &quot;1001&quot;,</span></span><br><span class="line"><span class="string">              &quot;id5&quot;: &quot;1001L&quot;,</span></span><br><span class="line"><span class="string">              &quot;id6&quot;: 1001</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">ObjectNode</span> <span class="variable">objectNode</span> <span class="operator">=</span> ((ObjectNode) mapper.readTree(withLong));</span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">id1</span> <span class="operator">=</span> objectNode.get(<span class="string">&quot;id1&quot;</span>);</span><br><span class="line">    assertThat(id1.isLong()).isFalse();</span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">id2</span> <span class="operator">=</span> objectNode.get(<span class="string">&quot;id2&quot;</span>);</span><br><span class="line">    assertThat(id2.isLong()).isFalse();</span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">id3</span> <span class="operator">=</span> objectNode.get(<span class="string">&quot;id3&quot;</span>);</span><br><span class="line">    assertThat(id3.isLong()).isTrue();</span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">id4</span> <span class="operator">=</span> objectNode.get(<span class="string">&quot;id4&quot;</span>);</span><br><span class="line">    assertThat(id4.isLong()).isFalse();</span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">id5</span> <span class="operator">=</span> objectNode.get(<span class="string">&quot;id5&quot;</span>);</span><br><span class="line">    assertThat(id5.isLong()).isFalse();</span><br><span class="line">    <span class="type">JsonNode</span> <span class="variable">id6</span> <span class="operator">=</span> objectNode.get(<span class="string">&quot;id6&quot;</span>);</span><br><span class="line">    assertThat(id6.isLong()).isFalse();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>针对整型数字转换时，如果数字小于 <code>Integer.MAX_VALUE</code> 就会转换成 <code>Integer</code>，而不是 <code>Long</code>。</p>
<h1 id="6-建造者模式"><a class="header-anchor" href="#6-建造者模式"></a>6. 建造者模式</h1>
<h2 id="6-1-简单使用"><a class="header-anchor" href="#6-1-简单使用"></a>6.1 简单使用</h2>
<p>有时会使用建造者模式来构造对象，那如何使用 Jackson 将给定 JSON 信息反序列化成使用了建造者模式的类对应的对象呢？</p>
<p>需要使用到两个注解：</p>
<ul>
<li><code>@JsonDeserialize</code>：使用 <code>builder</code> 指定使用哪个建造者进行反序列化</li>
<li><code>@JsonPOJOBuilder</code>：标记具体的建造者。默认情况下，要求建造者的建造方法名为 <code>build</code>，设置值的方法前缀是 <code>with</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@JsonDeserialize(builder = Person.Builder.class)</span></span><br><span class="line"><span class="meta">@AllArgsConstructor(access = AccessLevel.PRIVATE)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 并没有提供 builder() 方法</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonPOJOBuilder</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">        Builder <span class="title function_">withName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Builder <span class="title function_">withAge</span><span class="params">(Integer age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Person <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>(name, age);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JSON</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;name&quot;: &quot;mofan&quot;,</span></span><br><span class="line"><span class="string">          &quot;age&quot;: 21</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimplyUse</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().readValue(JSON, Person.class);</span><br><span class="line">    assertThat(person).extracting(Person::getName, Person::getAge)</span><br><span class="line">            .containsExactly(<span class="string">&quot;mofan&quot;</span>, <span class="number">21</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-2-与-Lombok-结合"><a class="header-anchor" href="#6-2-与-Lombok-结合"></a>6.2 与 Lombok 结合</h2>
<p>实际开发过程中常常使用 Lombok 的 <code>@Builder</code> 注解来实现建造者模式，此时 Jackson 怎么与其结合呢？</p>
<p>Lombok 提供了 <code>@Jacksonized</code> 注解来处理这种情况，它是 <code>@Builder</code> 和 <code>@SuperBuilder</code> 的附加注解，也就是说 <code>@Jacksonized</code> 必须与 <code>@Builder</code> 或 <code>@SuperBuilder</code> 注解一起使用才有效，<code>@Jacksonized</code> 注解能对 Lombok 生成的建造者类进行一些配置，以供 Jackson 反序列化使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Jacksonized</span></span><br><span class="line"><span class="meta">@Builder(builderMethodName = &quot;hiddenBuilder&quot;)</span></span><br><span class="line"><span class="meta">@AllArgsConstructor(access = AccessLevel.PRIVATE)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="meta">@JsonProperty(&quot;studentName&quot;)</span></span><br><span class="line">    <span class="meta">@JsonAlias(&#123;&quot;stuName&quot;, &quot;stu_name&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StudentBuilder <span class="title function_">builder</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hiddenBuilder().name(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FIRST_STUDENT_JSON</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;studentName&quot;: &quot;mofan&quot;,</span></span><br><span class="line"><span class="string">          &quot;age&quot;: 21</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SECOND_STUDENT_JSON</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;stu_name&quot;: &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">          &quot;age&quot;: 0</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUseWithLombok</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    assertThat(mapper.readValue(FIRST_STUDENT_JSON, Student.class))</span><br><span class="line">            .extracting(Student::getName, Student::getAge)</span><br><span class="line">            .containsExactly(<span class="string">&quot;mofan&quot;</span>, <span class="number">21</span>);</span><br><span class="line">    <span class="comment">// 测试别名</span></span><br><span class="line">    assertThat(mapper.readValue(SECOND_STUDENT_JSON, Student.class))</span><br><span class="line">            .extracting(Student::getName, Student::getAge)</span><br><span class="line">            .containsExactly(<span class="string">&quot;默烦&quot;</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://projectlombok.org/features/experimental/Jacksonized">@Jacksonized </a> 做了下列这些事：</p>
<ul>
<li>配置 Jackson 反序列化使用的建造者类，即自动在原始类上添加 <code>@JsonDeserialize</code> 注解，并指定其 <code>builder</code> 的值为 Lombok 生成的建造者类；</li>
<li>将原始类上与 Jackson 相关的注解复制到建造者类上，比如 <code>@JsonProperty</code>、<code>@JsonAlias</code> 等注解，以便  Jackson 在使用建造者类时能够识别到它们；</li>
<li>插入 <code>@JsonPOJOBuilder(withPrefix=&quot;&quot;)</code> 注解在构造器类上，覆盖默认使用 <code>with</code> 作为设置值方法的前缀的设置。如果配置了 <code>@Builder</code> 注解的 <code>setterPrefix</code> 值或 <code>buildMethodName</code> 值，这些配置也会同步到插入；</li>
<li>对 <code>@SuperBuilder</code> 注解，将构造器的实现类设置为 <code>private</code>。</li>
</ul>
<p>额外补充一点：如果 JSON 信息中的字段名与目标对象中的字段名不一样，<code>@JsonProperty</code> 注解应该标记在建造者类的字段上，而不是原始类的字段上，除此之外，使用 <code>@JsonAlias</code> 注解设置字段别名时，该字段必须已经被 <code>@JsonProperty</code> 标记。</p>
<h1 id="7-不仅仅是-JSON"><a class="header-anchor" href="#7-不仅仅是-JSON"></a>7. 不仅仅是 JSON</h1>
<p>Jackson 除了用于处理 JSON 外，还提供了一系列拓展用来处理不同类型的配置文件，比如 YAML、XML、BSON、Properties、TOML 等等，使用时需要引入额外的依赖，本节以最常见的 YAML 与 XML 为例。</p>
<h2 id="7-1-处理-YAML"><a class="header-anchor" href="#7-1-处理-YAML"></a>7.1 处理 YAML</h2>
<p>YAML 是 JSON 的超集，Jackson 既然能够解析 JSON，那么 YAML 也自然不在话下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-yaml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>GitHub 仓库 README：<a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson-dataformats-text/tree/master/yaml">FasterXML/jackson-dataformats-text</a></p>
<p>处理方式与处理 JSON 类似，只不过使用的不再是 <code>ObjectMapper</code>，而是其子类 <code>YAMLMapper</code>（其实处理 JSON 使用的也是 <code>ObjectMapper</code> 的子类，名为 <code>JsonMapper</code>）。</p>
<p>比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.</span></span><br><span class="line"><span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">YAMLMapper</span>();</span><br><span class="line"><span class="comment">// 2.</span></span><br><span class="line"><span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>(<span class="keyword">new</span> <span class="title class_">YAMLFactory</span>());</span><br><span class="line"><span class="comment">// 3.</span></span><br><span class="line"><span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> YAMLMapper.builder().build();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>写入与读取</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">File</span> <span class="variable">YAML_FILE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;test.yaml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">YamlObject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String str;</span><br><span class="line">    <span class="keyword">private</span> Integer integer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWrite</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">YAMLMapper</span>();</span><br><span class="line">    <span class="type">YamlObject</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">YamlObject</span>();</span><br><span class="line">    object.setStr(<span class="string">&quot;string&quot;</span>);</span><br><span class="line">    object.setInteger(<span class="number">212</span>);</span><br><span class="line">    <span class="comment">// 写入 test.yaml 文件中</span></span><br><span class="line">    mapper.writeValue(YAML_FILE, object);</span><br><span class="line">    assertThat(YAML_FILE).isNotEmpty();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRead</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>(<span class="keyword">new</span> <span class="title class_">YAMLFactory</span>());</span><br><span class="line">    <span class="type">YamlObject</span> <span class="variable">value</span> <span class="operator">=</span> mapper.readValue(YAML_FILE, YamlObject.class);</span><br><span class="line">    assertThat(value).extracting(YamlObject::getStr, YamlObject::getInteger)</span><br><span class="line">            .containsExactly(<span class="string">&quot;string&quot;</span>, <span class="number">212</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-2-处理-XML"><a class="header-anchor" href="#7-2-处理-XML"></a>7.2 处理 XML</h2>
<p>处理 XML 也需要先导入 Jackson 拓展依赖，同时选择 Woodstox 作为 XML 类库，而不是 JDK 自身提供的实现：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用 Woodstox 作为 XML 类库--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.woodstox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>woodstox-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>GitHub 仓库：<a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson-dataformat-xml">FasterXML/jackson-dataformat-xml</a></p>
<p>处理 XML 使用的也是 <code>ObjectMapper</code> 的子类，名为 <code>XmlMapper</code>，构造 <code>XmlMapper</code> 的方式也有很多，但更推荐以下更简单易用的方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.</span></span><br><span class="line"><span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlMapper</span>();</span><br><span class="line"><span class="comment">// 2. </span></span><br><span class="line"><span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> XmlMapper.builder().build();</span><br></pre></td></tr></table></figure>
<p>至于 <code>new ObjectMapper(new XmlFactory())</code> 的创建方式无法做到开箱即用，需要进行额外的配置。</p>
<blockquote>
<p>写入与读取</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">File</span> <span class="variable">XML_FILE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;test.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">XmlObject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line">    <span class="keyword">private</span> Integer integer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWrite</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlMapper</span>();</span><br><span class="line">    <span class="type">XmlObject</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlObject</span>();</span><br><span class="line">    object.setString(<span class="string">&quot;string&quot;</span>);</span><br><span class="line">    object.setInteger(<span class="number">212</span>);</span><br><span class="line">    mapper.writeValue(XML_FILE, object);</span><br><span class="line">    assertThat(XML_FILE).isNotEmpty();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRead</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> XmlMapper.builder().build();</span><br><span class="line">    <span class="type">XmlObject</span> <span class="variable">value</span> <span class="operator">=</span> mapper.readValue(XML_FILE, XmlObject.class);</span><br><span class="line">    assertThat(value).extracting(XmlObject::getString, XmlObject::getInteger)</span><br><span class="line">            .containsExactly(<span class="string">&quot;string&quot;</span>, <span class="number">212</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>test.xml</code> 的文件内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">XmlObject</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>string<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;<span class="name">integer</span>&gt;</span>212<span class="tag">&lt;/<span class="name">integer</span>&gt;</span><span class="tag">&lt;/<span class="name">XmlObject</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>相关的几个注解</p>
</blockquote>
<ul>
<li>
<p><code>@JacksonXmlRootElement</code>：<code>namespace</code> 属性用于指定 XML 标签中 <code>xmlns</code> 的值，显式设置 <code>namespace</code> 的值后，其内部子标签都将增加 <code>xmlns</code> 属性。<code>localName</code> 属性指定 XML 标签的名称。</p>
</li>
<li>
<p><code>@JacksonXmlProperty</code>：<code>namespace</code> 属性用于指定 XML 标签中 <code>xmlns</code> 的值。<code>localName</code> 属性指定 XML 标签的名称。<code>isAttribute</code> 指定当前字段是否作为父标签的属性，默认为 <code>false</code>，表示作为父标签的子标签。</p>
</li>
<li>
<p><code>@JacksonXmlText</code>：将字段值直接作为普通文本。</p>
</li>
<li>
<p><code>@JacksonXmlCData</code>：将字段值包裹在 <code>CDATA</code> 标签中。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JacksonXmlRootElement(localName = &quot;Root&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AnnotationTestObject</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line">    <span class="keyword">private</span> Integer integer;</span><br><span class="line">    <span class="keyword">private</span> Double decimal;</span><br><span class="line">    <span class="meta">@JacksonXmlText</span></span><br><span class="line">    <span class="keyword">private</span> String str;</span><br><span class="line">    <span class="meta">@JacksonXmlCData</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="meta">@JacksonXmlProperty(isAttribute = true)</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAnnotation</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">AnnotationTestObject</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationTestObject</span>();</span><br><span class="line">    object.setString(<span class="string">&quot;string&quot;</span>);</span><br><span class="line">    object.setInteger(<span class="number">212</span>);</span><br><span class="line">    object.setDecimal(<span class="number">3.14</span>);</span><br><span class="line">    object.setStr(<span class="string">&quot;str&quot;</span>);</span><br><span class="line">    object.setCode(<span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line">    object.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1672502400000L</span>));</span><br><span class="line"></span><br><span class="line">    <span class="type">XmlMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> XmlMapper.builder()</span><br><span class="line">            <span class="comment">// 格式化输出</span></span><br><span class="line">            .enable(SerializationFeature.INDENT_OUTPUT)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;xml-annotation.xml&quot;</span>);</span><br><span class="line">    mapper.writeValue(file, object);</span><br><span class="line">    assertThat(file).isNotEmpty();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>xml-annotation.xml</code> 的文件内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Root</span> <span class="attr">date</span>=<span class="string">&quot;2022-12-31&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">string</span>&gt;</span>string<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">integer</span>&gt;</span>212<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">decimal</span>&gt;</span>3.14<span class="tag">&lt;/<span class="name">decimal</span>&gt;</span>str</span><br><span class="line">  <span class="tag">&lt;<span class="name">code</span>&gt;</span>&lt;![CDATA[hello world!]]&gt;<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="8-更多注解"><a class="header-anchor" href="#8-更多注解"></a>8. 更多注解</h1>
<table>
<thead>
<tr>
<th style="text-align:center">注解</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">@JacksonAnnotation</td>
<td style="text-align:center">Jackson 注解的元注解，用于标记当前注解是 Jackson 注解的一部分</td>
</tr>
<tr>
<td style="text-align:center">@JacksonAnnotationsInside</td>
<td style="text-align:center">将多个 Jackson 注解组合成一个自定义注解</td>
</tr>
</tbody>
</table>
<h1 id="9-杂项补充"><a class="header-anchor" href="#9-杂项补充"></a>9. 杂项补充</h1>
<h2 id="9-1-JsonAutoDetect"><a class="header-anchor" href="#9-1-JsonAutoDetect"></a>9.1 JsonAutoDetect</h2>
<p>默认情况下，Jackson 使用 <code>public</code> 的字段、<code>public</code> 的 Getter/Setter 进行序列化或反序列化。</p>
<p>这种可见性规则是可以显示指定的，比如在第三方类库中很可能存在不符合默认序列化要求的类，但又想让其能够被序列化或反序列化，此时可以显示指定 Jackson 的 <code>JsonAutoDetect</code> 可见性规则。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Student <span class="title function_">of</span><span class="params">(String name, Integer age)</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student.name = name;</span><br><span class="line">        student.age = age;</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJsonAutoDetect</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="comment">// 也可以在目标类上使用 @JsonAutoDetect 注解</span></span><br><span class="line">    mapper.setVisibility(</span><br><span class="line">            mapper.getVisibilityChecker()</span><br><span class="line">                    <span class="comment">// 利用反射，不依赖 Getter/Setter</span></span><br><span class="line">                    .withFieldVisibility(JsonAutoDetect.Visibility.ANY)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> Student.of(<span class="string">&quot;默烦&quot;</span>, <span class="number">21</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(student);</span><br><span class="line">    JsonAssert.with(json)</span><br><span class="line">            .assertEquals(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;默烦&quot;</span>)</span><br><span class="line">            .assertEquals(<span class="string">&quot;age&quot;</span>, <span class="number">21</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 反序列化时必须要求有无参构造或者 Jackson 注解显式指定的用于反序列化的构造器</span></span><br><span class="line">    assertThat(mapper.readValue(json, Student.class))</span><br><span class="line">            .extracting(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>)</span><br><span class="line">            .containsExactly(<span class="string">&quot;默烦&quot;</span>, <span class="number">21</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-2-属性忽略"><a class="header-anchor" href="#9-2-属性忽略"></a>9.2 属性忽略</h2>
<p>在序列化或反序列化过程中经常会遇到忽略某种或某个属性的情况，在此对这种情况的实现进行一个总结。</p>
<blockquote>
<p>只序列化不为 <code>null</code> 的属性</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>反序列化时忽略在 JSON 中存在、而在 Java 类中不存在的属性</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>利用注解简单实现属性忽略</p>
</blockquote>
<ul>
<li><code>@JsonIgnore</code>：使被标记的字段或属性不会被序列化、反序列化</li>
<li><code>@JsonIgnoreProperties</code>：使指定的多个属性不会被序列化、反序列化</li>
<li><code>@JsonIgnoreType</code>：使某种类型不会被序列化或反序列化</li>
</ul>
<p>使用方式可以参考：<a target="_blank" rel="noopener" href="https://github.com/mofan212/jackson-study/blob/master/src/test/java/indi/mofan/test/JsonIgnoreTest.java">JsonIgnoreTest.java</a></p>
<blockquote>
<p>利用 <code>@JsonFilter</code> 实现序列化或反序列化的单一属性忽略</p>
</blockquote>
<p>某些情况下可能只要求在序列化（或反序列化）时进行属性忽略，而在反序列化（或序列化）时不进行属性忽略，此时可以使用 <code>@JsonFilter</code> 指定自定义的过滤器。</p>
<p>比如要求不序列化 <code>Person</code> 的 <code>idCardNum</code> 字段、<code>Person</code> 中 <code>company</code> 字段的 <code>location</code> 字段，需要先使用 <code>@JsonFilter</code> 注解指定过滤器名称：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JsonFilter(&quot;idCardNumFilter&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String idCardNum;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String otherSensitiveInfo;</span><br><span class="line">    <span class="meta">@JsonFilter(&quot;locationFilter&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Company company;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Company</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于指定的过滤器名称，要求在 <code>ObjectMapper</code> 对象中一定要存在同名的过滤器，否则运行时抛出 <code>JsonMappingException</code> 异常，提示没有配置指定名称的过滤器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJsonFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SimpleFilterProvider</span> <span class="variable">filterProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleFilterProvider</span>();</span><br><span class="line">    <span class="comment">// 序列化时忽略 idCardNum 字段</span></span><br><span class="line">    filterProvider.addFilter(<span class="string">&quot;idCardNumFilter&quot;</span>, SimpleBeanPropertyFilter.serializeAllExcept(<span class="string">&quot;idCardNum&quot;</span>))</span><br><span class="line">            .addFilter(<span class="string">&quot;locationFilter&quot;</span>, SimpleBeanPropertyFilter.serializeAllExcept(<span class="string">&quot;location&quot;</span>));</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    mapper.setFilterProvider(filterProvider);</span><br><span class="line"></span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">    person.setName(<span class="string">&quot;默烦&quot;</span>);</span><br><span class="line">    person.setAge(<span class="number">21</span>);</span><br><span class="line">    person.setIdCardNum(<span class="string">&quot;XXX&quot;</span>);</span><br><span class="line">    person.setOtherSensitiveInfo(<span class="string">&quot;ABC&quot;</span>);</span><br><span class="line">    <span class="type">Company</span> <span class="variable">company</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Company</span>();</span><br><span class="line">    company.setName(<span class="string">&quot;百年不倒股份有限公司&quot;</span>);</span><br><span class="line">    company.setLocation(<span class="string">&quot;Have a guess&quot;</span>);</span><br><span class="line">    person.setCompany(company);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(person);</span><br><span class="line">    JsonAssert.with(json).assertNotDefined(<span class="string">&quot;idCardNum&quot;</span>)</span><br><span class="line">            .assertNotDefined(<span class="string">&quot;otherSensitiveInfo&quot;</span>)</span><br><span class="line">            .assertNotDefined(<span class="string">&quot;$.company.location&quot;</span>)</span><br><span class="line">            .assertThat(<span class="string">&quot;$.name&quot;</span>, equalTo(<span class="string">&quot;默烦&quot;</span>))</span><br><span class="line">            .assertThat(<span class="string">&quot;$.age&quot;</span>, equalTo(<span class="number">21</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//language=JSON</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">deserializedJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;age&quot;: 21,</span></span><br><span class="line"><span class="string">              &quot;idCardNum&quot;: &quot;XXX&quot;,</span></span><br><span class="line"><span class="string">              &quot;otherSensitiveInfo&quot;: &quot;ABC&quot;,</span></span><br><span class="line"><span class="string">              &quot;company&quot;: &#123;</span></span><br><span class="line"><span class="string">                &quot;name&quot;: &quot;百年不倒股份有限公司&quot;,</span></span><br><span class="line"><span class="string">                &quot;location&quot;: &quot;UNKNOWN&quot;</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="type">Person</span> <span class="variable">newPerson</span> <span class="operator">=</span> mapper.readValue(deserializedJson, Person.class);</span><br><span class="line">    assertThat(newPerson).hasNoNullFieldsOrPropertiesExcept(<span class="string">&quot;otherSensitiveInfo&quot;</span>)</span><br><span class="line">            .extracting(<span class="string">&quot;idCardNum&quot;</span>, <span class="string">&quot;company.location&quot;</span>)</span><br><span class="line">            .containsExactly(<span class="string">&quot;XXX&quot;</span>, <span class="string">&quot;UNKNOWN&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接在目标类上添加注解来实现属性忽略将作用于全局，而在某些极端场景下要求只在该场景进行属性忽略，此时可以使用 Jackson 的 Mix-in 特性来实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SimpleObj</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String a;</span><br><span class="line">    <span class="keyword">private</span> String b;</span><br><span class="line">    <span class="keyword">private</span> String c;</span><br><span class="line">    <span class="keyword">private</span> String d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比如只要求不序列化 <code>c</code>、<code>d</code> 字段，对 <code>a</code>、<code>b</code> 字段依旧照常序列化，那么可以先定义 Mix-in 类，在该类上使用 <code>@JsonFilter</code> 指定过滤器，而后使 MixIn 类“混入”目标类 <code>SimpleObj</code> 以实现这种极端场景：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonFilter(&quot;selectiveFilter&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SelectiveFilterMixIn</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectiveFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SimpleObj</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleObj</span>();</span><br><span class="line">    obj.setA(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    obj.setB(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">    obj.setC(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">    obj.setD(<span class="string">&quot;d&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">SimpleFilterProvider</span> <span class="variable">provider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleFilterProvider</span>();</span><br><span class="line">    provider.addFilter(<span class="string">&quot;selectiveFilter&quot;</span>, SimpleBeanPropertyFilter.serializeAllExcept(<span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>));</span><br><span class="line">    mapper.setFilterProvider(provider)</span><br><span class="line">        .addMixIn(SimpleObj.class, SelectiveFilterMixIn.class);</span><br><span class="line">    JsonAssert.with(mapper.writeValueAsString(obj))</span><br><span class="line">        .assertNotDefined(<span class="string">&quot;c&quot;</span>)</span><br><span class="line">        .assertNotDefined(<span class="string">&quot;d&quot;</span>)</span><br><span class="line">        .assertEquals(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">        .assertEquals(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;b&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-3-Mix-in"><a class="header-anchor" href="#9-3-Mix-in"></a>9.3 Mix-in</h2>
<p>在【8.2 属性忽略】中首次接触到了 Mix-in，Mix-in 可直译为“混入”，是一种将注解与类向关联的方式，而无需修改目标类本身，旨在帮助用户将某些 Jackson 的注解添加到无法修改源码的第三方类库中的类上。</p>
<p>可供参考的官方链接：<a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson-docs/wiki/JacksonMixInAnnotations">JacksonMixInAnnotations · FasterXML/jackson-docs Wiki</a></p>
<blockquote>
<p>序列化第三方类库中的类</p>
</blockquote>
<p>除了修改 Jackson 的 <code>JsonAutoDetect</code> 可见性规则来使第三方类库中的类可被序列化之外，还可以使用 Mix-in 实现。</p>
<p>假设有一第三方类库中的类为 <code>Person</code>，所有字段均为 <code>private</code>，并且没有提供任何公共的 Getter/Setter，也没有无参构造，显然无法使用 Jackson 的默认序列化规则对其进行序列化或反序列化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String firstName, String lastName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">        <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建 <code>Person</code> 的 Mix-in 类，使它具有与 <code>Person</code> 相同的字段，使用合适的注解指定其被序列化或反序列化使用的信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PersonMixIn</span> &#123;</span><br><span class="line">    <span class="meta">@JsonProperty</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String firstName;</span><br><span class="line">    <span class="meta">@JsonProperty</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonCreator</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PersonMixIn</span><span class="params">(<span class="meta">@JsonProperty(&quot;firstName&quot;)</span> String firstName, <span class="meta">@JsonProperty(&quot;lastName&quot;)</span> String lastName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">        <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来关联 <code>Person</code> 类与其 Mix-in 类，使得 <code>Person</code> 能够被序列化或反序列化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSerializeThirdPartyObject</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;默&quot;</span>, <span class="string">&quot;烦&quot;</span>);</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    assertThatThrownBy(() -&gt; mapper.writeValueAsString(person))</span><br><span class="line">            .isInstanceOf(InvalidDefinitionException.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// configure-first-then-use，new 一个新的 ObjectMapper 对象</span></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">anotherMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    anotherMapper.addMixIn(Person.class, PersonMixIn.class);</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> anotherMapper.writeValueAsString(person);</span><br><span class="line">    JsonAssert.with(json).assertThat(<span class="string">&quot;$.firstName&quot;</span>, equalTo(<span class="string">&quot;默&quot;</span>))</span><br><span class="line">            .assertThat(<span class="string">&quot;$.lastName&quot;</span>, equalTo(<span class="string">&quot;烦&quot;</span>));</span><br><span class="line">    <span class="type">Person</span> <span class="variable">newPerson</span> <span class="operator">=</span> anotherMapper.readValue(json, Person.class);</span><br><span class="line">    assertThat(newPerson).extracting(<span class="string">&quot;firstName&quot;</span>, <span class="string">&quot;lastName&quot;</span>)</span><br><span class="line">            .containsExactly(<span class="string">&quot;默&quot;</span>, <span class="string">&quot;烦&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>序列化时忽略、改变第三方类库中类的属性</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String idCardNum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">StudentMixIn</span> &#123;</span><br><span class="line">    <span class="meta">@JsonProperty(&quot;NAME&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String idCardNum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIgnoreAndChangeThirdPartyObjectProperties</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setName(<span class="string">&quot;默烦&quot;</span>);</span><br><span class="line">    student.setIdCardNum(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    mapper.addMixIn(Student.class, StudentMixIn.class);</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(student);</span><br><span class="line">    JsonAssert.with(json).assertNotDefined(<span class="string">&quot;idCardNum&quot;</span>)</span><br><span class="line">            .assertThat(<span class="string">&quot;$.NAME&quot;</span>, equalTo(<span class="string">&quot;默烦&quot;</span>));</span><br><span class="line">    <span class="type">Student</span> <span class="variable">newStu</span> <span class="operator">=</span> mapper.readValue(json, Student.class);</span><br><span class="line">    assertThat(newStu).extracting(<span class="string">&quot;name&quot;</span>).isEqualTo(<span class="string">&quot;默烦&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>修改自定义序列化器、反序列化器</p>
</blockquote>
<p>某些情况下要求某个类在序列化或反序列化时不使用其默认的序列化器或反序列化器，这种需求也可以使用 Mix-in 实现。</p>
<p>比如 <code>People</code> 默认的序列化器是 <code>PeopleSerializer</code>，默认的反序列化器是 <code>PeopleDeserializer</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEPARATOR</span> <span class="operator">=</span> <span class="string">&quot;-&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(of = &#123;&quot;realName&quot;, &quot;nickName&quot;&#125;)</span></span><br><span class="line"><span class="meta">@JsonSerialize(using = People.PeopleSerializer.class)</span></span><br><span class="line"><span class="meta">@JsonDeserialize(using = People.PeopleDeserializer.class)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">People</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String realName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String nickName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonCreator</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">People</span><span class="params">(<span class="meta">@JsonProperty</span> String realName, <span class="meta">@JsonProperty</span> String nickName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.realName = realName;</span><br><span class="line">        <span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PeopleSerializer</span> <span class="keyword">extends</span> <span class="title class_">JsonSerializer</span>&lt;People&gt; &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(People people, JsonGenerator jsonGenerator, SerializerProvider serializerProvider)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="comment">// 序列化时，先真实姓名再昵称</span></span><br><span class="line">            jsonGenerator.writeString(people.getRealName() + SEPARATOR + people.getNickName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PeopleDeserializer</span> <span class="keyword">extends</span> <span class="title class_">JsonDeserializer</span>&lt;People&gt; &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> People <span class="title function_">deserialize</span><span class="params">(JsonParser jsonParser, DeserializationContext deserializationContext)</span> <span class="keyword">throws</span> IOException, JacksonException &#123;</span><br><span class="line">            String[] split = jsonParser.getValueAsString().split(SEPARATOR);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">People</span>(split[<span class="number">0</span>], split[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在要求修改这种默认配置，而使用用户自定义的配置，同样是创建对应的 Mix-in 类（或接口），然后添加自定义配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonSerialize(using = PeopleMixIn.AnotherPeopleSerializer.class)</span></span><br><span class="line"><span class="meta">@JsonDeserialize(using = PeopleMixIn.AnotherPeopleDeserializer.class)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">PeopleMixIn</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AnotherPeopleSerializer</span> <span class="keyword">extends</span> <span class="title class_">JsonSerializer</span>&lt;People&gt; &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(People people, JsonGenerator jsonGenerator, SerializerProvider serializerProvider)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="comment">// 序列化时，先昵称再真实姓名</span></span><br><span class="line">            jsonGenerator.writeString(people.getNickName() + SEPARATOR + people.getRealName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AnotherPeopleDeserializer</span> <span class="keyword">extends</span> <span class="title class_">JsonDeserializer</span>&lt;People&gt; &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> People <span class="title function_">deserialize</span><span class="params">(JsonParser jsonParser, DeserializationContext deserializationContext)</span> <span class="keyword">throws</span> IOException, JacksonException &#123;</span><br><span class="line">            String[] split = jsonParser.getValueAsString().split(SEPARATOR);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">People</span>(split[<span class="number">1</span>], split[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testChangeCustomSerializer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;默烦&quot;</span>, <span class="string">&quot;mofan212&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> mapper.writeValueAsString(people);</span><br><span class="line">    assertThat(str).isEqualTo(<span class="string">&quot;\&quot;默烦-&gt;mofan212\&quot;&quot;</span>);</span><br><span class="line">    <span class="type">People</span> <span class="variable">newPeople</span> <span class="operator">=</span> mapper.readValue(str, People.class);</span><br><span class="line">    assertThat(newPeople).isEqualTo(people);</span><br><span class="line"></span><br><span class="line">    mapper = <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    mapper.addMixIn(People.class, PeopleMixIn.class);</span><br><span class="line">    str = mapper.writeValueAsString(people);</span><br><span class="line">    assertThat(str).isEqualTo(<span class="string">&quot;\&quot;mofan212-&gt;默烦\&quot;&quot;</span>);</span><br><span class="line">    newPeople = mapper.readValue(str, People.class);</span><br><span class="line">    assertThat(newPeople).isEqualTo(people);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-4-序列化中的循环引用"><a class="header-anchor" href="#9-4-序列化中的循环引用"></a>9.4 序列化中的循环引用</h2>
<p>当 A 对象依赖 B 对象，B 对象有依赖 A 对象，且相同对象都指向同一个内存地址时，此时对 A 对象进行序列化就会产生 <code>StackOverflowError</code> 错误，要想解决这个问题，就需要切断对象间的循环引用，可以使用这几个方式：</p>
<ol>
<li>序列化时忽略相互引用的字段</li>
<li>使用 <code>@JsonIdentityInfo</code> 注解序列化循环引用的标识符，而不是序列化完整对象</li>
<li>使用 <code>@JsonBackReference</code> 注解指定引用关系</li>
</ol>
<blockquote>
<p>忽略相互引用的字段</p>
</blockquote>
<p>使用 <code>@JsonIgnoreProperties</code> 注解忽略相互引用的字段：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line">    <span class="keyword">private</span> Role role;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Role</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@JsonIgnoreProperties(&quot;role&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCircularReference</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUsername(<span class="string">&quot;mofan&quot;</span>);</span><br><span class="line">    user.setPwd(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Role</span>();</span><br><span class="line">    role.setName(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    role.setUsers(List.of(user));</span><br><span class="line"></span><br><span class="line">    user.setRole(role);</span><br><span class="line"></span><br><span class="line">    <span class="type">JsonMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> JsonMapper.builder().build();</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(user);</span><br><span class="line">    <span class="comment">// language=JSON</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;username&quot;: &quot;mofan&quot;,</span></span><br><span class="line"><span class="string">              &quot;pwd&quot;: &quot;123456&quot;,</span></span><br><span class="line"><span class="string">              &quot;role&quot;: &#123;</span></span><br><span class="line"><span class="string">                &quot;name&quot;: &quot;admin&quot;,</span></span><br><span class="line"><span class="string">                &quot;users&quot;: [</span></span><br><span class="line"><span class="string">                  &#123;</span></span><br><span class="line"><span class="string">                    &quot;username&quot;: &quot;mofan&quot;,</span></span><br><span class="line"><span class="string">                    &quot;pwd&quot;: &quot;123456&quot;</span></span><br><span class="line"><span class="string">                  &#125;</span></span><br><span class="line"><span class="string">                ]</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(json).isEqualTo(expectJson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样做尽管解决了循环引用，但再次对序列化得到的 JSON 信息进行反序列化时，会造成信息丢失。</p>
<blockquote>
<p>使用 <code>@JsonIdentityInfo</code> 注解</p>
</blockquote>
<p>使用 <code>@JsonIdentityInfo</code> 注解后，在序列化过程中遇到相同引用的对象时，将使用指定的标识符代替该对象，而不是将该对象完整地序列化。</p>
<ul>
<li>
<p>一对一：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JsonIdentityInfo(generator = ObjectIdGenerators.PropertyGenerator.class, property = &quot;id&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Order order;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long orderId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; itemIds;</span><br><span class="line">    <span class="keyword">private</span> Customer customer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimplyUse</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line">    order.setOrderId(<span class="number">1L</span>);</span><br><span class="line">    order.setItemIds(List.of(<span class="number">10</span>, <span class="number">30</span>));</span><br><span class="line"></span><br><span class="line">    <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>();</span><br><span class="line">    customer.setId(<span class="number">2L</span>);</span><br><span class="line">    customer.setName(<span class="string">&quot;Peter&quot;</span>);</span><br><span class="line">    <span class="comment">// customer 依赖 order</span></span><br><span class="line">    customer.setOrder(order);</span><br><span class="line">    <span class="comment">// order 又依赖 custom，出现依赖循环</span></span><br><span class="line">    order.setCustomer(customer);</span><br><span class="line"></span><br><span class="line">    <span class="type">JsonMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> JsonMapper.builder().build();</span><br><span class="line">    <span class="comment">// 序列化</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(customer);</span><br><span class="line">    <span class="comment">// language=json</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;id&quot;: 2,</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;Peter&quot;,</span></span><br><span class="line"><span class="string">              &quot;order&quot;: &#123;</span></span><br><span class="line"><span class="string">                &quot;orderId&quot;: 1,</span></span><br><span class="line"><span class="string">                &quot;itemIds&quot;: [10, 30],</span></span><br><span class="line"><span class="string">                &quot;customer&quot;: 2</span></span><br><span class="line"><span class="string">              &#125;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">             &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// order 虽然依赖了 customer，但在使用 @JsonIdentityInfo 注解后，以指定的 id 作为代替</span></span><br><span class="line">    JsonAssertions.assertThatJson(json).isEqualTo(expectJson);</span><br><span class="line"></span><br><span class="line">    <span class="type">Customer</span> <span class="variable">newCustom</span> <span class="operator">=</span> mapper.readValue(json, Customer.class);</span><br><span class="line">    Assertions.assertThat(newCustom).isEqualTo(newCustom.getOrder().getCustomer()).extracting(</span><br><span class="line">            Customer::getId, Customer::getName,</span><br><span class="line">            i -&gt; i.getOrder().getOrderId(), i -&gt; i.getOrder().getItemIds()</span><br><span class="line">    ).containsSequence(<span class="number">2L</span>, <span class="string">&quot;Peter&quot;</span>, <span class="number">1L</span>, List.of(<span class="number">10</span>, <span class="number">30</span>));</span><br><span class="line">    Assertions.assertThat(newCustom).extracting(i -&gt; i.getOrder().getCustomer())</span><br><span class="line">            .extracting(Customer::getId, Customer::getName)</span><br><span class="line">            .containsSequence(<span class="number">2L</span>, <span class="string">&quot;Peter&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>一对多：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JsonIdentityInfo(generator = ObjectIdGenerators.PropertyGenerator.class, property = &quot;empId&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long empId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Dept&gt; depts;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Dept</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long deptId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Employee&gt; employees;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testOne2Many</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">    employee.setEmpId(<span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Dept</span> <span class="variable">dept1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dept</span>();</span><br><span class="line">    dept1.setDeptId(<span class="number">11L</span>);</span><br><span class="line">    dept1.setEmployees(Collections.singletonList(employee));</span><br><span class="line"></span><br><span class="line">    <span class="type">Dept</span> <span class="variable">dept2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dept</span>();</span><br><span class="line">    dept2.setDeptId(<span class="number">12L</span>);</span><br><span class="line">    dept2.setEmployees(Collections.singletonList(employee));</span><br><span class="line"></span><br><span class="line">    employee.setDepts(List.of(dept1, dept2));</span><br><span class="line"></span><br><span class="line">    <span class="type">JsonMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> JsonMapper.builder().build();</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(employee);</span><br><span class="line">    <span class="comment">// language=json</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;empId&quot;: 1,</span></span><br><span class="line"><span class="string">              &quot;depts&quot;: [</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                  &quot;deptId&quot;: 11,</span></span><br><span class="line"><span class="string">                  &quot;employees&quot;: [1]</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                  &quot;deptId&quot;: 12,</span></span><br><span class="line"><span class="string">                  &quot;employees&quot;: [1]</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">              ]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(json).isEqualTo(expectJson);</span><br><span class="line"></span><br><span class="line">    <span class="type">Employee</span> <span class="variable">newEmp</span> <span class="operator">=</span> mapper.readValue(json, Employee.class);</span><br><span class="line">    Assertions.assertThat(newEmp).extracting(</span><br><span class="line">            i -&gt; i.getDepts().get(<span class="number">0</span>).getEmployees().get(<span class="number">0</span>).getEmpId(),</span><br><span class="line">            i -&gt; i.getDepts().get(<span class="number">1</span>).getEmployees().get(<span class="number">0</span>).getEmpId()</span><br><span class="line">    ).containsSequence(<span class="number">1L</span>, <span class="number">1L</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>@JsonIdentityInfo</code> 注解中的 <code>generator</code> 除了指定为 <code>PropertyGenerator</code> 外，还有其他生成器可供选择，比如：</p>
<ul>
<li><code>StringIdGenerator</code></li>
<li><code>UUIDGenerator</code></li>
<li><code>IntSequenceGenerator</code></li>
</ul>
<p>当然也可以自定义生成器。</p>
<p>使用 <code>IntSequenceGenerator</code> 作为生成器处理自引用关系：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JsonIdentityInfo(generator = ObjectIdGenerators.IntSequenceGenerator.class, property = &quot;@key&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Entity&gt; entities;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIntSequenceGenerator</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Entity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Entity</span>();</span><br><span class="line">    entity.setName(<span class="string">&quot;Root&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Entity</span> <span class="variable">firstSubEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Entity</span>();</span><br><span class="line">    firstSubEntity.setName(<span class="string">&quot;SubEntity-1&quot;</span>);</span><br><span class="line">    <span class="type">Entity</span> <span class="variable">secondSubEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Entity</span>();</span><br><span class="line">    secondSubEntity.setName(<span class="string">&quot;SubEntity-2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    entity.setEntities(List.of(entity, firstSubEntity, secondSubEntity));</span><br><span class="line"></span><br><span class="line">    <span class="type">JsonMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> JsonMapper.builder().build();</span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;@key&quot;: 1,</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;Root&quot;,</span></span><br><span class="line"><span class="string">              &quot;entities&quot;: [</span></span><br><span class="line"><span class="string">                1,</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                  &quot;@key&quot;: 2,</span></span><br><span class="line"><span class="string">                  &quot;name&quot;: &quot;SubEntity-1&quot;,</span></span><br><span class="line"><span class="string">                  &quot;entities&quot;: null</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                  &quot;@key&quot;: 3,</span></span><br><span class="line"><span class="string">                  &quot;name&quot;: &quot;SubEntity-2&quot;,</span></span><br><span class="line"><span class="string">                  &quot;entities&quot;: null</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">              ]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(mapper.writeValueAsString(entity))</span><br><span class="line">            .isEqualTo(expectJson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用 <code>@JsonBackReference</code> 注解</p>
</blockquote>
<p>使用 <code>@JsonBackReference</code> 注解后进行序列化时，得到的结果与使用了 <code>@JsonIgnore</code> 类似，而与 <code>@JsonManagedReference</code> 注解联合使用指定引用关系时，对先前序列化的结果进行反序列化后，得到的对象信息并不会缺失。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Employer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@JsonManagedReference</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Employee&gt; employees;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@JsonBackReference</span></span><br><span class="line">    <span class="keyword">private</span> Employer employer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">    employee.setName(<span class="string">&quot;mofan&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Employer</span> <span class="variable">employer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employer</span>();</span><br><span class="line">    employer.setName(<span class="string">&quot;默烦&quot;</span>);</span><br><span class="line">    employer.setEmployees(List.of(employee));</span><br><span class="line"></span><br><span class="line">    employee.setEmployer(employer);</span><br><span class="line"></span><br><span class="line">    <span class="type">JsonMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> JsonMapper.builder().build();</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(employer);</span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;name&quot;: &quot;默烦&quot;,</span></span><br><span class="line"><span class="string">              &quot;employees&quot;: [</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                  &quot;name&quot;: &quot;mofan&quot;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">              ]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">// 效果与使用了 @JsonIgnore 类似，没有序列化被 @JsonBackReference 标记的字段</span></span><br><span class="line">    JsonAssertions.assertThatJson(json).isEqualTo(expectJson);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 反序列化呢？在 Employer 中的 employees 上使用 @JsonManagedReference 注解</span></span><br><span class="line">    <span class="type">Employer</span> <span class="variable">value</span> <span class="operator">=</span> mapper.readValue(expectJson, Employer.class);</span><br><span class="line">    assertThat(value.getEmployees()).map(Employee::getEmployer)</span><br><span class="line">            .filteredOn(Objects::nonNull)</span><br><span class="line">            .hasSize(<span class="number">1</span>)</span><br><span class="line">            .map(Employer::getName)</span><br><span class="line">            .singleElement()</span><br><span class="line">            .isEqualTo(<span class="string">&quot;默烦&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-5-对-JDK8-日期时间的支持"><a class="header-anchor" href="#9-5-对-JDK8-日期时间的支持"></a>9.5 对 JDK8 日期时间的支持</h2>
<p>Jackson 也对 JDK8 新增的日期时间类提供了支持，这些支持以 Jackson 模块的形式提供，因此需要导入对应的依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-datatype-jsr310<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>导入依赖后并不是就万事大吉了，还要在使用时注册这些模块。</p>
<p>可以按需单个注册：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapper.addModule(<span class="keyword">new</span> <span class="title class_">JavaTimeModule</span>());</span><br></pre></td></tr></table></figure>
<p>也可以让 Jackson 自己查找并注册所有模块：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapper.findAndRegisterModules();</span><br></pre></td></tr></table></figure>
<p>简单测试下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TimeObject</span> &#123;</span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate localDate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSupportDateTime</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">TimeObject</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TimeObject</span>();</span><br><span class="line">    object.setLocalDate(LocalDate.of(<span class="number">2023</span>, <span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    assertThatThrownBy(() -&gt; <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(object))</span><br><span class="line">            .isExactlyInstanceOf(InvalidDefinitionException.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> JsonMapper.builder()</span><br><span class="line">            .addModule(<span class="keyword">new</span> <span class="title class_">JavaTimeModule</span>())</span><br><span class="line">            .build();</span><br><span class="line">    <span class="type">String</span> <span class="variable">expectJson</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              &quot;localDate&quot;: &quot;2023-01-01&quot;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    JsonAssertions.assertThatJson(mapper.writeValueAsString(object))</span><br><span class="line">            .isEqualTo(expectJson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="9-6-传播-transient"><a class="header-anchor" href="#9-6-传播-transient"></a>9.6 传播 transient</h2>
<p>Java 提供了 <code>transient</code> 关键字用来修饰无需被序列化的字段，但在默认情况下，Jackson 必不认这个关键字，除非开启 <code>MapperFeature.PROPAGATE_TRANSIENT_MARKER</code> 的配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Phone</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="meta">@Serial</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2025192839395117683L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String staticStr;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> BigDecimal price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSerializedPhoneByJackson</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line">    phone.setName(<span class="string">&quot;XiaoMi&quot;</span>);</span><br><span class="line">    phone.setPrice(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;1999.0&quot;</span>));</span><br><span class="line">    Phone.staticStr = <span class="string">&quot;Hello, Thank you&quot;</span>;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(phone);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">except</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                &quot;name&quot;: &quot;XiaoMi&quot;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">    assertThatJson(json)</span><br><span class="line">            .isObject()</span><br><span class="line">            .isNotEqualTo(except)</span><br><span class="line">            .containsEntry(<span class="string">&quot;price&quot;</span>, <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;1999.0&quot;</span>))</span><br><span class="line">            <span class="comment">// 静态字段不会被反序列化</span></span><br><span class="line">            .doesNotContainKey(<span class="string">&quot;staticStr&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不序列化被 transient 修饰的字段</span></span><br><span class="line">    mapper = JsonMapper.builder().configure(MapperFeature.PROPAGATE_TRANSIENT_MARKER, <span class="literal">true</span>).build();</span><br><span class="line">    json = mapper.writeValueAsString(phone);</span><br><span class="line">    assertThatJson(json).isEqualTo(except);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>针对静态字段来说，Jackson 与 Java 的序列化机制一样，也不会序列化静态字段。</p>
<h1 id="10-使用细节"><a class="header-anchor" href="#10-使用细节"></a>10. 使用细节</h1>
<h2 id="10-1-与-Lombok-一起使用可能存在的问题"><a class="header-anchor" href="#10-1-与-Lombok-一起使用可能存在的问题"></a>10.1 与 Lombok 一起使用可能存在的问题</h2>
<p>存在名为 <code>MyFirstData</code> 的类，使用 Lombok 为其生成 Getter/Setter：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyFirstData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String s;</span><br><span class="line">    <span class="keyword">private</span> Integer iAge;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将给定字符串反序列化成 <code>MyFirstData</code> 实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">JsonMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> JsonMapper.builder().build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// language=JSON</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JSON</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;iAge&quot;: 21</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">                    &quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeserializeFirstData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 抛出异常</span></span><br><span class="line">    assertThatExceptionOfType(UnrecognizedPropertyException.class)</span><br><span class="line">            .isThrownBy(() -&gt; mapper.readValue(JSON, MyFirstData.class));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 忽略 JSON 串中存在，Java 类中不存在的字段</span></span><br><span class="line">    <span class="type">JsonMapper</span> <span class="variable">jsonMapper</span> <span class="operator">=</span> JsonMapper.builder()</span><br><span class="line">            .disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">MyFirstData</span> <span class="variable">data</span> <span class="operator">=</span> jsonMapper.readValue(JSON, MyFirstData.class);</span><br><span class="line">        assertThat(data).extracting(MyFirstData::getIAge).isNull();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">MyFirstData</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyFirstData</span>();</span><br><span class="line">    data.setIAge(<span class="number">21</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> mapper.writeValueAsString(data);</span><br><span class="line">    JsonAssertions.assertThatJson(result).isObject()</span><br><span class="line">            <span class="comment">// 不存在 iAge</span></span><br><span class="line">            .doesNotContainKey(<span class="string">&quot;iAge&quot;</span>)</span><br><span class="line">            <span class="comment">// 存在 iage</span></span><br><span class="line">            .containsEntry(<span class="string">&quot;iage&quot;</span>, <span class="number">21</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一次反序列化时抛出了异常，提示无法识别 JSON 串中的 <code>iAge</code> 字段，而后加上停用 <code>DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES</code> 特性再次反序列化时，不再抛出异常，但 <code>MyFirstData</code> 实例中的 <code>iAge</code> 字段值为 <code>null</code>。</p>
<p>新建一个 <code>MyFirstData</code> 实例，对其进行序列化，在得到的 JSON 中不包含 <code>iAge</code> 的字段，而是包含名为 <code>iage</code> 的字段，这是为什么？</p>
<p>这是因为 Lombok 生成的 Setter 与预期不符，查看编译生成的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyFirstData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String s;</span><br><span class="line">    <span class="keyword">private</span> Integer iAge;</span><br><span class="line"></span><br><span class="line">    MyFirstData() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getS</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getIAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.iAge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setS</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.s = s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIAge</span><span class="params">(Integer iAge)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iAge = iAge;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>iAge</code> 字段生成的 Set 方法名为 <code>setIAge</code>，Jackson 在初始化序列器时，会使用 <code>DefaultAccessorNamingStrategy#legacyManglePropertyName()</code> 方法来处理 Getter/Setter，它会将方法的 <code>get/set</code> 前缀移除，将其后面连续大写字符转换为小写字符返回。</p>
<p>如果使用 IDEA 生成的 Getter/Setter 就不会出现这样的问题：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;SpellCheckingInspection&quot;)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MySecondData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer iAge;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getiAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> iAge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setiAge</span><span class="params">(Integer iAge)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iAge = iAge;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeserializeFourthData</span><span class="params">()</span> &#123;</span><br><span class="line">    validDeserializeToTargetClass(MyFourthData.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">validDeserializeToTargetClass</span><span class="params">(Class&lt;T&gt; clazz)</span> &#123;</span><br><span class="line">    <span class="type">T</span> <span class="variable">data</span> <span class="operator">=</span> mapper.readValue(JSON, clazz);</span><br><span class="line">    assertThat(data).isNotNull()</span><br><span class="line">            .extracting(<span class="string">&quot;iAge&quot;</span>)</span><br><span class="line">            .isEqualTo(<span class="number">21</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> mapper.writeValueAsString(data);</span><br><span class="line">    JsonAssertions.assertThatJson(result).isObject().isEqualTo(JSON);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果非要使用 Lombok 生成 Getter/Setter，则需要搭配 <code>@JsonProperty</code> 注解使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyThirdData</span> &#123;</span><br><span class="line">    <span class="meta">@JsonProperty(&quot;iAge&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer iAge;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeserializeThirdData</span><span class="params">()</span> &#123;</span><br><span class="line">    validDeserializeToTargetClass(MyThirdData.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译生成的 <code>MyThirdData</code> 类的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyThirdData</span> &#123;</span><br><span class="line">    <span class="meta">@JsonProperty(&quot;iAge&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer iAge;</span><br><span class="line"></span><br><span class="line">    MyThirdData() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getIAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.iAge;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;iAge&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIAge</span><span class="params">(Integer iAge)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iAge = iAge;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>字段 <code>iAge</code> 和 <code>setIAge()</code> 方法上都使用了 <code>@JsonProperty(&quot;iAge&quot;)</code> 注解。</p>
<p>其实只在 <code>setIAge()</code> 方法上使用 <code>@JsonProperty(&quot;iAge&quot;)</code> 注解即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyFourthData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer iAge;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;iAge&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIAge</span><span class="params">(Integer iAge)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iAge = iAge;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeserializeFourthData</span><span class="params">()</span> &#123;</span><br><span class="line">    validDeserializeToTargetClass(MyFourthData.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mofan212.github.io">默烦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mofan212.github.io/posts/Java-Class-Library-Jackson/">https://mofan212.github.io/posts/Java-Class-Library-Jackson/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mofan212.github.io" target="_blank">Mofan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Jackson/">Jackson</a><a class="post-meta__tags" href="/tags/JSON/">JSON</a></div><div class="post_share"><div class="social-share" data-image="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/74.jpg" data-sites="wechat,qq,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://jsd.onmicrosoft.cn/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/AliPay.png" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/img/AliPay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="/img/WeChatPay.png" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/img/WeChatPay.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/Mockito-In-Action/" title="Mockito 实战"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/75.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Mockito 实战</div></div></a></div><div class="next-post pull-right"><a href="/posts/The-Basics-Of-Redis-Part-Two/" title="【下篇】Redis 基础篇"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/73.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【下篇】Redis 基础篇</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/Quick-Start-To-JSONPath/" title="JSONPath 快速入门"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/130.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-10</div><div class="title">JSONPath 快速入门</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">默烦</div><div class="author-info__description">彩笔的打怪升级之路...</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">150</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/23658864/dynamic"><i class="fas fa-running"></i><span>关注我的B站</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mofan212" target="_blank" title="GitHub"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:cy.mofan@foxmail.com" target="_blank" title="邮箱"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS链接"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本站所有博文均是博主的学习笔记与个人理解。<strong><font style="color:red">除特别注明外，</font>如需转载，请在文章头部醒目处附带原文链接并<a target="_blank" rel="noopener" href="https://mofan212.gitee.io/mine/" style="color:#49B1F5;text-decoration:underline">告知我</a></strong>你将转载。😊</br><strong><font style="color:red">严禁未遵循规范的转载。</font></strong>😡</br><strong>死去的评论系统复活啦！欢迎到留言板畅所欲言！</strong>当然也可以使用更高效的<a target="_blank" href="https://space.bilibili.com/23658864/dynamic" style="color:#49B1F5;text-decoration:underline"> 哔哩哔哩私信 </a>或<a href="mailto:cy.mofan@foxmail.com" style="color:#49B1F5;text-decoration:underline" target="_blank">邮箱</a>。 😉</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Jackson-%E6%A6%82%E8%BF%B0"><span class="toc-text">1. Jackson 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF-Jackson"><span class="toc-text">1.1 什么是 Jackson</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Jackson-%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97"><span class="toc-text">1.2 Jackson 核心模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="toc-text">2. 快速开始</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-ObjectMapper-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2.1 ObjectMapper 的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-JSON-%E6%9D%A5%E6%BA%90"><span class="toc-text">2.2 JSON 来源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E7%AE%80%E5%8D%95-JSON-%E4%B8%B2%E7%9A%84%E8%AF%BB%E5%8F%96"><span class="toc-text">2.3 简单 JSON 串的读取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E6%A0%91%E6%A8%A1%E5%9E%8B"><span class="toc-text">2.4 树模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E8%BD%AC%E6%8D%A2%E6%88%90-JSON-%E4%B8%B2"><span class="toc-text">2.5 转换成 JSON 串</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%B5%81%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-text">3. 流解析器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E6%B5%81%E8%A7%A3%E6%9E%90%E5%99%A8%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="toc-text">3.1 流解析器的概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">3.2 基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%86%99%E5%85%A5-JSON-%E6%95%B0%E6%8D%AE"><span class="toc-text">3.3 写入 JSON 数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E8%AF%BB%E5%8F%96-JSON-%E6%95%B0%E6%8D%AE"><span class="toc-text">3.4 读取 JSON 数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Jackson-%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-text">4. Jackson 的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E9%85%8D%E7%BD%AE%E5%89%8D%E8%A8%80"><span class="toc-text">4.1 配置前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%B8%B8%E7%94%A8%E7%9A%84-Features"><span class="toc-text">4.2 常用的 Features</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E5%B8%B8%E7%94%A8%E7%9A%84-Annotations"><span class="toc-text">4.3 常用的 Annotations</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-text">5. 数据类型转换</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-text">5.1 类型转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E8%A7%A3%E6%9E%90%E4%B8%BA-Long-%E7%B1%BB%E5%9E%8B"><span class="toc-text">5.2 解析为 Long 类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">6. 建造者模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-text">6.1 简单使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E4%B8%8E-Lombok-%E7%BB%93%E5%90%88"><span class="toc-text">6.2 与 Lombok 结合</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E4%B8%8D%E4%BB%85%E4%BB%85%E6%98%AF-JSON"><span class="toc-text">7. 不仅仅是 JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E5%A4%84%E7%90%86-YAML"><span class="toc-text">7.1 处理 YAML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E5%A4%84%E7%90%86-XML"><span class="toc-text">7.2 处理 XML</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E6%9B%B4%E5%A4%9A%E6%B3%A8%E8%A7%A3"><span class="toc-text">8. 更多注解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E6%9D%82%E9%A1%B9%E8%A1%A5%E5%85%85"><span class="toc-text">9. 杂项补充</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-JsonAutoDetect"><span class="toc-text">9.1 JsonAutoDetect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-%E5%B1%9E%E6%80%A7%E5%BF%BD%E7%95%A5"><span class="toc-text">9.2 属性忽略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-Mix-in"><span class="toc-text">9.3 Mix-in</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%AD%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8"><span class="toc-text">9.4 序列化中的循环引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-%E5%AF%B9-JDK8-%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E7%9A%84%E6%94%AF%E6%8C%81"><span class="toc-text">9.5 对 JDK8 日期时间的支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-6-%E4%BC%A0%E6%92%AD-transient"><span class="toc-text">9.6 传播 transient</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E4%BD%BF%E7%94%A8%E7%BB%86%E8%8A%82"><span class="toc-text">10. 使用细节</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E4%B8%8E-Lombok-%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">10.1 与 Lombok 一起使用可能存在的问题</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/The-Basis-Of-Java-Multithreading/" title="学毛线（Thread）的 Java"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/57.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="学毛线（Thread）的 Java"/></a><div class="content"><a class="title" href="/posts/The-Basis-Of-Java-Multithreading/" title="学毛线（Thread）的 Java">学毛线（Thread）的 Java</a><time datetime="2024-07-10T16:00:00.000Z" title="更新于 2024-07-11 00:00:00">2024-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/SpringBoot-Shutdown-Hook/" title="SpringBoot Shutdown Hook"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/141.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringBoot Shutdown Hook"/></a><div class="content"><a class="title" href="/posts/SpringBoot-Shutdown-Hook/" title="SpringBoot Shutdown Hook">SpringBoot Shutdown Hook</a><time datetime="2024-07-10T16:00:00.000Z" title="更新于 2024-07-11 00:00:00">2024-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/LinkedHashMap-In-JDK21/" title="JDK21 中的 LinkedHashMap"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/150.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JDK21 中的 LinkedHashMap"/></a><div class="content"><a class="title" href="/posts/LinkedHashMap-In-JDK21/" title="JDK21 中的 LinkedHashMap">JDK21 中的 LinkedHashMap</a><time datetime="2024-07-06T16:00:00.000Z" title="更新于 2024-07-07 00:00:00">2024-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/The-Basics-Of-Linux-Part-One/" title="【上篇】Linux 基础"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/96.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【上篇】Linux 基础"/></a><div class="content"><a class="title" href="/posts/The-Basics-Of-Linux-Part-One/" title="【上篇】Linux 基础">【上篇】Linux 基础</a><time datetime="2024-07-04T16:00:00.000Z" title="更新于 2024-07-05 00:00:00">2024-07-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Quick-Start-To-Arthas/" title="Arthas 快速入门"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/127.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Arthas 快速入门"/></a><div class="content"><a class="title" href="/posts/Quick-Start-To-Arthas/" title="Arthas 快速入门">Arthas 快速入门</a><time datetime="2024-07-01T16:00:00.000Z" title="更新于 2024-07-02 00:00:00">2024-07-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Commonly-Used-Classes-In-Java/" title="Java 常用类"><img src= "/img/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/65.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java 常用类"/></a><div class="content"><a class="title" href="/posts/Commonly-Used-Classes-In-Java/" title="Java 常用类">Java 常用类</a><time datetime="2024-06-28T16:00:00.000Z" title="更新于 2024-06-29 00:00:00">2024-06-29</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 默烦</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://jsd.onmicrosoft.cn/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://jsd.onmicrosoft.cn/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://jsd.onmicrosoft.cn/npm/vanilla-lazyload@latest/dist/lazyload.iife.min.js"></script><script src="https://jsd.onmicrosoft.cn/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://jsd.onmicrosoft.cn/npm/mermaid@10.9.0/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://jsd.onmicrosoft.cn/gh/mofan212/blog-static-resources@master/js/mine.min.js"></script><script src="https://npm.elemecdn.com/mermaid/dist/mermaid.min.js"></script><script defer="defer" id="ribbon" src="https://jsd.onmicrosoft.cn/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="click-show-text" src="https://jsd.onmicrosoft.cn/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Azathoth,Yog-Sothoth,Shub-Niggurath,Nyarlathotep,Cthulhu,Hastur,Abhoth,Ghroth,Tsathoggua,Cthugha,Deep Ones,Dagon,Chaugnar Faugn,Mordiggian,Shoggoth,Old One,Mi-Go,Great Race of Yith,Flying Polyp,Hounds of Tindalos,Dhole" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://jsd.onmicrosoft.cn/npm/@docsearch/css/dist/style.min.css"/><script src="https://jsd.onmicrosoft.cn/npm/@docsearch/js/dist/umd/index.min.js"></script><script>(() => {
  docsearch(Object.assign({
    appId: 'BAFEL7A6K1',
    apiKey: '89fcb5961984c5c054bf04149f345f38',
    indexName: 'mofan212io',
    container: '#docsearch',
  }, null))

  const handleClick = () => {
    document.querySelector('.DocSearch-Button').click()
  }

  const searchClickFn = () => {
    btf.addEventListenerPjax(document.querySelector('#search-button > .search'), 'click', handleClick)
  }

  searchClickFn()
  window.addEventListener('pjax:complete', searchClickFn)
})()</script></div></div></body></html>