<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【MySQL 高级篇三】用户与权限管理 | Mofan</title><meta name="author" content="默烦,cy.mofan@foxmail.com"><meta name="copyright" content="默烦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文介绍了 MySQL 中的用户管理、权限管理、权限表、角色管理和配置文件的使用。">
<meta property="og:type" content="article">
<meta property="og:title" content="【MySQL 高级篇三】用户与权限管理">
<meta property="og:url" content="https://mofan212.github.io/posts/MySQL-Advanced-Third-User-And-Permission-Management/index.html">
<meta property="og:site_name" content="Mofan">
<meta property="og:description" content="本文介绍了 MySQL 中的用户管理、权限管理、权限表、角色管理和配置文件的使用。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/132.jpg">
<meta property="article:published_time" content="2023-03-26T16:00:00.000Z">
<meta property="article:modified_time" content="2023-03-26T16:00:00.000Z">
<meta property="article:author" content="默烦">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/132.jpg"><link rel="shortcut icon" href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/favicon.png"><link rel="canonical" href="https://mofan212.github.io/posts/MySQL-Advanced-Third-User-And-Permission-Management/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"距离本文上次更新已经过去","messageNext":"天，请注意时效性。"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 默烦","link":"链接: ","source":"来源: Mofan","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  infinitegrid: {
    js: 'https://fastly.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【MySQL 高级篇三】用户与权限管理',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-27 00:00:00'
}</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/mofan212/blog-static-resources@master/css/myStyle.min.css"><link rel="stylesheet" href="https://cdn.staticfile.net/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" /><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono.min.css" /><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="Mofan" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/mofan212/blog-static-resources/css/minimal.min.css"/><script src="https://fastly.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">153</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/post_top_img.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Mofan</span></a><a class="nav-page-title" href="/"><span class="site-name">【MySQL 高级篇三】用户与权限管理</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> 维护</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> 里程碑</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> 关于本站</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> 关于我</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">【MySQL 高级篇三】用户与权限管理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-26T16:00:00.000Z" title="发表于 2023-03-27 00:00:00">2023-03-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-26T16:00:00.000Z" title="更新于 2023-03-27 00:00:00">2023-03-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL/">MySQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">11.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>38分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>封面来源：由博主个人绘制，如需使用请联系博主。</p>
<p>本文参考：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1iq4y1u7vj?p=105">MySQL数据库教程天花板，mysql安装到mysql高级，强！硬！</a></p>
<h1 id="1-用户管理"><a class="header-anchor" href="#1-用户管理"></a>1. 用户管理</h1>
<p>MySQL 用户可以分为普通用户和 root 用户。root 用户是超级管理员，拥有所有权限，包括创建用户、删除用户和修改用户的密码等管理权限，普通用户只拥有被授予的各种权限。</p>
<p>MySQL 提供了许多语句来管理用户账号，这些语句可以用用来管理包括登录和退出 MySQL 服务器、创建用户、删除用户、密码管理和权限管理等内容。</p>
<p>MySQL 数据库的安全性需要通过账户管理来保证。</p>
<h2 id="1-1-登录MySQL服务器"><a class="header-anchor" href="#1-1-登录MySQL服务器"></a>1.1 登录MySQL服务器</h2>
<p>启动 MySQL 服务后，可以通过 <code>mysql</code> 命令来登录 MySQL 服务器，命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql –h hostname|hostIP –P port –u username –p DatabaseName –e &quot;SQL语句&quot;</span><br></pre></td></tr></table></figure>
<p>使用的参数：</p>
<ul>
<li>
<p><code>-h</code>：其后紧跟主机名或者主机 IP，<code>hostname</code> 表示主机，<code>hostIP</code> 表示主机 IP；</p>
</li>
<li>
<p><code>-P</code>：其后紧跟 MySQL 服务的端口，通过该参数连接到指定的端口。MySQL 服务的默认端口是 3306，不使用该参数时自动连接到 3306 端口，<code>port</code> 表示连接的端口号；</p>
</li>
<li>
<p><code>-u</code>：其后紧跟用户名，<code>username</code> 为用户名；</p>
</li>
<li>
<p><code>-p</code>：提示输入密码；</p>
</li>
<li>
<p><code>DatabaseName</code>：指明登录后使用哪个数据库。如果没有该参数，直接登录到 MySQL 数据库中，然后可以使用 <code>USE</code> 命令选择数据库；</p>
</li>
<li>
<p><code>-e</code>：后面可以直接追加 SQL 语句。登录 MySQL 服务器后立即执行该 SQL 语句，然后退出 MySQL 服务器。</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p -hlocalhost -P3306 mysql -e &quot;select host,user from user&quot;</span><br></pre></td></tr></table></figure>
<pre>
+-----------+------------------+
| host      | user             |
+-----------+------------------+
| localhost | mysql.infoschema |
| localhost | mysql.session    |
| localhost | mysql.sys        |
| localhost | root             |
+-----------+------------------+
</pre>
<h2 id="1-2-创建用户"><a class="header-anchor" href="#1-2-创建用户"></a>1.2 创建用户</h2>
<p>在 MySQL 数据库中，官方推荐使用 <code>CREATE USER</code> 语句来创建新用户。MySQL8 版本移除了 PASSWORD 加密方法，因此不在推荐使用 <code>INSERT</code> 语句修改 <code>user</code> 表来增加用户。</p>
<p>使用 <code>CREATE USER</code> 语句创建新用户时，必须拥有 <code>CREATE USER</code> 权限。每添加一个用户，<code>CREATE USER</code> 语句就会在 <code>user</code> 表中增加一条记录，但是新创建的用户没有任何权限。</p>
<p>如果创建的用户已经存在，则会报错。</p>
<p><code>CREATE USER</code> 语句的基本语法形式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER 用户名 [IDENTIFIED BY &#x27;密码&#x27;][,用户名 [IDENTIFIED BY &#x27;密码&#x27;]];</span><br></pre></td></tr></table></figure>
<ul>
<li>用户名参数表示新建用户的账户，由用户（user）和主机名（host）构成；</li>
<li><code>[ ]</code> 表示可选，也就是说可以指定用户登录时需要密码验证，也可以不指定密码验证，使得用户可以直接登录。当然，不指定密码的方式不安全，不推荐使用。如果指定密码值，则需要使用 <code>IDENTIFIED BY</code> 指定明文密码值。</li>
<li><code>CREATE USER</code> 语句可以同时创建多个用户。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER zhang3 IDENTIFIED BY &#x27;123123&#x27;;  # 默认 host 是 %</span><br><span class="line">CREATE USER &#x27;mofan&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure>
<p><code>user</code> 表中的账户是唯一的，这是说 <code>user</code> 表中的 <code>user</code> 和 <code>host</code> 列是组合唯一的，因此可以存在相同的 <code>user</code> 但 <code>host</code> 不同。</p>
<h2 id="1-3-修改用户"><a class="header-anchor" href="#1-3-修改用户"></a>1.3 修改用户</h2>
<p>这里的修改用户特指修改用户名，而不是修改用户的权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE mysql.user SET USER=&#x27;zhang3&#x27; WHERE USER=&#x27;li4&#x27;;</span><br><span class="line"></span><br><span class="line">FLUSH PRIVILEGES; </span><br></pre></td></tr></table></figure>
<h2 id="1-4-删除用户"><a class="header-anchor" href="#1-4-删除用户"></a>1.4 删除用户</h2>
<p>可以使用 <code>DROP USER</code> 语句来删除用户，也可以直接在 <code>mysql.user</code> 表中删除用户。</p>
<blockquote>
<p>推荐：使用 <code>DROP</code> 方式删除</p>
</blockquote>
<p>使用 <code>DROP USER</code> 语句来删除用户时，必须拥有 <code>DROP USER</code> 权限。<code>DROP USER</code> 语句的基本语法形式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP USER user[,user]...;</span><br></pre></td></tr></table></figure>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DROP USER li4;  # 默认删除 host 为 % 的用户</span><br><span class="line">DROP USER &#x27;mofan&#x27;@&#x27;localhost&#x27;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用 <code>DELETE</code> 方式删除</p>
</blockquote>
<p>还可以使用 <code>DELETE</code> 语句直接将用户信息从 <code>mysql.user</code> 表中删除，但必须拥有对 <code>mysql.user</code> 表的 <code>DELETE</code> 权限。基本语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># host 和 user 字段是 user 表的联合主键，需要两个字段的值才能确定一条记录</span><br><span class="line">DELETE FROM mysql.user WHERE host=’hostname’ AND user=’username’;</span><br><span class="line"># 执行完 DELETE 命令后要使用 FLUSH 命令来使用户生效</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM mysql.user WHERE host=&#x27;localhost&#x27; AND user=&#x27;Emily&#x27;;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>不推荐使用 <code>DELETE</code> 方式对用户进行删除，系统会有残留信息。而 <code>DROP USER</code> 命令会删除用户以及对应的权限，执行命令后会发现 <code>mysql.user</code> 表和 <code>mysql.db</code> 表的相应记录都消失了。</p>
<h2 id="1-5-设置当前用户密码"><a class="header-anchor" href="#1-5-设置当前用户密码"></a>1.5 设置当前用户密码</h2>
<p>适用于 root 用户修改自己的密码，以及普通用户登录后修改自己的密码。</p>
<p>root 用户拥有最高的权限，因此必须保证 root 用户的密码安全。root 用户可以通过多种方式来修改密码，使用 <code>ALTER USER</code> 修改用户密码是 MySQL  官方推荐的方式。此外，也可以通过 <code>SET</code> 语句修改密码。由于 MySQL 8 中已经移除了 <code>PASSWORD()</code> 函数，因此不再使用 <code>UPDATE</code> 语句直接操作用户表修改密码。</p>
<p>旧写法，在 MySQL 5.7 中测试有效：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 修改当前用户的密码</span><br><span class="line">SET PASSWORD = PASSWORD(&#x27;123456&#x27;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>推荐的写法</p>
</blockquote>
<ul>
<li>使用 <code>ALTER USER</code> 命令修改当前用户密码：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER USER() IDENTIFIED BY &#x27;new_password&#x27;;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>SET</code> 语句修改当前用户密码。使用 root 用户登录 MySQL 后，可以使用 <code>SET</code> 语句来修改密码：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 该语句会自动将密码加密后再赋给当前用户</span><br><span class="line">SET PASSWORD=&#x27;new_password&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="1-6-修改其它用户密码"><a class="header-anchor" href="#1-6-修改其它用户密码"></a>1.6 修改其它用户密码</h2>
<p>root 用户不仅可以修改自己的密码，还可以修改其他普通用户的密码。root 用户登录 MySQL 服务器后，可以通过 <code>ALTER</code> 语句和 <code>SET</code> 语句来修改普通用户的密码。由于 <code>PASSWORD()</code> 函数已经移除，因此不再使用 <code>UPDATE</code> 直接操作用户表。</p>
<ul>
<li>使用 <code>ALTER</code> 语句来修改普通用户的密码：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># user 表示账户，由用户名和主机名构成</span><br><span class="line">ALTER USER user [IDENTIFIED BY &#x27;新密码&#x27;]</span><br><span class="line">[,user[IDENTIFIED BY &#x27;新密码&#x27;]]...;</span><br><span class="line"># 比如:</span><br><span class="line">ALTER USER &#x27;mofan&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;mofan212&#x27;;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>SET</code> 命令来修改普通用户的密码。使用 root 用户登录到 MySQL 服务器后，可以使用 <code>SET</code> 语句修改普通用户的密码：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET PASSWORD FOR &#x27;username&#x27;@&#x27;hostname&#x27;=&#x27;new_password&#x27;;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>UPDATE</code> 语句修改普通用户的密码（不推荐）：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE mysql.user </span><br><span class="line">SET authentication_string=PASSWORD(&quot;123456&quot;)</span><br><span class="line">WHERE user = &quot;username&quot; AND host = &quot;hostname&quot;;</span><br></pre></td></tr></table></figure>
<h2 id="1-7-MySQL8-的密码管理（了解）"><a class="header-anchor" href="#1-7-MySQL8-的密码管理（了解）"></a>1.7 MySQL8 的密码管理（了解）</h2>
<blockquote>
<p>密码过期策略</p>
</blockquote>
<p>在 MySQL 中，数据库管理员可以手动设置账号密码过期，也可以建立一个自动密码过期策略。</p>
<p>过期策略可以是全局的，也可以为每个账号单独设置过期策略。</p>
<p><strong>手动设置密码立马过期：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER user PASSWORD EXPIRE;</span><br></pre></td></tr></table></figure>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#x27;mofan&#x27;@&#x27;localhost&#x27; PASSWORD EXPIRE;</span><br></pre></td></tr></table></figure>
<p>该语句将 mofan 的密码设置为过期，mofan 用户仍然可以登录进数据库，但是无法进行查询，只用重新设置了新密码才能正常使用。</p>
<p><strong>手动全局设置指定时间过期方式：</strong></p>
<p>如果密码使用的时间大于允许的时间，服务器会自动将其设置为过期，无需手动设置。</p>
<p>MySQL 使用 <code>default_password_lifetime</code> 系统变量建立全局过期密码策略。</p>
<ul>
<li>它的默认值是 0，表示禁用自动密码过期。</li>
<li>它允许的值是正整数 N，表示密码的生存期，密码必须每隔 N 天进行修改。</li>
</ul>
<p>可以使用 SQL 语句更改该变量的值并持久化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 建立全局策略，设置密码每隔180天过期</span><br><span class="line">SET PERSIST default_password_lifetime = 180;</span><br></pre></td></tr></table></figure>
<p>还可以直接在配置文件 <code>my.cnf</code> 中配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">default_password_lifetime</span>=<span class="string">180  # 建立全局策略，设置密码每隔180天过期</span></span><br></pre></td></tr></table></figure>
<p><strong>手动单独设置指定时间过期方式：</strong></p>
<p>每个账号既可延用全局密码过期策略，也可单独设置策略。在 <code>CREATE USER</code> 和 <code>ALTER USER</code> 语句上加入 <code>PASSWORD EXPIRE</code> 选项即可实现单独设置策略。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#设置mofan账号密码每90天过期：</span><br><span class="line">CREATE USER &#x27;mofan&#x27;@&#x27;localhost&#x27; PASSWORD EXPIRE INTERVAL 90 DAY;</span><br><span class="line">ALTER USER &#x27;mofan&#x27;@&#x27;localhost&#x27; PASSWORD EXPIRE INTERVAL 90 DAY;</span><br><span class="line"></span><br><span class="line">#设置密码永不过期：</span><br><span class="line">CREATE USER &#x27;mofan&#x27;@&#x27;localhost&#x27; PASSWORD EXPIRE NEVER;</span><br><span class="line">ALTER USER &#x27;mofan&#x27;@&#x27;localhost&#x27; PASSWORD EXPIRE NEVER;</span><br><span class="line"></span><br><span class="line">#延用全局密码过期策略：</span><br><span class="line">CREATE USER &#x27;mofan&#x27;@&#x27;localhost&#x27; PASSWORD EXPIRE DEFAULT;</span><br><span class="line">ALTER USER &#x27;mofan&#x27;@&#x27;localhost&#x27; PASSWORD EXPIRE DEFAULT;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>密码重用策略</p>
</blockquote>
<p>MySQL 限制使用已用过的密码。重用限制策略基于 <strong>密码更改的数量</strong> 和 <strong>使用的时间</strong>。重用策略可以是全局的，也可以给每个账号单独设置。</p>
<p>账号的历史密码包含过去该账号所使用的密码，MySQL 基于以下规则来限制密码重用：</p>
<ul>
<li>如果账号密码限制基于 <strong>密码更改的数量</strong>，那么新密码不能从最近限制的密码数量中选择。例如密码更改的最小值为 3，那么新密码不能与最近 3 个密码中的任何一个相同。</li>
<li>如果账号密码限制基于 <strong>时间</strong>，那么新密码不能从规定的时间内选择。例如，如果密码重用周期为 60 天，那么新密码不能从最近 60 天内使用的密码中选择。</li>
</ul>
<p>MySQL 使用 <code>password_history</code> 和 <code>password_reuse_interval</code> 系统变量设置密码重用策略：</p>
<ul>
<li><code>password_history</code>：密码重用的数量；</li>
<li><code>password_reuse_interval</code>：密码重用的周期。</li>
</ul>
<p><strong>手动全局设置密码重用方式：</strong></p>
<p>可以通过 SQL 语句进行设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 设置不能选择最近使用过的6个密码</span><br><span class="line">SET PERSIST password_history = 6; </span><br><span class="line"># 设置不能选择最近一年内的密码</span><br><span class="line">SET PERSIST password_reuse_interval = 365;</span><br></pre></td></tr></table></figure>
<p>也可以在 <code>my.ini</code> 配置文件中设置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">password_history</span>=<span class="string">6</span></span><br><span class="line"><span class="attr">password_reuse_interval</span>=<span class="string">365</span></span><br></pre></td></tr></table></figure>
<p><strong>手动单独设置密码重用方式：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#不能使用最近5个密码：</span><br><span class="line">CREATE USER &#x27;mofan&#x27;@&#x27;localhost&#x27; PASSWORD HISTORY 5;</span><br><span class="line">ALTER USER &#x27;mofan&#x27;@&#x27;localhost&#x27; PASSWORD HISTORY 5;</span><br><span class="line"></span><br><span class="line">#不能使用最近365天内的密码：</span><br><span class="line">CREATE USER &#x27;mofan&#x27;@&#x27;localhost&#x27; PASSWORD REUSE INTERVAL 365 DAY;</span><br><span class="line">ALTER USER &#x27;mofan&#x27;@&#x27;localhost&#x27; PASSWORD REUSE INTERVAL 365 DAY;</span><br><span class="line"></span><br><span class="line">#既不能使用最近5个密码，也不能使用365天内的密码</span><br><span class="line">CREATE USER &#x27;mofan&#x27;@&#x27;localhost&#x27;</span><br><span class="line">PASSWORD HISTORY 5</span><br><span class="line">PASSWORD REUSE INTERVAL 365 DAY;</span><br><span class="line"></span><br><span class="line">ALTER USER &#x27;mofan&#x27;@&#x27;localhost&#x27;</span><br><span class="line">PASSWORD HISTORY 5</span><br><span class="line">PASSWORD REUSE INTERVAL 365 DAY;</span><br></pre></td></tr></table></figure>
<h1 id="2-权限管理"><a class="header-anchor" href="#2-权限管理"></a>2. 权限管理</h1>
<h2 id="2-1-权限列表"><a class="header-anchor" href="#2-1-权限列表"></a>2.1 权限列表</h2>
<p>官方文档：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html">MySQL :: MySQL 8.0 Reference Manual :: 6.2.2 Privileges Provided by MySQL</a></p>
<p>MySQL 到底都有哪些权限呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show privileges;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">权限</th>
<th style="text-align:center">user 表中对应的列</th>
<th style="text-align:center">权限范围</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_all"><code>ALL [PRIVILEGES\]</code></a></td>
<td style="text-align:center">Synonym for “all privileges”</td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_alter"><code>ALTER</code></a></td>
<td style="text-align:center"><code>Alter_priv</code></td>
<td style="text-align:center">Tables</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_alter-routine"><code>ALTER ROUTINE</code></a></td>
<td style="text-align:center"><code>Alter_routine_priv</code></td>
<td style="text-align:center">Stored routines</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create"><code>CREATE</code></a></td>
<td style="text-align:center"><code>Create_priv</code></td>
<td style="text-align:center">Databases, tables, or indexes</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-role"><code>CREATE ROLE</code></a></td>
<td style="text-align:center"><code>Create_role_priv</code></td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-routine"><code>CREATE ROUTINE</code></a></td>
<td style="text-align:center"><code>Create_routine_priv</code></td>
<td style="text-align:center">Stored routines</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-tablespace"><code>CREATE TABLESPACE</code></a></td>
<td style="text-align:center"><code>Create_tablespace_priv</code></td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-temporary-tables"><code>CREATE TEMPORARY TABLES</code></a></td>
<td style="text-align:center"><code>Create_tmp_table_priv</code></td>
<td style="text-align:center">Tables</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-user"><code>CREATE USER</code></a></td>
<td style="text-align:center"><code>Create_user_priv</code></td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_create-view"><code>CREATE VIEW</code></a></td>
<td style="text-align:center"><code>Create_view_priv</code></td>
<td style="text-align:center">Views</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_delete"><code>DELETE</code></a></td>
<td style="text-align:center"><code>Delete_priv</code></td>
<td style="text-align:center">Tables</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_drop"><code>DROP</code></a></td>
<td style="text-align:center"><code>Drop_priv</code></td>
<td style="text-align:center">Databases, tables, or views</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_drop-role"><code>DROP ROLE</code></a></td>
<td style="text-align:center"><code>Drop_role_priv</code></td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_event"><code>EVENT</code></a></td>
<td style="text-align:center"><code>Event_priv</code></td>
<td style="text-align:center">Databases</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_execute"><code>EXECUTE</code></a></td>
<td style="text-align:center"><code>Execute_priv</code></td>
<td style="text-align:center">Stored routines</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_file"><code>FILE</code></a></td>
<td style="text-align:center"><code>File_priv</code></td>
<td style="text-align:center">File access on server host</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_grant-option"><code>GRANT OPTION</code></a></td>
<td style="text-align:center"><code>Grant_priv</code></td>
<td style="text-align:center">Databases, tables, or stored routines</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_index"><code>INDEX</code></a></td>
<td style="text-align:center"><code>Index_priv</code></td>
<td style="text-align:center">Tables</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_insert"><code>INSERT</code></a></td>
<td style="text-align:center"><code>Insert_priv</code></td>
<td style="text-align:center">Tables or columns</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_lock-tables"><code>LOCK TABLES</code></a></td>
<td style="text-align:center"><code>Lock_tables_priv</code></td>
<td style="text-align:center">Databases</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_process"><code>PROCESS</code></a></td>
<td style="text-align:center"><code>Process_priv</code></td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_proxy"><code>PROXY</code></a></td>
<td style="text-align:center">See <code>proxies_priv</code> table</td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_references"><code>REFERENCES</code></a></td>
<td style="text-align:center"><code>References_priv</code></td>
<td style="text-align:center">Databases or tables</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_reload"><code>RELOAD</code></a></td>
<td style="text-align:center"><code>Reload_priv</code></td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-client"><code>REPLICATION CLIENT</code></a></td>
<td style="text-align:center"><code>Repl_client_priv</code></td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_replication-slave"><code>REPLICATION SLAVE</code></a></td>
<td style="text-align:center"><code>Repl_slave_priv</code></td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_select"><code>SELECT</code></a></td>
<td style="text-align:center"><code>Select_priv</code></td>
<td style="text-align:center">Tables or columns</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-databases"><code>SHOW DATABASES</code></a></td>
<td style="text-align:center"><code>Show_db_priv</code></td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_show-view"><code>SHOW VIEW</code></a></td>
<td style="text-align:center"><code>Show_view_priv</code></td>
<td style="text-align:center">Views</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_shutdown"><code>SHUTDOWN</code></a></td>
<td style="text-align:center"><code>Shutdown_priv</code></td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_super"><code>SUPER</code></a></td>
<td style="text-align:center"><code>Super_priv</code></td>
<td style="text-align:center">Server administration</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_trigger"><code>TRIGGER</code></a></td>
<td style="text-align:center"><code>Trigger_priv</code></td>
<td style="text-align:center">Tables</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_update"><code>UPDATE</code></a></td>
<td style="text-align:center"><code>Update_priv</code></td>
<td style="text-align:center">Tables or columns</td>
</tr>
<tr>
<td style="text-align:center"><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_usage"><code>USAGE</code></a></td>
<td style="text-align:center">Synonym for “no privileges”</td>
<td style="text-align:center">Server administration</td>
</tr>
</tbody>
</table>
<ul>
<li><code>CREATE</code> 和 <code>DROP</code> 权限，可以创建新的数据库和表，或删除（移掉）已有的数据库和表。如果将 MySQL 数据库中的 <code>DROP</code> 权限授予某用户，该用户就可以删除 MySQL 访问权限保存的数据库。</li>
<li><code>SELECT</code>、<code>INSERT</code>、<code>UPDATE</code> 和 <code>DELETE</code> 权限允许在一个数据库现有的表上实施操作。</li>
<li><code>SELECT</code> 权限只有在它们真正从一个表中检索行时才被用到。</li>
<li><code>INDEX</code> 权限允许创建或删除索引，<code>INDEX</code> 适用于已有的表。如果具有某个表的 <code>CREATE</code> 权限，那么可以在<code>CREATE TABLE</code> 语句中包括索引定义。</li>
<li><code>ALTER</code> 权限可以使用 <code>ALTER TABLE</code> 来更改表的结构和重新命名表。</li>
<li><code>CREATE ROUTINE</code> 权限用来创建保存的程序（函数和程序），<code>ALTER ROUTINE</code> 权限用来更改和删除保存的程序，<code>EXECUTE</code> 权限用来执行保存的程序。</li>
<li><code>GRANT</code> 权限允许授权给其他用户，可用于数据库、表和保存的程序。</li>
<li><code>FILE</code> 权限使用户可以使用 <code>LOAD DATA INFILE</code> 和 <code>SELECT...INTO OUTFILE</code> 语句读或写服务器上的文件，任何被授予 <code>FILE</code> 权限的用户都能读或写 MySQL 服务器上的任何文件（说明用户可以读任何数据库目录下的文件，因为服务器可以访问这些文件）。</li>
</ul>
<p>MySQL 的权限如何分布：</p>
<table>
<thead>
<tr>
<th style="text-align:center">权限分布</th>
<th style="text-align:center">可能设置的权限</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">表权限</td>
<td style="text-align:center">SELECT、INSERT、UPDATE、DELETE、CREATE、DROP、GRANT、REFERENCES、INDEX、ALTER</td>
</tr>
<tr>
<td style="text-align:center">列权限</td>
<td style="text-align:center">SELECT、INSERT、UPDATE、REFERENCES</td>
</tr>
<tr>
<td style="text-align:center">过程权限</td>
<td style="text-align:center">EXECUTE、ALTER ROUTINE、GRANT</td>
</tr>
</tbody>
</table>
<h2 id="2-2-授予权限的原则"><a class="header-anchor" href="#2-2-授予权限的原则"></a>2.2 授予权限的原则</h2>
<p>权限控制主要是出于安全因素，因此需要遵循以下几个经验原则：</p>
<ol>
<li>只授予能满足需要的最小权限，防止用户干坏事。比如用户只是需要查询，那就只给 SELECT 权限，不要给用户赋予 UPDATE、INSERT 或者 DELETE 权限；</li>
<li>创建用户的时候限制用户的登录主机，一般是限制成指定 IP 或者内网 IP 段。</li>
<li>为每个用户设置满足密码复杂度的密码。</li>
<li>定期清理不需要的用户，回收权限或者删除用户。</li>
</ol>
<h2 id="2-3-授予权限"><a class="header-anchor" href="#2-3-授予权限"></a>2.3 授予权限</h2>
<p>给用户授权的方式有 2 种，分别是通过把 <strong>角色赋予用户给用户授权</strong> 和 <strong>直接给用户授权</strong>。用户是数据库的使用者，可以通过给用户授予访问数据库中资源的权限，来控制使用者对数据库的访问，消除安全隐患。</p>
<p>授权命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT 权限1, 权限2, ...权限n ON 数据库名称.表名称 TO 用户名@用户地址 [IDENTIFIED BY &#x27;密码口令&#x27;];</span><br></pre></td></tr></table></figure>
<p>在授权时如果发现没有指定的用户，会直接创建一个用户。</p>
<p>比如：</p>
<ul>
<li>给 li4 用户用本地命令行方式，授予 test_table 这个库下的所有表的插删改查的权限</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT SELECT, INSERT, DELETE, UPDATE ON test_table.* TO li4@localhost;</span><br></pre></td></tr></table></figure>
<ul>
<li>授予通过网络方式登录的 joe 用户 ，对所有库所有表的全部权限，密码设为 123。注意这里唯独不包括 <code>GRANT</code> 的权限：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO joe@&#x27;%&#x27; IDENTIFIED BY &#x27;123&#x27;;</span><br></pre></td></tr></table></figure>
<p><code>ALL PRIVILEGES</code> 表示所有权限，也可以指定 <code>SELECT</code>、<code>UPDATE</code> 等权限。<code>ON</code> 用来指定权限针对哪些库和表。<code>.</code> 前面的 <code>*</code> 用来指定数据库名，后面的 <code>*</code> 用来指定表名。<code>TO</code> 表示将权限授予哪个用户。<code>li4@localhost</code> 表示 <code>li4</code> 用户，<code>@</code> 后面跟限制的主机，可以是 IP、IP 段、域名以及 <code>%</code>，<code>%</code> 表示任何地方。在不同的版本中 <code>%</code> 的含义不同，有些版本中 <code>%</code> 可能不包括本地，此时再加上一个 <code>localhost</code> 的用户就行。</p>
<p>如果需要授予包括 <code>GRANT</code> 的权限，添加参数 <code>WITH GRANT OPTION</code> 选项即可，表示该用户可以将自己拥有的权限授予给别人。经常有人在创建操作用户时不指定 <code>WITH GRANT OPTION</code> 选项导致后来该用户不能使用 <code>GRANT</code> 命令创建用户或者给其它用户授权。</p>
<p>权限叠加：可以使用 <code>GRANT</code> 重复给用户添加权限。比如先给用户添加 <code>SELECT</code> 权限，然后又给用户添加 <code>INSERT</code> 权限，那么该用户就同时拥有了 <code>SELECT</code> 和 <code>INSERT</code> 权限。</p>
<p>在开发应用的时候，经常会遇到一种需求，就是要根据用户的不同，对数据进行横向和纵向的分组。</p>
<ul>
<li>
<p>所谓横向的分组，就是指用户可以接触到的数据的范围，比如可以看到哪些表的数据；</p>
</li>
<li>
<p>所谓纵向的分组，就是指用户对接触到的数据能访问到什么程度，比如能看、能改，甚至是删除。</p>
</li>
</ul>
<h2 id="2-4-查看权限"><a class="header-anchor" href="#2-4-查看权限"></a>2.4 查看权限</h2>
<p>查看当前用户权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SHOW GRANTS;</span><br><span class="line"># 或</span><br><span class="line">SHOW GRANTS FOR CURRENT_USER; </span><br><span class="line"># 或 </span><br><span class="line">SHOW GRANTS FOR CURRENT_USER();</span><br></pre></td></tr></table></figure>
<p>查看某用户的全局权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW GRANTS FOR &#x27;user&#x27;@&#x27;主机地址&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="2-5-收回权限"><a class="header-anchor" href="#2-5-收回权限"></a>2.5 收回权限</h2>
<p>收回权限就是取消已经授予用户的某些权限。收回用户不必要的权限可以在一定程度上保证系统的安全性。MySQL 中使用 <code>REVOKE</code> 语句取消用户的某些权限。使用 <code>REVOKE</code> 收回权限之后，用户账户的记录将从 db、host、tables_priv 和 columns_priv 表中删除，但是用户账户记录仍然在 user 表中保存（删除 user 表中的账户记录使用 <code>DROP USER</code> 语句）。</p>
<p><mark>注意：</mark> 在将用户账户从 user 表删除之前，应该收回相应用户的所有权限。</p>
<p>基本语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REVOKE 权限1, 权限2, ...权限n ON 数据库名称.表名称 FROM 用户名@用户地址;</span><br></pre></td></tr></table></figure>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 收回全库全表的所有权限</span><br><span class="line">REVOKE ALL PRIVILEGES ON *.* FROM joe@&#x27;%&#x27;;</span><br><span class="line"></span><br><span class="line"># 收回 mysql 库下的所有表的插删改查权限</span><br><span class="line">REVOKE SELECT, INSERT, UPDATE, DELETE ON mysql.* FROM joe@localhost;</span><br></pre></td></tr></table></figure>
<p>权限收回后，需要用户重新登录才会生效。</p>
<p>在直接收回所有权限时，可能会提示：</p>
<pre>
ERROR 1227 (42000): Access denied; you need (at Least one of) the SYSTEM_USER privilege(s) for this operation
</pre>
<p>此时给 root 用户授予 <code>SYSTEM_USER</code> 权限后再操作即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant SYSTEM_USER on *.* to &#x27;root &#x27;@&#x27;%&#x27; ;</span><br></pre></td></tr></table></figure>
<p>一些程序员喜欢使用 root 超级用户来访问数据库，完全把权限控制放在应用层面实现，但建议尽量使用数据库自己的角色和用户机制来控制访问权限，不要轻易用 root 账号。因为 root 账号密码放在代码里面不安全，一旦泄露，数据库就会完全失去保护。</p>
<h1 id="3-权限表"><a class="header-anchor" href="#3-权限表"></a>3. 权限表</h1>
<p>MySQL 服务器通过权限表来控制用户对数据库的访问，权限表存放在数据库 <code>mysql</code> 中。MySQL 数据库系统会根据这些权限表的内容为每个用户赋予相应的权限。这些权限表中最重要的是 <code>user</code> 表、<code>db</code> 表。 除此之外，还有 <code>tables_priv</code> 表、<code>columns_ priv</code> 表和 <code>proc_ priv</code> 表等。在 MySQL 启动时，服务器将这些数据库表中权限信息的内容读入内存。</p>
<table>
<thead>
<tr>
<th style="text-align:center">表名</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">user</td>
<td style="text-align:center">用户账号及权限信息</td>
</tr>
<tr>
<td style="text-align:center">global_grants</td>
<td style="text-align:center">动态全局授权</td>
</tr>
<tr>
<td style="text-align:center">db</td>
<td style="text-align:center">数据库层级的权限</td>
</tr>
<tr>
<td style="text-align:center">tables_priv</td>
<td style="text-align:center">表层级的权限</td>
</tr>
<tr>
<td style="text-align:center">columns_priv</td>
<td style="text-align:center">列层级的权限</td>
</tr>
<tr>
<td style="text-align:center">procs_priv</td>
<td style="text-align:center">存储的过程和函数的权限</td>
</tr>
<tr>
<td style="text-align:center">proxics_priv</td>
<td style="text-align:center">代理用户的权限</td>
</tr>
<tr>
<td style="text-align:center">default_roles</td>
<td style="text-align:center">账号连接并认证后默认授予的角色</td>
</tr>
<tr>
<td style="text-align:center">role_edges</td>
<td style="text-align:center">角色子图的便边界</td>
</tr>
<tr>
<td style="text-align:center">password_history</td>
<td style="text-align:center">密码更改信息</td>
</tr>
</tbody>
</table>
<h2 id="3-1-user-表"><a class="header-anchor" href="#3-1-user-表"></a>3.1 user 表</h2>
<p>user 表是 MySQL 中最重要的一个权限表，记录用户账号和权限信息，有 49 个字段。如下图：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/user%E8%A1%A8%E7%9A%84%E8%A1%A8%E7%BB%93%E6%9E%84.png" alt="user表的表结构"></p>
<p>这些字段可以分成4类，分别是范围列（或用户列）、权限列、安全列和资源控制列。</p>
<blockquote>
<p>范围列（或用户列）</p>
</blockquote>
<p>host：连接类型。</p>
<ul>
<li>
<p><code>%</code> 表示所有远程通过 TCP方式的连接</p>
</li>
<li>
<p>IP 地址，如（192.168.1.2、127.0.0.1）通过制定 IP 地址进行的 TCP 方式的连接</p>
</li>
<li>
<p>机器名，通过制定网络中的机器名进行的TCP方式的连接</p>
</li>
<li>
<p><code>::1</code>，IPv6 的本地 IP 地址，等同于 IPv4 的 127.0.0.1</p>
</li>
<li>
<p><code>localhost</code> 本地方式通过命令行方式的连接 ，比如 <code>mysql -u xxx -p xxx</code> 方式的连接。</p>
</li>
</ul>
<p>user：用户名，同一用户通过不同方式链接的权限是不一样的。</p>
<p>password：密码。</p>
<ul>
<li>所有密码串通过 <code>password(明文字符串)</code> 函数生成密文字符串。MySQL 8.0 在用户管理方面增加了角色管理，默认的密码加密方式也做了调整，由之前的 SHA1 改为了 SHA2 ，不可逆 。同时加上 MySQL 5.7 的禁用用户和用户过期的功能，MySQL 在用户管理方面的功能和安全性都较之前版本大大的增强了。</li>
<li>MySQL 5.7 及之后版本的密码保存到 <code>authentication_string</code> 字段中不再使用 <code>password</code> 字段。</li>
</ul>
<blockquote>
<p>权限列</p>
</blockquote>
<p><code>Grant_priv </code>字段表示是否拥有 <code>GRANT</code> 权限。</p>
<p><code>Shutdown_priv</code> 字段表示是否拥有停止 MySQL 服务的权限</p>
<p><code>Super_priv</code> 字段表示是否拥有超级权限。</p>
<p><code>Execute_priv</code> 字段表示是否拥有 <code>EXECUTE</code> 权限。拥有 <code>EXECUTE</code> 权限，可以执行存储过程和函数。</p>
<p><code>Select_priv</code>，<code>Insert_priv</code> 等为该用户所拥有的权限。</p>
<blockquote>
<p>资源控制列</p>
</blockquote>
<p>资源控制列的字段用来限制用户使用的资源，包含 4 个字段，分别为：</p>
<ol>
<li><code>max_questions</code>，用户每小时允许执行的查询操作次数；</li>
<li><code>max_updates</code>，用户每小时允许执行的更新操作次数；</li>
<li><code>max_connections</code>，用户每小时允许执行的连接操作次数；</li>
<li><code>max_user_connections</code>，用户允许同时建立的连接次数。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查看字段</span><br><span class="line">DESC mysql.user;</span><br><span class="line"># 查看用户, 以列的方式显示数据</span><br><span class="line">SELECT * FROM mysql.user \G;</span><br><span class="line"># 查询特定字段</span><br><span class="line">SELECT host, user, authentication_string, select_priv, insert_priv, drop_priv</span><br><span class="line">FROM mysql.user; </span><br></pre></td></tr></table></figure>
<h2 id="3-2-db-表"><a class="header-anchor" href="#3-2-db-表"></a>3.2 db 表</h2>
<p>db 表是 MySQL 数据中非常重要的权限表。db 表中存储了用户对某个数据库的操作权限，决定用户能从哪个主机存取哪个数据库。</p>
<p>user 表中的权限是针对所有数据库的，如果 user 表中的 <code>Select_ priv</code> 字段取值为 <code>Y</code>，那么该用户可以查询所有数据库中的表。如果希望用户只对某个数据库有操作权限，那么需要将 user 表中对应的权限设置为<code>N</code>，然后在 db 表中设置对应数据库的操作权限。</p>
<p>使用 <code>DESCRIBE</code> 查看 db 表的基本结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DESCRIBE mysql.db;</span><br></pre></td></tr></table></figure>
<pre>
+-----------------------+---------------+------+-----+---------+-------+
| Field                 | Type          | Null | Key | Default | Extra |
+-----------------------+---------------+------+-----+---------+-------+
| Host                  | char(255)     | NO   | PRI |         |       |
| Db                    | char(64)      | NO   | PRI |         |       |
| User                  | char(32)      | NO   | PRI |         |       |
| Select_priv           | enum('N','Y') | NO   |     | N       |       |
| Insert_priv           | enum('N','Y') | NO   |     | N       |       |
| Update_priv           | enum('N','Y') | NO   |     | N       |       |
| Delete_priv           | enum('N','Y') | NO   |     | N       |       |
| Create_priv           | enum('N','Y') | NO   |     | N       |       |
| Drop_priv             | enum('N','Y') | NO   |     | N       |       |
| Grant_priv            | enum('N','Y') | NO   |     | N       |       |
| References_priv       | enum('N','Y') | NO   |     | N       |       |
| Index_priv            | enum('N','Y') | NO   |     | N       |       |
| Alter_priv            | enum('N','Y') | NO   |     | N       |       |
| Create_tmp_table_priv | enum('N','Y') | NO   |     | N       |       |
| Lock_tables_priv      | enum('N','Y') | NO   |     | N       |       |
| Create_view_priv      | enum('N','Y') | NO   |     | N       |       |
| Show_view_priv        | enum('N','Y') | NO   |     | N       |       |
| Create_routine_priv   | enum('N','Y') | NO   |     | N       |       |
| Alter_routine_priv    | enum('N','Y') | NO   |     | N       |       |
| Execute_priv          | enum('N','Y') | NO   |     | N       |       |
| Event_priv            | enum('N','Y') | NO   |     | N       |       |
| Trigger_priv          | enum('N','Y') | NO   |     | N       |       |
+-----------------------+---------------+------+-----+---------+-------+
</pre>
<blockquote>
<p>用户列</p>
</blockquote>
<p>db 表用户列有 3 个字段，分别是 <code>Host</code>、<code>User</code>、<code>Db</code>。这 3 个字段分别表示主机名、用户名和数据库名，表示从某个主机连接某个用户对某个数据库的操作权限，这 3 个字段的组合构成了 db 表的主键。</p>
<blockquote>
<p>权限列</p>
</blockquote>
<p><code>Create_routine_priv</code> 和 <code>Alter_routine_priv</code> 这两个字段决定用户是否具有创建和修改存储过程的权限。</p>
<h2 id="3-3-tables-priv-表和-columns-priv-表"><a class="header-anchor" href="#3-3-tables-priv-表和-columns-priv-表"></a>3.3 tables_priv 表和 columns_priv 表</h2>
<p>tables_priv 表用来对表设置操作权限，columns_priv 表用来对表的某一列设置权限。</p>
<p>tables_priv 表有8个字段，分别是 Host、Db、User、Table_name、Grantor、Timestamp、Table_priv 和 Column_priv，各个字段说明如下：</p>
<ul>
<li>
<p>Host 、Db 、User 和 Table_name 四个字段分别表示主机名、数据库名、用户名和表名。</p>
</li>
<li>
<p>Grantor 表示修改该记录的用户。</p>
</li>
<li>
<p>Timestamp 表示修改该记录的时间。</p>
</li>
<li>
<p>Table_priv 表示对象的操作权限。包括 Select、Insert、Update、Delete、Create、Drop、Grant、<br>
References、Index 和 Alter。</p>
</li>
<li>
<p>Column_priv 字段表示对表中的列的操作权限，包括 Select、Insert、Update 和 References。</p>
</li>
</ul>
<p>columns_ priv 表只有 7 个字段，分别是 Host、Db、User、Table_name、Column_name、Timestamp、Column_ priv。 其中，Column_ name 用来指定对哪些数据列具有操作权限。</p>
<h2 id="3-4-procs-priv-表"><a class="header-anchor" href="#3-4-procs-priv-表"></a>3.4 procs_priv 表</h2>
<p>procs_priv 表可以对存储过程和存储函数设置操作权限，表结构如图：</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/procs_priv%E8%A1%A8%E7%9A%84%E8%A1%A8%E7%BB%93%E6%9E%84.png" alt="procs_priv表的表结构"></p>
<p>procs_priv 表包含 8 个字段，分别是 Host、Db、User、Routine_ name、Routine_type、Grantor、 Proc_priv 和 Timestamp，各个字段的说明如下：</p>
<ul>
<li>Host、 Db 和 User 字段分别表示主机名、数据库名和用户名。</li>
<li>Routine_name 表示存储过程或函数的过程。</li>
<li>Routine_type 表示存储过程或函数的类型。Routine_type 字段有两个值，分别是 FUNTION 和 PROCEDURE，前者表示存储函数，后者表示存储过程。</li>
<li>Grantor 是插入或修改该记录的用户。</li>
<li>Proc_priv 表示拥有的权限，包括 Execute、Alter Routine 和 Grant 三种。</li>
<li>Timestamp 表示记录更新时间。</li>
</ul>
<h1 id="4-访问控制（了解）"><a class="header-anchor" href="#4-访问控制（了解）"></a>4. 访问控制（了解）</h1>
<p>正常情况下，并不希望每个用户都可以执行所有的数据库操作。当 MySQL 允许一个用户执行各种操作时， 它将首先核实该用户向 MySQL 服务器发送的连接请求，然后确认用户的操作请求是否被允许。这个过程称为 MySQL 中的访问控制过程。MySQL 的访问控制分为两个阶段:连接核实阶段和请求核实阶段。</p>
<h2 id="4-1-连接核实阶段"><a class="header-anchor" href="#4-1-连接核实阶段"></a>4.1 连接核实阶段</h2>
<p>当用户试图连接 MySQL 服务器时，服务器基于用户的身份以及用户是否能提供正确的密码验证身份来确定接受或拒绝连接。即客户端用户会在连接请求中提供用户名、主机地址、用户密码，MySQL 服务器接收到用户请求后，会使用 user 表中的 Host、User 和 authentication_string 这 3 个字段匹配客户端提供信息。</p>
<p>服务器只有在 user 表记录的 Host 和 User 字段匹配客户端主机名和用户名，并且提供正确的密码时才接受连接。如果连接核实没有通过，服务器就完全拒绝访问；否则服务器接受连接，然后进入阶段 2 等待用户请求。</p>
<h2 id="4-2-请求核实阶段"><a class="header-anchor" href="#4-2-请求核实阶段"></a>4.2 请求核实阶段</h2>
<p>一旦建立了连接，服务器就进入了访问控制的阶段 2，也就是请求核实阶段。对此连接上进来的每个请求，服务器会检查该请求要执行什么操作、是否有足够的权限来执行它，这正是需要授权表中的权限列发挥作用的地方。这些权限可以来自 user、db、table_priv 和 column_priv 表。</p>
<p>确认权限时，MySQL 首先检查 user 表，如果指定的权限没有在 user 表中被授予，那么 MySQL 就会继续检查 db 表，db 表是下一安全层级，其中的权限限定于数据库层级，在该层级的 SELECT 权限允许用户查看指定数据库的所有表中的数据；如果在该层级没有找到限定的权限，则 MySQL 继续检查 tables_priv 表以及 columns_priv 表，如果所有权限表都检查完毕，但还是没有找到允许的权限操作，MySQL 将返回错误信息，显示用户请求的操作不能执行，操作失败。</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/MySQL%E8%AF%B7%E6%B1%82%E6%A0%B8%E5%AE%9E%E9%98%B6%E6%AE%B5%E8%BF%87%E7%A8%8B%E5%9B%BE.png" alt="MySQL请求核实阶段过程图"></p>
<p>MySQL 通过向下层级的顺序（从 user 表到 columns_priv 表）检查权限表，但并不是所有的权限都要执行该过程。例如，一个用户登录到 MySQL 服务器之后只执行对 MySQL 的管理操作，此时只涉及管理权限，因此 MySQL 只检查 user 表。另外，如果请求的权限操作不被允许，MySQL 也不会继续检查下一层级的表。</p>
<h1 id="5-角色管理"><a class="header-anchor" href="#5-角色管理"></a>5. 角色管理</h1>
<h2 id="5-1-角色的理解"><a class="header-anchor" href="#5-1-角色的理解"></a>5.1 角色的理解</h2>
<p>角色是在 MySQL 8.0 中引入的新功能。在 MySQL 中，角色是权限的集合，可以为角色添加或移除权限。用户可以被赋予角色，同时也被授予角色包含的权限。对角色进行操作需要较高的权限，并且像用户账户一样，角色可以拥有授予和撤消的权限。</p>
<p>引入角色的目的是方便管理拥有相同权限的用户。恰当的权限设定，可以确保数据的安全性，这是至关重要的。</p>
<p><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/SQLImages/%E8%A7%92%E8%89%B2%E7%9A%84%E7%90%86%E8%A7%A3.png" alt="角色的理解"></p>
<h2 id="5-2-创建角色"><a class="header-anchor" href="#5-2-创建角色"></a>5.2 创建角色</h2>
<p>创建角色使用 <code>CREATE ROLE</code> 语句，语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE ROLE &#x27;role_name&#x27;[@&#x27;host_name&#x27;] [,&#x27;role_name&#x27;[@&#x27;host_name&#x27;]]...</span><br></pre></td></tr></table></figure>
<p>角色名称的命名规则和用户名类似。如果 <code>host_name</code> 省略，默认为 <code>%</code>，<code>role_name</code> 不可省略，不可为空。也可以一次性创建多个用户，彼此以 <code>,</code> 隔开即可。</p>
<p>比如创建一个经理的角色：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE ROLE &#x27;manager&#x27;;</span><br></pre></td></tr></table></figure>
<p>没有写主机名，默认是通配符 <code>%</code>，意思是该用户可以从任何一台主机上登录数据库。</p>
<p>也可以写上主机名，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE ROLE &#x27;manager&#x27;@&#x27;localhost&#x27;;</span><br></pre></td></tr></table></figure>
<p>这表示该用户只能从数据库服务器运行的这台计算机登录。</p>
<h2 id="5-3-给角色赋予权限"><a class="header-anchor" href="#5-3-给角色赋予权限"></a>5.3 给角色赋予权限</h2>
<p>创建角色之后，默认这个角色是没有任何权限的，因此需要给角色授权。基本语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT privileges ON table_name TO &#x27;role_name&#x27;[@&#x27;host_name&#x27;];</span><br></pre></td></tr></table></figure>
<p>上述语句中 <code>privileges</code> 代表权限的名称，多个权限以逗号隔开，可使用 <code>SHOW</code> 语句查询权限名称。</p>
<p>比如查看权限列表信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW privileges \G;</span><br></pre></td></tr></table></figure>
<p>比如给经理角色授予商品信息表、盘点表和应付账款表的只读权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GRANT SELECT ON demo.settlement TO &#x27;manager&#x27;;</span><br><span class="line">GRANT SELECT ON demo.goodsmaster TO &#x27;manager&#x27;;</span><br><span class="line">GRANT SELECT ON demo.invcount TO &#x27;manager&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="5-4-查看角色的权限"><a class="header-anchor" href="#5-4-查看角色的权限"></a>5.4 查看角色的权限</h2>
<p>赋予角色权限之后，可以通过 <code>SHOW GRANTS</code> 语句，来查看权限是否创建成功：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW GRANTS FOR &#x27;manager&#x27;;</span><br></pre></td></tr></table></figure>
<pre>
+-------------------------------------------------------+
| Grants for manager@%                                  |
+-------------------------------------------------------+
| GRANT USAGE ON *.* TO `manager`@`%`                   |
| GRANT SELECT ON `demo`.`goodsmaster` TO `manager`@`%` |
| GRANT SELECT ON `demo`.`invcount` TO `manager`@`%`    |
| GRANT SELECT ON `demo`.`settlement` TO `manager`@`%`  |
+-------------------------------------------------------+
</pre>
<p>只要创建了一个角色，系统就会自动分配一个 <code>USAGE</code> 权限，意思是连接登录数据库的权限。最后三行代表了为角色 manager 授予的权限，也就是对商品信息表、盘点表和应付账款表的只读权限。</p>
<h2 id="5-5-回收角色的权限"><a class="header-anchor" href="#5-5-回收角色的权限"></a>5.5 回收角色的权限</h2>
<p>角色授权后，可以对角色的权限进行维护，对权限进行添加或撤销。添加权限使用 <code>GRANT</code> 语句，与角色授权相同。回收角色或角色权限使用 <code>REVOKE</code> 语句。</p>
<p>修改了角色的权限，会影响拥有该角色的账户的权限。回收角色权限的语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REVOKE privileges ON tablename FROM &#x27;rolename&#x27;;</span><br></pre></td></tr></table></figure>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 回收 school_write 角色的权限</span><br><span class="line">REVOKE INSERT, UPDATE, DELETE ON school.* FROM &#x27;school_write&#x27;;</span><br><span class="line"># 再查看其对应的权限</span><br><span class="line">SHOW GRANTS FOR &#x27;school_write&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="5-6-删除角色"><a class="header-anchor" href="#5-6-删除角色"></a>5.6 删除角色</h2>
<p>当需要对业务重新整合的时候，可能就需要对之前创建的角色进行清理，删除一些不会再使用的角色。语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP ROLE role [,role2]...</span><br></pre></td></tr></table></figure>
<p>如果删除了角色，那么用户也就失去了通过这个角色所获得的所有权限。</p>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP ROLE &#x27;school_read&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="5-7-给用户赋予角色"><a class="header-anchor" href="#5-7-给用户赋予角色"></a>5.7 给用户赋予角色</h2>
<p>角色创建并授权后，要赋予用户并处于 <strong>激活状态</strong> 才能发挥作用。给用户添加角色可使用 <code>GRANT</code> 语句，语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT role [,role2,...] TO user [,user2,...];</span><br></pre></td></tr></table></figure>
<p>上述语句中，role 代表角色，user 代表用户。可将多个角色同时赋予多个用户，用逗号隔开即可。</p>
<p>比如为 mofan 添加 school_read 角色：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 添加 school_read 角色</span><br><span class="line">GRANT &#x27;school_read&#x27; TO &#x27;mofan&#x27;@&#x27;localhost&#x27;;</span><br><span class="line"># 使用 SHOW 查看是否添加成功</span><br><span class="line">SHOW GRANTS FOR &#x27;mofan&#x27;@&#x27;localhost&#x27;;</span><br></pre></td></tr></table></figure>
<p>使用 mofan 用户登录，然后查询当前回话的角色，如果角色未激活，结果将显示 <code>NONE</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT CURRENT_ROLE();</span><br></pre></td></tr></table></figure>
<pre>
+----------------+
| current_role() |
+----------------+
| NONE           |
+----------------+
</pre>
<p>如果此时使用赋予了角色的用户去登录、操作，会发现这个账号没有任何权限。这是因为在 MySQL 中创建角色之后，默认都是没有被激活，也就是不能用， <strong>必须手动激活，</strong> 之后用户才能拥有角色对应的权限。</p>
<h2 id="5-8-激活角色"><a class="header-anchor" href="#5-8-激活角色"></a>5.8 激活角色</h2>
<blockquote>
<p>方式一：使用 <code>SET DEFAULT ROLE</code> 命令激活角色</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET DEFAULT &#x27;school_read&#x27; ALL TO &#x27;mofan&#x27;@&#x27;localhost&#x27;;</span><br></pre></td></tr></table></figure>
<p>也可以同时为多个用户默认激活所有已拥有的角色：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SET DEFAULT &#x27;school_read&#x27; ALL TO </span><br><span class="line">&#x27;dev1&#x27;@&#x27;localhost&#x27;,</span><br><span class="line">&#x27;read_user1&#x27;@&#x27;localhost&#x27;,</span><br><span class="line">&#x27;read_user2&#x27;@&#x27;localhost&#x27;,</span><br><span class="line">&#x27;rw_user1&#x27;@&#x27;localhost&#x27;;</span><br></pre></td></tr></table></figure>
<p>用户需要退出并重新登录才能看到被赋予的角色。</p>
<blockquote>
<p>方式2：将 <code>activate_all_roles_on_login</code> 设置为 ON</p>
</blockquote>
<p>未设置前：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#x27;activate_all_roles_on_login&#x27;;</span><br></pre></td></tr></table></figure>
<pre>
+-----------------------------+-------+
| Variable_name               | Value |
+-----------------------------+-------+
| activate_all_roles_on_login | OFF   |
+-----------------------------+-------+
</pre>
<p>进行设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET GLOBAL activate_all_roles_on_login = ON;</span><br></pre></td></tr></table></figure>
<p>该语句的意思是对所有角色永久激活。运行这条语句之后，用户才真正拥有了赋予角色的所有权限。</p>
<h2 id="5-9-撤销用户的角色"><a class="header-anchor" href="#5-9-撤销用户的角色"></a>5.9 撤销用户的角色</h2>
<p>基本语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REVOKE role FROM user;</span><br></pre></td></tr></table></figure>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 撤销 mofan 的 school_read 角色</span><br><span class="line">REVOKE &#x27;school_read&#x27; FROM &#x27;mofan&#x27;@&#x27;localhost&#x27;;</span><br><span class="line"># 查看 mofan 用户的角色信息</span><br><span class="line">SHOW GRANTS FOR &#x27;mofan&#x27;@&#x27;localhost&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="5-10-设置强制角色"><a class="header-anchor" href="#5-10-设置强制角色"></a>5.10 设置强制角色</h2>
<p>强制角色是给每个创建账户的默认角色，不需要手动设置。强制角色无法被 <code>REVOKE</code> 或 <code>DROP</code>。</p>
<p>可以在服务启动前修改 <code>my.conf</code> 文件：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">mandatory_roles</span>=<span class="string">&#x27;role1,role2@localhost&#x27;</span></span><br></pre></td></tr></table></figure>
<p>也可以在运行时设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 系统重启后仍然有效</span><br><span class="line">SET PERSIST mandatory_roles = &#x27;role1,role2@localhost&#x27;;</span><br><span class="line"># 系统重启后失效</span><br><span class="line">SET GLOBAL mandatory_roles = &#x27;role1,role2@localhost&#x27;;</span><br></pre></td></tr></table></figure>
<h1 id="6-配置文件的使用"><a class="header-anchor" href="#6-配置文件的使用"></a>6. 配置文件的使用</h1>
<h2 id="6-1-配置文件格式"><a class="header-anchor" href="#6-1-配置文件格式"></a>6.1 配置文件格式</h2>
<p>与在命令行中指定启动选项不同的是，配置文件中的启动选项被划分为若干组，每个组有一个组名，用中括号 <code>[]</code> 括起来，比如：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[server]</span></span><br><span class="line"><span class="attr">(具体的启动选项...)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">(具体的启动选项...)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[mysqld_safe]</span></span><br><span class="line"><span class="attr">(具体的启动选项...)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[client]</span></span><br><span class="line"><span class="attr">(具体的启动选项...)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[mysql]</span></span><br><span class="line"><span class="attr">(具体的启动选项...)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[mysqladmin]</span></span><br><span class="line"><span class="attr">(具体的启动选项...)</span></span><br></pre></td></tr></table></figure>
<p>像这个配置文件里就定义了许多个组，组名分别是 <code>server</code>、<code>mysqld</code>、<code>mysqld_safe</code>、<code>client</code>、<code>mysql</code>、<code>mysqladmin</code>。每个组下边可以定义若干个启动选项，以 <code>[server]</code> 组为例来看一下填写启动选项的形式：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[server]</span></span><br><span class="line"><span class="comment"># 该选项不需要选项值</span></span><br><span class="line"><span class="attr">option1</span></span><br><span class="line"><span class="comment"># 该选项需要选项值</span></span><br><span class="line"><span class="attr">option2</span>=<span class="string">value2 </span></span><br><span class="line"><span class="attr">...</span></span><br></pre></td></tr></table></figure>
<p>在配置文件中指定启动选项的语法类似于命令行语法，但是配置文件中指定的启动选项不允许加 <code>--</code> 前缀，并且每行只指定一 个选项，而且 <code>=</code> 周围可以有空白字符（命令行中选项名、<code>=</code>、选项值之间不允许有空白字符）。另外，在配置文件中可以使用 <code>#</code> 来添加注释，从 <code>#</code> 出现直到行尾的内容都属于注释内容，读取配置文件时会忽略这些注释内容。</p>
<h2 id="6-2-启动命令与选项组"><a class="header-anchor" href="#6-2-启动命令与选项组"></a>6.2 启动命令与选项组</h2>
<p>配置文件中不同的选项组是给不同的启动命令使用的。不过有两个选项组比较特别：</p>
<ul>
<li><code>[server]</code> 组下边的启动选项将作用于 <strong>所有的服务器</strong> 程序。</li>
<li><code>[client]</code> 组下边的启动选项将作用于 <strong>所有的客户端</strong> 程序。</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">启动命令</th>
<th style="text-align:center">类别</th>
<th style="text-align:center">能读取的组</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>mysqld</code></td>
<td style="text-align:center">启动服务器</td>
<td style="text-align:center"><code>[mysqld]</code>、<code>[server]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>mysqld_safe</code></td>
<td style="text-align:center">启动服务器</td>
<td style="text-align:center"><code>[mysqld]</code>、<code>[server]</code>、<code>[mysqld_safe]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>mysql.server</code></td>
<td style="text-align:center">启动服务器</td>
<td style="text-align:center"><code>[mysqld]</code>、<code>[server]</code>、<code>[mysql.server]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>mysql</code></td>
<td style="text-align:center">启动客户端</td>
<td style="text-align:center"><code>[mysql]</code>、<code>[client]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>mysqladmin</code></td>
<td style="text-align:center">启动客户端</td>
<td style="text-align:center"><code>[mysqladmin]</code>、<code>[client]</code></td>
</tr>
<tr>
<td style="text-align:center"><code>mysqldump</code></td>
<td style="text-align:center">启动客户端</td>
<td style="text-align:center"><code>[mysqldump]</code>、<code>[client]</code></td>
</tr>
</tbody>
</table>
<p>比如在 <code>/etc/mysql/my.cnf</code> 这个配置文件中添加一些内容：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[server]</span></span><br><span class="line"><span class="attr">skip-networking</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=<span class="string">MyISAM</span></span><br></pre></td></tr></table></figure>
<p>然后直接用 <code>mysqld</code> 启动服务器程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld</span><br></pre></td></tr></table></figure>
<p>虽然在命令行没有添加启动选项，但在程序启动时，会默认到上边提到的配置文件路径下查找配置文件，其中就包括 <code>/etc/my.cnf</code>。又由于 <code>mysqld</code> 命令可以读取 <code>[server]</code> 选项组的内容，所以 <code>skip-networking</code> 和 <code>default-storage-engine=MyISAM</code> 这两个选项是生效的，如果把这些启动选项放在 <code>[client]</code> 组里再用 <code>mysqld</code> 启动服务器程序，是不会生效的。</p>
<h2 id="6-3-特定-MySQL-版本的专用选项组"><a class="header-anchor" href="#6-3-特定-MySQL-版本的专用选项组"></a>6.3 特定 MySQL 版本的专用选项组</h2>
<p>可以在选项组的名称后加上特定的 MySQL 版本号，比如对于 <code>[mysqld]</code> 选项组来说，可以定义一个 <code>[mysqld-5.7]</code> 的选项组，它的含义和 <code>[mysqld]</code> 一样，只不过只有版本号为 <code>5.7</code> 的 <code>mysqld</code> 程序才能使用这个选项组中的选项。</p>
<h2 id="6-4-同一个配置文件中多个组的优先级"><a class="header-anchor" href="#6-4-同一个配置文件中多个组的优先级"></a>6.4 同一个配置文件中多个组的优先级</h2>
<p>同一个命令可以访问配置文件中的多个组，比如 <code>mysqld</code> 可以访问 <code>[mysqld]</code>、<code>[server]</code> 组，如果在同一个配置文件中，比如 <code>~/.my.cnf</code> 文件中的组里出现了同样的配置项：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[server]</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=<span class="string">InnoDB</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[mysqld]</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=<span class="string">MyISAM</span></span><br></pre></td></tr></table></figure>
<p>此时将以最后一个出现的组中的启动选项为准，上方例子中就以 <code>[mysqld]</code> 组中的配置项为准。</p>
<h2 id="6-5-命令行和配置文件中选项的区别"><a class="header-anchor" href="#6-5-命令行和配置文件中选项的区别"></a>6.5 命令行和配置文件中选项的区别</h2>
<p>在命令行上指定的绝大部分启动选项都可以放到配置文件中，但是有一些选项是专门为命令行设计的，比方说 <code>defaults-extra-file</code>、<code>defaults-file</code> 这样的选项本身就是为了指定配置文件路径的，放在配置文件中使用没有任何意义。</p>
<p>如果同一个启动选项既出现在命令行中，又出现在配置文件中，那么以命令行中的启动选项为准。比如在配置文件中写了：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[server]</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=<span class="string">InnoDB</span></span><br></pre></td></tr></table></figure>
<p>而启动命令是：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mysq1.server</span> <span class="string">start --default-storage-engine=MyISAM</span></span><br></pre></td></tr></table></figure>
<p>那么 <code>default-storage-engine</code> 最终的值是 <code>MyISAM</code>。</p>
<h1 id="7-系统变量"><a class="header-anchor" href="#7-系统变量"></a>7. 系统变量</h1>
<p>MySQL 的系统变量已在 【MySQL的变量、流程控制、游标与触发器】一文中讲解，此处仅做复习。</p>
<h2 id="7-1-系统变量简介"><a class="header-anchor" href="#7-1-系统变量简介"></a>7.1 系统变量简介</h2>
<p>MySQL 服务器程序运行过程中会用到许多影响程序行为的变量，它们被称为 MySQL 系统变量。 比如：</p>
<ul>
<li>
<p><code>max_connections</code>：允许同时连入的客户端数量</p>
</li>
<li>
<p><code>default_storage_engine</code>：表的默认存储引擎</p>
</li>
<li>
<p><code>query_cache_size</code>：查询缓存的大小</p>
</li>
</ul>
<p>MySQL 服务器程序的系统变量有很多，在此不再一一列举。</p>
<h2 id="7-2-查看系统变量"><a class="header-anchor" href="#7-2-查看系统变量"></a>7.2 查看系统变量</h2>
<p>查看 MySQL 服务器程序支持的系统变量以及它们的当前值：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看所有全局变量</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> VARIABLES;</span><br><span class="line"># 查看所有会话变量</span><br><span class="line"><span class="keyword">SHOW</span> SESSION VARIABLES;</span><br><span class="line"># 或者直接</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查看满足条件的部分系统变量</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> VARIABLES <span class="keyword">LIKE</span> &quot;%标识符%&quot;;</span><br><span class="line"># 查看满足条件的部分会话变量</span><br><span class="line"><span class="keyword">SHOW</span> SESSION VARIABLES <span class="keyword">LIKE</span> &quot;%标识符%&quot;;</span><br></pre></td></tr></table></figure>
<p>由于系统变量的数量实在太多，所以通常会使用 <code>LIKE</code> 来过滤需要查看的系统变量值，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#x27;default_storage_engine&#x27;;</span><br><span class="line">SHOW VARIABLES LIKE &#x27;max_connections&#x27;;</span><br></pre></td></tr></table></figure>
<p><code>LIKE</code> 也可以跟通配符来进行模糊查询，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询出所有以 default 开头的系统变量值</span><br><span class="line">SHOW VARIABLES LIKE &#x27;default%&#x27;;</span><br></pre></td></tr></table></figure>
<h2 id="7-3-设置系统变量"><a class="header-anchor" href="#7-3-设置系统变量"></a>7.3 设置系统变量</h2>
<blockquote>
<p>通过启动选项设置</p>
</blockquote>
<p>大部分的系统变量都可以通过启动服务器时传送启动选项的方式来进行设置。</p>
<p>主要有以下两种方式：</p>
<ul>
<li>通过命令行添加启动选项</li>
</ul>
<p>比方在启动服务器程序时使用：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mysqld</span> <span class="string">--default-storage-engine=MyISAM --max-connections=10</span></span><br></pre></td></tr></table></figure>
<ul>
<li>通过配置文件添加启动选项</li>
</ul>
<p>可以这样填写配置文件:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[server]</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=<span class="string">MyISAM</span></span><br><span class="line"><span class="attr">max-connections</span>=<span class="string">10</span></span><br></pre></td></tr></table></figure>
<p>当使用上边两种方式中的任意一种启动服务器程序后，再来查看系统变量的值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW VARIABLES LIKE &#x27;default_storage_engine&#x27;;</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>default-storage-engine</code> 和 <code>max-connections</code> 这两个系统变量的值已经被修改。有一点需要注意，对于启动选项来说，如果启动选项名由多个单词组成，各个单词之间用短划线 <code>-</code> 或者下划线 <code>_</code> 连接起来都可以，但它对应的系统变量的单词之间必须使用下划线 <code>_</code> 连接起来。</p>
<blockquote>
<p>服务器程序运行过程中设置</p>
</blockquote>
<p>对于大部分系统变量来说，它们的值可以在服务器程序运行过程中进行动态修改而无需停止并重启服务器，但系统变量有作用范围之分。</p>
<p><strong>设置不同作用范围的系统变量</strong></p>
<p>多个客户端程序可以同时连接到一个服务器程序。对于同一个系统变量，有时想让不同的客户端有不同的值。比方说使客户端 A 对应的默认存储引擎为 InnoDB，所以可以把系统变量 <code>default_storage_engine</code> 的值设置为 <code>InnoDB</code>；而又想让客户端 B 对应的默认存储引擎为 MyISAM，所以可以把系统变量 <code>default_storage_engine</code> 的值设置为 MyISAM。这样两个客户端拥有不同的默认存储引擎，使用时互不影响，十分方便。但是这样各个客户端都私有一份系统变量可能产生下列两个问题：</p>
<ul>
<li>
<p>有一些系统变量并不是针对单个客户端的，比如允许同时连接到服务器的客户端数量 <code>max_ connections</code>，查询缓存的大小 <code>query_cache_size</code>，这些公有的系统变量让某个客户端私有显然不合适。</p>
</li>
<li>
<p>一个新连接到服务器的客户端对应的系统变量的值该怎么设置？</p>
</li>
</ul>
<p>为了解决这两个问题，MySQL 提出了系统变量作用范围的概念，具体来说作用范围分为这两种：</p>
<ul>
<li>
<p>GLOBAL：全局变量，影响服务器的整体操作。</p>
</li>
<li>
<p>SESSION：会话变量，影响某个客户端连接的操作。 （注：SESSION 有个别名叫 LOCAL）</p>
</li>
</ul>
<p>在服务器启动时，会将每个全局变量初始化为其默认值（可以通过命令行或选项文件中指定的选项更改这些默认<br>
值），然后服务器还为每个连接的客户端维护一组会话变量，客户端的会话变量在连接时使用相应全局变量的当<br>
前值初始化。</p>
<p>以 <code>default_storage_engine</code> 举例，在服务器启动时会初始化一个名为 <code>default_storage_engine</code>，作用范围为 <code>GLOBAL</code> 的系统变量，之后每当有一个客户端连接到该服务器时， 服务器都会单独为该客户端分配一个名为 <code>default_storage_engine</code>，作用范围为 SESSION 的系统变量，该作用范围为 SESSION 的系统变量值按照当前作用范围为 GLOBAL 的同名系统变量值进行初始化。</p>
<p>很显然，通过启动选项设置的系统变量的作用范围都是 GLOBAL 的，也就是对所有客户端都有效，因为在系统启动时还没有客户端程序连接进来。了解了系统变量的 GLOBAL 和 SESSION 作用范围后，再看一下在服务器程序运行期间通过客户端程序设置系统变量的语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET [GLOABL|SESSION] 系统变量名 = 值;</span><br></pre></td></tr></table></figure>
<p>或者：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET [@@(GLOBAL|SESSION).]var_name = XXX;</span><br></pre></td></tr></table></figure>
<p>比如，服务器运行过程中把作用范围为 GLOBAL 的系统变量 <code>default_storage_engine</code> 的值修改为 MyISAM，也就是想让之后新连接到服务器的客户端都用 MyISAM 作为默认存储弓|擎，那可以选择下边两条语句中的任意一条来进行设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 方式一</span><br><span class="line">SET GLOBAL default_storage_engine = MyISAM;</span><br><span class="line"># 方式二</span><br><span class="line">SET @@GLOBAL.default_storage_engine = MyISAM;</span><br></pre></td></tr></table></figure>
<p>如果只想对本客户端生效，也可以选择下边三条语句中的任意一条进行设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 方式一</span><br><span class="line">SET SESSION default_storage_engine = MyISAM;</span><br><span class="line"># 方式二</span><br><span class="line">SET @@SESSION.default_storage_engine = MyISAM;</span><br><span class="line"># 方式三</span><br><span class="line">SET default_storage_engine = MyISAM;</span><br></pre></td></tr></table></figure>
<p>从上边的方式三可以看出，如果在设置系统变量的语句中省略了作用范围，默认作用范围就是 SESSION，也就是说 <code>SET 系统变量名 = 值</code> 和 <code>SET SESSION 系统变量名 = 值</code> 是等价的。</p>
<p><strong>查看不同作用范围的系统变量</strong></p>
<p>既然系统变量有作用范围之分，那 <code>SHOW VARIABLES</code> 语句查看的是什么作用范围的系统变量呢？</p>
<p>默认查看的是 SESSION 作用范围的系统变量。</p>
<p>也可以在查看系统变量的语句上加上要查看的系统变量的作用范围：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW [GLOBAL|SESSION] VARIABLES [LIKE 匹配的模式];</span><br></pre></td></tr></table></figure>
<p>如果某个客户端改变了某个系统变量在 GLOBAL 作用范围的值，并不会影响该系统变量在当前已经连接的客户端作用范围为 SESSION 的值，只会影响后续连入的客户端在作用范围为 SESSION 的值。</p>
<p><strong>注意事项</strong></p>
<p>并不是所有系统变量都具有 GLOBAL 和 SESSION 的作用范围。</p>
<ul>
<li>
<p>有一些系统变量只具有 GLOBAL 作用范围，比如表示服务器程序支持同时最多有多少<br>
个客户端程序进行连接的 <code>max_connections</code>。</p>
</li>
<li>
<p>有一些系统变量只具有 SESSION 作用范围，比如表示在对某个包含 <code>AUTO_INCREMENT</code> 列的表进<br>
行插入时，该列初始的值 <code>insert_id</code>。</p>
</li>
<li>
<p>有一些系统变量的值既具有 GLOBAL 作用范围，也具有 SESSION 作用范围，比如 <code>default_storage_engine</code>，当然大部分的系统变量都是这样。</p>
</li>
<li>
<p>还有些系统变量是只读的，并不能设置值。比如表示当前 MySQL 版本的 <code>version</code>，不能设置它的值，只能使用 <code>SHOW VARIABLES</code> 语句查看。</p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://mofan212.github.io">默烦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://mofan212.github.io/posts/MySQL-Advanced-Third-User-And-Permission-Management/">https://mofan212.github.io/posts/MySQL-Advanced-Third-User-And-Permission-Management/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://mofan212.github.io" target="_blank">Mofan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post-share"><div class="social-share" data-image="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/132.jpg" data-sites="wechat,qq,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://fastly.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" target="_blank"><img class="post-qr-code-img" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" target="_blank"><img class="post-qr-code-img" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="prev-post pull-left" href="/posts/From-Callback-To-LambdaSafe/" title="从回调到 LambdaSafe"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/131.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">从回调到 LambdaSafe</div></div></a><a class="next-post pull-right" href="/posts/Spring's-Enhancements-To-Java-Annotation/" title="Spring 对 Java 注解的增强"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/133.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Spring 对 Java 注解的增强</div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a href="/posts/New-Features-Of-MySQL-8/" title="【MySQL 七】MySQL 8.0 的新特性"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/111.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2022-10-03</div><div class="title">【MySQL 七】MySQL 8.0 的新特性</div></div></a><a href="/posts/DDL-And-DML-Of-MySQL/" title="【MySQL 二】DDL 与 DML"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/106.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-07-04</div><div class="title">【MySQL 二】DDL 与 DML</div></div></a><a href="/posts/Variable-Process-Control-Cursor-And-Trigger-Of-MySQL/" title="【MySQL 六】变量、流程控制、游标与触发器"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/110.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2022-10-02</div><div class="title">【MySQL 六】变量、流程控制、游标与触发器</div></div></a><a href="/posts/Data-Type-Of-MySQL/" title="【MySQL 三】数据类型"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/107.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2022-09-12</div><div class="title">【MySQL 三】数据类型</div></div></a><a href="/posts/DQL-Of-MySQL/" title="【MySQL 一】DQL"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/105.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-01-08</div><div class="title">【MySQL 一】DQL</div></div></a><a href="/posts/View-Procedure-And-Function-Of-MySQL/" title="【MySQL 五】视图、存储过程与存储函数"><img class="cover" src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/109.png" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2022-09-24</div><div class="title">【MySQL 五】视图、存储过程与存储函数</div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info is-center"><div class="avatar-img"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">默烦</div><div class="author-info-description">彩笔的打怪升级之路...</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">153</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mofan212"><i class="fab fa-github"></i><span>follow me</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:cy.mofan@foxmail.com" target="_blank" title="邮箱"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a><a class="social-icon" href="https://www.travellings.cn/go.html" target="_blank" title="开往"><i class="fas fa-subway"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">本站所有博文均是博主的学习笔记与个人理解。<strong><font style="color:red">除特别注明外，</font>如需转载，请在文章头部醒目处附带原文链接并<a target="_blank" rel="noopener" href="https://mofan212.gitee.io/mine/" style="color:#49B1F5;text-decoration:underline">告知我</a></strong>你将转载。😊</br><strong><font style="color:red">严禁未遵循规范的转载。</font></strong>😡</br><strong>死去的评论系统复活啦！欢迎到留言板畅所欲言！</strong>当然也可以使用更高效的<a target="_blank" href="https://space.bilibili.com/23658864/dynamic" style="color:#49B1F5;text-decoration:underline"> 哔哩哔哩私信 </a>或<a href="mailto:cy.mofan@foxmail.com" style="color:#49B1F5;text-decoration:underline" target="_blank">邮箱</a>。 😉</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-text">1. 用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E7%99%BB%E5%BD%95MySQL%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">1.1 登录MySQL服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-text">1.2 创建用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7"><span class="toc-text">1.3 修改用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="toc-text">1.4 删除用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E8%AE%BE%E7%BD%AE%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-text">1.5 设置当前用户密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-%E4%BF%AE%E6%94%B9%E5%85%B6%E5%AE%83%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-text">1.6 修改其它用户密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-MySQL8-%E7%9A%84%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="toc-text">1.7 MySQL8 的密码管理（了解）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-text">2. 权限管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%9D%83%E9%99%90%E5%88%97%E8%A1%A8"><span class="toc-text">2.1 权限列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%8E%88%E4%BA%88%E6%9D%83%E9%99%90%E7%9A%84%E5%8E%9F%E5%88%99"><span class="toc-text">2.2 授予权限的原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E6%8E%88%E4%BA%88%E6%9D%83%E9%99%90"><span class="toc-text">2.3 授予权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E6%9F%A5%E7%9C%8B%E6%9D%83%E9%99%90"><span class="toc-text">2.4 查看权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E6%94%B6%E5%9B%9E%E6%9D%83%E9%99%90"><span class="toc-text">2.5 收回权限</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%9D%83%E9%99%90%E8%A1%A8"><span class="toc-text">3. 权限表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-user-%E8%A1%A8"><span class="toc-text">3.1 user 表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-db-%E8%A1%A8"><span class="toc-text">3.2 db 表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-tables-priv-%E8%A1%A8%E5%92%8C-columns-priv-%E8%A1%A8"><span class="toc-text">3.3 tables_priv 表和 columns_priv 表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-procs-priv-%E8%A1%A8"><span class="toc-text">3.4 procs_priv 表</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%EF%BC%88%E4%BA%86%E8%A7%A3%EF%BC%89"><span class="toc-text">4. 访问控制（了解）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E8%BF%9E%E6%8E%A5%E6%A0%B8%E5%AE%9E%E9%98%B6%E6%AE%B5"><span class="toc-text">4.1 连接核实阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E8%AF%B7%E6%B1%82%E6%A0%B8%E5%AE%9E%E9%98%B6%E6%AE%B5"><span class="toc-text">4.2 请求核实阶段</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E8%A7%92%E8%89%B2%E7%AE%A1%E7%90%86"><span class="toc-text">5. 角色管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E8%A7%92%E8%89%B2%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-text">5.1 角色的理解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E5%88%9B%E5%BB%BA%E8%A7%92%E8%89%B2"><span class="toc-text">5.2 创建角色</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E7%BB%99%E8%A7%92%E8%89%B2%E8%B5%8B%E4%BA%88%E6%9D%83%E9%99%90"><span class="toc-text">5.3 给角色赋予权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E6%9F%A5%E7%9C%8B%E8%A7%92%E8%89%B2%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-text">5.4 查看角色的权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-%E5%9B%9E%E6%94%B6%E8%A7%92%E8%89%B2%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-text">5.5 回收角色的权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6-%E5%88%A0%E9%99%A4%E8%A7%92%E8%89%B2"><span class="toc-text">5.6 删除角色</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-7-%E7%BB%99%E7%94%A8%E6%88%B7%E8%B5%8B%E4%BA%88%E8%A7%92%E8%89%B2"><span class="toc-text">5.7 给用户赋予角色</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-8-%E6%BF%80%E6%B4%BB%E8%A7%92%E8%89%B2"><span class="toc-text">5.8 激活角色</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-9-%E6%92%A4%E9%94%80%E7%94%A8%E6%88%B7%E7%9A%84%E8%A7%92%E8%89%B2"><span class="toc-text">5.9 撤销用户的角色</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-10-%E8%AE%BE%E7%BD%AE%E5%BC%BA%E5%88%B6%E8%A7%92%E8%89%B2"><span class="toc-text">5.10 设置强制角色</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">6. 配置文件的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-text">6.1 配置文件格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4%E4%B8%8E%E9%80%89%E9%A1%B9%E7%BB%84"><span class="toc-text">6.2 启动命令与选项组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E7%89%B9%E5%AE%9A-MySQL-%E7%89%88%E6%9C%AC%E7%9A%84%E4%B8%93%E7%94%A8%E9%80%89%E9%A1%B9%E7%BB%84"><span class="toc-text">6.3 特定 MySQL 版本的专用选项组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-%E5%90%8C%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%A4%9A%E4%B8%AA%E7%BB%84%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-text">6.4 同一个配置文件中多个组的优先级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%92%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E9%80%89%E9%A1%B9%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">6.5 命令行和配置文件中选项的区别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-text">7. 系统变量</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F%E7%AE%80%E4%BB%8B"><span class="toc-text">7.1 系统变量简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-text">7.2 查看系统变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F"><span class="toc-text">7.3 设置系统变量</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Something-About-Blog/" title="博客搭建与维护"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/42.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="博客搭建与维护"/></a><div class="content"><a class="title" href="/posts/Something-About-Blog/" title="博客搭建与维护">博客搭建与维护</a><time datetime="2024-10-06T16:00:00.000Z" title="更新于 2024-10-07 00:00:00">2024-10-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Algorithm-Quick-Shell-Sort/" title="【排序算法】快速排序和希尔排序"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/48.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="【排序算法】快速排序和希尔排序"/></a><div class="content"><a class="title" href="/posts/Algorithm-Quick-Shell-Sort/" title="【排序算法】快速排序和希尔排序">【排序算法】快速排序和希尔排序</a><time datetime="2024-09-30T16:00:00.000Z" title="更新于 2024-10-01 00:00:00">2024-10-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Method-Handle/" title="方法句柄"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/142.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="方法句柄"/></a><div class="content"><a class="title" href="/posts/Method-Handle/" title="方法句柄">方法句柄</a><time datetime="2024-09-05T16:00:00.000Z" title="更新于 2024-09-06 00:00:00">2024-09-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Annotation-And-Reflection/" title="注解、类的加载、反射"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/20.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="注解、类的加载、反射"/></a><div class="content"><a class="title" href="/posts/Annotation-And-Reflection/" title="注解、类的加载、反射">注解、类的加载、反射</a><time datetime="2024-08-31T16:00:00.000Z" title="更新于 2024-09-01 00:00:00">2024-09-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/DataStructure-Trie/" title="数据结构之Trie"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/43.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="数据结构之Trie"/></a><div class="content"><a class="title" href="/posts/DataStructure-Trie/" title="数据结构之Trie">数据结构之Trie</a><time datetime="2024-08-28T16:00:00.000Z" title="更新于 2024-08-29 00:00:00">2024-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Spring's-Enhancements-To-Java-Annotation/" title="Spring 对 Java 注解的增强"><img src= "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/133.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Spring 对 Java 注解的增强"/></a><div class="content"><a class="title" href="/posts/Spring's-Enhancements-To-Java-Annotation/" title="Spring 对 Java 注解的增强">Spring 对 Java 注解的增强</a><time datetime="2024-08-26T16:00:00.000Z" title="更新于 2024-08-27 00:00:00">2024-08-27</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 默烦</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://fastly.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://fastly.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://fastly.jsdelivr.net/npm/vanilla-lazyload@latest/dist/lazyload.iife.min.js"></script><script src="https://fastly.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://npm.elemecdn.com/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://fastly.jsdelivr.net/gh/mofan212/blog-static-resources@master/js/mine.min.js"></script><script defer="defer" id="ribbon" src="https://fastly.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="click-show-text" src="https://fastly.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Azathoth,Yog-Sothoth,Shub-Niggurath,Nyarlathotep,Cthulhu,Hastur,Abhoth,Ghroth,Tsathoggua,Cthugha,Deep Ones,Dagon,Chaugnar Faugn,Mordiggian,Shoggoth,Old One,Mi-Go,Great Race of Yith,Flying Polyp,Hounds of Tindalos,Dhole" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@docsearch/css/dist/style.min.css"/><script src="https://fastly.jsdelivr.net/npm/@docsearch/js/dist/umd/index.min.js"></script><script>(() => {
  docsearch(Object.assign({
    appId: 'BAFEL7A6K1',
    apiKey: '89fcb5961984c5c054bf04149f345f38',
    indexName: 'mofan212io',
    container: '#docsearch',
    placeholder: '输入关键字进行搜索',
  }, null))

  const handleClick = () => {
    document.querySelector('.DocSearch-Button').click()
  }

  const searchClickFn = () => {
    btf.addEventListenerPjax(document.querySelector('#search-button > .search'), 'click', handleClick)
  }

  searchClickFn()
  window.addEventListener('pjax:complete', searchClickFn)
})()</script></div></div></body></html>