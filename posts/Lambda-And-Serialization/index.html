<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Lambda ä¸åºåˆ—åŒ– | Mofan</title><meta name="author" content="é»˜çƒ¦,cy.mofan@foxmail.com"><meta name="copyright" content="é»˜çƒ¦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æ€ä¹ˆé€šè¿‡æ–¹æ³•å¼•ç”¨æ¥è·å–å­—æ®µåç§°ã€Lambda è¡¨è¾¾å¼çš„åºåˆ—åŒ–åˆæ˜¯ä»€ä¹ˆï¼Ÿ">
<meta property="og:type" content="article">
<meta property="og:title" content="Lambda ä¸åºåˆ—åŒ–">
<meta property="og:url" content="https://mofan212.github.io/posts/Lambda-And-Serialization/">
<meta property="og:site_name" content="Mofan">
<meta property="og:description" content="æ€ä¹ˆé€šè¿‡æ–¹æ³•å¼•ç”¨æ¥è·å–å­—æ®µåç§°ã€Lambda è¡¨è¾¾å¼çš„åºåˆ—åŒ–åˆæ˜¯ä»€ä¹ˆï¼Ÿ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/104.png">
<meta property="article:published_time" content="2022-07-03T16:00:00.000Z">
<meta property="article:modified_time" content="2024-07-19T16:00:00.000Z">
<meta property="article:author" content="é»˜çƒ¦">
<meta property="article:tag" content="Java-Lambda">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/104.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Lambda ä¸åºåˆ—åŒ–",
  "url": "https://mofan212.github.io/posts/Lambda-And-Serialization/",
  "image": "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/104.png",
  "datePublished": "2022-07-03T16:00:00.000Z",
  "dateModified": "2024-07-19T16:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "é»˜çƒ¦",
      "url": "https://mofan212.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/favicon.png"><link rel="canonical" href="https://mofan212.github.io/posts/Lambda-And-Serialization/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":150,"languages":{"author":"ä½œè€…: é»˜çƒ¦","link":"é“¾æ¥: ","source":"æ¥æº: Mofan","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡","cht_to_chs":"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡","day_to_night":"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  infinitegrid: {
    js: 'https://testingcf.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Lambda ä¸åºåˆ—åŒ–',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources@master/css/myStyle.min.css"><link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/style.css" /><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono-nl.min.css" /><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Mofan" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources/css/minimal.min.css"/><script src="https://testingcf.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">174</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">54</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">37</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> æ–‡ç« </span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> è®¡åˆ’</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> ç»´æŠ¤</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> å…³äºæœ¬ç«™</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> å…³äºæˆ‘</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw fa-solid fa-coins"></i><span> èµåŠ©</span></a></li><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> é‡Œç¨‹ç¢‘</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-subway"></i><span> å¼€å¾€</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/post_top_img.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Mofan</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> æ–‡ç« </span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> è®¡åˆ’</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> ç»´æŠ¤</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> å…³äºæœ¬ç«™</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> å…³äºæˆ‘</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw fa-solid fa-coins"></i><span> èµåŠ©</span></a></li><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> é‡Œç¨‹ç¢‘</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-subway"></i><span> å¼€å¾€</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Lambda ä¸åºåˆ—åŒ–</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-07-03T16:00:00.000Z" title="å‘è¡¨äº 2022-07-04 00:00:00">2022-07-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-07-19T16:00:00.000Z" title="æ›´æ–°äº 2024-07-20 00:00:00">2024-07-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">14.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>57åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;è·ç¦»æœ¬æ–‡ä¸Šæ¬¡æ›´æ–°å·²ç»è¿‡å»&quot;,&quot;messageNext&quot;:&quot;å¤©ï¼Œè¯·æ³¨æ„æ—¶æ•ˆæ€§ã€‚&quot;,&quot;postUpdate&quot;:&quot;2024-07-20 00:00:00&quot;}" hidden></div><p>å°é¢æ¥æºï¼šç¢§è“èˆªçº¿ æ·±åº¦å›éŸ³ æ´»åŠ¨CG</p>
<p>æœ¬æ–‡æ¶‰åŠçš„ä»£ç ï¼š<a target="_blank" rel="noopener" href="https://github.com/mofan212/java8/tree/master/lambda">java8/lambda</a></p>
<p>å‚è€ƒé“¾æ¥ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.jb51.net/article/195308.htm">Java8ä¸­å¦‚ä½•é€šè¿‡æ–¹æ³•å¼•ç”¨è·å–å±æ€§åè¯¦è§£</a></li>
<li><a target="_blank" rel="noopener" href="https://www.vlts.cn/posts/e18e433c.html">JDKä¸­Lambdaè¡¨è¾¾å¼çš„åºåˆ—åŒ–ä¸SerializedLambdaçš„å·§å¦™ä½¿ç”¨</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/HDK2016/p/6838908.html">è¯¦è§£javaå¯¹è±¡çš„åºåˆ—åŒ–</a></li>
<li><a target="_blank" rel="noopener" href="https://www.vlts.cn/posts/8dce25c8.html">èŠèŠJavaå†…çœIntrospector</a></li>
</ul>
<h1 id="0-å‰è¨€"><a class="header-anchor" href="#0-å‰è¨€"></a>0. å‰è¨€</h1>
<p>åˆæ¬¡è§åˆ° Mybatis-Plus ä¸­çš„ LambdaQuery æ—¶ï¼Œå…¶ä½¿ç”¨æ–¹æ³•å¼•ç”¨è·å–å®ä½“å­—æ®µåç§°çš„æ–¹å¼ä¸ºæˆ‘å¯¹ä»£ç é‡æ„çš„ç†è§£æä¾›äº†æ–°æ€è·¯ï¼Œä½†é‚£æ—¶å¹¶æ²¡æœ‰å¯¹å…¶è¿›è¡Œæ·±ç©¶ï¼Œä»…ä»…æ˜¯åœ¨ä½¿ç”¨ Mybatis-Plus æ—¶æ›´å¤šåœ°ä½¿ç”¨ LambdaQueryã€‚</p>
<p>è¿™æ¬¡å°±æ¥å¥½å¥½å” å” ï¼Œå¦‚ä½•é€šè¿‡ Java8 çš„æ–¹æ³•å¼•ç”¨æ¥è·å–å®ä½“å­—æ®µåç§°ï¼Œä»¥åŠèƒŒåçš„å®ç°åŸç†ã€‚</p>
<p>æœ¬æ–‡åŸºäº JDK8 ç¼–å†™å¹¶åœ¨å¼€ç¯‡ç›´æ¥ç»™å‡ºé€šè¿‡æ–¹æ³•å¼•ç”¨è·å–å­—æ®µåç§°çš„å…·ä½“å®ç°ï¼Œè€Œåé€šè¿‡å¯¹å…·ä½“å®ç°è¿›è¡Œé€è¡Œåˆ†æå®Œæˆå…¨æ–‡ç¼–å†™ã€‚</p>
<h1 id="1-é€šè¿‡æ–¹æ³•å¼•ç”¨è·å–å­—æ®µåç§°"><a class="header-anchor" href="#1-é€šè¿‡æ–¹æ³•å¼•ç”¨è·å–å­—æ®µåç§°"></a>1. é€šè¿‡æ–¹æ³•å¼•ç”¨è·å–å­—æ®µåç§°</h1>
<h2 id="1-1-å…·ä½“å®ç°"><a class="header-anchor" href="#1-1-å…·ä½“å®ç°"></a>1.1 å…·ä½“å®ç°</h2>
<p>é¦–å…ˆéœ€è¦ä¸€ä¸ª <strong>å¯åºåˆ—åŒ–</strong> çš„å‡½æ•°å¼æ¥å£ï¼Œç”±äº JDK ä¸­å¹¶æ²¡æœ‰æä¾›å¯åºåˆ—åŒ–çš„å‡½æ•°å¼æ¥å£ï¼Œå› æ­¤éœ€è¦è‡ªè¡Œå®šä¹‰ä¸€ä¸ªï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/7 17:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SFunction</span>&lt;T, R&gt; <span class="keyword">extends</span> <span class="title class_">Serializable</span>, Function&lt;T, R&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå¯ä»¥é€šè¿‡æ–¹æ³•å¼•ç”¨è·å–åˆ°å®ä½“ç±»çš„å­—æ®µåç§°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReflectionUtil</span><span class="params">()</span> &#123;</span><br><span class="line">    SFunction&lt;Person, String&gt; function = Person::getName;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fieldName</span> <span class="operator">=</span> ReflectionUtil.getFieldName(function);</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;name&quot;</span>, fieldName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ <code>ReflectionUtil.getFieldName()</code> åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/9 16:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectionUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">GETTER_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;get&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BOOLEAN_GETTER_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;is&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LAMBDA_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;lambda$&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;SFunction&lt;?, ?&gt;, Field&gt; CACHE = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, R&gt; String <span class="title function_">getFieldName</span><span class="params">(SFunction&lt;T, R&gt; function)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getField(function).getName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Field <span class="title function_">getField</span><span class="params">(SFunction&lt;?, ?&gt; function)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CACHE.computeIfAbsent(function, ReflectionUtil::findField);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Field <span class="title function_">findField</span><span class="params">(SFunction&lt;?, ?&gt; function)</span> &#123;</span><br><span class="line">        Field field;</span><br><span class="line">        String fieldName;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Optional&lt;SerializedLambda&gt; serializedLambda = LambdaUtil.getSerializedLambda(function);</span><br><span class="line">            <span class="type">String</span> <span class="variable">implMethodName</span> <span class="operator">=</span> serializedLambda.map(SerializedLambda::getImplMethodName).orElse(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (implMethodName.startsWith(GETTER_PREFIX) &amp;&amp; implMethodName.length() &gt; GETTER_PREFIX.length()) &#123;</span><br><span class="line">                fieldName = Introspector.decapitalize(implMethodName.substring(GETTER_PREFIX.length()));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (implMethodName.startsWith(BOOLEAN_GETTER_PREFIX) &amp;&amp; implMethodName.length() &gt; BOOLEAN_GETTER_PREFIX.length()) &#123;</span><br><span class="line">                fieldName = Introspector.decapitalize(implMethodName.substring(BOOLEAN_GETTER_PREFIX.length()));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (implMethodName.startsWith(LAMBDA_PREFIX)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;ä¸æ”¯æŒ Lambda è¡¨è¾¾å¼ï¼Œè¯·ä½¿ç”¨æ–¹æ³•å¼•ç”¨&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(implMethodName + <span class="string">&quot;ä¸æ˜¯ Getter æ–¹æ³•å¼•ç”¨&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">String</span> <span class="variable">implClass</span> <span class="operator">=</span> serializedLambda.map(SerializedLambda::getImplClass).orElse(<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">            Class&lt;?&gt; aClass = Class.forName(implClass, <span class="literal">false</span>, ClassUtils.getDefaultClassLoader());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é€šè¿‡ Spring çš„ ReflectionUtils è·å– Field å¯¹è±¡</span></span><br><span class="line">            field = ReflectionUtils.findField(aClass, fieldName);</span><br><span class="line">            <span class="keyword">if</span> (field != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> field;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchFieldException</span>(fieldName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;å­—æ®µä¿¡æ¯è·å–å¤±è´¥ &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>findField()</code> æ–¹æ³•å¼€å§‹ï¼Œé¦–å…ˆä½¿ç”¨äº† <code>LambdaUtil.getSerializedLambda()</code> è·å–è¢« <code>Optional</code> åŒ…è£…çš„ <code>SerializedLambda</code> å¯¹è±¡ï¼Œé‚£ <code>getSerializedLambda()</code> åˆæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LambdaUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getImplClass</span><span class="params">(Serializable serializable)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> getSerializedLambda(serializable)</span><br><span class="line">            .map(i -&gt; i.getImplClass().replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>))</span><br><span class="line">            .orElse(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Optional&lt;SerializedLambda&gt; <span class="title function_">getSerializedLambda</span><span class="params">(Serializable serializable)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class&lt;? <span class="keyword">extends</span> <span class="title class_">Serializable</span>&gt; aClass = serializable.getClass();</span><br><span class="line">        <span class="keyword">if</span> (aClass.isSynthetic()) &#123;</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> aClass.getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">            method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span> Optional.of((SerializedLambda) method.invoke(serializable));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>ReflectionUtil</code> ä¸­æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<p>1ã€<code>String getFieldName(SFunction&lt;T, R&gt; function)</code>ï¼šè·å–å­—æ®µåç§°å¯¹åº”çš„å­—ç¬¦ä¸²ï¼›</p>
<p>2ã€<code>Field getField(SFunction&lt;?, ?&gt; function)</code>ï¼šè·å–å­—æ®µåç§°å¯¹åº”çš„ <code>Field</code> å¯¹è±¡ã€‚å¦‚æœç¼“å­˜ä¸­å­˜åœ¨åˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ï¼Œå¦åˆ™é€šè¿‡åå°„è·å–å¹¶å°†å…¶æ”¾å…¥ç¼“å­˜ä¸­ï¼›</p>
<p>3ã€<code>Field findField(SFunction&lt;?, ?&gt; function)</code>ï¼šé€šè¿‡åå°„è·å–å­—æ®µåç§°å¯¹åº”çš„ <code>Field</code> å¯¹è±¡ã€‚</p>
<h2 id="1-2-é—®é¢˜çš„æŠ›å‡º"><a class="header-anchor" href="#1-2-é—®é¢˜çš„æŠ›å‡º"></a>1.2 é—®é¢˜çš„æŠ›å‡º</h2>
<p>ä¸éš¾çœ‹å‡ºä¸Šè¿°å…·ä½“å®ç°ä¸­çš„è¦ç‚¹å°±æ˜¯é€šè¿‡ <code>SerializedLambda</code> å¯¹è±¡è·å–åˆ°ä½¿ç”¨çš„æ–¹æ³•å¼•ç”¨ä¸­çš„ä¿¡æ¯ï¼Œè€Œè·å– <code>SerializedLambda</code> å¯¹è±¡åˆ™æ˜¯é€šè¿‡åå°„è°ƒç”¨ <code>writeReplace()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>
<p><code>SerializedLambda</code> æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</li>
<li>
<p><code>writeReplace()</code> æ–¹æ³•åˆæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</li>
</ul>
<p>è¦å›ç­”è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå¾—å…ˆå¼„æ¸…æ¥š Java çš„åºåˆ—åŒ–ã€‚</p>
<h1 id="2-Java-çš„åºåˆ—åŒ–"><a class="header-anchor" href="#2-Java-çš„åºåˆ—åŒ–"></a>2. Java çš„åºåˆ—åŒ–</h1>
<h2 id="2-1-ä»€ä¹ˆæ˜¯åºåˆ—åŒ–"><a class="header-anchor" href="#2-1-ä»€ä¹ˆæ˜¯åºåˆ—åŒ–"></a>2.1 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–</h2>
<p>åºåˆ—åŒ–ï¼ˆSerializationï¼‰æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯è½¬æ¢ä¸ºå¯ä»¥å­˜å‚¨æˆ–ä¼ è¾“çš„å½¢å¼çš„è¿‡ç¨‹ã€‚æ¯”å¦‚å°†ä¸€ä¸ªå¯¹è±¡åºåˆ—åŒ–åå¯ä»¥å°†å®ƒçš„ä¿¡æ¯å­˜å‚¨åˆ°ç£ç›˜ä¸­çš„æŸä¸ªæ–‡ä»¶é‡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡ååºåˆ—åŒ–å°†æ–‡ä»¶é‡Œçš„ä¿¡æ¯è¯»å–å‡ºæ¥å¹¶æ¢å¤æˆåŸæ¥çš„å¯¹è±¡ã€‚ä½¿ç”¨åºåˆ—åŒ–å¯ä»¥è®©å¯¹è±¡è„±ç¦»ç¨‹åºç‹¬ç«‹å­˜åœ¨ã€‚</p>
<p>å¦‚æœæƒ³è®©æŸä¸ªç±»èƒ½è¢«åºåˆ—åŒ–ï¼Œé‚£ä¹ˆå®ƒ <strong>å¿…é¡»</strong> å®ç° <code>Serializable</code> æ¥å£ã€‚<code>Serializable</code> æ¥å£åªæ˜¯ä¸€ä¸ª <strong>æ ‡è®°</strong> æ¥å£ï¼Œå®ƒé‡Œé¢æ²¡æœ‰ä»»ä½•æŠ½è±¡æ–¹æ³•ï¼Œå®ƒä»…è¡¨ç¤ºå®ç°å®ƒçš„å­ç±»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚</p>
<p>æ‰€æœ‰éœ€è¦åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„ç±»éƒ½åº”è¯¥æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œæ‰€æœ‰éœ€è¦è¢«ä¿å­˜åœ¨ç£ç›˜ä¸Šçš„ç±»ä¹Ÿåº”è¯¥æ˜¯å¯åºåˆ—åŒ–çš„ã€‚</p>
<h2 id="2-2-Java-åºåˆ—åŒ–çš„ç»†èŠ‚"><a class="header-anchor" href="#2-2-Java-åºåˆ—åŒ–çš„ç»†èŠ‚"></a>2.2 Java åºåˆ—åŒ–çš„ç»†èŠ‚</h2>
<p>1ã€ä¸€ä¸ªå¯¹è±¡è¢«åºåˆ—åŒ–æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡çš„ç±»åã€æœªè¢« <code>transient</code> ä¿®é¥°çš„æˆå‘˜å˜é‡éƒ½ä¼šè¢«åºåˆ—åŒ–ï¼Œå¯¹è±¡çš„æ–¹æ³•ã€ç±»å˜é‡ï¼ˆè¢« <code>static</code> ä¿®é¥°çš„å˜é‡ï¼‰ã€è¢« <code>transient</code> ä¿®é¥°çš„æˆå‘˜å˜é‡ä¸ä¼šè¢«åºåˆ—åŒ–ï¼›</p>
<p>2ã€è¦ä¸€ä¸ªæˆå‘˜å˜é‡ä¸è¢«åºåˆ—åŒ–ï¼Œå¯ä»¥ç”¨ <code>transient</code> å…³é”®è¯ä¿®é¥°å®ƒï¼›</p>
<p>3ã€å¦‚æœç±»é‡Œé¢æœ‰å¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨ç±»å‹ä¹Ÿ <strong>å¿…é¡»</strong> æ˜¯å¯åºåˆ—åŒ–çš„ï¼ˆæˆ–è€…ä½¿ç”¨ <code>transient</code> ä¿®é¥°ï¼‰ï¼Œå¦åˆ™è¿™ä¸ªç±»ä¸èƒ½è¢«åºåˆ—åŒ–ï¼›</p>
<p>4ã€ååºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œ<strong>å¿…é¡»</strong> æœ‰ç›®æ ‡å¯¹è±¡çš„ Class æ–‡ä»¶ï¼›</p>
<p>5ã€é€šè¿‡ç½‘ç»œã€æ–‡ä»¶æ¥ä¼ è¾“åºåˆ—åŒ–çš„å¯¹è±¡æ—¶ï¼Œ<strong>å¿…é¡»</strong> æŒ‰ç…§å®é™…å†™å…¥é¡ºåºè¯»å–ã€‚</p>
<h2 id="2-3-åºåˆ—åŒ–çš„ç®€å•ç¤ºä¾‹"><a class="header-anchor" href="#2-3-åºåˆ—åŒ–çš„ç®€å•ç¤ºä¾‹"></a>2.3 åºåˆ—åŒ–çš„ç®€å•ç¤ºä¾‹</h2>
<p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªç®€å•çš„ <code>People</code> ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/22 19:46</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">People</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">8209986739933993768L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">People</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Peopleçš„æ— å‚æ„é€ å™¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Peopleçš„cloneæ–¹æ³•&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆ›å»ºä¸€ä¸ª <code>People</code> å¯¹è±¡å¹¶å°†å…¶ä¿å­˜åˆ° <code>mofan.out</code> æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSerial</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;Mofan&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;mofan.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    oos.writeObject(people);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­åºåˆ—åŒ–ç”Ÿæˆçš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    Assert.assertTrue(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;mofan.out&quot;</span>).exists());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åå†ä½¿ç”¨ä¸‹é¢çš„ä»£ç ä» <code>mofan.out</code> æ–‡ä»¶ä¸­ååºåˆ—åŒ–ç”Ÿæˆ <code>People</code> å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeSerial</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;mofan.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * æ„é€  People å¯¹è±¡æ—¶ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨å®ƒçš„æ— å‚æ„é€ æ–¹æ³•ä¹Ÿæ²¡æœ‰è°ƒç”¨ clone æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> (People) ois.readObject();</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;Mofan&quot;</span>, people.getName());</span><br><span class="line">    Assert.assertEquals(<span class="number">20</span>, people.getAge());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œä¸Šè¿°ååºåˆ—åŒ–çš„ä»£ç åè§‚å¯Ÿ IDEA æ§åˆ¶å°çš„è¾“å‡ºä¼šå‘ç°å¹¶æ²¡æœ‰è¾“å‡ºä»»ä½•å†…å®¹ï¼Œè¿™è¯´æ˜ååºåˆ—åŒ–åˆ›å»ºå¯¹è±¡æ—¶å¹¶æ²¡æœ‰è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰è°ƒç”¨ <code>clone()</code> æ–¹æ³•ï¼Œå¯ä»¥è®¤ä¸ºååºåˆ—åŒ–åˆ›å»ºå¯¹è±¡æ˜¯ä¸€ç§ç‰¹æ®Šçš„åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ã€‚</p>
<p>æ›´å¤šå…³äºå¦‚ä½•åˆ›å»ºå¯¹è±¡çš„å†…å®¹å¯ä»¥å‚è€ƒæœ¬ç«™ã€Šå•èº«ç‹—çš„ç¦éŸ³â€”â€”å¦‚ä½•è·å¾—ä¸€ä¸ªå¯¹è±¡ã€‹ä¸€æ–‡ï¼ˆå¥½ä¸­äºŒçš„æ ‡é¢˜ ğŸ˜‚ï¼‰ã€‚</p>
<p>å¦‚æœè¢«åºåˆ—åŒ–å¯¹è±¡æ²¡æœ‰å®ç° <code>Serializable</code> æ¥å£ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º <code>NotSerializableException</code> å¼‚å¸¸ã€‚æ¯”å¦‚å®šä¹‰ä¸€ä¸ªâ€œç®€å•â€ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/28 19:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Simple</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String stringField;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå®ä¾‹åŒ–â€œç®€å•â€å¯¹è±¡ï¼Œå¹¶å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testNotImplSerializable</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Simple</span> <span class="variable">simple</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Simple</span>(<span class="string">&quot;simple&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–æ—¶åºåˆ—åŒ–å¯¹è±¡æœªå®ç°åºåˆ—åŒ–æ¥å£</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;simple.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        oos.writeObject(simple);</span><br><span class="line">        Assert.fail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        Assert.assertTrue(e <span class="keyword">instanceof</span> NotSerializableException);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç®€å•æŸ¥çœ‹æºç ï¼Œåœ¨ <code>ObjectOutputStream</code> çš„ <code>writeObject0()</code> æ–¹æ³•ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/writeObject0%E6%96%B9%E6%B3%95%E9%83%A8%E5%88%86%E6%BA%90%E7%A0%81.png" alt="writeObject0æ–¹æ³•éƒ¨åˆ†æºç "></p>
<p><strong>å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸æ˜¯å­—ç¬¦ä¸²ã€æ•°ç»„ã€æšä¸¾ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰å®ç° <code>Serializable</code> æ¥å£ï¼Œ</strong> é‚£ä¹ˆå°±ä¼šæŠ›å‡º <code>NotSerializableException</code> å¼‚å¸¸ï¼Œå¹¶ä¸”è¿™æ®µä»£ç ä¹Ÿè¯æ˜äº† <code>Serializable</code> æ¥å£ä»…ä»…æ˜¯åšä¸€ä¸ªæ ‡è¯†ï¼Œæ€ä¹ˆè¿›è¡Œåºåˆ—åŒ–å¹¶ä¸æ˜¯ç”±å®ƒå®Œæˆçš„ã€‚</p>
<h2 id="2-4-å¼•ç”¨å¯¹è±¡çš„åºåˆ—åŒ–"><a class="header-anchor" href="#2-4-å¼•ç”¨å¯¹è±¡çš„åºåˆ—åŒ–"></a>2.4 å¼•ç”¨å¯¹è±¡çš„åºåˆ—åŒ–</h2>
<p>åœ¨ä¸Šè¿°ç®€å•çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº† <code>People</code> ç±»ï¼Œå®ƒå«æœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼Œç±»å‹åˆ†åˆ«æ˜¯åŸºæœ¬ç±»å‹ <code>int</code> å’Œå¼•ç”¨ç±»å‹ <code>String</code>ã€‚ è§‚å¯Ÿ <code>String</code> æºç å¯çŸ¥ï¼Œ<code>String</code> ä¹Ÿå®ç°äº†åºåˆ—åŒ–æ¥å£ã€‚</p>
<p>åœ¨ã€2.2 åºåˆ—åŒ–çš„ç»†èŠ‚ã€‘ä¸­è¯´è¿‡ï¼šå¦‚æœç±»é‡Œé¢æœ‰å¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨ç±»å‹ä¹Ÿ <strong>å¿…é¡»</strong> æ˜¯å¯åºåˆ—åŒ–çš„ï¼ˆæˆ–è€…ä½¿ç”¨ <code>transient</code> ä¿®é¥°ï¼‰ï¼Œå¦åˆ™è¿™ä¸ªç±»ä¸èƒ½è¢«åºåˆ—åŒ–ã€‚</p>
<blockquote>
<p>åºåˆ—åŒ–å«æœ‰å¼•ç”¨ç±»å‹å­—æ®µçš„å¯¹è±¡</p>
</blockquote>
<p>ä¾‹å¦‚å®šä¹‰ <code>Company</code> ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/23 15:24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Company</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">2033276417972897957L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String companyName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;People&gt; employees;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Company</span><span class="params">(String companyName, List&lt;People&gt; employees)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.companyName = companyName;</span><br><span class="line">        <span class="built_in">this</span>.employees = employees;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>Company</code> ç±»ä¸­ï¼Œæœ‰ä¸¤ä¸ªå¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªå¼•ç”¨ç±»å‹å¯¹åº”çš„ç±»éƒ½æ˜¯å¯åºåˆ—åŒ–çš„ã€‚</p>
<p>ç¼–å†™ç®€å•çš„æµ‹è¯•æ–¹æ³•å¯¹ <code>Company</code> å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ã€ååºåˆ—åŒ–æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSerialReferenceType</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    List&lt;People&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;mofan&quot;</span>, <span class="number">20</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;MOFAN&quot;</span>, <span class="number">21</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;é»˜çƒ¦&quot;</span>, <span class="number">21</span>));</span><br><span class="line"></span><br><span class="line">    <span class="type">Company</span> <span class="variable">hugeCompany</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Company</span>(<span class="string">&quot;å¤§å…¬å¸&quot;</span>, list);</span><br><span class="line">    <span class="type">Company</span> <span class="variable">smallCompany</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Company</span>(<span class="string">&quot;å°å…¬å¸&quot;</span>, list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–å¯¹è±¡</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;company.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    oos.writeObject(list);</span><br><span class="line">    oos.writeObject(hugeCompany);</span><br><span class="line">    oos.writeObject(smallCompany);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¾æ¬¡ååºåˆ—åŒ–å¯¹è±¡</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;company.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">    List&lt;People&gt; deSerialList = (List&lt;People&gt;) ois.readObject();</span><br><span class="line">    <span class="type">Company</span> <span class="variable">deSerialHugeCompany</span> <span class="operator">=</span> (Company) ois.readObject();</span><br><span class="line">    <span class="type">Company</span> <span class="variable">deSerialSmallCompany</span> <span class="operator">=</span> (Company) ois.readObject();</span><br><span class="line"></span><br><span class="line">    Assert.assertSame(deSerialList, deSerialHugeCompany.getEmployees());</span><br><span class="line">    Assert.assertSame(deSerialList, deSerialSmallCompany.getEmployees());</span><br><span class="line">    Assert.assertNotSame(deSerialHugeCompany, deSerialSmallCompany);</span><br><span class="line"></span><br><span class="line">    Assert.assertNotSame(list, deSerialList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•æ–¹æ³•åï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–éƒ½èƒ½å¤ŸæˆåŠŸï¼Œå¹¶ä¸”è¿˜å‘ç°ï¼šåºåˆ—åŒ–å‰çš„å¯¹è±¡å¼•ç”¨å…³ç³»å’Œååºåˆ—åŒ–åçš„å¯¹è±¡å¼•ç”¨å…³ç³»æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æ¯”å¦‚ï¼Œåºåˆ—åŒ–å‰æ„é€ çš„ <code>List</code> å¯¹è±¡ã€<code>hugeCompany</code> å¯¹è±¡ä¸­å¼•ç”¨çš„ <code>List</code> å¯¹è±¡å’Œ <code>smallCompany</code> å¯¹è±¡ä¸­å¼•ç”¨çš„ <code>List</code> å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œåœ¨ååºåˆ—åŒ–åæ„é€ çš„ <code>List</code> å¯¹è±¡ã€<code>deSerialHugeCompany</code> å¯¹è±¡ä¸­å¼•ç”¨çš„ <code>List</code> å¯¹è±¡å’Œ <code>deSerialSmallCompany</code> å¯¹è±¡ä¸­å¼•ç”¨çš„ <code>List</code> å¯¹è±¡ä¹Ÿæ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚å½“ç„¶äº†ï¼Œåºåˆ—åŒ–å‰çš„ <code>List</code> å¯¹è±¡å’Œååºåˆ—åŒ–å <code>List</code> å¯¹è±¡ <strong>è‚¯å®šä¸æ˜¯</strong> åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>
<blockquote>
<p>Java åºåˆ—åŒ–æœºåˆ¶ç»†èŠ‚</p>
</blockquote>
<p>1ã€æ‰€æœ‰ä¿å­˜åˆ°ç£ç›˜ä¸­çš„å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåºåˆ—åŒ–ç¼–å·ï¼›</p>
<p>2ã€å½“ç¨‹åºè¯•å›¾åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œç¨‹åºå°†æ£€æŸ¥è¯¥å¯¹è±¡æ˜¯å¦è¢«åºåˆ—åŒ–è¿‡ï¼Œåªæœ‰è¯¥å¯¹è±¡ä»æœªè¢«åºåˆ—åŒ–ï¼ˆåœ¨æœ¬æ¬¡è™šæ‹Ÿæœºä¸­ï¼‰è¿‡ï¼Œç³»ç»Ÿæ‰ä¼šå°†è¯¥å¯¹è±¡è½¬åŒ–ä¸ºå­—èŠ‚åºåˆ—è¾“å‡ºï¼›</p>
<p>3ã€å¦‚æœæŸä¸ªå¯¹è±¡å·²ç»è¢«åºåˆ—åŒ–è¿‡äº†ï¼Œç¨‹åºåªæ˜¯è¾“å‡ºä¸€ä¸ªåºåˆ—åŒ–ç¼–å·ï¼Œè€Œä¸æ˜¯é‡æ–°åºåˆ—åŒ–è¯¥å¯¹è±¡ã€‚</p>
<blockquote>
<p>åºåˆ—åŒ–å«æœ‰æœªå®ç° <code>Serializable</code> æ¥å£çš„å¼•ç”¨ç±»å‹å­—æ®µçš„å¯¹è±¡</p>
</blockquote>
<p>å®šä¹‰ä¸€ä¸ª <code>Complex</code> ç±»ï¼Œåœ¨è¿™ä¸ªç±»ä¸­å¼•ç”¨æœªå®ç° <code>Serializable</code> æ¥å£çš„ <code>Simple</code> ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/28 19:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Complex</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">7663091376889314225L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> intField;</span><br><span class="line">    <span class="keyword">private</span> Simple simple;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åç¼–å†™æµ‹è¯•æ–¹æ³•æµ‹è¯• <code>Complex</code> å¯¹è±¡èƒ½å¦è¢«åºåˆ—åŒ–æˆåŠŸï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testNotImplSerializableFiled</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Simple</span> <span class="variable">simple</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Simple</span>(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">    <span class="type">Complex</span> <span class="variable">complex</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Complex</span>(<span class="number">100</span>, simple);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;complex.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        oos.writeObject(complex);</span><br><span class="line">        Assert.fail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="comment">// æŠ›å‡º NotSerializableException</span></span><br><span class="line">        Assert.assertTrue(e <span class="keyword">instanceof</span> NotSerializableException);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ‰§è¡Œ <code>oos.writeObject(complex);</code> æ—¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œå°†å…¶æ•è·åè¿›è¡Œæ–­è¨€ï¼Œå‘ç°æŠ›å‡ºäº† <code>NotSerializableException</code> å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åºåˆ—åŒ–å«æœ‰æœªå®ç° <code>Serializable</code> æ¥å£çš„å¼•ç”¨ç±»å‹å­—æ®µçš„å¯¹è±¡æ—¶å°†æŠ›å‡º <code>NotSerializableException</code> å¼‚å¸¸ã€‚</p>
<blockquote>
<p>ä½¿ç”¨ <code>transient</code> ä¿®é¥°ä¸éœ€è¦è¢«åºåˆ—åŒ–çš„å­—æ®µ</p>
</blockquote>
<p>å½“å¯¹è±¡ä¸­çš„æŸäº›å­—æ®µä¸éœ€è¦è¢«åºåˆ—åŒ–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>transient</code> å…³é”®è¯å¯¹è¿™ä¸ªå­—æ®µè¿›è¡Œä¿®é¥°ã€‚æ¯”å¦‚å¯ä»¥ä½¿ç”¨ <code>transient</code> ä¿®é¥°æœªå®ç° <code>Serializable</code> æ¥å£çš„ <code>Simple</code> ç±»å‹çš„å­—æ®µï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/28 19:40</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransientComplex</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">6616158309969761040L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Simple simple;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> bool;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„è¯å³ä½¿ <code>Simple</code> æœªå®ç°åºåˆ—åŒ–æ¥å£ï¼Œåœ¨åºåˆ—åŒ– <code>TransientComplex</code> å¯¹è±¡æ—¶ä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTransient</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Simple</span> <span class="variable">simple</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Simple</span>(<span class="string">&quot;TestString&quot;</span>);</span><br><span class="line">    <span class="type">TransientComplex</span> <span class="variable">transientComplex</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransientComplex</span>(<span class="string">&quot;string&quot;</span>, simple, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;transient.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    oos.writeObject(transientComplex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;transient.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">    <span class="type">TransientComplex</span> <span class="variable">object</span> <span class="operator">=</span> (TransientComplex) ois.readObject();</span><br><span class="line"></span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;string&quot;</span>, object.getString());</span><br><span class="line">    Assert.assertTrue(object.isBool());</span><br><span class="line">    <span class="comment">// è™½ç„¶ Simple æ²¡æœ‰å®ç°åºåˆ—åŒ–æ¥å£ï¼Œä½†å®ƒè¢« transient ä¿®é¥°ï¼Œä¸ä¼šè¢«åºåˆ—åŒ–ï¼Œå› æ­¤ä¹Ÿä¸ä¼šæŠ¥é”™</span></span><br><span class="line">    Assert.assertNull(object.getSimple());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é™¤äº†ä½¿ç”¨ <code>transient</code> å…³é”®è¯å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>static</code> å…³é”®è¯æ¥ä½¿æŸä¸ªå­—æ®µä¸è¢«åºåˆ—åŒ–ï¼Œè¿™å¾ˆå¥½ç†è§£ï¼Œåºåˆ—åŒ–æ˜¯ä¸ºäº†ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œä½¿ç”¨ <code>static</code> ä¿®é¥°å­—æ®µåï¼Œè¿™ä¸ªå­—æ®µå°±å˜æˆäº†ç±»çš„çŠ¶æ€ï¼Œå› æ­¤åºåˆ—åŒ–æ—¶ä¹Ÿå°±ä¼šæŠŠå®ƒå¿½ç•¥äº†ã€‚åªä¸è¿‡å¹¶ä¸å»ºè®®ä¸ºäº†ä½¿æŸä¸ªå­—æ®µä¸è¢«åºåˆ—åŒ–å°± <strong>å¼ºè¡Œ</strong> è®© <code>static</code> ä¿®é¥°å®ƒã€‚</p>
<h2 id="2-5-åºåˆ—åŒ–çš„çº¦æŸ"><a class="header-anchor" href="#2-5-åºåˆ—åŒ–çš„çº¦æŸ"></a>2.5 åºåˆ—åŒ–çš„çº¦æŸ</h2>
<p>åºåˆ—åŒ–æ˜¯å°† Java å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—ï¼Œè€Œååºåˆ—åŒ–å°±æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„é€†è½¬ï¼Œè€Œåœ¨åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä»–äººå¯¹ä¸­é—´çš„å­—èŠ‚æµè¿›è¡Œäº†ç¯¡æ”¹ï¼Œé‚£ä¹ˆååºåˆ—åŒ–å‡ºçš„å¯¹è±¡å°†ä¼šå­˜åœ¨é—®é¢˜ã€‚</p>
<p>å¦‚æœåœ¨ååºåˆ—åŒ–æ—¶èƒ½å¤Ÿå¯¹æ„é€ å‡ºçš„å¯¹è±¡è¿›è¡Œæ ¡éªŒï¼Œé‚£å°±å¯ä»¥åœ¨ <strong>ä¸€å®šç¨‹åº¦ä¸Š</strong> é˜²æ­¢ä»–äººç¯¡æ”¹æ•°æ®ã€‚åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­è¿›è¡Œååºåˆ—åŒ–æ„é€ å¯¹è±¡æ—¶éƒ½è°ƒç”¨äº† <code>ObjectInputStream</code> çš„ <code>readObject()</code> æ–¹æ³•ï¼Œè€Œæˆ‘ä»¬ä¹Ÿèƒ½è‡ªå®šä¹‰ <code>readObject()</code> æ–¹æ³•ä»è€Œçº¦æŸååºåˆ—åŒ–æ„é€ å‡ºçš„å¯¹è±¡ã€‚</p>
<p>æ¯”å¦‚éœ€è¦å¯¹ <code>Student</code> å¯¹è±¡åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ï¼Œå…¶ä¸­çš„ <code>score</code> å­—æ®µå€¼çš„èŒƒå›´åœ¨ 0 åˆ° 150 ä¹‹é—´ï¼Œä¸ºäº†é˜²æ­¢ä»–äººå°†å…¶ç¯¡æ”¹ä¸ºéæ³•æ•°æ®ï¼Œå¯ä»¥è‡ªå®šä¹‰ <code>readObject()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/1 15:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">4539491935997507115L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> score;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨é»˜è®¤çš„ååºåˆ—åŒ–æ–¹æ³•</span></span><br><span class="line">        ois.defaultReadObject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€»è¾‘åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">if</span> (score &lt; <span class="number">0</span> || score &gt; <span class="number">150</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;å­¦ç”Ÿåˆ†æ•°å¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åä½¿ç”¨ä¸€ä¸ª <code>score</code> å­—æ®µå€¼ä¸º <code>-1</code> çš„ <code>Student</code> å¯¹è±¡è¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReadObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;mofan&quot;</span>, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;student.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    oos.writeObject(student);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;student.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ois.readObject();</span><br><span class="line">        Assert.fail();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        Assert.assertTrue(e <span class="keyword">instanceof</span> IllegalArgumentException);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‡å†™çš„ <code>readObject()</code> æ–¹æ³•ä¼šåœ¨ååºåˆ—åŒ–æ—¶è°ƒç”¨ï¼Œå› æ­¤ä¹Ÿä¼šåœ¨ååºåˆ—åŒ–æ—¶æŠ›å‡º <code>IllegalArgumentException</code> å¼‚å¸¸ã€‚é‚£é—®é¢˜åˆæ¥äº†ï¼Œä¸ºä»€ä¹ˆä¼šè°ƒç”¨è‡ªå®šä¹‰çš„ <code>readObject()</code> æ–¹æ³•å‘¢ï¼Ÿ</p>
<p>è¿™ä¸€åˆ‡éƒ½åœ¨ <code>ObjectStreamClass</code> ç±»ï¼ˆ<code>ObjectStreamClass</code> æ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°çš„ç±»æè¿°ç¬¦ï¼‰çš„ç§æœ‰æ„é€ æ–¹æ³•ä¸­ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/ObjectStreamClass%E7%9A%84%E7%A7%81%E6%9C%89%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95.png" alt="ObjectStreamClassçš„ç§æœ‰æ„é€ æ–¹æ³•"></p>
<p>ä¸éš¾çœ‹å‡ºæ˜¯åˆ©ç”¨äº†åå°„æ¥è°ƒç”¨äº†è‡ªå®šä¹‰çš„ <code>readObject()</code> æ–¹æ³•ã€‚</p>
<p>æœ‰ä¸¤ä¸ªç»†èŠ‚ï¼š</p>
<p>1ã€ <strong>å¦‚æœç±»æ˜¯ <code>Externalizable</code> çš„å­ç±»ï¼Œé‚£ä¹ˆè‡ªå®šä¹‰çš„ <code>readObject()</code> æ–¹æ³•ä¸ä¼šè¢«åå°„è°ƒç”¨ã€‚</strong> <code>Externalizable</code> æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªåºåˆ—åŒ–æ¥å£ï¼Œè¿™åé¢å†è¯´ã€‚</p>
<p>2ã€å°±ç®—å­—æ®µè¢« <code>transient</code> å…³é”®è¯ä¿®é¥°ï¼Œåªè¦åœ¨è‡ªå®šä¹‰çš„ <code>writeObject()</code> å’Œ <code>readObject()</code> æ–¹æ³•é‡Œæ˜¾å¼å£°æ˜äº†éœ€è¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¢«ä¿®é¥°çš„å­—æ®µï¼Œé‚£ä¹ˆè¿™ä¸ªå­—æ®µä¹Ÿä¼šè¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/2 21:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">4647801022792976129L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(ObjectOutputStream oos)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        oos.defaultWriteObject();</span><br><span class="line"></span><br><span class="line">        oos.writeObject(<span class="built_in">this</span>.password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream ois)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ois.defaultReadObject();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.password = (String) ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ObjectStreamClass</code> ç±»çš„ç§æœ‰æ„é€ æ–¹æ³•ä¸­è¿˜æåˆ°äº† <code>readObjectNoData()</code>ã€<code>writeReplace()</code> å’Œ <code>readResolve()</code> æ–¹æ³•ï¼Œé‚£è¿™äº›æ–¹æ³•åˆæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p>
<h2 id="2-6-readObjectNoData-æ–¹æ³•"><a class="header-anchor" href="#2-6-readObjectNoData-æ–¹æ³•"></a>2.6 readObjectNoData æ–¹æ³•</h2>
<p><code>readObjectNoData()</code> æ–¹æ³•ç”¨äºæ­£ç¡®åˆå§‹åŒ–ååºåˆ—åŒ–å¯¹è±¡ã€‚æ¯”å¦‚ç°æœ‰ <code>Vip</code> ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/2 21:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Vip</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">5125855385522887545L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String level;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ„å»ºä¸€ä¸ª <code>Vip</code> å¯¹è±¡å¹¶å°†å…¶åºåˆ—åŒ–å­˜å‚¨åˆ°ç£ç›˜ä¸Šï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// Vip è¿˜æœªç»§æ‰¿ User</span></span><br><span class="line">    <span class="type">Vip</span> <span class="variable">vip</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Vip</span>();</span><br><span class="line">    vip.setLevel(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;vip.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    oos.writeObject(vip);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‡è®¾æ­¤æ—¶éœ€è¦ <code>Vip</code> ç»§æ‰¿ <code>User</code>ï¼Œè¿™æ—¶å¯¹ <code>vip.out</code> ååºåˆ—åŒ–å¹¶æ„é€  <code>Vip</code> å¯¹è±¡ï¼Œæ˜¾ç„¶æ„é€ å‡ºçš„å¯¹è±¡ä¸­çš„ <code>userName</code> å’Œ <code>password</code> ä¸º <code>null</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReadObjectNoData</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;vip.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">    <span class="type">Vip</span> <span class="variable">newVip</span> <span class="operator">=</span> (Vip) ois.readObject();</span><br><span class="line"></span><br><span class="line">    Assert.assertNull(newVip.getUserName());</span><br><span class="line">    Assert.assertNull(newVip.getPassword());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å®é™…éœ€æ±‚ä¸‹ <code>null</code> å€¼æ•°æ®æ˜¯éæ³•çš„ï¼Œéœ€è¦ä¸ºå®ƒä»¬è®¾ç½®é»˜è®¤å€¼ï¼Œè¿™æ—¶å°±å¯ä»¥åœ¨ <code>User</code> ç±»ä¸­å¢åŠ è‡ªå®šä¹‰çš„ <code>readObjectNoData()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">// çœç•¥å…¶ä»–å†…å®¹</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObjectNoData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userName = <span class="string">&quot;Unknown&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.password = <span class="string">&quot;***&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ—¶å†ååºåˆ—åŒ–æ„é€ å¯¹è±¡å°±ä¼šä½¿æœªè¢«åºåˆ—åŒ–çš„å­—æ®µè®¾ç½®ä¸Šé»˜è®¤å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReadObjectNoData</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;vip.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">    <span class="type">Vip</span> <span class="variable">newVip</span> <span class="operator">=</span> (Vip) ois.readObject();</span><br><span class="line"></span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;Unknown&quot;</span>, newVip.getUserName());</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;***&quot;</span>, newVip.getPassword());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“å­—èŠ‚ä¿¡æ¯æ¥æ”¶æ–¹æ‹“å±•äº†å‘é€æ–¹å‘é€çš„å­—èŠ‚ä¿¡æ¯æŒ‡å‘çš„ç±»æ—¶ï¼Œæˆ–è€…å­—èŠ‚ä¿¡æ¯è¢«ç¯¡æ”¹æ—¶ï¼Œè‡ªå®šä¹‰ <code>readObjectNoData()</code> æ–¹æ³•å¯ä»¥ä¿è¯æ•°æ®çš„åŸºæœ¬æ­£ç¡®æ€§ã€‚</p>
<h2 id="2-7-éšè—æ–¹æ³•-writeReplace"><a class="header-anchor" href="#2-7-éšè—æ–¹æ³•-writeReplace"></a>2.7 éšè—æ–¹æ³• - writeReplace</h2>
<p>å®ç°äº† <code>Serializable</code> æ¥å£çš„ç±»ä¸­å®šä¹‰ <code>writeReplace()</code> æ–¹æ³•ï¼Œå…¶æ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ANY-ACCESS-MODIFIER Object <span class="title function_">writeReplace</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªéšè—æ–¹æ³•ï¼Œå½“ JVM å¯¹å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–æ—¶ï¼Œå¦‚æœå¯¹è±¡ä¸­å«æœ‰æ­¤æ–¹æ³•ï¼Œé‚£ä¹ˆ <code>writeReplace()</code> æ–¹æ³•ä¼šåœ¨ <code>writeObject()</code> <strong>ä¹‹å</strong> è°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦å®šä¹‰äº† <code>writeReplace()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆç”± <code>writeObject()</code> åºåˆ—åŒ–çš„å¯¹è±¡ä¼šè¢«å®Œå…¨ä¸¢å¼ƒï¼Œè¢«åºåˆ—åŒ–åå­˜å‚¨åˆ°ç£ç›˜çš„å¯¹è±¡æ˜¯ <code>writeReplace()</code> æ‰€è¿”å›çš„ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>writeReplace()</code> æ–¹æ³• <strong>æ‰€è¿”å›çš„å¯¹è±¡ä¹Ÿå¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œ</strong> å¦åˆ™ä¼šæŠ›å‡º <code>NotSerializableException</code> å¼‚å¸¸ã€‚</p>
<p>å®šä¹‰ä¸€ä¸ªå®ç°äº† <code>Serializable</code> æ¥å£çš„ç±»ï¼Œå¹¶ä¸”è¿™ä¸ªç±»ä¸­å«æœ‰ <code>writeReplace()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/28 19:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">City</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">2376268232459336285L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> area;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">writeReplace</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException &#123;</span><br><span class="line">        <span class="comment">// è¿”å›çš„å¯¹è±¡å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;mofan&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–å†™æµ‹è¯•æ–¹æ³•å¯¹ <code>City</code> å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWriteReplace</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">City</span> <span class="variable">city</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">City</span>(<span class="string">&quot;Chengdu&quot;</span>, <span class="number">143</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;chengdu.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    oos.writeObject(city);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;chengdu.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line"></span><br><span class="line">    Assert.assertTrue(object <span class="keyword">instanceof</span> People);</span><br><span class="line">    <span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> (People) object;</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;mofan&quot;</span>, people.getName());</span><br><span class="line">    Assert.assertEquals(<span class="number">20</span>, people.getAge());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥æŸ¥çœ‹åºåˆ—åŒ–ç”Ÿæˆçš„ <code>chengdu.out</code> æ–‡ä»¶å†…å®¹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/chengdu.out.png" alt="chengdu.out"></p>
<p>è™½ç„¶è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹æˆ‘ä»¬éš¾ä»¥è¯»æ‡‚ï¼Œä½†æ˜¯èƒ½çœ‹åˆ° <code>indi.mofan.serial.People</code> å’Œ <code>mofan</code> ç­‰å­—æ ·ï¼Œè€Œå‰è€…å°±æ˜¯ <code>People</code> ç±»çš„å…¨é™å®šåç§°ï¼Œè¿™ä¹Ÿè¡¨ç¤ºè¢«åºåˆ—åŒ–å­˜å‚¨åˆ°ç£ç›˜ä¸Šçš„å¯¹è±¡ä¿¡æ¯æ˜¯ <code>writeReplace()</code> æ–¹æ³•çš„è¿”å›å€¼ã€‚</p>
<h2 id="2-8-éšè—æ–¹æ³•-readResolve"><a class="header-anchor" href="#2-8-éšè—æ–¹æ³•-readResolve"></a>2.8 éšè—æ–¹æ³• - readResolve</h2>
<p>å’Œ <code>writeReplace()</code> ç›¸å¯¹çš„å°±æ˜¯ <code>readResolve()</code> æ–¹æ³•ï¼Œ<code>readResolve()</code> æ–¹æ³•ä¼šåœ¨ <code>readObject()</code> æ–¹æ³• <strong>ä¹‹å</strong> è°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦å®šä¹‰äº† <code>readResolve()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆç”± <code>readObject()</code> æ–¹æ³•ååºåˆ—åŒ–æ‰€æ„é€ çš„å¯¹è±¡ä¼šè¢«å®Œå…¨ä¸¢å¼ƒï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ç”± <code>readResolve()</code> æ–¹æ³•æ‰€è¿”å›çš„å¯¹è±¡ã€‚</p>
<p>ä¸ <code>writeReplace()</code> æ–¹æ³•ä¸åŒçš„æ˜¯ï¼Œ<code>readResolve()</code> æ–¹æ³•è¿”å›çš„å¯¹è±¡ <strong>ä¸ä¸€å®š</strong> å¾—æ˜¯å¯åºåˆ—åŒ–çš„ã€‚</p>
<p>å®šä¹‰ä¸€ä¸ªå®ç°äº† <code>Serializable</code> æ¥å£çš„ç±»ï¼Œå¹¶ä¸”è¿™ä¸ªç±»ä¸­å«æœ‰ <code>readResolve()</code> æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/28 20:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Fruit</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">4088817990272523988L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> size;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException &#123;</span><br><span class="line">        <span class="comment">// è¿”å›çš„å¯¹è±¡ä¸ä¸€å®šæ˜¯å¯åºåˆ—åŒ–çš„</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Simple</span>(<span class="string">&quot;Simple&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–å†™æµ‹è¯•æ–¹æ³•å¯¹ <code>Fruit</code> å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testReadResolve</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Fruit</span> <span class="variable">fruit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fruit</span>(<span class="string">&quot;orange&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="number">2.12</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;orange.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    oos.writeObject(fruit);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;orange.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line"></span><br><span class="line">    Assert.assertTrue(object <span class="keyword">instanceof</span> Simple);</span><br><span class="line">    <span class="type">Simple</span> <span class="variable">simple</span> <span class="operator">=</span> (Simple) object;</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;Simple&quot;</span>, simple.getStringField());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·ä¹ŸæŸ¥çœ‹åºåˆ—åŒ–ç”Ÿæˆçš„ <code>orange.out</code> æ–‡ä»¶å†…å®¹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/orange.out.png" alt="orange.out"></p>
<p>åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ° <code>indi.mofan.serial.Fruit</code> çš„å­—æ ·ï¼Œè¿™ä¹Ÿæ˜¯ <code>Fruit</code> ç±»çš„å…¨é™å®šåç§°ã€‚æ ¹æ®å‰é¢çš„ç»éªŒå¯ä»¥çŸ¥é“ï¼Œè¢«åºåˆ—åŒ–å­˜å‚¨åˆ°ç£ç›˜ä¸Šçš„å¯¹è±¡ä¿¡æ¯ä¾æ—§æ˜¯ <code>Fruit</code> å¯¹è±¡çš„ä¿¡æ¯ï¼Œåªä¸è¿‡ç”±äºå­˜åœ¨çš„ <code>readResolve()</code> æ–¹æ³•ä½¿å¾—ååºåˆ—åŒ–è¿”å›çš„å¯¹è±¡æ˜¯ <code>readResolve()</code> æ–¹æ³•è¿”å›çš„å¯¹è±¡ã€‚</p>
<blockquote>
<p>å•ä¾‹æ¨¡å¼çš„å¢å¼º</p>
</blockquote>
<p>ååºåˆ—åŒ–æ„é€ å¯¹è±¡æ˜¯ä¸€ç§æ„é€ å¯¹è±¡çš„ç‰¹æ®Šæ–¹å¼ï¼Œé‚£ä¹ˆè¿™å°±æœ‰å¯èƒ½å¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼š <strong>å¯åºåˆ—åŒ–çš„å•ä¾‹å¯¹è±¡å¯èƒ½å¹¶ä¸å•ä¾‹ã€‚</strong></p>
<p>é‡‡ç”¨é™æ€åµŒå¥—ç±»æ–¹å¼å®ç°å•ä¾‹æ¨¡å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/1 12:53</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">5603073114730981002L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">SINGLETON</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title function_">getSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.SINGLETON;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Singleton</code> å®ç°äº† <code>Serializable</code> æ¥å£ï¼Œå°è¯•åºåˆ—åŒ–è¿™ä¸ªå•ä¾‹å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSingleton</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;singleton.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    oos.writeObject(Singleton.getSingleton());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;singleton.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">    <span class="type">Singleton</span> <span class="variable">singleton</span> <span class="operator">=</span> (Singleton) ois.readObject();</span><br><span class="line"></span><br><span class="line">    Assert.assertNotSame(Singleton.getSingleton(), singleton);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šæ–¹æµ‹è¯•æ–¹æ³•èƒ½å¤ŸæˆåŠŸé€šè¿‡ï¼Œé€šè¿‡æœ€åçš„æ–­è¨€å¯çŸ¥ï¼Œååºåˆ—åŒ–æ„é€ çš„å¯¹è±¡ä¸åºåˆ—åŒ–å‰çš„å•ä¾‹å¯¹è±¡ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚è¿™æ—¶å°±å¯ä»¥åˆ©ç”¨ <code>readResolve()</code> æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ <code>Singleton</code> ç±»ä¸­å®šä¹‰ <code>readResolve()</code> æ–¹æ³•ï¼Œç„¶åè¿”å›å•ä¾‹å¯¹è±¡å³å¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çœç•¥å…¶ä»–å®ç°</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException &#123;</span><br><span class="line">        <span class="keyword">return</span> getSingleton();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-9-Externalizable-æ¥å£"><a class="header-anchor" href="#2-9-Externalizable-æ¥å£"></a>2.9 Externalizable æ¥å£</h2>
<p>é™¤äº†å®ç° <code>Serializable</code> æ¥å£å¯ä»¥è®©å¯¹è±¡å…·å¤‡å¯åºåˆ—åŒ–çš„ç‰¹æ€§å¤–ï¼Œå®ç° <code>Externalizable</code> æ¥å£ä¹Ÿå¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œåªä¸è¿‡è¿™ä¸ªæ¥å£ä¸å†æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œéœ€è¦é‡å†™å®ƒé‡Œé¢çš„ <code>writeExternal()</code> å’Œ <code>readExternal()</code> æŠ½è±¡æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/28 20:59</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Animal</span> <span class="keyword">implements</span> <span class="title class_">Externalizable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">3303909578015151048L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Animal</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Externalizable ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨æ— å‚æ„é€ æ–¹æ³•</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Animal çš„æ— å‚æ„é€ å™¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Animal</span><span class="params">(String type, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeExternal</span><span class="params">(ObjectOutput out)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–æ—¶ä½¿ç”¨</span></span><br><span class="line">        out.writeObject(<span class="built_in">this</span>.type);</span><br><span class="line">        out.writeInt(<span class="built_in">this</span>.age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readExternal</span><span class="params">(ObjectInput in)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–ä½¿ç”¨ã€‚è®¾ç½®å­—æ®µå€¼çš„é¡ºåºè¦å’Œåºåˆ—åŒ–æ—¶ä¸€è‡´ã€‚</span></span><br><span class="line">        <span class="built_in">this</span>.type = (String) in.readObject();</span><br><span class="line">        <span class="built_in">this</span>.age = in.readInt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–å†™æµ‹è¯•æ–¹æ³•å¯¹ <code>Animal</code> å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testExternalizable</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;cat&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;cat.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    oos.writeObject(animal);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;cat.out&quot;</span>);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line"></span><br><span class="line">    <span class="type">Animal</span> <span class="variable">cat</span> <span class="operator">=</span> (Animal) object;</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;cat&quot;</span>, cat.getType());</span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>, cat.getAge());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•æ–¹æ³•åï¼Œæ–­è¨€èƒ½å®Œå…¨é€šè¿‡ï¼Œå¹¶ä¸”åœ¨æ§åˆ¶å°æ‰“å°å‡ºï¼š</p>
<pre>
Animal çš„æ— å‚æ„é€ å™¨
</pre>
<p>é€šè¿‡æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„å†…å®¹å¯çŸ¥ï¼Œ <strong>å®ç° <code>Externalizable</code> æ¥å£æ¥ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œ</strong> ç„¶ååœ¨ <code>readExternal()</code> æ–¹æ³•ä¸­å¯¹æˆå‘˜å˜é‡èµ‹å€¼ï¼Œè€Œå®ç° <code>Serializable</code> æ¥å£è¿›è¡Œååºåˆ—åŒ–æ—¶æ˜¯ä¸ä¼šè°ƒç”¨ä»»ä½•æ„é€ å™¨çš„ã€‚</p>
<p><code>Externalizable</code> æ¥å£ä¸­æœ‰ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå…¶ä¸­åºåˆ—åŒ–æ—¶ä½¿ç”¨ <code>writeExternal()</code>ï¼Œååºåˆ—åŒ–æ—¶ä½¿ç”¨ <code>readExternal()</code>ã€‚</p>
<p><mark>æ³¨æ„ï¼š</mark></p>
<p>1ã€ç›¸æ¯”äºå®ç° <code>Serializable</code> æ¥å£ï¼Œå®ç° <code>Externalizable</code> æ¥å£æ—¶ï¼Œæ— å‚æ„é€ æ–¹æ³•æ˜¯ <strong>å¿…è¦</strong> çš„ã€‚</p>
<p>2ã€åœ¨ <code>readExternal()</code> æ–¹æ³•ä¸­è®¾ç½®å­—æ®µå€¼çš„é¡ºåºè¦å’Œ <code>writeExternal()</code> æ–¹æ³•ä¸­è¯»å–å­—æ®µå€¼çš„é¡ºåºä¸€è‡´ã€‚</p>
<p>3ã€å°±ç®—å­—æ®µè¢« <code>transient</code> å…³é”®è¯ä¿®é¥°ï¼Œåªè¦åœ¨é‡å†™çš„æ–¹æ³•é‡Œæ˜¾å¼å£°æ˜äº†éœ€è¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¢«ä¿®é¥°çš„å­—æ®µï¼Œé‚£ä¹ˆè¿™ä¸ªå­—æ®µä¹Ÿä¼šè¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>
<h2 id="2-10-åºåˆ—åŒ–çš„ç‰ˆæœ¬"><a class="header-anchor" href="#2-10-åºåˆ—åŒ–çš„ç‰ˆæœ¬"></a>2.10 åºåˆ—åŒ–çš„ç‰ˆæœ¬</h2>
<p>åœ¨å®ç°äº†åºåˆ—åŒ–æ¥å£çš„ç±»ä¸­ç»å¸¸èƒ½çœ‹åˆ°ä»¥ä¸‹ä¸€è¡Œä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">5125855385522887545L</span>;</span><br></pre></td></tr></table></figure>
<p>ååºåˆ—åŒ– Java å¯¹è±¡å¿…é¡»è¦æœ‰è¯¥å¯¹è±¡çš„ Class æ–‡ä»¶ï¼Œä½†éšç€é¡¹ç›®çš„è¿­ä»£å‡çº§ï¼Œç³»ç»Ÿçš„ Class æ–‡ä»¶ä¹Ÿåœ¨è¿­ä»£å‡çº§ï¼Œä¸ºäº†ä¿è¯ä¸¤ä¸ª Class æ–‡ä»¶çš„å…¼å®¹æ€§ï¼ŒJava çš„åºåˆ—åŒ–æœºåˆ¶ä¸ºåºåˆ—åŒ–ç±» <strong>é»˜è®¤</strong> æä¾›äº†ä¸€ä¸ªåä¸º <code>serialVersionUID</code> çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯ Java ç±»çš„åºåˆ—åŒ–ç‰ˆæœ¬ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼å£°æ˜ <code>serialVersionUID</code> çš„å€¼ï¼Œå½“ç±»å‘ç”Ÿè¿­ä»£å‡çº§åï¼Œé»˜è®¤æä¾›çš„ <code>serialVersionUID</code> å€¼ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<p>å½“ä¸€ä¸ªç±»è¿­ä»£å‡çº§åï¼Œåªè¦å®ƒçš„ <code>serialVersionUID</code> å€¼ä¸å˜ï¼Œåºåˆ—åŒ–æœºåˆ¶å°±ä¼šæŠŠå®ƒä»¬å½“æˆæ˜¯åŒä¸€ä¸ªåºåˆ—åŒ–ç‰ˆæœ¬ï¼Œä¹Ÿå°±å¯ä»¥ååºåˆ—åŒ–æˆåŠŸï¼Œå¦åˆ™æŠ›å‡º <code>InvalidClassException</code> å¼‚å¸¸ç»ˆæ­¢å‘åºåˆ—åŒ–è¿‡ç¨‹ã€‚</p>
<p><strong>å› æ­¤å»ºè®®å‡¡æ˜¯å®ç°äº† <code>Serializable</code> æ¥å£çš„ç±»ï¼Œéƒ½åº”å½“æ˜¾å¼å£°æ˜ <code>serialVersionUID</code> çš„å€¼ã€‚</strong></p>
<h2 id="2-11-serialPersistentFields"><a class="header-anchor" href="#2-11-serialPersistentFields"></a>2.11 serialPersistentFields</h2>
<p>åœ¨ JDK 14 ä¸­å¼•å…¥äº† <code>@Serial</code> æ³¨è§£ï¼Œè¯¥æ³¨è§£åªç”¨äºæ ‡è®°ï¼Œå’Œ <code>@Override</code>ã€<code>@FunctionalInterface</code> ç­‰æ³¨è§£ç±»ä¼¼ï¼Œ<code>@Serial</code> æ³¨è§£ç”¨äºæ ‡è®°ä¸åºåˆ—åŒ–ç›¸å…³çš„æ–¹æ³•å’Œå­—æ®µã€‚</p>
<p>ä¸åºåˆ—åŒ–ç›¸å…³çš„å­—æ®µé™¤äº† <code>serialVersionUID</code> å¤–ï¼Œè¿˜æœ‰ <code>serialPersistentFields</code>ã€‚æ¯”å¦‚åœ¨ <code>String</code> ç±»çš„æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@java</span>.io.Serial</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectStreamField[] serialPersistentFields = <span class="keyword">new</span> <span class="title class_">ObjectStreamField</span>[<span class="number">0</span>];</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªå®ç°äº† <code>Serialzable</code> æ¥å£çš„ç±»ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰é <code>transient</code>ã€é <code>static</code> çš„å­—æ®µéƒ½ä¼šè¢«åºåˆ—åŒ–ï¼Œä½†å¦‚æœå®šä¹‰äº† <code>serialPersistentFields</code> å­—æ®µï¼Œé‚£ä¹ˆåªæœ‰ <code>serialPersistentFields</code> é‡Œæ·»åŠ çš„å­—æ®µæ‰ä¼šè¢«åºåˆ—åŒ–ã€‚å¦‚æœä¸€ä¸ªå­—æ®µè¢« <code>transient</code> ä¿®é¥°ï¼Œä½†åˆè¢«æ·»åŠ åˆ° <code>serialPersistentFields</code> å­—æ®µä¸­ï¼Œè¿™ä¸ªå­—æ®µä¾æ—§ä¼šè¢«åºåˆ—åŒ–ã€‚<code>serialPersistentFields</code> çš„ä¼˜å…ˆçº§æ¯” <code>transient</code> é«˜ï¼Œè€Œè¢« <code>static</code> ä¿®é¥°çš„å­—æ®µå§‹ç»ˆä¸èƒ½è¢«åºåˆ—åŒ–ã€‚</p>
<blockquote>
<p>ä½¿ç”¨ç»†èŠ‚</p>
</blockquote>
<ul>
<li><code>serialPersistentFields</code> å­—æ®µå¿…é¡»æ˜¯ <code>ObjectStreamField[]</code> ç±»å‹ï¼Œä¸”è¢« <code>private static final</code> ä¿®é¥°ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆã€‚</li>
<li>å¦‚æœ <code>serialPersistentFields</code> å­—æ®µå€¼ä¸º <code>null</code>ï¼Œä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼›ä½†å¦‚æœå­—æ®µå€¼æ˜¯ç©ºæ•°ç»„ï¼Œæ¯”å¦‚ <code>&#123;&#125;</code> æˆ– <code>new ObjectStreamField[0]</code>ï¼Œåˆ™ä¸ä¼šåºåˆ—åŒ–ç±»ä¸­çš„ä»»ä½•å­—æ®µã€‚</li>
<li>å¦‚æœå£°æ˜äº†ç±»ä¸­å¹¶ä¸å­˜åœ¨çš„å­—æ®µï¼Œåœ¨åºåˆ—åŒ–æ—¶æŠ›å‡º <code>InvalidClassException</code> å¼‚å¸¸ã€‚</li>
</ul>
<blockquote>
<p>ä½¿ç”¨ç¤ºä¾‹</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/6/15 21:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Computer</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Serial</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">455386781881536390L</span>;</span><br><span class="line">    <span class="meta">@Serial</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectStreamField[] serialPersistentFields = &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ObjectStreamField</span>(<span class="string">&quot;brand&quot;</span>, String.class),</span><br><span class="line">            <span class="comment">// å¯ä»¥åºåˆ—åŒ–è¢« transient å­—æ®µï¼Œä½†ä¸èƒ½åºåˆ—åŒ– static å­—æ®µ</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ObjectStreamField</span>(<span class="string">&quot;price&quot;</span>, BigDecimal.class)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> String size;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String staticStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@SneakyThrows</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSerializedComputer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Computer</span> <span class="variable">computer</span> <span class="operator">=</span> buildComputer();</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;./target/rog.out&quot;</span>;</span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(filePath);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">    <span class="keyword">try</span> (fos; oos) &#123;</span><br><span class="line">        oos.writeObject(computer);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        Assertions.fail();</span><br><span class="line">    &#125;</span><br><span class="line">    assertThat(<span class="keyword">new</span> <span class="title class_">File</span>(filePath))</span><br><span class="line">            .isNotEmpty()</span><br><span class="line">            .content()</span><br><span class="line">            .doesNotContain(<span class="string">&quot;Republic of Gamers&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line">    <span class="keyword">try</span> (fis; ois) &#123;</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">result</span> <span class="operator">=</span> (Computer) ois.readObject();</span><br><span class="line">        assertThat(result).extracting(Computer::getBrand, Computer::getSize, Computer::getPrice, i -&gt; Computer.staticStr)</span><br><span class="line">                .containsSequence(<span class="string">&quot;ROG&quot;</span>, <span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;10000.00&quot;</span>), <span class="string">&quot;Republic of Gamers&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        Assertions.fail();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Computer <span class="title function_">buildComputer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Computer</span> <span class="variable">computer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Computer</span>();</span><br><span class="line">    computer.setBrand(<span class="string">&quot;ROG&quot;</span>);</span><br><span class="line">    computer.setPrice(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;10000.00&quot;</span>));</span><br><span class="line">    computer.setSize(<span class="string">&quot;16 inch&quot;</span>);</span><br><span class="line">    Computer.staticStr = <span class="string">&quot;Republic of Gamers&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> computer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åºåˆ—åŒ–çš„å†…å®¹å°±è¯´è¿™ä¹ˆå¤šï¼Œä¹ŸçŸ¥é“äº† <code>writeReplace()</code> æ–¹æ³•æ˜¯å¹²å˜›çš„ï¼Œä½†ç°åœ¨åˆå‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼šè™½ç„¶å®šä¹‰çš„å‡½æ•°å¼æ¥å£ <code>SFunction</code> ç»§æ‰¿äº† <code>Serializable</code> æ¥å£ï¼Œä½†å¹¶æ²¡æœ‰åƒå‰æ–‡è®²çš„é‚£æ ·æ˜¾å¼å£°æ˜ <code>writeReplace()</code> æ–¹æ³•ï¼Œå¹¶ä¸”è¿˜å¯ä»¥åå°„è°ƒç”¨ <code>writeReplace()</code> æ–¹æ³•è·å–åˆ° <code>SerializedLambda</code> å¯¹è±¡ã€‚è¿™åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>è¿™å°±ä¸å¾—ä¸è¯´è¯´ Lambda è¡¨è¾¾å¼çš„åºåˆ—åŒ–äº†ã€‚</p>
<h1 id="3-Lambda-è¡¨è¾¾å¼çš„åºåˆ—åŒ–"><a class="header-anchor" href="#3-Lambda-è¡¨è¾¾å¼çš„åºåˆ—åŒ–"></a>3. Lambda è¡¨è¾¾å¼çš„åºåˆ—åŒ–</h1>
<h2 id="3-1-LambdaMetafactory"><a class="header-anchor" href="#3-1-LambdaMetafactory"></a>3.1 LambdaMetafactory</h2>
<p>Lambda è¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨ä½¿ç”¨åˆ°çš„è‡ªå®šä¹‰çš„å‡½æ•°å¼æ¥å£ <code>SFunction</code> ä»¥åŠ Java ä¸­è‡ªå¸¦çš„å‡½æ•°å¼æ¥å£è™½ç„¶åªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œä½†æœ€ç»ˆåœ¨ç¨‹åºä¸­å¿…å®šä¹Ÿæ˜¯ä¸€ä¸ªå®ç°ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œä¸ç„¶ç¨‹åºæ€ä¹ˆèƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œå‘¢ï¼Ÿè¿™äº›å®ä¾‹å¯¹è±¡çš„åˆ›å»ºè‚¯å®šæ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºçš„ï¼Œæ¯•ç«Ÿä½¿ç”¨è€…å¹¶æ²¡æœ‰æ˜¾å¼åˆ›å»ºå®ƒä»¬ã€‚</p>
<p>è¯´åˆ°è¿™äº›å®ä¾‹å¯¹è±¡çš„åˆ›å»ºå°±ä¸å¾—ä¸è°ˆåˆ° <code>LambdaMetafactory</code> ç±»äº†ï¼Œå…‰ä»ç±»åå°±ä¸éš¾çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªå·¥å‚ç±»ï¼Œè€Œä¸”æ˜¯å’Œ Lambda è¡¨è¾¾å¼ç›¸å…³çš„å·¥å‚ç±»ï¼Œé‚£è¿™ä¸ªå·¥å‚ç±»æ˜¯ç”¨æ¥åˆ›å»ºä»€ä¹ˆå¯¹è±¡å‘¢ï¼Ÿ</p>
<p>å¾ˆæ˜¾ç„¶æ˜¯ç”¨æ¥åˆ›å»º Lambda è¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨çš„å®ç°ç±»çš„å®ä¾‹å¯¹è±¡ã€‚è¯æ®å¯ä»¥æŸ¥çœ‹ <code>LambdaMetafactory</code> çš„é¦–æ®µæ³¨é‡Šï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/LambdaMetafactory%E7%9A%84%E9%A6%96%E6%AE%B5%E6%B3%A8%E9%87%8A.png" alt="LambdaMetafactoryçš„é¦–æ®µæ³¨é‡Š"></p>
<p><code>LambdaMetafactory</code> çš„é¡¶éƒ¨æœ‰å¤§é‡çš„æ³¨é‡Šï¼Œä¸å¦¨å°±ä»è¿™äº›æ³¨é‡Šå‡ºå‘ï¼Œæ¢ç´¢ Lambda è¡¨è¾¾å¼åºåˆ—åŒ–çš„å¥¥ç§˜ã€‚</p>
<p><code>LambdaMetafactory</code> ä¸­æœ‰ä¸”ä»…æœ‰ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ <code>metafactory()</code> å’Œ <code>altMetafactory()</code>ã€‚æŒ‰ç…§å®˜æ–¹ç»™å‡ºçš„æ³¨é‡Šä¿¡æ¯ï¼Œ<code>metafactory()</code> æ˜¯æ„é€ å®ä¾‹å¯¹è±¡çš„æ ‡å‡†ç‰ˆï¼Œ<code>altMetafactory()</code> åˆ™æ˜¯å¤‡ç”¨ç‰ˆï¼Œæ˜¯æ ‡å‡†ç‰ˆçš„æ¦‚æ‹¬ã€‚å¤‡ç”¨ç‰ˆå¯¹ç”Ÿæˆçš„å‡½æ•°å¯¹è±¡æä¾›äº†é¢å¤–çš„æ§åˆ¶ï¼Œå¹¶ä¸”å¢åŠ äº†ç®¡ç†å‡½æ•°å¯¹è±¡çš„æŸäº›ç‰¹æ€§çš„èƒ½åŠ›ï¼Œå…¶ä¸­æœ‰ä¸ªç‰¹æ€§ä¾¿æ˜¯ <strong>å¯åºåˆ—åŒ–æ€§</strong>ã€‚</p>
<p>æœ‰ä¸€æ®µçš„æ³¨é‡Šå†…å®¹å¦‚ä¸‹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E5%87%BD%E6%95%B0%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8F%AF%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%A7.png" alt="å‡½æ•°å¯¹è±¡çš„å¯åºåˆ—åŒ–æ€§"></p>
<p>è¿™æ®µæ–‡å­—ç»™å‡ºä¸¤ä¸ªä¿¡æ¯ï¼š</p>
<p>1ã€ç”Ÿæˆçš„å‡½æ•°å¯¹è±¡ <strong>é»˜è®¤</strong> ä¸å…·å¤‡å¯åºåˆ—åŒ–æ€§ï¼Œé™¤éè¢« <code>FLAG_SERIALIZABLE</code> æ ‡è®°ï¼›</p>
<p>2ã€å…·å¤‡å¯åºåˆ—åŒ–æ€§çš„å‡½æ•°å¯¹è±¡å°†ä»¥ <code>SerializedLambda</code> å®ä¾‹çš„å½¢å¼è¿›è¡Œåºåˆ—åŒ–ã€‚</p>
<p><code>FLAG_SERIALIZABLE</code> æ˜¯ <code>LambdaMetafactory</code> ä¸­çš„ä¸€ä¸ªå¸¸é‡ï¼Œå…³äºå®ƒæ›´å¤šçš„ä¿¡æ¯åœ¨ <code>altMetafactory()</code> æ–¹æ³•çš„å¤´éƒ¨æ³¨é‡Šæœ‰è¿™æ ·ä¸€æ®µï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/FLAG_SERIALIZABLE%E7%9A%84%E4%BD%9C%E7%94%A8.png" alt="FLAG_SERIALIZABLEçš„ä½œç”¨"></p>
<p>å†ç®€å•æ¦‚æ‹¬ä¸‹ï¼šè¢« <code>FLAG_SERIALIZABLE</code> æ ‡è®°è€Œç”Ÿæˆçš„å‡½æ•°å¯¹è±¡ä¼šå®ç° <code>Serializable</code> æ¥å£ï¼Œå¹¶ä¸”å‡½æ•°å¯¹è±¡å°†æœ‰ä¸€ä¸ªåä¸º <code>writeReplace()</code> ä¸”è¿”å›ç±»å‹ä¸º <code>SerializedLambda</code> çš„æ–¹æ³•ã€‚è°ƒç”¨è¿™äº›å‡½æ•°å¯¹è±¡çš„æ–¹æ³•çš„ç±»ä¸­å¿…é¡»æœ‰ä¸€ä¸ªåä¸º <code>$deserializeLambda$</code> çš„æ–¹æ³•ï¼Œå¦‚åŒ <code>SerializedLambda</code> é‚£æ ·ã€‚</p>
<p>è¿™æ®µæ³¨é‡Šçš„å…·ä½“å®ç°å¯ä»¥æŸ¥çœ‹ <code>altMetafactory()</code> æ–¹æ³•çš„æœ€åå‡ è¡Œï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E6%9E%84%E9%80%A0InnerClassLambdaMetafactory%E5%AF%B9%E8%B1%A1%E5%B9%B6%E8%B0%83%E7%94%A8buildCallSite%E6%96%B9%E6%B3%95.png" alt="æ„é€ InnerClassLambdaMetafactoryå¯¹è±¡å¹¶è°ƒç”¨buildCallSiteæ–¹æ³•"></p>
<p>åœ¨æ­¤æ„é€ äº† <code>InnerClassLambdaMetafactory</code> å¯¹è±¡å¹¶è°ƒç”¨å…¶ <code>buildCallSite()</code> æ–¹æ³•ï¼Œè°ƒç”¨çš„ <code>InnerClassLambdaMetafactory</code> æ„é€ æ–¹æ³•ä¸­æœ‰ä¸ªåä¸º <code>isSerializable</code> çš„å±€éƒ¨å˜é‡ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">isSerializable</span> <span class="operator">=</span> ((flags &amp; FLAG_SERIALIZABLE) != <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>ç®€å•æ¥è¯´å°±æ˜¯ç”Ÿæˆçš„å‡½æ•°å¯¹è±¡æ˜¯å¦å…·å¤‡å¯åºåˆ—åŒ–æ€§ã€‚</p>
<p>å†çœ‹ <code>InnerClassLambdaMetafactory</code> å¯¹è±¡çš„ <code>buildCallSite()</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³• <strong>é¦–è¡Œ</strong> è°ƒç”¨äº†åä¸º <code>spinInnerClass()</code> çš„ç§æœ‰æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢æœ‰è¿™æ ·ä¸€è¡Œä»£ç ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E8%B0%83%E7%94%A8generateSerializationFriendlyMethods%E6%96%B9%E6%B3%95.png" alt="è°ƒç”¨generateSerializationFriendlyMethodsæ–¹æ³•"></p>
<p>å¦‚æœ <strong>å…·å¤‡å¯åºåˆ—åŒ–æ€§</strong>ï¼Œé‚£ä¹ˆå°±è°ƒç”¨ <code>generateSerializationFriendlyMethods()</code> æ–¹æ³•ï¼Œè§åè¯†æ„ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”±æ¥ç”Ÿæˆåºåˆ—åŒ–æ–¹æ³•çš„ï¼Œé‚£ä¹ˆ <code>writeReplace()</code> ææœ‰å¯èƒ½å°±æ˜¯åœ¨æ­¤ç”Ÿæˆçš„ã€‚</p>
<p>æŸ¥çœ‹å…¶æºç ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/generateSerializationFriendlyMethods%E6%96%B9%E6%B3%95%E7%9A%84%E9%83%A8%E5%88%86%E6%BA%90%E7%A0%81.png" alt="generateSerializationFriendlyMethodsæ–¹æ³•çš„éƒ¨åˆ†æºç "></p>
<p>çŒœæƒ³æ­£ç¡®ï¼ğŸ‰</p>
<blockquote>
<p>å°æ€»ç»“</p>
</blockquote>
<p>å®ç°äº† <code>Serializable</code> æ¥å£çš„å‡½æ•°å¼æ¥å£ç”Ÿæˆçš„å‡½æ•°å¯¹è±¡ä¸­è‡ªåŠ¨ä¼šç”Ÿæˆä¸€ä¸ªåä¸º <code>writeReplace</code> ä¸”è¿”å›å€¼ä¸º <code>SerializedLambda</code> çš„æ–¹æ³•ã€‚</p>
<p>OKï¼Œæ²¡æœ‰æ˜¾å¼å®šä¹‰ <code>writeReplace()</code> æ–¹æ³•å´èƒ½å¤Ÿåå°„è°ƒç”¨ <code>writeReplace()</code> æ–¹æ³•çš„åŸå› æ‰¾åˆ°äº†ï¼Œé‚£ <code>SerializedLambda</code> åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<h2 id="3-2-SerializedLambda"><a class="header-anchor" href="#3-2-SerializedLambda"></a>3.2 SerializedLambda</h2>
<p>ä¾æ—§ä»æ³¨é‡Šå…¥æ‰‹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/SerializedLambda%E7%9A%84%E9%A1%B6%E9%83%A8%E6%B3%A8%E9%87%8A.png" alt="SerializedLambdaçš„é¡¶éƒ¨æ³¨é‡Š"></p>
<p>ç®€å•æ¦‚æ‹¬ä¸‹ï¼š</p>
<p>ç¬¬ä¸€å¤§æ®µï¼š<code>SerializedLambda</code> æ˜¯ Lambda è¡¨è¾¾å¼çš„åºåˆ—åŒ–å½¢å¼ï¼Œå®ƒå­˜å‚¨äº† Lambda è¡¨è¾¾å¼çš„è¿è¡Œæ—¶ä¿¡æ¯ã€‚</p>
<p>ç¬¬äºŒå¤§æ®µï¼šä¸ºç¡®ä¿ Lambda è¡¨è¾¾å¼åºåˆ—åŒ–çš„æ­£ç¡®æ€§ï¼Œç¼–è¯‘å™¨æˆ–è¯­è¨€ç±»åº“å¯ä»¥é€‰ç”¨çš„ä¸€ç§æ–¹æ³•æ˜¯ç¡®ä¿ <code>writeReplace()</code> æ–¹æ³•è¿”å› <code>SerializedLambda</code> å®ä¾‹ï¼Œè€Œä¸æ˜¯è¿›è¡Œé»˜è®¤çš„åºåˆ—åŒ–ã€‚</p>
<p>ç¬¬ä¸‰å¤§æ®µï¼š<code>SerializedLambda</code> ä¸­æœ‰ä¸€ä¸ªåä¸º <code>readResolve()</code> çš„æ–¹æ³•ï¼Œ<code>readResolve()</code> è°ƒç”¨â€œæ•è·ç±»â€ä¸­ä¸€ä¸ªåä¸º <code>$deserializeLambda$(SerializedLambda)</code> çš„é™æ€æ–¹æ³•ï¼ˆå¯èƒ½æ˜¯ç§æœ‰çš„ï¼‰ï¼Œè¿™ä¸ªé™æ€æ–¹æ³•ä»¥å½“å‰ <code>SerializedLambda</code> å®ä¾‹ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°å¹¶è¿”å›ç»“æœã€‚å®ç° <code>$deserializeLambda$</code> çš„ Lambda ç±»è´Ÿè´£éªŒè¯åºåˆ—åŒ– Lambda çš„å±æ€§æ˜¯å¦ä¸è¯¥ç±»å®é™…æ•è·çš„ Lambda ä¸€è‡´ã€‚å¯ä»¥ç†è§£ä¸ºååºåˆ—åŒ–ã€‚</p>
<p>åœ¨é«˜ç‰ˆæœ¬ JDK ä¸­æ­¤å¤„æ³¨é‡Šè¿˜æœ‰ç¬¬å››å¤§æ®µï¼Œå…¶å¤§è‡´å«ä¹‰ä¸ºï¼šåºåˆ—åŒ–å’Œååºåˆ—åŒ–äº§ç”Ÿçš„å‡½æ•°å¯¹è±¡çš„æ ‡è¯†ä¿¡æ¯æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå› æ­¤ä¸åŒå®ç°ç±»çš„å‡½æ•°å¯¹è±¡ã€ç”šè‡³åŒä¸€ä¸ªå®ç°ç±»çš„ä¸åŒååºåˆ—åŒ–ç»“æœçš„æ•æ„Ÿæ ‡è¯†æ“ä½œï¼ˆç›¸ç­‰æ€§ã€å¯¹è±¡é”ã€æ ‡è¯†å“ˆå¸Œç ï¼‰éƒ½æ˜¯ä¸åŒçš„ã€‚</p>
<p>è¯´äº†è¿™ä¹ˆå¤šï¼Œé‡ç‚¹è¿˜æ˜¯ç¬¬ä¸€å¤§æ®µè®²çš„ <strong><code>SerializedLambda</code> å­˜å‚¨äº†æ‹¥æœ‰å¯åºåˆ—åŒ–æ€§çš„ Lambda è¡¨è¾¾å¼çš„è¿è¡Œæ—¶ä¿¡æ¯ã€‚</strong></p>
<p>è¿™äº›è¿è¡Œæ—¶ä¿¡æ¯ä¿å­˜åœ¨ <code>SerializedLambda</code> çš„æˆå‘˜å˜é‡ä¸­ï¼Œå„ä¸ªå«ä¹‰å¯ä»¥å‚è€ƒ <code>SerializedLambda</code> çš„å…¨å‚æ„é€ æ–¹æ³•çš„æ³¨é‡Šï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/SerializedLambda%E5%85%A8%E5%8F%82%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95%E7%9A%84%E6%B3%A8%E9%87%8A.png" alt="SerializedLambdaå…¨å‚æ„é€ æ–¹æ³•çš„æ³¨é‡Š"></p>
<p>æ ¹æ®æ³¨é‡Šï¼Œæ•´ç†å‡ºå¦‚ä¸‹è¡¨æ ¼ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">æˆå‘˜å˜é‡</th>
<th style="text-align:center">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">capturingClass</td>
<td style="text-align:center">æ•è·ç±»ï¼ŒLambda è¡¨è¾¾å¼å‡ºç°çš„æ‰€åœ¨ç±»</td>
</tr>
<tr>
<td style="text-align:center">functionalInterfaceClass</td>
<td style="text-align:center">Lambda è¡¨è¾¾å¼å¯¹åº”çš„å‡½æ•°å¼æ¥å£åç§°ï¼Œä»¥ <code>/</code> åˆ†å‰²</td>
</tr>
<tr>
<td style="text-align:center">functionalInterfaceMethodName</td>
<td style="text-align:center">å‡½æ•°å¼æ¥å£çš„æŠ½è±¡æ–¹æ³•åç§°</td>
</tr>
<tr>
<td style="text-align:center">functionalInterfaceMethodSignature</td>
<td style="text-align:center">å‡½æ•°å¼æ¥å£çš„æŠ½è±¡æ–¹æ³•çš„ç­¾åï¼ˆä½¿ç”¨äº†æ³›å‹åˆ™æ˜¯æ³›å‹æ“¦é™¤åçš„ç±»å‹ï¼‰</td>
</tr>
<tr>
<td style="text-align:center">implMethodKind</td>
<td style="text-align:center">å®ç°æ–¹æ³•çš„ <code>Method Handle</code> ç±»å‹</td>
</tr>
<tr>
<td style="text-align:center">implClass</td>
<td style="text-align:center">æŒæœ‰è¯¥å‡½æ•°å¼æ¥å£æŠ½è±¡æ–¹æ³•çš„ <strong>å®ç°æ–¹æ³•</strong> æ‰€åœ¨çš„ç±»åç§°ï¼ˆå®ç°äº†å‡½æ•°å¼æ¥å£æ–¹æ³•çš„å®ç°ç±»ï¼‰ï¼Œä»¥ <code>/</code> åˆ†éš”</td>
</tr>
<tr>
<td style="text-align:center">implMethodName</td>
<td style="text-align:center">å‡½æ•°å¼æ¥å£æŠ½è±¡æ–¹æ³•çš„ <strong>å®ç°æ–¹æ³•</strong> åç§°</td>
</tr>
<tr>
<td style="text-align:center">implMethodSignature</td>
<td style="text-align:center">å‡½æ•°å¼æ¥å£æŠ½è±¡æ–¹æ³•çš„ <strong>å®ç°æ–¹æ³•</strong> ç­¾å</td>
</tr>
<tr>
<td style="text-align:center">instantiatedMethodType</td>
<td style="text-align:center">å‡½æ•°å¼æ¥å£å¯¹åº”çš„å®ç°ç±»ä¸­å®ç°æ–¹æ³•çš„ç­¾å</td>
</tr>
<tr>
<td style="text-align:center">capturedArgs</td>
<td style="text-align:center">Lambda è¡¨è¾¾å¼æ•è·çš„åŠ¨æ€å‚æ•°</td>
</tr>
</tbody>
</table>
<p>æœ‰å‡ ä¸ªè¦ç‚¹ï¼š</p>
<p>1ã€<code>implClass</code> è¡¨ç¤º <strong>æŒæœ‰</strong> å®ç°æ–¹æ³•çš„ Class åç§°ï¼Œæ³¨æ„å¹¶ä¸æ˜¯å‡½æ•°å¼æ¥å£å¯¹åº”çš„å®ç°ç±»çš„åç§°ï¼›</p>
<p>2ã€ä¸Šè¡¨é»‘ä½“çš„ <strong>å®ç°æ–¹æ³•</strong> ä¸å®ç°ç±»ä¸­çš„å®ç°æ–¹æ³•ä¸æ˜¯åŒä¸€æ¦‚å¿µã€‚</p>
<blockquote>
<p>SerializedLambda å®ä¾‹</p>
</blockquote>
<p>ä»¥ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ä¸ºä¾‹ï¼Œå¹¶åœ¨å…¶ <strong>æœ€åä¸€è¡Œæ‰“ä¸Šæ–­ç‚¹</strong>ï¼ŒæŸ¥çœ‹ Lambda è¡¨è¾¾å¼ä¸æ–¹æ³•å¼•ç”¨å¯¹åº”çš„ <code>SerializedLambda</code> å¯¹è±¡çš„åŒºåˆ«ï¼Œå¹¶æ¯”è¾ƒ <code>SerializedLambda</code> ä¸­æˆå‘˜å˜é‡å€¼çš„å·®å¼‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> indi.mofan;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/9 10:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LambdaTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSerializedLambda</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        SFunction&lt;Person, String&gt; methodReferenceFunc = Person::getName;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">methodReferenceMethod</span> <span class="operator">=</span> methodReferenceFunc.getClass().getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">        methodReferenceMethod.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">SerializedLambda</span> <span class="variable">methodReferenceLambda</span> <span class="operator">=</span> (SerializedLambda) methodReferenceMethod.invoke(methodReferenceFunc);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        SFunction&lt;Person, String&gt; lambdaFunc = (person) -&gt; person.getName();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">lambdaMethod</span> <span class="operator">=</span> lambdaFunc.getClass().getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">        lambdaMethod.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">SerializedLambda</span> <span class="variable">lambda</span> <span class="operator">=</span> (SerializedLambda) lambdaMethod.invoke(lambdaFunc);</span><br><span class="line"></span><br><span class="line">        System.out.println(); <span class="comment">// æ­¤å¤„æ–­ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E4%B8%8D%E5%90%8CSerializedLambda%E5%AE%9E%E4%BE%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB.png" alt="ä¸åŒSerializedLambdaå®ä¾‹ä¹‹é—´çš„åŒºåˆ«"></p>
<p>æ–¹æ³•å¼•ç”¨ <code>Person::getName</code> å¯¹åº”çš„ <code>SerializedLambda</code> å®ä¾‹ç›¸æ¯”äº Lambda è¡¨è¾¾å¼ <code>(person) -&gt; person.getName()</code> å¯¹åº”çš„ <code>SerializedLambda</code> å®ä¾‹ <strong>ä¸»è¦</strong> æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p>
<p>1ã€<code>implClass</code> ä¸åŒã€‚å‰è€…æŒ‡å‘ <code>Person</code> ç±»ï¼Œåè€…æŒ‡å‘å½“å‰æµ‹è¯•ç±»ï¼›</p>
<p>2ã€<code>implMethodName</code> ä¸åŒã€‚å‰è€…æŒ‡å‘ <code>getName</code> æ–¹æ³•ï¼Œåè€…æŒ‡å‘ Lambda è¡¨è¾¾å¼ç”Ÿæˆçš„å®ç°ç±»ä¸­çš„å¯¹åº”çš„å®ç°æ–¹æ³•ï¼›</p>
<p>3ã€<code>implMethodSignature</code> ä¸åŒã€‚åŸå› åŒä¸Šã€‚</p>
<p>æ ¹æ®ä¸Šé¢ä¸‰ä¸ª <strong>ä¸»è¦åŒºåˆ«</strong>ï¼Œå¯ä»¥ä½¿ç”¨ <code>implMethodName</code> çš„å€¼æ¥åˆ¤æ–­ä½¿ç”¨çš„æ˜¯æ–¹æ³•å¼•ç”¨è¿˜æ˜¯ Lambda è¡¨è¾¾å¼ã€‚è¿™ä¹Ÿæ˜¯æ–‡é¦– <code>ReflectionUtil.findField()</code> æ–¹æ³•ä¸­ <code>implMethodName.startsWith(LAMBDA_PREFIX)</code> åˆ¤æ–­çš„ç”±æ¥ã€‚</p>
<blockquote>
<p>Lambda è¡¨è¾¾å¼çš„åºåˆ—åŒ–</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSerialLambda</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    SFunction&lt;Person, String&gt; methodReferenceFunc = Person::getName;</span><br><span class="line">    Class&lt;?&gt; methodReferenceClass = serial(methodReferenceFunc);</span><br><span class="line"></span><br><span class="line">    SFunction&lt;Person, String&gt; lambdaFunc = (person) -&gt; person.getName();</span><br><span class="line">    Class&lt;?&gt; lambdaClass = serial(lambdaFunc);</span><br><span class="line"></span><br><span class="line">    System.out.println(); <span class="comment">// æ­¤å¤„æ–­ç‚¹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Class&lt;?&gt; serial(Serializable serializable) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos);</span><br><span class="line">    oos.writeObject(serializable);</span><br><span class="line">    oos.close();</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray()));</span><br><span class="line">    <span class="keyword">return</span> ois.readObject().getClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>testSerialLambda()</code> æ–¹æ³•æœ€åä¸€è¡Œæ–­ç‚¹ï¼ŒæŸ¥çœ‹ <code>methodReferenceClass</code> å’Œ <code>lambdaClass</code> çš„ä¿¡æ¯ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8%E4%B8%8ELambda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%BA%A7%E7%94%9F%E7%9A%84Class%E4%BF%A1%E6%81%AF.png" alt="ååºåˆ—åŒ–æ–¹æ³•å¼•ç”¨ä¸Lambdaè¡¨è¾¾å¼äº§ç”Ÿçš„Classä¿¡æ¯"></p>
<blockquote>
<p>å¦ä¸€ç§è·å– SerializedLambda å®ä¾‹çš„æ–¹å¼</p>
</blockquote>
<p>å‰æ–‡ä¸­ <code>SerializedLambda</code> å®ä¾‹éƒ½æ˜¯ä½¿ç”¨åå°„è°ƒç”¨ <code>writeReplace()</code> æ–¹æ³•æ¥è·å–çš„ï¼Œè¿˜å¯ä»¥é€šè¿‡åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„æ–¹å¼æ¥è·å– <code>SerializedLambda</code> å®ä¾‹ã€‚</p>
<p>ååºåˆ—åŒ–è°ƒç”¨çš„ <code>ObjectInputStream.readObject()</code> æ–¹æ³•ä¼šå›è°ƒ <code>SerializedLambda.readResolve()</code> æ–¹æ³•ï¼Œè‡´ä½¿æœ€ç»ˆè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªæ–°æ¨¡æ¿ç±»æ‰¿è½½çš„ Lambda è¡¨è¾¾å¼å®ä¾‹ï¼Œå› æ­¤éœ€è¦æƒ³åŠæ³•ä¸­æ–­è¿™ä¸ªè°ƒç”¨ä»¥æå‰è¿”å›ç»“æœã€‚</p>
<p>æ–¹æ³•æ˜¯æ„é€ ä¸€ä¸ªå’Œ <code>java.lang.invoke.SerializedLambda</code> åŒåçš„ç±»ï¼ˆå¯ä»¥ä¸åŒåŒ…åï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªç±»é‡Œæ²¡æœ‰ <code>readResolve()</code> æ–¹æ³•ï¼Œä»¥ä¾¿ç»•è¿‡ <code>ObjectStreamClass.classNamesEqual()</code> æ–¹æ³•çš„åˆ¤æ–­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Compares class names for equality, ignoring package names.  Returns true</span></span><br><span class="line"><span class="comment"> * if class names equal, false otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">classNamesEqual</span><span class="params">(String name1, String name2)</span> &#123;</span><br><span class="line">    name1 = name1.substring(name1.lastIndexOf(<span class="string">&#x27;.&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">    name2 = name2.substring(name2.lastIndexOf(<span class="string">&#x27;.&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// åªåˆ¤æ–­ç±»åï¼Œå¹¶æœªåˆ¤æ–­å…¨é™å®šå</span></span><br><span class="line">    <span class="keyword">return</span> name1.equals(name2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡ªå®šä¹‰çš„ <code>SerializedLambda</code> å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> indi.mofan.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/3 18:41</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;ALL&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializedLambda</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">8025925345765570181L</span>;</span><br><span class="line">    <span class="keyword">private</span>  Class&lt;?&gt; capturingClass;</span><br><span class="line">    <span class="keyword">private</span>  String functionalInterfaceClass;</span><br><span class="line">    <span class="keyword">private</span>  String functionalInterfaceMethodName;</span><br><span class="line">    <span class="keyword">private</span>  String functionalInterfaceMethodSignature;</span><br><span class="line">    <span class="keyword">private</span>  String implClass;</span><br><span class="line">    <span class="keyword">private</span>  String implMethodName;</span><br><span class="line">    <span class="keyword">private</span>  String implMethodSignature;</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">int</span> implMethodKind;</span><br><span class="line">    <span class="keyword">private</span>  String instantiatedMethodType;</span><br><span class="line">    <span class="keyword">private</span>  Object[] capturedArgs;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCapturingClass</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> capturingClass.getName().replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFunctionalInterfaceClass</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> functionalInterfaceClass;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFunctionalInterfaceMethodName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> functionalInterfaceMethodName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFunctionalInterfaceMethodSignature</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> functionalInterfaceMethodSignature;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getImplClass</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> implClass;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getImplMethodName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> implMethodName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getImplMethodSignature</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> implMethodSignature;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getImplMethodKind</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> implMethodKind;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String <span class="title function_">getInstantiatedMethodType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> instantiatedMethodType;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCapturedArgCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> capturedArgs.length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getCapturedArg</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> capturedArgs[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åå°±æ˜¯ä¸€ä¸ªç®€å•çš„æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreateSerializedLambdaByAnotherWay</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    SFunction&lt;Person, String&gt; function = Person::getName;</span><br><span class="line">    indi.mofan.lambda.<span class="type">SerializedLambda</span> <span class="variable">serializedLambda</span> <span class="operator">=</span> getSerializedLambda(function);</span><br><span class="line"></span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;getName&quot;</span>, serializedLambda.getImplMethodName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> indi.mofan.lambda.SerializedLambda <span class="title function_">getSerializedLambda</span><span class="params">(Serializable serializable)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">         <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(baos)) &#123;</span><br><span class="line">        oos.writeObject(serializable);</span><br><span class="line">        oos.flush();</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(baos.toByteArray())) &#123;</span><br><span class="line">            <span class="comment">// é‡å†™ resolveClass æ–¹æ³•ï¼ŒåŠè·¯æˆªèƒ¡ï¼Œä½¿ååºåˆ—åŒ–è¿”å›çš„ç±»å‹ä¸º indi.mofan.lambda.SerializedLambda</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass desc) <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">                Class&lt;?&gt; klass = <span class="built_in">super</span>.resolveClass(desc);</span><br><span class="line">                <span class="keyword">return</span> klass == java.lang.invoke.SerializedLambda.class ? indi.mofan.lambda.SerializedLambda.class : klass;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            <span class="keyword">return</span> (indi.mofan.lambda.SerializedLambda) ois.readObject();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-3-éšè—çš„-deserializeLambda-æ–¹æ³•"><a class="header-anchor" href="#3-3-éšè—çš„-deserializeLambda-æ–¹æ³•"></a>3.3 éšè—çš„ $deserializeLambda$ æ–¹æ³•</h2>
<p>é˜…è¯» <code>SerializedLambda</code> çš„é¡¶éƒ¨æ³¨é‡Šæ—¶çŸ¥é“è¿™ä¸ªç±»ä¸­æœ‰ä¸ª <code>readResolve()</code> æ–¹æ³•ï¼Œå®ƒä¼šè°ƒç”¨â€œæ•è·ç±»â€ä¸­ä¸€ä¸ªåä¸º <code>$deserializeLambda$(SerializedLambda)</code> çš„é™æ€æ–¹æ³•ã€‚<code>readResolve()</code> çš„æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ReflectiveOperationException &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">deserialize</span> <span class="operator">=</span> AccessController.doPrivileged(<span class="keyword">new</span> <span class="title class_">PrivilegedExceptionAction</span>&lt;Method&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Method <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                <span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> capturingClass.getDeclaredMethod(<span class="string">&quot;$deserializeLambda$&quot;</span>, SerializedLambda.class);</span><br><span class="line">                m.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">return</span> m;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> deserialize.invoke(<span class="literal">null</span>, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (PrivilegedActionException e) &#123;</span><br><span class="line">        <span class="type">Exception</span> <span class="variable">cause</span> <span class="operator">=</span> e.getException();</span><br><span class="line">        <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> ReflectiveOperationException)</span><br><span class="line">            <span class="keyword">throw</span> (ReflectiveOperationException) cause;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> RuntimeException)</span><br><span class="line">            <span class="keyword">throw</span> (RuntimeException) cause;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Exception in SerializedLambda.readResolve&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®æºç å¯çŸ¥ï¼Œæ˜¯ä½¿ç”¨åå°„è°ƒç”¨çš„ <code>$deserializeLambda$</code> æ–¹æ³•ã€‚</p>
<p>æ ¹æ®å‰æ–‡ä¸­è·å–çš„ <code>SerializedLambda</code> å®ä¾‹å¯çŸ¥ï¼Œè¿™é‡Œçš„â€œæ•è·ç±»â€æ˜¯æµ‹è¯•ç±» <code>indi.mofan.LambdaTest</code> ç±»ï¼Œè¿™ä¸ªç±»ä¸­å¹¶æ²¡æœ‰å®šä¹‰åä¸º <code>$deserializeLambda$</code> çš„æ–¹æ³•ï¼Œé‚£è¿™çœŸçš„æœ‰å—ï¼Ÿæµ‹è¯•ä¸€ä¸‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> testGet$deserializeLambda$MethodInfo() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    SFunction&lt;Person, String&gt; function = Person::getName;</span><br><span class="line">    <span class="type">Method</span> <span class="variable">writeReplaceMethod</span> <span class="operator">=</span> function.getClass().getDeclaredMethod(<span class="string">&quot;writeReplace&quot;</span>);</span><br><span class="line">    writeReplaceMethod.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">SerializedLambda</span> <span class="variable">serializedLambda</span> <span class="operator">=</span> (SerializedLambda) writeReplaceMethod.invoke(function);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åå°„è·å–â€œæ•è·ç±»â€å¯¹åº”çš„ Class å¯¹è±¡</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">capturingClassName</span> <span class="operator">=</span> serializedLambda.getCapturingClass().replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">    Assert.assertEquals(<span class="built_in">this</span>.getClass().getName(), capturingClassName);</span><br><span class="line">    Class&lt;?&gt; capturingClass = Class.forName(capturingClassName);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨ Spring çš„æ–¹æ³•</span></span><br><span class="line">    ReflectionUtils.doWithMethods(capturingClass, method -&gt; &#123;</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;$deserializeLambda$&quot;</span>, method.getName());</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;private static&quot;</span>, Modifier.toString(method.getModifiers()));</span><br><span class="line">        Assert.assertEquals(<span class="number">1</span>, method.getParameterCount());</span><br><span class="line">        Assert.assertEquals(SerializedLambda.class.getName(), method.getParameterTypes()[<span class="number">0</span>].getName());</span><br><span class="line">        Assert.assertEquals(Object.class.getName(), method.getReturnType().getName());</span><br><span class="line">    &#125;, method -&gt; Objects.equals(method.getName(), <span class="string">&quot;$deserializeLambda$&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ–¹æ³•é€šè¿‡ï¼Œåœ¨â€œæ•è·ç±»â€ä¸­è¿˜çœŸå­˜åœ¨ä¸€ä¸ªåä¸º <code>$deserializeLambda$</code>ã€å‚æ•°ç±»å‹ä¸º <code>SerializedLambda</code>ã€è¿”å›å€¼ç±»å‹ä¸º <code>Object</code> çš„ç§æœ‰é™æ€æ–¹æ³•ã€‚</p>
<blockquote>
<p>Spring çš„ ReflectionUtils.doWithMethods æ–¹æ³•</p>
</blockquote>
<p><code>ReflectionUtils.doWithMethods()</code> æ–¹æ³•çš„å‚æ•°ä¸è¿”å›å€¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doWithMethods</span><span class="params">(Class&lt;?&gt; clazz, ReflectionUtils.MethodCallback mc, <span class="meta">@Nullable</span> ReflectionUtils.MethodFilter mf)</span>&#123;</span><br><span class="line">    <span class="comment">// çœç•¥å…·ä½“å®ç°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>doWithMethods()</code> æ–¹æ³•ä¼šéå† <code>clazz</code> ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¯¹è¿™äº›æ–¹æ³•æŒ‰ç…§è¿‡æ»¤å™¨ <code>mf</code> è¿›è¡Œç­›é€‰ï¼Œè¿‡æ»¤å¾—åˆ°çš„æ–¹æ³•éƒ½å°†å›è°ƒ <code>mc</code>ã€‚</p>
<hr>
<p>åˆ°æ­¤ï¼Œ<code>SerializedLambda</code> ç±»å’Œ <code>writeReplace()</code> æ–¹æ³•çš„ä½œç”¨éƒ½å¾—åˆ°äº†è§£ç­”ï¼Œè§£å†³äº†ä¸¤ä¸ªæœ€å¤§çš„é—®é¢˜åå¹¶ä¸æ„å‘³ç€å°±ç»“æŸäº†ï¼Œå…¶ä¸­ä¾ç„¶å­˜åœ¨ç€å¾ˆå¤šç»†èŠ‚ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>å‡½æ•°å¼æ¥å£å¯¹åº”çš„å®ç°ç±»æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li><code>ReflectionUtil</code> ä¸­ç¼“å­˜ <code>CACHE</code> ä¸ºä»€ä¹ˆè¦ä»¥ <code>SFunction</code> ä½œä¸º keyï¼Œè¿™æœ‰æ„ä¹‰å—ï¼Ÿ</li>
<li><code>LambdaUtil.getSerializedLambda()</code> ä¸­ <code>aClass.isSynthetic()</code> æ˜¯ç”¨æ¥åˆ¤æ–­ä»€ä¹ˆçš„ï¼Ÿ</li>
<li><code>ReflectionUtil.findField()</code> ä¸­ä½¿ç”¨åˆ°çš„ <code>Introspector</code> ç±»æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>Debug æŸ¥çœ‹ <code>SerializedLambda</code> å¯¹è±¡çš„ä¿¡æ¯æ—¶ï¼Œä¸ºä»€ä¹ˆè®¸å¤šä¿¡æ¯éƒ½ä»¥ <code>/</code> åˆ†å‰²ï¼Œè€Œä¸æ˜¯ <code>.</code>ï¼Ÿ</li>
<li><code>LambdaUtil.getSerializedLambda()</code> ä¸­è·å– <code>writeReplace</code> çš„ <code>Method</code> å¯¹è±¡æ—¶ä¸ºä»€ä¹ˆä½¿ç”¨äº† <code>getDeclaredMethod()</code> æ–¹æ³•ï¼Œè€Œä¸æ˜¯ <code>getMethod()</code>ï¼Ÿ</li>
</ul>
<h1 id="4-å…¶ä»–ç»†èŠ‚è¡¥å……"><a class="header-anchor" href="#4-å…¶ä»–ç»†èŠ‚è¡¥å……"></a>4. å…¶ä»–ç»†èŠ‚è¡¥å……</h1>
<h2 id="4-1-å‡½æ•°å¼æ¥å£çš„å®ç°ç±»"><a class="header-anchor" href="#4-1-å‡½æ•°å¼æ¥å£çš„å®ç°ç±»"></a>4.1 å‡½æ•°å¼æ¥å£çš„å®ç°ç±»</h2>
<p>å‰æ–‡è¯´åˆ°ï¼Œç¨‹åºä¸­ Lambda è¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨ä½¿ç”¨çš„å‡½æ•°å¼æ¥å£æœ€ç»ˆå¿…å®šä¹Ÿæ˜¯ä¸€ä¸ªå®ç°ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œé‚£è¿™å®ç°ç±»æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹å¼èƒ½çœ‹åˆ°ï¼Ÿ</p>
<p>è¿˜çœŸæœ‰ï¼Œåœ¨ Java8 ä¸­å¯ä»¥é€šè¿‡å¦‚ä¸‹ç¡¬ç¼–ç å½¢å¼çš„å±æ€§é…ç½®å°†å‡½æ•°å¼æ¥å£åŠ¨æ€ç”Ÿæˆçš„ class æ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.setProperty(<span class="string">&quot;jdk.internal.lambda.dumpProxyClasses&quot;</span>, <span class="string">&quot;.&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>ç”±äº Java9 å¼•è¿›çš„æ¨¡å—åŒ–ï¼Œåç»­ç‰ˆæœ¬çš„ JDK åªèƒ½é€šè¿‡ JVM å‚æ•°æŒ‡å®šï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># JDK 11 ä¸­æŒ‡å®šçš„å‚æ•°</span></span><br><span class="line"><span class="attr">-Djdk.internal.lambda.dumpProxyClasses</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># JDK 21 ä¸­æŒ‡å®šçš„å‚æ•°</span></span><br><span class="line"><span class="attr">-Djdk.invoke.LambdaMetafactory.dumpProxyClassFiles</span></span><br></pre></td></tr></table></figure>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E6%98%BE%E7%A4%BA%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3%E7%94%9F%E6%88%90%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%B1%BB.png" alt="æ˜¾ç¤ºå‡½æ•°å¼æ¥å£ç”Ÿæˆçš„å®ç°ç±»"></p>
<p>æ ¹æ®ä¸Šæ–¹çš„å›¾ç‰‡å¯ä»¥çœ‹å‡ºï¼Œ <strong>ä»£ç ä¸­å¤šæ¬¡ç¼–å†™çš„åŒä¸€ä¸ªæ–¹æ³•å¼•ç”¨ä¼šç”Ÿæˆå¤šä¸ªå®ç°ç±»ï¼Œå®ƒä»¬çš„å®ä¾‹å¯¹è±¡ä¹Ÿä¸ä¼šæ˜¯åŒä¸€ä¸ªã€‚</strong></p>
<p>åœ¨åŠ¨æ€ç”Ÿæˆçš„ Class ä¸­è¿˜å¯ä»¥çœ‹åˆ° <code>writeReplace()</code> æ–¹æ³•ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8%E5%8A%A8%E6%80%81%E7%94%9F%E6%88%90%E7%9A%84Class.png" alt="æ–¹æ³•å¼•ç”¨åŠ¨æ€ç”Ÿæˆçš„Class"></p>
<p>æ—¢ç„¶ä¸€ä¸ªæ–¹æ³•åˆ›å»ºä¸€ä¸ªå®ç°ç±»ï¼Œå®ç°ç±»åˆå¯¹åº”ä¸åŒçš„å¯¹è±¡ï¼Œé‚£ä¹ˆ <code>ReflectionUtil</code> ä¸­å°† <code>SFunction</code> ä½œä¸ºç¼“å­˜çš„ key è¿˜æœ‰æ„ä¹‰å—ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚å› ä¸º <strong>åŒä¸€æ–¹æ³•ä¸­ <mark>å®šä¹‰</mark> çš„ Lambda è¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨åªä¼šåŠ¨æ€åˆ›å»ºä¸€æ¬¡å®ç°ç±»å¹¶åªå®ä¾‹åŒ–ä¸€æ¬¡ï¼Œ</strong> è€Œè¢«å¤šæ¬¡è°ƒç”¨æ—¶å°±å¯ä»¥åˆ©ç”¨ç¼“å­˜æä¾›æ€§èƒ½ã€‚</p>
<p>æˆ–è®¸è¿˜ä¸æ˜ç™½ï¼Œé‚£ä¹ˆè¯·çœ‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCallSFunction</span><span class="params">()</span> &#123;</span><br><span class="line">    SFunction&lt;Person, String&gt; function1 = Person::getName;</span><br><span class="line">    SFunction&lt;Person, String&gt; function2 = Person::getName;</span><br><span class="line"></span><br><span class="line">    Assert.assertNotSame(function1, function2);</span><br><span class="line"></span><br><span class="line">    List&lt;SFunction&lt;Person, String&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        SFunction&lt;Person, String&gt; function = Person::getName;</span><br><span class="line">        System.out.println(function);</span><br><span class="line">        list.add(function);</span><br><span class="line">    &#125;</span><br><span class="line">    Assert.assertSame(list.get(<span class="number">0</span>), list.get(<span class="number">1</span>));</span><br><span class="line">    Assert.assertSame(list.get(<span class="number">1</span>), list.get(<span class="number">2</span>));</span><br><span class="line">    Assert.assertSame(list.get(<span class="number">2</span>), list.get(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–è®¸ä½ ä»¥ä¸ºä¸Šè¿°ä»£ç å°†åˆ›å»º 5 ä¸ªå®ç°ç±»ï¼Œå…¶å®åªä¼šåˆ›å»º 3 ä¸ªã€‚<code>for</code> å¾ªç¯ä¸­çš„å®šä¹‰çš„æ–¹æ³•å¼•ç”¨åªä¼šåˆ›å»º 1 ä¸ªå®ç°ç±»ï¼Œè€Œä¸æ˜¯ 3 ä¸ªï¼Œå› ä¸ºå®ƒåªè¢«å®šä¹‰äº†ä¸€æ¬¡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¸å°±å¯ä»¥èµ°ç¼“å­˜äº†å—ï¼Ÿ</p>
<p>é‚£ç¼“å­˜åˆä¸ºä»€ä¹ˆä¸ä»¥ <code>SFunction</code> çš„ <code>Class</code> ä¸º keyï¼Œè¿˜è¦ä»¥è¿™ç§è®©äººç–‘æƒ‘çš„ <code>SFunction</code> å®ä¾‹å¯¹è±¡ä¸º key å‘¢ï¼Ÿ</p>
<p>å·²ç»çŸ¥é“æ— è®ºæ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡ï¼Œæ–¹æ³•å†…çš„æ–¹æ³•å¼•ç”¨å¯¹è±¡å§‹ç»ˆæ˜¯åŒä¸€ä¸ªï¼Œå¦‚æœé‡‡ç”¨å…¶ <code>Class</code> åšä¸ºç¼“å­˜ keyï¼Œæ¯æ¬¡æŸ¥è¯¢ç¼“å­˜æ—¶éƒ½éœ€è¦è°ƒç”¨ <code>native</code> æ–¹æ³•<code>getClass()</code>è·å–å…¶ <code>Class</code>ï¼Œè€Œè¿™ä¹Ÿæ˜¯ä¸€ç§èµ„æºæŸè€—ã€‚</p>
<h2 id="4-2-synthetic-class"><a class="header-anchor" href="#4-2-synthetic-class"></a>4.2 synthetic class</h2>
<p>åœ¨ <code>Class</code> ç±»ä¸­æœ‰è¿™æ ·ä¸€ä¸ªç§æœ‰å¸¸é‡å’Œæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Class</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable,</span><br><span class="line">                                GenericDeclaration,</span><br><span class="line">                                Type,</span><br><span class="line">                                AnnotatedElement &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SYNTHETIC</span> <span class="operator">=</span> <span class="number">0x00001000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSynthetic</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (getModifiers() &amp; SYNTHETIC) != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>isSynthetic()</code> ç”¨äºåˆ¤æ–­ä¸€ä¸ª Class æ˜¯å¦æ˜¯åˆæˆçš„ Classã€‚é‚£ä»€ä¹ˆæ˜¯åˆæˆçš„ Classï¼Ÿ</p>
<p>éåŸºæœ¬ç±»å‹ï¼Œå³å¤åˆç±»å‹ï¼ˆå¼•ç”¨ç±»å‹ï¼‰å°±æ˜¯åˆæˆçš„ Classï¼Ÿéä¹Ÿã€‚</p>
<p>åˆæˆçš„ Class æ˜¯æŒ‡ <strong>ç”± JVM ç”Ÿæˆï¼Œå¹¶ä¸”åœ¨æºä»£ç ä¸­æ²¡æœ‰ç¬¦åˆçš„ç»“æ„å°†è¢«æ ‡è®°ä¸ºåˆæˆçš„ã€‚ä¸åŒ…æ‹¬é»˜è®¤æ„é€ å™¨ã€ç±»åˆå§‹åŒ–æ–¹æ³•ï¼ˆ<code>&lt;init&gt;()</code>ï¼‰ã€æšä¸¾çš„ values å’Œ valueOf æ–¹æ³•ã€‚</strong></p>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“ Lambda è¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨åœ¨ç¨‹åºè¿è¡Œæ—¶ä¼šåŠ¨æ€ç”Ÿæˆçš„ Classï¼Œè¿™äº› Class å°±æ˜¯åˆæˆçš„ã€‚</p>
<p>æ—¢ç„¶éƒ½æ˜¯åˆæˆçš„ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ <code>isSynthetic()</code> è¿›è¡Œåˆ¤æ–­å‘¢ï¼Ÿ</p>
<p>åœ¨ Java8 ç‰ˆæœ¬ä»¥å‰ï¼Œè¿˜æ²¡æœ‰ Lambda è¡¨è¾¾å¼æ—¶ï¼Œç»å¸¸ç”¨åŒ¿åå†…éƒ¨ç±»ä»£æ›¿ Lambdaï¼Œä¸ºäº†æ’é™¤è¿™ç§æƒ…å†µï¼Œå°±éœ€è¦ä½¿ç”¨ <code>isSynthetic()</code> è¿›è¡Œåˆ¤æ–­ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/7 17:37</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SSupplier</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Supplier</span>&lt;T&gt;, Serializable &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetImplClass</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">    SSupplier&lt;String&gt; consumer = person::getName;</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;indi.mofan.domain.Person&quot;</span>, getImplClass(consumer));</span><br><span class="line"></span><br><span class="line">    SSupplier&lt;String&gt; supplier = <span class="keyword">new</span> <span class="title class_">SSupplier</span>&lt;String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> person.getName();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">    Assert.assertTrue(getImplClass(supplier).isEmpty());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-3-Introspector"><a class="header-anchor" href="#4-3-Introspector"></a>4.3 Introspector</h2>
<p><code>Introspector</code> æ˜¯ <code>java.beans</code> åŒ…ä¸‹çš„ä¸€ä¸ªç±»ï¼Œå®ƒä¸ºç›®æ ‡ JavaBean æä¾›äº†ä¸€ç§äº†è§£åŸç±»æ–¹æ³•ã€å±æ€§å’Œäº‹ä»¶ç­‰ä¿¡æ¯çš„æ ‡å‡†æ–¹æ³•ã€‚ç®€å•æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡ <code>Introspector</code> æ„å»ºä¸€ä¸ª <code>BeanInfo</code> å¯¹è±¡ï¼Œè€Œè¿™ä¸ª <code>BeanInfo</code> å¯¹è±¡ä¸­åŒ…å«äº†ç›®æ ‡ JavaBean ä¸­çš„å±æ€§ã€æ–¹æ³•å’Œäº‹ä»¶ç­‰æè¿°ä¿¡æ¯ï¼Œé™¤äº†è·å–è¿™äº›ä¿¡æ¯å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è¿™ä¸ª <code>BeanInfo</code> å¯¹è±¡å¯¹ç›®æ ‡ JavaBean å¯¹è±¡è¿›è¡Œç›¸å…³æ“ä½œã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯ JavaBeanï¼Ÿ</p>
</blockquote>
<p>JavaBean å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„ã€å¯é‡ç”¨çš„ Java ç±»ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/jsp/jsp-javabean.html">èœé¸Ÿæ•™ç¨‹å…³äº JavaBean</a> æ˜¯è¿™ä¹ˆæè¿°çš„ï¼š</p>
<p>JavaBean æ˜¯ç‰¹æ®Šçš„ Java ç±»ï¼Œä½¿ç”¨ Java è¯­è¨€ä¹¦å†™ï¼Œå¹¶ä¸”éµå®ˆ JavaBean API è§„èŒƒã€‚JavaBean ä¸å…¶å®ƒ Java ç±»ç›¸æ¯”è€Œè¨€ç‹¬ä¸€æ— äºŒçš„ç‰¹å¾ï¼š</p>
<ul>
<li>æä¾›ä¸€ä¸ªé»˜è®¤çš„æ— å‚æ„é€ å‡½æ•°ã€‚</li>
<li>éœ€è¦è¢«åºåˆ—åŒ–å¹¶ä¸”å®ç°äº† Serializable æ¥å£ã€‚</li>
<li>å¯èƒ½æœ‰ä¸€ç³»åˆ—å¯è¯»å†™å±æ€§ã€‚</li>
<li>å¯èƒ½æœ‰ä¸€ç³»åˆ—çš„ getter æˆ– <strong>setter</strong> æ–¹æ³•ã€‚</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/JavaBean/529577">ç™¾åº¦ç™¾ç§‘å…³äº JavaBean</a> æ˜¯è¿™ä¹ˆæè¿°çš„ï¼š</p>
<p>JavaBean æ˜¯ä¸€ç§ Java è¯­è¨€å†™æˆçš„å¯é‡ç”¨ç»„ä»¶ã€‚ä¸ºå†™æˆ JavaBeanï¼Œç±»å¿…é¡»æ˜¯å…·ä½“çš„å’Œå…¬å…±çš„ï¼Œå¹¶ä¸”å…·æœ‰æ— å‚æ•°çš„æ„é€ å™¨ã€‚JavaBean  é€šè¿‡æä¾›ç¬¦åˆä¸€è‡´æ€§è®¾è®¡æ¨¡å¼çš„å…¬å…±æ–¹æ³•å°†å†…éƒ¨åŸŸæš´éœ²æˆå‘˜å±æ€§ï¼Œset å’Œ get æ–¹æ³•è·å–ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œå±æ€§åç§°ç¬¦åˆè¿™ç§æ¨¡å¼ï¼Œå…¶ä»– Java ç±»å¯ä»¥é€šè¿‡è‡ªçœæœºåˆ¶ï¼ˆåå°„æœºåˆ¶ï¼‰å‘ç°å’Œæ“ä½œè¿™äº› JavaBean çš„å±æ€§ã€‚</p>
<p>JavaBean æ˜¯ä¸€ç§å¯é‡ç”¨çš„ Java ç»„ä»¶ï¼Œå®ƒå¯ä»¥è¢« Appletã€Servletã€JSP ç­‰ Java åº”ç”¨ç¨‹åºè°ƒç”¨ï¼ä¹Ÿå¯ä»¥å¯è§†åŒ–åœ°è¢« Java å¼€å‘å·¥å…·ä½¿ç”¨ã€‚å®ƒåŒ…å«å±æ€§ï¼ˆPropertiesï¼‰ã€æ–¹æ³•ï¼ˆMethodsï¼‰ã€äº‹ä»¶ï¼ˆEventsï¼‰ç­‰ç‰¹æ€§ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/JavaBeans">ç»´åŸºç™¾ç§‘å…³äº JavaBean</a> æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p>
<p>JavaBeans æ˜¯ Java ä¸­ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œå¯ä»¥å°†å¤šä¸ªå¯¹è±¡å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ï¼ˆbeanï¼‰ä¸­ã€‚ç‰¹ç‚¹æ˜¯å¯åºåˆ—åŒ–ï¼Œæä¾› public æ— å‚æ„é€ å™¨ï¼Œæä¾› getter æ–¹æ³•å’Œ setter æ–¹æ³•è®¿é—®å¯¹è±¡çš„å±æ€§ã€‚åç§°ä¸­çš„â€œBeanâ€æ˜¯ç”¨äº Java çš„å¯é‡ç”¨è½¯ä»¶ç»„ä»¶çš„æƒ¯ç”¨å«æ³•ã€‚</p>
<p>æ¯”å¦‚ï¼Œä¸‹è¿°çš„ <code>Person</code> å°±æ˜¯ä¸€ä¸ª JavaBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/3/29 12:24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">8597585718927776100L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(String age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç®€å•çš„ä½¿ç”¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIntrospector</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// è·å–æ•´ä¸ª bean ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//  BeanInfo personBeanInfo = Introspector.getBeanInfo(Person.class);</span></span><br><span class="line">    <span class="comment">// æ£€ç´¢åˆ° Object æ—¶åœæ­¢ï¼Œå¯ä»¥æ£€ç´¢åˆ° JavaBean çš„ä»»æ„çˆ¶ç±»æ—¶åœæ­¢</span></span><br><span class="line">    <span class="type">BeanInfo</span> <span class="variable">beanInfo</span> <span class="operator">=</span> Introspector.getBeanInfo(Person.class, Object.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å±æ€§ä¿¡æ¯</span></span><br><span class="line">    PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();</span><br><span class="line">    List&lt;String&gt; beanFieldInfo = Arrays.stream(propertyDescriptors).map(PropertyDescriptor::getName)</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">    List&lt;String&gt; classFieldInfo = Arrays.stream(Person.class.getDeclaredFields()).map(Field::getName).collect(Collectors.toList());</span><br><span class="line">    Assert.assertTrue(classFieldInfo.containsAll(beanFieldInfo));</span><br><span class="line">    Assert.assertEquals(<span class="number">2</span>, beanFieldInfo.size());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– bean ä¸­ public çš„æ–¹æ³•</span></span><br><span class="line">    MethodDescriptor[] methodInfo = beanInfo.getMethodDescriptors();</span><br><span class="line">    Assert.assertEquals(<span class="number">4</span>, methodInfo.length);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å±æ€§çš„å€¼</span></span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">    person.setName(<span class="string">&quot;mofan&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">propertyName</span> <span class="operator">=</span> <span class="string">&quot;name&quot;</span>;</span><br><span class="line">    <span class="type">PropertyDescriptor</span> <span class="variable">nameProperty</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PropertyDescriptor</span>(propertyName, Person.class);</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;mofan&quot;</span>, nameProperty.getReadMethod().invoke(person));</span><br><span class="line">    <span class="comment">// ä¿®æ”¹å±æ€§çš„å€¼</span></span><br><span class="line">    nameProperty.getWriteMethod().invoke(person, <span class="string">&quot;TestName&quot;</span>);</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;TestName&quot;</span>, nameProperty.getReadMethod().invoke(person));</span><br><span class="line">    <span class="comment">// åŸå¯¹è±¡ä¹Ÿæœ‰å½±å“</span></span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;TestName&quot;</span>, person.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šå¸¸ä¼šä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼è·å– <code>BeanInfo</code> å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> BeanInfo <span class="title function_">getBeanInfo</span><span class="params">(Class&lt;?&gt; beanClass)</span> <span class="keyword">throws</span> IntrospectionException</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> BeanInfo <span class="title function_">getBeanInfo</span><span class="params">(Class&lt;?&gt; beanClass, Class&lt;?&gt; stopClass)</span> <span class="keyword">throws</span> IntrospectionException</span><br></pre></td></tr></table></figure>
<p>æ›´å»ºè®®ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼æ¥è·å– <code>BeanInfo</code> å¯¹è±¡ã€‚é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œå°†æ£€ç´¢åˆ° stopClass æ—¶åœæ­¢ã€‚æ¯”å¦‚å°† stopClass è®¾ç½®ä¸º <code>Object.class</code>ï¼Œè¿™æ ·çš„è¯å¯ä»¥è§„é¿ <code>Object</code> ç±»ä¸­çš„ä¿¡æ¯ï¼Œè¿›è€Œå¾—åˆ°æ›´åŠ çº¯å‡€çš„ç›®æ ‡ JavaBean ä¿¡æ¯ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetAllBeanInfo</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">BeanInfo</span> <span class="variable">beanInfo</span> <span class="operator">=</span> Introspector.getBeanInfo(Person.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰å±æ€§</span></span><br><span class="line">    PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();</span><br><span class="line">    Assert.assertEquals(<span class="number">3</span>, propertyDescriptors.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Person</code> ä¸­æ˜æ˜åªæœ‰ <code>name</code> å’Œ <code>age</code> ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼Œä¸ºä»€ä¹ˆè·å–åˆ°çš„å±æ€§æ•°é‡æ˜¯ 3 å‘¢ï¼ŸDebug ä¸€ä¸‹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E8%8E%B7%E5%8F%96%E5%88%B0%E7%9A%84class%E5%B1%9E%E6%80%A7.png" alt="è·å–åˆ°çš„classå±æ€§"></p>
<p>å±…ç„¶æœ‰ä¸€ä¸ª name ä¸º <code>class</code> çš„å±æ€§ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ<code>Person</code> ç±»ä¸­æ²¡æœ‰ï¼Œ<code>Object</code> ç±»ä¸­ä¹Ÿæ²¡æœ‰ï¼Œå®ƒæ˜¯å“ªæ¥çš„ï¼Ÿ</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜å°±å¾—è¯´è¯´ Java ç±»ä¸­æˆå‘˜å˜é‡ Fields å’Œå±æ€§ Properties çš„åŒºåˆ«äº†ã€‚</p>
<blockquote>
<p>Java ç±»ä¸­æˆå‘˜å˜é‡ Fields å’Œå±æ€§ Properties çš„åŒºåˆ«</p>
</blockquote>
<p>æˆ–è®¸ä½ è®¤ä¸ºè¿™ä¸¤ä¸ªè¡¨ç¤ºåŒä¸€ä¸ªæ„æ€ï¼Œå…¶å®å¹¶ä¸æ˜¯ï¼Œä»¥ <code>Person</code> ä¸ºä¾‹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/Person%E7%9A%84Fields%E5%92%8CProperties.png" alt="Personçš„Fieldså’ŒProperties"></p>
<p>æˆå‘˜å˜é‡ Fields å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> String age;</span><br></pre></td></tr></table></figure>
<p>ä½†å±æ€§ Properties å°±ä¸æ˜¯è¿™æ ·äº†ï¼Œå®ƒæŒ‡çš„æ˜¯ getter/setter æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(String age)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ IDEA å¯¹ç±»ç»“æ„è¿›è¡Œæ˜¾ç¤ºæ—¶ï¼Œåœ¨å·¦ä¾§ä¹Ÿèƒ½æ¸…æ™°åœ°æ˜¾ç¤ºæˆå‘˜å˜é‡å’Œå±æ€§çš„åŒºåˆ«ã€‚</p>
<p><strong>å±æ€§ Properties çš„å®˜æ–¹å®šä¹‰ï¼šå±æ€§æ˜¯æŒ‡ get æˆ–è€… set æ–¹æ³•åå»æ‰ get æˆ–è€… set åï¼ŒæŠŠå‰©ä½™çš„éƒ¨åˆ†é¦–å­—æ¯æ”¹ä¸ºå°å†™åï¼Œå³ä¸ºè¿™ä¸ªç±»çš„å±æ€§ã€‚</strong> æ¯”å¦‚ï¼Œ<code>getName</code> è½¬æ¢ä¸º <code>name</code>ï¼Œ<code>getname</code> è½¬æ¢ä¸º <code>name</code>ï¼Œ<code>getURL</code> è½¬æ¢ä¸º <code>URL</code>ã€‚</p>
<p>åœ¨ <code>Object</code> ç±»ä¸­æœ‰åä¸º <code>getClass()</code>ï¼Œå› æ­¤ <code>class</code> ä¹Ÿæ˜¯ä¸€ä¸ªå±æ€§ã€‚æ­£å› å¦‚æ­¤ï¼Œæ›´æ¨èä½¿ç”¨ä»¥ä¸‹æ–¹å¼è·å– <code>BeanInfo</code> ä»¥å¾—åˆ°çº¯å‡€çš„ JavaBean ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> BeanInfo <span class="title function_">getBeanInfo</span><span class="params">(Class&lt;?&gt; beanClass, Class&lt;?&gt; stopClass)</span> <span class="keyword">throws</span> IntrospectionException</span><br></pre></td></tr></table></figure>
<p>Fields å’Œ Properties ä¸€èˆ¬æ¥è¯´æ—¶ç›¸ç­‰çš„ï¼Œä½†ä¹Ÿæ—¶å¸¸ä¼šå­˜åœ¨ä¸ç›¸ç­‰çš„æƒ…å†µï¼Œé’ˆå¯¹è¿™äº›æƒ…å†µï¼Œå¸¸ç”¨åå°„æ¥è·å– Fieldsï¼Œä½¿ç”¨ Introspector æ¥è·å– Propertiesã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetFieldsAndProperties</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// è·å– Fields</span></span><br><span class="line">    Field[] fields = Person.class.getDeclaredFields();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– Properties</span></span><br><span class="line">    <span class="type">BeanInfo</span> <span class="variable">beanInfo</span> <span class="operator">=</span> Introspector.getBeanInfo(Person.class, Object.class);</span><br><span class="line">    PropertyDescriptor[] properties = beanInfo.getPropertyDescriptors();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜éœ€è¦æ³¨æ„ï¼Œç”±äºåœ¨ <code>Person</code> ä¸­å®šä¹‰äº† <code>serialVersionUID</code>ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ª Fieldï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E5%90%8D%E4%B8%BAserialVersionUID%E7%9A%84Field.png" alt="åä¸ºserialVersionUIDçš„Field"></p>
<blockquote>
<p>å†…çœ Introspector å’Œåå°„ Reflection çš„åŒºåˆ«</p>
</blockquote>
<p>å†…çœ Introspector å’Œåå°„ Reflection å¾ˆç›¸ä¼¼ï¼Œå°±è¿ä½¿ç”¨æ–¹æ³•ä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒIntrospector æ›´å¤šçš„ä½¿ç”¨æ–¹æ³•è‡ªè¡Œæ¢ç´¢ï¼Œåœ¨æ­¤æ¢³ç†ä¸‹å®ƒä»¬ä¸¤è€…çš„åŒºåˆ«ã€‚</p>
<p>åå°„æ˜¯åœ¨è¿è¡Œæ—¶è·å–ç±»çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬æˆå‘˜å˜é‡ã€æˆå‘˜æ–¹æ³•ã€æ„é€ å™¨ç­‰ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æ“çºµä¿®æ”¹å¯¹è±¡çš„å­—æ®µå€¼ã€æ–¹æ³•ã€æ„é€ å™¨ç­‰å†…å®¹ã€‚åå°„å¯ä»¥ç†è§£ä¸ºç±»â€œç…§é•œå­â€åå¾—åˆ°çš„ä¿¡æ¯ï¼Œå°±åƒæˆ‘ä»¬ç°å®ä¸­ç…§é•œå­ä¸€æ ·ï¼Œç±»â€œç…§é•œå­â€åå¾—åˆ°çš„ä¿¡æ¯ <strong>å¿…å®šæ˜¯æ­£ç¡®çš„ã€‚</strong></p>
<p>å†…çœåŸºäºåå°„å®ç°ï¼Œå¸¸ç”¨äºæ“ä½œ <code>JavaBean</code>ï¼ŒåŸºäº <code>JavaBean</code> çš„è§„èŒƒå¯¹ Bean ä¿¡æ¯è¿›è¡Œè§£æï¼Œä¾æ®äºç±»çš„ <code>Getter</code> å’Œ <code>Setter</code> æ–¹æ³•ï¼Œè·å–åˆ°ç±»çš„æè¿°ç¬¦ã€‚å¯ä»¥ç†è§£ä¸ºâ€œç±»çš„åçœâ€ï¼Œä¹Ÿå’Œç°å®ä¸­çš„åçœä¸€æ ·ï¼Œâ€œç±»çš„åçœâ€ä¸ä¸€å®šæ˜¯æ­£ç¡®çš„ã€‚å¦‚æœä¸€ä¸ªç±»ä¸­çš„å±æ€§æ²¡æœ‰<code>Setter</code>å’Œ<code>Getter</code>æ–¹æ³•ï¼Œæ— æ³•ä½¿ç”¨å†…çœã€‚</p>
<blockquote>
<p>å¯èƒ½å¯¼è‡´çš„å†…å­˜æº¢å‡º</p>
</blockquote>
<p>å¦‚æœæ¡†æ¶æˆ–è€…ç¨‹åºç”¨åˆ°äº† <code>Introspector</code>ï¼Œå°±ç›¸å½“äºå¯ç”¨äº†ä¸€ä¸ªç³»ç»Ÿçº§åˆ«çš„ç¼“å­˜ï¼Œè¿™ä¸ªç¼“å­˜ä¼šå­˜æ”¾ä¸€äº›æ›¾åŠ è½½å¹¶åˆ†æè¿‡çš„ JavaBean çš„å¼•ç”¨ã€‚å½“ Web æœåŠ¡å™¨å…³é—­æ—¶ï¼Œç”±äºè¿™ä¸ªç¼“å­˜ä¸­å­˜æ”¾ç€çš„ JavaBean çš„å¼•ç”¨ï¼Œæ‰€ä»¥åƒåœ¾å›æ”¶å™¨ä¸èƒ½å¯¹ Web å®¹å™¨ä¸­çš„ JavaBean å¯¹è±¡è¿›è¡Œå›æ”¶ï¼Œå¯¼è‡´å†…å­˜è¶Šæ¥è¶Šå¤§ã€‚</p>
<p>æ¸…é™¤ <code>Introspector</code> ç¼“å­˜çš„å”¯ä¸€æ–¹å¼æ˜¯åˆ·æ–°æ•´ä¸ªç¼“å­˜ç¼“å†²åŒºï¼Œè¿™æ˜¯å› ä¸º JDK æ²¡æ³•åˆ¤æ–­å“ªäº›æ˜¯å±äºå½“å‰çš„åº”ç”¨çš„å¼•ç”¨ï¼Œè€Œåˆ·æ–°æ•´ä¸ª <code>Introspector</code> ç¼“å­˜ç¼“å†²åŒºåˆä¼šå¯¼è‡´æŠŠæœåŠ¡å™¨ä¸Šæ‰€æœ‰åº”ç”¨çš„ <code>Introspector</code> ç¼“å­˜éƒ½åˆ æ‰ã€‚å¯¹æ­¤ Spring æä¾›äº† <code>org.springframework.web.util.IntrospectorCleanupListener</code> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå½“æŸä¸ª Web æœåŠ¡å™¨åœæ­¢æ—¶ï¼Œå°±ä¼šæ¸…ç†è¿™ä¸ªæœåŠ¡å™¨ä¸‹çš„ <code>Introspector</code> ç¼“å­˜ï¼Œä½¿é‚£äº› JavaBean èƒ½è¢«åƒåœ¾å›æ”¶å™¨æ­£ç¡®å›æ”¶ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ JDK çš„ Introspector ç¼“å­˜ç®¡ç†æ˜¯æœ‰ä¸€å®šç¼ºé™·çš„ã€‚ä½†å¦‚æœåœ¨ Spring ä½“ç³»ä¸­ä½¿ç”¨åˆ™ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜ï¼Œåœ¨ Spring ä½“ç³»ä¸‹ <code>Introspector</code> ç¼“å­˜çš„ç®¡ç†ç§»äº¤ç»™äº† Spring è‡ªèº«è€Œä¸æ˜¯ JDKï¼ˆæˆ–è€…åœ¨ Web å®¹å™¨é”€æ¯åå®Œå…¨ä¸ç®¡ï¼‰ã€‚</p>
<p>åœ¨ Spring ä½“ç³»ä¸­ï¼Œä¸ºäº†é˜²æ­¢ JDK å¯¹ <code>Introspector</code> çš„ç¼“å­˜æ— æ³•è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶å¯¼è‡´å†…å­˜æº¢å‡ºï¼Œä¸»è¦çš„æ“ä½œé™¤äº†å¯ä»¥é€šè¿‡é…ç½® <code>IntrospectorCleanupListener</code> é¢„é˜²å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ <code>CachedIntrospectionResults</code> ç±»è‡ªè¡Œç®¡ç† <code>Introspector</code> ä¸­çš„ç¼“å­˜ï¼ˆè¿™ç§æ–¹å¼æ‰æ˜¯ä¼˜é›…çš„æ–¹å¼ï¼Œè¿™å¯ä»¥é¿å…åˆ·æ–°æ•´ä¸ª <code>Introspector</code> çš„ç¼“å­˜ç¼“å†²åŒºè€Œå¯¼è‡´å…¶ä»–åº”ç”¨çš„ <code>Introspector</code> ä¹Ÿè¢«æ¸…ç©ºï¼‰ã€‚</p>
<p>åœ¨ SpringBoot åˆ·æ–°ä¸Šä¸‹æ–‡çš„æ–¹æ³• <code>AbstractApplicationContext#refresh()</code> ä¸­çš„ <code>finally</code> ä»£ç å—ä¸­ <code>AbstractApplicationContext#resetCommonCaches();</code> æ–¹æ³•é‡Œè°ƒç”¨åˆ°çš„ <code>CachedIntrospectionResults#clearClassLoader(getClassLoader())</code> æ–¹æ³•å°±æ˜¯æ¸…ç†æŒ‡å®šçš„ <code>ClassLoader</code> ä¸‹çš„æ‰€æœ‰ <code>Introspector</code> ä¸­çš„ç¼“å­˜çš„å¼•ç”¨ã€‚</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/AbstractApplicationContext%E4%B8%AD%E7%9A%84resetCommonCaches%E6%96%B9%E6%B3%95.png" alt="AbstractApplicationContextä¸­çš„resetCommonCachesæ–¹æ³•"></p>
<p><code>resetCommonCaches()</code> æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">resetCommonCaches</span><span class="params">()</span> &#123;</span><br><span class="line">    ReflectionUtils.clearCache();</span><br><span class="line">    AnnotationUtils.clearCache();</span><br><span class="line">    ResolvableType.clearCache();</span><br><span class="line">    <span class="comment">// æ¸…é™¤æŒ‡å®š ClassLoader ä¸‹æ‰€æœ‰ Introspector çš„ç¼“å­˜çš„å¼•ç”¨</span></span><br><span class="line">    CachedIntrospectionResults.clearClassLoader(<span class="built_in">this</span>.getClassLoader());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-4-Java-æè¿°ç¬¦"><a class="header-anchor" href="#4-4-Java-æè¿°ç¬¦"></a>4.4 Java æè¿°ç¬¦</h2>
<p>å½“æˆ‘ä»¬ Debug æŸ¥çœ‹ <code>SerializedLambda</code> å¯¹è±¡çš„ä¿¡æ¯æ—¶ï¼Œè®¸å¤šä¿¡æ¯éƒ½ä»¥ <code>/</code> åˆ†å‰²ï¼Œè€Œä¸æ˜¯å°è±¡ä¸­çš„ <code>.</code>ã€‚æ¯”å¦‚ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E4%B8%8D%E5%90%8CSerializedLambda%E5%AE%9E%E4%BE%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB.png" alt="ä¸åŒSerializedLambdaå®ä¾‹ä¹‹é—´çš„åŒºåˆ«"></p>
<p>å…·ä½“åŸå› æ€»ç»“ä¸‹æ¥å°±å››ä¸ªå­—ï¼šå†å²åŸå› ã€‚é‡ç‚¹æ˜¯çœ‹ä¸€ä¸‹å®ƒçš„è§„åˆ™æ˜¯æ€ä¹ˆæ ·çš„ã€‚</p>
<blockquote>
<p>ç±»å‹æè¿°ç¬¦</p>
</blockquote>
<p>Java ä¸­çš„ç±»å‹åˆ†ä¸ºåŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ï¼ŒåŸºæœ¬ç±»å‹çš„æè¿°ç¬¦æ˜¯å•ä¸ªå­—æ¯ï¼Œå…·ä½“å†…å®¹å¯ä»¥æŸ¥çœ‹ <code>sun.invoke.util.Wrapper</code> ä¸­çš„å†…å®¹ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/sun.invoke.util.Wrapper%E6%9E%9A%E4%B8%BE%E9%A1%B9.png" alt="sun.invoke.util.Wrapperæšä¸¾é¡¹"></p>
<p>æ ¹æ®ä¸Šå›¾æ‰€ç¤ºï¼Œ<code>boolean</code> çš„ç±»å‹æè¿°ç¬¦æ˜¯ <code>Z</code>ï¼Œ<code>byte</code> çš„ç±»å‹æè¿°ç¬¦æ˜¯ <code>B</code>ï¼Œé’ˆå¯¹åŸºæœ¬ç±»å‹ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹å¯¹ç…§è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">åŸºæœ¬ç±»å‹</th>
<th style="text-align:center">ç±»å‹æè¿°ç¬¦</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">boolean</td>
<td style="text-align:center">Z</td>
</tr>
<tr>
<td style="text-align:center">byte</td>
<td style="text-align:center">B</td>
</tr>
<tr>
<td style="text-align:center">short</td>
<td style="text-align:center">S</td>
</tr>
<tr>
<td style="text-align:center">char</td>
<td style="text-align:center">C</td>
</tr>
<tr>
<td style="text-align:center">int</td>
<td style="text-align:center">I</td>
</tr>
<tr>
<td style="text-align:center">long</td>
<td style="text-align:center">J</td>
</tr>
<tr>
<td style="text-align:center">float</td>
<td style="text-align:center">F</td>
</tr>
<tr>
<td style="text-align:center">double</td>
<td style="text-align:center">D</td>
</tr>
<tr>
<td style="text-align:center">void</td>
<td style="text-align:center">V</td>
</tr>
</tbody>
</table>
<p><mark>æ³¨æ„ï¼š</mark> <code>java.lang.Object</code> çš„ç±»å‹æè¿°ç¬¦å¹¶ä¸æ˜¯ <code>L</code>ï¼Œè€Œæ˜¯ <code>Ljava/lang/Object;</code>ã€‚</p>
<p>åŸºæœ¬ç±»å‹æœ‰äº†ï¼Œå†æ¥çœ‹çœ‹å¼•ç”¨ç±»å‹ã€‚å¼•ç”¨ç±»å‹çš„ç±»å‹æè¿°ç¬¦æ ¼å¼æ˜¯ä»¥ <code>L</code> å¼€å¤´ï¼Œç´§è·Ÿä¸Šä»¥ <code>/</code> åˆ†å‰²çš„ç±»å…¨é™å®šåï¼Œæœ€åä»¥ <code>;</code> ç»“å°¾ï¼Œå°±åƒå‰é¢è¯´çš„ <code>java.lang.Object</code> çš„ç±»å‹æè¿°ç¬¦ä¸€æ ·ã€‚ä¸€ä¸ªæ•°ç»„ç±»å‹çš„æè¿°ç¬¦æ˜¯ä¸€ä¸ª <code>[</code> åè·Ÿä¸Šè¯¥æ•°ç»„å…ƒç´ ç±»å‹çš„æè¿°ç¬¦ï¼Œå¹¶ä¸”æ˜¯å‡ ç»´æ•°ç»„ï¼Œå°±æœ‰å‡ ä¸ª <code>[</code> åœ¨å¼€å¤´ã€‚é’ˆå¯¹å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹å¯¹ç…§å‚è€ƒè¡¨ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">åŸºæœ¬ç±»å‹</th>
<th style="text-align:center">ç±»å‹æè¿°ç¬¦</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Object</td>
<td style="text-align:center">Ljava/lang/Object;</td>
</tr>
<tr>
<td style="text-align:center">int[]</td>
<td style="text-align:center">[I</td>
</tr>
<tr>
<td style="text-align:center">Object[][]</td>
<td style="text-align:center">[[Ljava/lang/Object;</td>
</tr>
<tr>
<td style="text-align:center">String</td>
<td style="text-align:center">Ljava/lang/String;</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ–¹æ³•æè¿°ç¬¦</p>
</blockquote>
<p>æ–¹æ³•æè¿°ç¬¦çš„æ ¼å¼ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(å‚æ•°ç±»å‹æè¿°ç¬¦ä»¬)è¿”å›å€¼ç±»å‹æè¿°ç¬¦</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼ŒæŒ‰ç…§å‚æ•°åˆ—è¡¨ä¾æ¬¡å†™å‡ºå®ƒä»¬çš„ç±»å‹æè¿°ç¬¦å³å¯ï¼Œä¹‹é—´ä¹Ÿä¸éœ€è¦ä»»ä½•åˆ†éš”ç¬¦ã€‚æ¯”å¦‚ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ–¹æ³•çš„å£°æ˜</th>
<th style="text-align:center">æ–¹æ³•æè¿°ç¬¦</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">void m(int i, float f)</td>
<td style="text-align:center">(IF)V</td>
</tr>
<tr>
<td style="text-align:center">int m(Object o)</td>
<td style="text-align:center">(Ljava/lang/Object;)I</td>
</tr>
<tr>
<td style="text-align:center">int[] m(int i,String s)</td>
<td style="text-align:center">(ILjava/lang/String;)[I</td>
</tr>
<tr>
<td style="text-align:center">Object m(int[] i)</td>
<td style="text-align:center">([I)Ljava/lang/Object;</td>
</tr>
</tbody>
</table>
<blockquote>
<p>è·å–æè¿°ç¬¦ä¿¡æ¯</p>
</blockquote>
<p>è¦è·å–æè¿°ç¬¦ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>ASM</code> ä¸­çš„æ–¹æ³•ï¼Œé¦–å…ˆå¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;asm&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">9.3</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>ç®€å•æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetModifierInfo</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;java/lang/String&quot;</span>, Type.getInternalName(String.class));</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;java/util/Map&quot;</span>, Type.getInternalName(Map.class));</span><br><span class="line"></span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;Ljava/lang/String;&quot;</span>, Type.getDescriptor(String.class));</span><br><span class="line"></span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;I&quot;</span>, Type.INT_TYPE.getDescriptor());</span><br><span class="line"></span><br><span class="line">    <span class="type">Method</span> <span class="variable">setNameMethod</span> <span class="operator">=</span> Person.class.getDeclaredMethod(<span class="string">&quot;setName&quot;</span>, String.class);</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;(Ljava/lang/String;)V&quot;</span>, Type.getMethodDescriptor(setNameMethod));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-5-Declared-ä¿®é¥°çš„æ–¹æ³•"><a class="header-anchor" href="#4-5-Declared-ä¿®é¥°çš„æ–¹æ³•"></a>4.5 Declared ä¿®é¥°çš„æ–¹æ³•</h2>
<p>åœ¨ <code>LambdaUtil.getSerializedLambda()</code> æ–¹æ³•ä¸­ä½¿ç”¨äº† <code>getDeclaredMethod()</code> æ–¹æ³•ï¼Œè€Œä¸æ˜¯ <code>getMethod()</code> æ–¹æ³•ï¼Œå¹¶ä¸”æŸ¥çœ‹ <code>Class</code> ç±»ä¸­çš„æ–¹æ³•ï¼Œå‘ç°æœ‰å¾ˆå¤šç±»ä¼¼è¿™æ ·çš„ä¸€ç»„æ–¹æ³•ï¼Œä¸€ä¸ªè¢« Declared ä¿®é¥°ï¼Œè€Œå¦ä¸€ä¸ªåˆæ²¡è¢«ä¿®é¥°ã€‚é‚£ä¹ˆå®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<p>é€šè¿‡ä¸€ä¸ªæµ‹è¯•ç±»æ¥è®²è§£ä»–ä»¬ä¹‹é—´çš„å…³ç³»ã€‚å…ˆå®šä¹‰ä¸€ä¸ªçˆ¶ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/4 18:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String privateParentField;</span><br><span class="line">    <span class="keyword">public</span> String publicParentField;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå®šä¹‰ä¸€ä¸ªæ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/4 18:17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SimpleInterface</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¥å£ä¸­çš„å˜é‡éƒ½æ˜¯å¸¸é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">CONSTANT</span> <span class="operator">=</span> <span class="string">&quot;constant&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†å®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œè¿™ä¸ªå­ç±»ç»§æ‰¿çˆ¶ç±»å¹¶å®ç°æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/7/4 18:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_">Parent</span> <span class="keyword">implements</span> <span class="title class_">SimpleInterface</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String privateChildField;</span><br><span class="line">    <span class="keyword">public</span> String publicChildField;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ååˆ©ç”¨å­ç±»å’Œçˆ¶ç±»çš„ Class è¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeclared</span><span class="params">()</span> &#123;</span><br><span class="line">    Class&lt;Parent&gt; parentClass = Parent.class;</span><br><span class="line">    Class&lt;Child&gt; childClass = Child.class;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰ç±»åŠå…¶çˆ¶ç±»ä¸­æ‰€æœ‰ public çš„å­—æ®µ</span></span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>, parentClass.getFields().length);</span><br><span class="line">    Assert.assertTrue(Arrays.stream(parentClass.getFields()).allMatch(i -&gt; <span class="string">&quot;publicParentField&quot;</span>.equals(i.getName())));</span><br><span class="line">    <span class="comment">// å½“å‰ç±»ä¸­æ‰€æœ‰çš„å­—æ®µ</span></span><br><span class="line">    List&lt;String&gt; parentFieldNameList = Arrays.asList(<span class="string">&quot;privateParentField&quot;</span>, <span class="string">&quot;publicParentField&quot;</span>);</span><br><span class="line">    Assert.assertEquals(parentFieldNameList.size(), parentClass.getDeclaredFields().length);</span><br><span class="line">    Assert.assertTrue(Arrays.stream(parentClass.getDeclaredFields()).map(Field::getName).allMatch(parentFieldNameList::contains));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰ç±»åŠå…¶çˆ¶ç±»ä¸­æ‰€æœ‰ public çš„å­—æ®µ</span></span><br><span class="line">    List&lt;String&gt; childPublicFieldNameList = Arrays.asList(<span class="string">&quot;publicChildField&quot;</span>, <span class="string">&quot;publicParentField&quot;</span>, <span class="string">&quot;CONSTANT&quot;</span>);</span><br><span class="line">    Assert.assertEquals(childPublicFieldNameList.size(), childClass.getFields().length);</span><br><span class="line">    Assert.assertTrue(Arrays.stream(childClass.getFields()).map(Field::getName).allMatch(childPublicFieldNameList::contains));</span><br><span class="line">    <span class="comment">// å½“å‰ç±»ä¸­æ‰€æœ‰çš„å­—æ®µï¼ˆå®ç°çš„æ¥å£ä¸­çš„å¸¸é‡ä¸åœ¨å…¶ä¸­ï¼‰</span></span><br><span class="line">    List&lt;String&gt; childFiledNameList = Arrays.asList(<span class="string">&quot;privateChildField&quot;</span>, <span class="string">&quot;publicChildField&quot;</span>);</span><br><span class="line">    Assert.assertEquals(childFiledNameList.size(), childClass.getDeclaredFields().length);</span><br><span class="line">    Assert.assertTrue(Arrays.stream(childClass.getDeclaredFields()).map(Field::getName).allMatch(childFiledNameList::contains));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰ç±»åŠå…¶çˆ¶ç±»ä¸­æ‰€æœ‰ public çš„æ–¹æ³•ï¼ˆå› æ­¤åŒ…å« Object ç±»ä¸­ public çš„æ–¹æ³•ï¼‰</span></span><br><span class="line">    List&lt;String&gt; parentPublicMethodNameList = Arrays.asList(<span class="string">&quot;setPrivateParentField&quot;</span>, <span class="string">&quot;getPublicParentField&quot;</span>,</span><br><span class="line">            <span class="string">&quot;getPrivateParentField&quot;</span>, <span class="string">&quot;setPublicParentField&quot;</span>);</span><br><span class="line">    Assert.assertTrue(parentClass.getMethods().length &gt; <span class="number">4</span>);</span><br><span class="line">    Assert.assertEquals(Object.class.getMethods().length + <span class="number">4</span>, parentClass.getMethods().length);</span><br><span class="line">    Assert.assertTrue(Arrays.stream(parentClass.getMethods()).map(Method::getName).collect(Collectors.toList()).containsAll(parentPublicMethodNameList));</span><br><span class="line">    <span class="comment">// å½“å‰ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•</span></span><br><span class="line">    Assert.assertEquals(parentPublicMethodNameList.size(), parentClass.getDeclaredMethods().length);</span><br><span class="line">    Assert.assertTrue(Arrays.stream(parentClass.getDeclaredMethods()).map(Method::getName).allMatch(parentPublicMethodNameList::contains));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰ç±»åŠå…¶çˆ¶ç±»ä¸­æ‰€æœ‰ public çš„æ–¹æ³•</span></span><br><span class="line">    List&lt;String&gt; childPublicMethodNameList = Arrays.asList(<span class="string">&quot;add&quot;</span>, <span class="string">&quot;setPublicChildField&quot;</span>, <span class="string">&quot;getPublicChildField&quot;</span>,</span><br><span class="line">            <span class="string">&quot;setPrivateChildField&quot;</span>, <span class="string">&quot;getPrivateChildField&quot;</span>);</span><br><span class="line">    Assert.assertTrue(childClass.getMethods().length &gt; childPublicMethodNameList.size());</span><br><span class="line">    Assert.assertEquals(parentClass.getMethods().length + childPublicMethodNameList.size(), childClass.getMethods().length);</span><br><span class="line">    Assert.assertTrue(Arrays.stream(childClass.getMethods()).map(Method::getName).collect(Collectors.toList()).containsAll(childPublicMethodNameList));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•</span></span><br><span class="line">    Assert.assertEquals(childPublicMethodNameList.size(), childClass.getDeclaredMethods().length);</span><br><span class="line">    Assert.assertTrue(Arrays.stream(childClass.getDeclaredMethods()).map(Method::getName).allMatch(childPublicMethodNameList::contains));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°æµ‹è¯•æ–¹æ³•èƒ½å¤Ÿé€šè¿‡ï¼Œå¯¹æ­¤ä¸éš¾å¾—å‡ºï¼š</p>
<p>1ã€<code>getFields()</code> æ–¹æ³•å¯ä»¥è·å–å½“å‰ç±»åŠå…¶çˆ¶ç±»ä¸­æ‰€æœ‰ <code>public</code> çš„æˆå‘˜å˜é‡ï¼›<code>getDeclaredFields()</code> æ–¹æ³•å¯ä»¥è·å–å½“å‰ç±»ä¸­æ‰€æœ‰çš„æˆå‘˜å˜é‡ã€‚</p>
<p>2ã€<code>getMethods()</code> æ–¹æ³•å¯ä»¥è·å–å½“å‰ç±»åŠå…¶çˆ¶ç±»ä¸­æ‰€æœ‰ <code>public</code> çš„æ–¹æ³•ï¼›<code>getDeclaredMethods()</code> æ–¹æ³•å¯ä»¥è·å–å½“å‰ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•ã€‚</p>
<h1 id="5-ç»“è¯­"><a class="header-anchor" href="#5-ç»“è¯­"></a>5. ç»“è¯­</h1>
<p>ä»¥ä¸Šå°±æ˜¯ã€ŠLambda ä¸åºåˆ—åŒ–ã€‹ä¸€æ–‡ä¸­çš„å…¨éƒ¨å†…å®¹ï¼Œæœ¬æ–‡ä¸ä»…ä»…è®²è¿°äº†å¦‚ä½•é€šè¿‡ Java8 çš„æ–¹æ³•å¼•ç”¨æ¥è·å–å­—æ®µåç§°ï¼Œè¿˜å›´ç»•ç€å…·ä½“å®ç°è¿›è¡Œå±•å¼€ï¼Œä»‹ç»äº† Java çš„åºåˆ—åŒ–ã€Lambda è¡¨è¾¾å¼çš„åºåˆ—åŒ–ä»¥åŠå…·ä½“å®ç°ä¸­çš„å…¶ä»–ç»†èŠ‚ã€‚</p>
<p>æœ€è¿‘è¿™ä¸€ä¸ªå¤šæœˆå·¥ä½œéƒ½æ¯”è¾ƒå¿™ï¼Œç»å¸¸åŠ ç­ï¼Œå°±è¿å‘¨å…­éƒ½ä¸ä¾‹å¤–ï¼Œå› æ­¤æœ¬æ–‡ä»æ„æ€åˆ°æœ€ç»ˆå®Œæˆç«Ÿç„¶ç”¨äº†è¶³è¶³ä¸€ä¸ªæœˆï¼Œä½†å¹¸è¿çš„æ˜¯è¿‡ç¨‹ä¸­å­¦åˆ°äº†å¾ˆå¤šä¸æ›¾äº†è§£çš„çŸ¥è¯†ç‚¹ï¼Œä¹Ÿç®—æ˜¯æ”¶è·é¢‡å¤šã€‚ä¾æˆ‘çœ‹æ¥ï¼Œè¿™ç¯‡æ–‡ç« æˆ–è®¸èƒ½æˆä¸ºæˆ‘ä»Šå¹´çš„ä»£è¡¨ä½œï¼Œå½“ç„¶ä¹Ÿå¸Œæœ›åœ¨ä»Šå¹´å‰©ä¸‹çš„å‡ ä¸ªæœˆä¸­èƒ½å†™å‡ºæ·±åº¦ã€å¹¿åº¦è·Ÿæœ¬æ–‡ä¸€æ ·ï¼Œç”šè‡³è¶…è¶Šæœ¬æ–‡çš„ç¯‡ç« ã€‚</p>
<p>æœ€åå‘æœ¬æ–‡æ‰€æœ‰å‚è€ƒæ–‡ç« çš„ä½œè€…è‡´ä»¥è¯šæŒšçš„è°¢æ„ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://mofan212.github.io">é»˜çƒ¦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://mofan212.github.io/posts/Lambda-And-Serialization/">https://mofan212.github.io/posts/Lambda-And-Serialization/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://mofan212.github.io" target="_blank">Mofan</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java-Lambda/">Java-Lambda</a><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="post-share"><div class="social-share" data-image="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/104.png" data-sites="wechat,qq,weibo,facebook,x"></div><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" target="_blank"><img class="post-qr-code-img" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" target="_blank"><img class="post-qr-code-img" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/Class-Resource-Loading-In-Java/" title="Java çš„ç±»èµ„æºåŠ è½½"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/103.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">Java çš„ç±»èµ„æºåŠ è½½</div></div><div class="info-2"><div class="info-item-1">æœ¬æ–‡ä»¥ Mockito ä¸­é™æ€æ–¹æ³•çš„ mock ä¸ºå¼•ï¼Œä»‹ç»äº† SPI æœºåˆ¶çš„åº”ç”¨ä¸æºç å‰–æã€‚</div></div></div></a><a class="pagination-related" href="/posts/DQL-Of-MySQL/" title="ã€MySQL ä¸€ã€‘DQL"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/105.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">ã€MySQL ä¸€ã€‘DQL</div></div><div class="info-2"><div class="info-item-1">æœ¬æ–‡ä»‹ç»äº† MySQL ä¸­æŸ¥è¯¢è¯­å¥çš„ç”¨æ³•ä¸ç¤ºä¾‹ï¼ŒåŒ…æ‹¬å¤šè¡¨æŸ¥è¯¢ã€å•è¡Œå‡½æ•°ã€èšåˆå‡½æ•°ã€å­æŸ¥è¯¢ç­‰å†…å®¹ã€‚</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/Combinator-Pattern/" title="Combinator Pattern"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/149.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-28</div><div class="info-item-2">Combinator Pattern</div></div><div class="info-2"><div class="info-item-1">æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åœ¨ Java ä¸­ä½¿ç”¨ Combinator Patternã€‚</div></div></div></a><a class="pagination-related" href="/posts/Method-Handle/" title="æ–¹æ³•å¥æŸ„"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/142.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-29</div><div class="info-item-2">æ–¹æ³•å¥æŸ„</div></div><div class="info-2"><div class="info-item-1">Java ä¸­ MethodHandle çš„ä½¿ç”¨ã€‚</div></div></div></a><a class="pagination-related" href="/posts/Java-Lambda-Expression-And-Functional-Programming/" title="Lambda è¡¨è¾¾å¼ä¸å‡½æ•°å¼ç¼–ç¨‹"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/152.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-20</div><div class="info-item-2">Lambda è¡¨è¾¾å¼ä¸å‡½æ•°å¼ç¼–ç¨‹</div></div><div class="info-2"><div class="info-item-1">æœ¬æ–‡ä»‹ç»äº† Java ä¸­çš„é—­åŒ…ä¸æŸ¯é‡ŒåŒ–ï¼Œæµ…è°ˆ Lambda è¡¨è¾¾å¼çš„æ‰§è¡ŒåŸç†ã€‚</div></div></div></a><a class="pagination-related" href="/posts/Basic-Use-Of-Reflections/" title="Reflections çš„åŸºæœ¬ä½¿ç”¨"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/85.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-25</div><div class="info-item-2">Reflections çš„åŸºæœ¬ä½¿ç”¨</div></div><div class="info-2"><div class="info-item-1">Reflectionsï¼ŒJava è¿è¡Œæ—¶å…ƒæ•°æ®åˆ†æï¼Œè®© Java çš„åå°„æ›´åŠ ç®€å•ã€‚</div></div></div></a><a class="pagination-related" href="/posts/Design-Pattern-Strategy-Pattern/" title="ã€è®¾è®¡æ¨¡å¼ã€‘ç­–ç•¥æ¨¡å¼"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/83.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-27</div><div class="info-item-2">ã€è®¾è®¡æ¨¡å¼ã€‘ç­–ç•¥æ¨¡å¼</div></div><div class="info-2"><div class="info-item-1">æœ¬æ–‡ä¸»è¦å¯¹ Java è®¾è®¡æ¨¡å¼ä¸­çš„ç­–ç•¥æ¨¡å¼è¿›è¡Œäº†ä»‹ç»ã€‚</div></div></div></a><a class="pagination-related" href="/posts/The-Basis-Of-Java-Multithreading/" title="å­¦æ¯›çº¿ï¼ˆThreadï¼‰çš„ Java"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/57.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-09</div><div class="info-item-2">å­¦æ¯›çº¿ï¼ˆThreadï¼‰çš„ Java</div></div><div class="info-2"><div class="info-item-1">çº¿ç¨‹æ€ä¹ˆåˆ›å»ºã€æœ‰å“ªäº›çŠ¶æ€ã€æ€ä¹ˆåŒæ­¥ã€æ€ä¹ˆåä½œï¼Ÿ</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">é»˜çƒ¦</div><div class="author-info-description">å½©ç¬”çš„æ‰“æ€ªå‡çº§ä¹‹è·¯...</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">174</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">54</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">37</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mofan212"><i class="fab fa-github"></i><span>follow me</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:cy.mofan@foxmail.com" target="_blank" title="é‚®ç®±"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æœ¬ç«™æ‰€æœ‰åšæ–‡å‡æ˜¯åšä¸»çš„å­¦ä¹ ç¬”è®°ä¸ä¸ªäººç†è§£ã€‚<strong><font style="color:red">é™¤ç‰¹åˆ«æ³¨æ˜å¤–ï¼Œ</font>å¦‚éœ€è½¬è½½ï¼Œè¯·åœ¨æ–‡ç« å¤´éƒ¨é†’ç›®å¤„é™„å¸¦åŸæ–‡é“¾æ¥å¹¶<a href="./mine/" style="color:#49B1F5;text-decoration:underline">å‘ŠçŸ¥æˆ‘</a></strong>ä½ å°†è½¬è½½ã€‚ğŸ˜Š</br><strong><font style="color:red">ä¸¥ç¦æœªéµå¾ªè§„èŒƒçš„è½¬è½½ã€‚</font></strong>ğŸ˜¡</br><strong>æ­»å»çš„è¯„è®ºç³»ç»Ÿå¤æ´»å•¦ï¼æ¬¢è¿åˆ°ç•™è¨€æ¿ç•…æ‰€æ¬²è¨€ï¼</strong>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´é«˜æ•ˆçš„<a target="_blank" href="https://space.bilibili.com/23658864/dynamic" style="color:#49B1F5;text-decoration:underline"> å“”å“©å“”å“©ç§ä¿¡ </a>æˆ–<a href="mailto:cy.mofan@foxmail.com" style="color:#49B1F5;text-decoration:underline" target="_blank">é‚®ç®±</a>ã€‚ ğŸ˜‰</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0-%E5%89%8D%E8%A8%80"><span class="toc-text">0. å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E9%80%9A%E8%BF%87%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8%E8%8E%B7%E5%8F%96%E5%AD%97%E6%AE%B5%E5%90%8D%E7%A7%B0"><span class="toc-text">1. é€šè¿‡æ–¹æ³•å¼•ç”¨è·å–å­—æ®µåç§°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-text">1.1 å…·ä½“å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E9%97%AE%E9%A2%98%E7%9A%84%E6%8A%9B%E5%87%BA"><span class="toc-text">1.2 é—®é¢˜çš„æŠ›å‡º</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Java-%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">2. Java çš„åºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">2.1 ä»€ä¹ˆæ˜¯åºåˆ—åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Java-%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%BB%86%E8%8A%82"><span class="toc-text">2.2 Java åºåˆ—åŒ–çš„ç»†èŠ‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="toc-text">2.3 åºåˆ—åŒ–çš„ç®€å•ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E5%BC%95%E7%94%A8%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">2.4 å¼•ç”¨å¯¹è±¡çš„åºåˆ—åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%BA%A6%E6%9D%9F"><span class="toc-text">2.5 åºåˆ—åŒ–çš„çº¦æŸ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-readObjectNoData-%E6%96%B9%E6%B3%95"><span class="toc-text">2.6 readObjectNoData æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-%E9%9A%90%E8%97%8F%E6%96%B9%E6%B3%95-writeReplace"><span class="toc-text">2.7 éšè—æ–¹æ³• - writeReplace</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-8-%E9%9A%90%E8%97%8F%E6%96%B9%E6%B3%95-readResolve"><span class="toc-text">2.8 éšè—æ–¹æ³• - readResolve</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-9-Externalizable-%E6%8E%A5%E5%8F%A3"><span class="toc-text">2.9 Externalizable æ¥å£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-10-%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%89%88%E6%9C%AC"><span class="toc-text">2.10 åºåˆ—åŒ–çš„ç‰ˆæœ¬</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-11-serialPersistentFields"><span class="toc-text">2.11 serialPersistentFields</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">3. Lambda è¡¨è¾¾å¼çš„åºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-LambdaMetafactory"><span class="toc-text">3.1 LambdaMetafactory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-SerializedLambda"><span class="toc-text">3.2 SerializedLambda</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E9%9A%90%E8%97%8F%E7%9A%84-deserializeLambda-%E6%96%B9%E6%B3%95"><span class="toc-text">3.3 éšè—çš„ $deserializeLambda$ æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E8%A1%A5%E5%85%85"><span class="toc-text">4. å…¶ä»–ç»†èŠ‚è¡¥å……</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-text">4.1 å‡½æ•°å¼æ¥å£çš„å®ç°ç±»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-synthetic-class"><span class="toc-text">4.2 synthetic class</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-Introspector"><span class="toc-text">4.3 Introspector</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-Java-%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-text">4.4 Java æè¿°ç¬¦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-Declared-%E4%BF%AE%E9%A5%B0%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text">4.5 Declared ä¿®é¥°çš„æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E7%BB%93%E8%AF%AD"><span class="toc-text">5. ç»“è¯­</span></a></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>Java Lambda Expression</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Lambda-And-Serialization/" title="Lambda ä¸åºåˆ—åŒ–"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/104.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Lambda ä¸åºåˆ—åŒ–"></a><div class="content"><a class="title" href="/posts/Lambda-And-Serialization/" title="Lambda ä¸åºåˆ—åŒ–">Lambda ä¸åºåˆ—åŒ–</a><time datetime="2022-07-03T16:00:00.000Z" title="å‘è¡¨äº 2022-07-04 00:00:00">2022-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Reduce-Functions/" title="Reduce Functions"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/137.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Reduce Functions"></a><div class="content"><a class="title" href="/posts/Reduce-Functions/" title="Reduce Functions">Reduce Functions</a><time datetime="2023-08-26T16:00:00.000Z" title="å‘è¡¨äº 2023-08-27 00:00:00">2023-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Method-Handle/" title="æ–¹æ³•å¥æŸ„"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/142.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="æ–¹æ³•å¥æŸ„"></a><div class="content"><a class="title" href="/posts/Method-Handle/" title="æ–¹æ³•å¥æŸ„">æ–¹æ³•å¥æŸ„</a><time datetime="2023-10-28T16:00:00.000Z" title="å‘è¡¨äº 2023-10-29 00:00:00">2023-10-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Using-Lambda-Expressions-To-Refactor-Backtracking/" title="ä½¿ç”¨ Lambda è¡¨è¾¾å¼é‡æ„æˆå›æº¯"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/143.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="ä½¿ç”¨ Lambda è¡¨è¾¾å¼é‡æ„æˆå›æº¯"></a><div class="content"><a class="title" href="/posts/Using-Lambda-Expressions-To-Refactor-Backtracking/" title="ä½¿ç”¨ Lambda è¡¨è¾¾å¼é‡æ„æˆå›æº¯">ä½¿ç”¨ Lambda è¡¨è¾¾å¼é‡æ„æˆå›æº¯</a><time datetime="2023-11-11T16:00:00.000Z" title="å‘è¡¨äº 2023-11-12 00:00:00">2023-11-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Lambda-Expression-And-Functional-Programming/" title="Lambda è¡¨è¾¾å¼ä¸å‡½æ•°å¼ç¼–ç¨‹"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/152.webp" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Lambda è¡¨è¾¾å¼ä¸å‡½æ•°å¼ç¼–ç¨‹"></a><div class="content"><a class="title" href="/posts/Java-Lambda-Expression-And-Functional-Programming/" title="Lambda è¡¨è¾¾å¼ä¸å‡½æ•°å¼ç¼–ç¨‹">Lambda è¡¨è¾¾å¼ä¸å‡½æ•°å¼ç¼–ç¨‹</a><time datetime="2024-07-19T16:00:00.000Z" title="å‘è¡¨äº 2024-07-20 00:00:00">2024-07-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Lambda-In-Action/" title="Java Lambda In Action"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/159.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java Lambda In Action"></a><div class="content"><a class="title" href="/posts/Java-Lambda-In-Action/" title="Java Lambda In Action">Java Lambda In Action</a><time datetime="2025-03-18T16:00:00.000Z" title="å‘è¡¨äº 2025-03-19 00:00:00">2025-03-19</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Something-About-Blog/" title="åšå®¢æ­å»ºä¸ç»´æŠ¤"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/42.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="åšå®¢æ­å»ºä¸ç»´æŠ¤"/></a><div class="content"><a class="title" href="/posts/Something-About-Blog/" title="åšå®¢æ­å»ºä¸ç»´æŠ¤">åšå®¢æ­å»ºä¸ç»´æŠ¤</a><time datetime="2026-01-24T16:00:00.000Z" title="æ›´æ–°äº 2026-01-25 00:00:00">2026-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Memory-Model/" title="Java å†…å­˜æ¨¡å‹"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/174.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java å†…å­˜æ¨¡å‹"/></a><div class="content"><a class="title" href="/posts/Java-Memory-Model/" title="Java å†…å­˜æ¨¡å‹">Java å†…å­˜æ¨¡å‹</a><time datetime="2026-01-02T16:00:00.000Z" title="æ›´æ–°äº 2026-01-03 00:00:00">2026-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Bytecode-And-Class-Loading/" title="å­—èŠ‚ç ä¸ç±»åŠ è½½"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/173.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="å­—èŠ‚ç ä¸ç±»åŠ è½½"/></a><div class="content"><a class="title" href="/posts/Java-Bytecode-And-Class-Loading/" title="å­—èŠ‚ç ä¸ç±»åŠ è½½">å­—èŠ‚ç ä¸ç±»åŠ è½½</a><time datetime="2026-01-01T16:00:00.000Z" title="æ›´æ–°äº 2026-01-02 00:00:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Class-Resource-Loading-In-Java/" title="Java çš„ç±»èµ„æºåŠ è½½"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/103.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java çš„ç±»èµ„æºåŠ è½½"/></a><div class="content"><a class="title" href="/posts/Class-Resource-Loading-In-Java/" title="Java çš„ç±»èµ„æºåŠ è½½">Java çš„ç±»èµ„æºåŠ è½½</a><time datetime="2026-01-01T16:00:00.000Z" title="æ›´æ–°äº 2026-01-02 00:00:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Annotation-And-Reflection/" title="æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/20.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„"/></a><div class="content"><a class="title" href="/posts/Annotation-And-Reflection/" title="æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„">æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„</a><time datetime="2026-01-01T16:00:00.000Z" title="æ›´æ–°äº 2026-01-02 00:00:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ren-zhi-jue-xing/" title="è®¤çŸ¥è§‰é†’"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/172.webp" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="è®¤çŸ¥è§‰é†’"/></a><div class="content"><a class="title" href="/posts/ren-zhi-jue-xing/" title="è®¤çŸ¥è§‰é†’">è®¤çŸ¥è§‰é†’</a><time datetime="2025-12-28T16:00:00.000Z" title="æ›´æ–°äº 2025-12-29 00:00:00">2025-12-29</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2020 - 2026 By é»˜çƒ¦</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><script src="https://testingcf.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://testingcf.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://testingcf.jsdelivr.net/npm/vanilla-lazyload@latest/dist/lazyload.iife.min.js"></script><script src="https://testingcf.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://gcore.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources@master/js/mine.min.js"></script><script src="/js/tip_portal.js"></script><script defer="defer" id="ribbon" src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="click-show-text" src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Azathoth,Yog-Sothoth,Shub-Niggurath,Nyarlathotep,Cthulhu,Hastur,Abhoth,Ghroth,Tsathoggua,Cthugha,Deep Ones,Dagon,Chaugnar Faugn,Mordiggian,Shoggoth,Old One,Mi-Go,Great Race of Yith,Flying Polyp,Hounds of Tindalos,Dhole" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@docsearch/css/dist/style.min.css"/><script src="https://testingcf.jsdelivr.net/npm/@docsearch/js/dist/umd/index.min.js"></script><script>(() => {
  docsearch(Object.assign({
    appId: 'BAFEL7A6K1',
    apiKey: '89fcb5961984c5c054bf04149f345f38',
    indexName: 'mofan212io',
    container: '#docsearch',
    placeholder: 'è¾“å…¥å…³é”®å­—è¿›è¡Œæœç´¢',
  }, null))

  const handleClick = () => {
    document.querySelector('.DocSearch-Button').click()
  }

  const searchClickFn = () => {
    btf.addEventListenerPjax(document.querySelector('#search-button > .search'), 'click', handleClick)
  }

  searchClickFn()
  window.addEventListener('pjax:complete', searchClickFn)
})()</script></div></div></body></html>