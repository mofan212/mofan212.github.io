<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MapStruct ä½¿ç”¨æ‰‹å†Œï¼ˆæ›´æ–°ä¸­ï¼‰ | Mofan</title><meta name="author" content="é»˜çƒ¦,cy.mofan@foxmail.com"><meta name="copyright" content="é»˜çƒ¦"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MapStruct æ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ï¼Œå®ƒåŸºäºçº¦å®šè€Œéé…ç½®çš„æ–¹æ³•ï¼Œæå¤§åœ°ç®€åŒ–äº† Java Bean ä¹‹é—´çš„è½¬æ¢ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="MapStruct ä½¿ç”¨æ‰‹å†Œï¼ˆæ›´æ–°ä¸­ï¼‰">
<meta property="og:url" content="https://mofan212.github.io/posts/MapStruct-User-Manual/">
<meta property="og:site_name" content="Mofan">
<meta property="og:description" content="MapStruct æ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ï¼Œå®ƒåŸºäºçº¦å®šè€Œéé…ç½®çš„æ–¹æ³•ï¼Œæå¤§åœ°ç®€åŒ–äº† Java Bean ä¹‹é—´çš„è½¬æ¢ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/82.png">
<meta property="article:published_time" content="2021-02-15T16:00:00.000Z">
<meta property="article:modified_time" content="2023-03-03T16:00:00.000Z">
<meta property="article:author" content="é»˜çƒ¦">
<meta property="article:tag" content="MapStruct">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/82.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MapStruct ä½¿ç”¨æ‰‹å†Œï¼ˆæ›´æ–°ä¸­ï¼‰",
  "url": "https://mofan212.github.io/posts/MapStruct-User-Manual/",
  "image": "https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/82.png",
  "datePublished": "2021-02-15T16:00:00.000Z",
  "dateModified": "2023-03-03T16:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "é»˜çƒ¦",
      "url": "https://mofan212.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/favicon.png"><link rel="canonical" href="https://mofan212.github.io/posts/MapStruct-User-Manual/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":true,"highlightMacStyle":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":150,"languages":{"author":"ä½œè€…: é»˜çƒ¦","link":"é“¾æ¥: ","source":"æ¥æº: Mofan","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡","cht_to_chs":"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡","day_to_night":"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  infinitegrid: {
    js: 'https://testingcf.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MapStruct ä½¿ç”¨æ‰‹å†Œï¼ˆæ›´æ–°ä¸­ï¼‰',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources@master/css/myStyle.min.css"><link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-screen-webfont@1.7.0/style.css" /><link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono-nl.min.css" /><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Mofan" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources/css/minimal.min.css"/><script src="https://testingcf.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">174</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">54</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">37</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> æ–‡ç« </span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> è®¡åˆ’</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> ç»´æŠ¤</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> å…³äºæœ¬ç«™</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> å…³äºæˆ‘</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw fa-solid fa-coins"></i><span> èµåŠ©</span></a></li><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> é‡Œç¨‹ç¢‘</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-subway"></i><span> å¼€å¾€</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/post_top_img.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Mofan</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-book-reader"></i><span> æ–‡ç« </span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/schedule/"><i class="fa-fw fas fa-list-alt"></i><span> è®¡åˆ’</span></a></div><div class="menus_item"><a class="site-page" href="/update/"><i class="fa-fw fas fa-tools"></i><span> ç»´æŠ¤</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fa fa-heart"></i><span> å…³äº</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> å…³äºæœ¬ç«™</span></a></li><li><a class="site-page child" href="/mine/"><i class="fa-fw fa fa-id-card"></i><span> å…³äºæˆ‘</span></a></li><li><a class="site-page child" href="/reward/"><i class="fa-fw fa-solid fa-coins"></i><span> èµåŠ©</span></a></li><li><a class="site-page child" href="/milestones/"><i class="fa-fw fa-solid fa-monument"></i><span> é‡Œç¨‹ç¢‘</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://www.travellings.cn/go.html"><i class="fa-fw fas fa-subway"></i><span> å¼€å¾€</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">MapStruct ä½¿ç”¨æ‰‹å†Œï¼ˆæ›´æ–°ä¸­ï¼‰</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-02-15T16:00:00.000Z" title="å‘è¡¨äº 2021-02-16 00:00:00">2021-02-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-03-03T16:00:00.000Z" title="æ›´æ–°äº 2023-03-04 00:00:00">2023-03-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">21.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>87åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;è·ç¦»æœ¬æ–‡ä¸Šæ¬¡æ›´æ–°å·²ç»è¿‡å»&quot;,&quot;messageNext&quot;:&quot;å¤©ï¼Œè¯·æ³¨æ„æ—¶æ•ˆæ€§ã€‚&quot;,&quot;postUpdate&quot;:&quot;2023-03-04 00:00:00&quot;}" hidden></div><p>å°é¢æ¥æºï¼šæœ¬æ–‡å°é¢æ¥æºäº MapStruct å®˜ç½‘ï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ã€‚</p>
<p>æºç ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://github.com/mofan212/mapstruct-demo">mofan212/mapstruct-demo</a></p>
<h1 id="0-é˜…è¯»å‰è¨€"><a class="header-anchor" href="#0-é˜…è¯»å‰è¨€"></a>0. é˜…è¯»å‰è¨€</h1>
<p>æœ¬æ–‡å†…å®¹åŸºäº MapStruct å®˜æ–¹æ–‡æ¡£è¿›è¡Œç¿»è¯‘å¹¶æ‹“å±•ï¼ŒåŠ›æ±‚ä¿è¯æ–‡ç« å‡†ç¡®æ€§ï¼Œä½†åšä¸»è‹±è¯­æ°´å¹³å ªå¿§ï¼Œåœ¨æŸäº›å¤„ç†ä¸Šä»æœ‰å¾ˆå¤šä¸è¶³ï¼Œè¿˜æœ›å„ä½çœ‹å®˜ä¸åèµæ•™ã€‚</p>
<p><mark>ç¿»è¯‘å·¥ä½œæå…¶è€—æ—¶ï¼Œæœ¬æ–‡ç¦æ­¢è½¬è½½ï¼</mark> ğŸ™</p>
<blockquote>
<p>å®˜ç½‘ä¸æ¨è</p>
</blockquote>
<p>MapStruct å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://mapstruct.org/">MapStruct</a></p>
<p>MapStruct å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://mapstruct.org/documentation/reference-guide/">Reference Guide</a></p>
<p>ä¸é”™çš„ MapStruct åšå®¢ç³»åˆ—ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/DDgougou/articles/12848625.html">å±æ€§æ˜ å°„å·¥å…·â€”â€”MapStructï¼ˆä¸€ï¼‰</a></p>
<h1 id="1-MapStruct-æ¦‚è¿°"><a class="header-anchor" href="#1-MapStruct-æ¦‚è¿°"></a>1. MapStruct æ¦‚è¿°</h1>
<h2 id="1-1-ä»€ä¹ˆæ˜¯-MapStruct"><a class="header-anchor" href="#1-1-ä»€ä¹ˆæ˜¯-MapStruct"></a>1.1 ä»€ä¹ˆæ˜¯ MapStruct</h2>
<p>MapStruct æ˜¯ä¸€ä¸ªJavaæ³¨é‡Šå¤„ç†å™¨ï¼Œç”¨äºç”Ÿæˆç±»å‹å®‰å…¨çš„ã€é«˜æ€§èƒ½çš„ã€æ— ä¾èµ–çš„ Bean æ˜ å°„ç±»ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ç»å¸¸ä¼šå°†å„ç§å¯¹è±¡ç›¸äº’è½¬æ¢ï¼Œæ¯”å¦‚ DTO è½¬ BOï¼ŒDTO è½¬ VO ç­‰ç­‰ï¼Œæœ€ç®€å•çš„åšæ³•å°±æ˜¯ <code>new</code> å¯¹è±¡ï¼Œç„¶åå¯¹å±æ€§å€¼è¿›è¡Œä¸€ä¸ªä¸ªåœ° GET/SETï¼Œä½†è¿™æ ·æ—¢ç¹çåˆæ— èŠã€‚</p>
<p>å¦‚æœæœ‰ä¸€ä¸ªä¸“é—¨ç”¨æ¥è§£å†³è½¬æ¢é—®é¢˜çš„å·¥å…·å°±å¾ˆæ£’äº†ï¼ŒMapStruct å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªå±æ€§æ˜ å°„å·¥å…·ï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ª Mapper æ¥å£ï¼ŒMapStruct å°±ä¼šè‡ªåŠ¨å®ç°è¿™ä¸ªæ˜ å°„æ¥å£ï¼Œé¿å…äº†å¤æ‚ç¹ççš„æ˜ å°„å®ç°ã€‚</p>
<blockquote>
<p>è¡¥å……ä¸æ‹“å±•</p>
</blockquote>
<p>å…³äº Java ä¸­çš„å„ç§ Oï¼Œå¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸¤ç¯‡æ–‡ç« ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq784515681/article/details/83088089">javaä¸­å„ç§Oçš„å«ä¹‰(POï¼ŒDOï¼ŒVOï¼ŒTOï¼ŒQOï¼ŒBOï¼ŒDAOï¼ŒDTOï¼ŒPOJO)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wzdnwyyu/p/11163058.html">æµ…æDTOã€VOã€DOã€POçš„æ¦‚å¿µ</a></p>
<h2 id="1-2-MapStruct-é…ç½®é€‰é¡¹"><a class="header-anchor" href="#1-2-MapStruct-é…ç½®é€‰é¡¹"></a>1.2 MapStruct é…ç½®é€‰é¡¹</h2>
<p>MapStruct ä»£ç ç”Ÿæˆå™¨å¯ä»¥ä½¿ç”¨æ³¨é‡Šå¤„ç†å™¨é€‰é¡¹è¿›è¡Œé…ç½®ã€‚</p>
<p>åœ¨ç›´æ¥è°ƒç”¨ javac æ—¶ï¼Œè¿™äº›é€‰é¡¹ä»¥ <code>-Akey = value</code> çš„å½¢å¼ä¼ é€’ç»™ç¼–è¯‘å™¨ã€‚ é€šè¿‡ Maven ä½¿ç”¨ MapStruct æ—¶ï¼Œä»»ä½•å¤„ç†å™¨é€‰é¡¹éƒ½å¯ä»¥åœ¨ Maven å¤„ç†å™¨æ’ä»¶çš„é…ç½®ä¸­ä½¿ç”¨ <code>compilerArgs</code> ä¼ é€’ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">annotationProcessorPaths</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">path</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.mapstruct.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">annotationProcessorPaths</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- due to problem in maven-compiler-plugin, for verbose mode add showWarnings --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">showWarnings</span>&gt;</span>true<span class="tag">&lt;/<span class="name">showWarnings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">compilerArgs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span>&gt;</span></span><br><span class="line">                -Amapstruct.suppressGeneratorTimestamp=true</span><br><span class="line">            <span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span>&gt;</span></span><br><span class="line">                -Amapstruct.suppressGeneratorVersionInfoComment=true</span><br><span class="line">            <span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">arg</span>&gt;</span></span><br><span class="line">                -Amapstruct.verbose=true</span><br><span class="line">            <span class="tag">&lt;/<span class="name">arg</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">compilerArgs</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>å…³äºå­˜åœ¨çš„é€‰é¡¹ï¼Œå¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://mapstruct.org/documentation/stable/reference/html/#configuration-options">Configuration options</a>ï¼Œæœ¬æ–‡ä¼šåœ¨ä½¿ç”¨åˆ°çš„åœ°æ–¹å†å…·ä½“è®²è§£ã€‚</p>
<h1 id="2-å®šä¹‰æ˜ å°„å™¨"><a class="header-anchor" href="#2-å®šä¹‰æ˜ å°„å™¨"></a>2. å®šä¹‰æ˜ å°„å™¨</h1>
<h2 id="2-1-Hello-MapStruct"><a class="header-anchor" href="#2-1-Hello-MapStruct"></a>2.1 Hello MapStruct</h2>
<p>åˆ›å»ºä¸€ä¸ª Maven é¡¹ç›®ï¼Œåœ¨ <code>pom.xml</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">org.mapstruct.version</span>&gt;</span>1.4.2.Final<span class="tag">&lt;/<span class="name">org.mapstruct.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.mapstruct.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span> <span class="comment">&lt;!-- depending on your project --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span> <span class="comment">&lt;!-- depending on your project --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">annotationProcessorPaths</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.mapstruct.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--ä½¿ç”¨ Lombok åï¼Œè¿™é‡Œä¹Ÿè¦æ·»åŠ --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- other annotation processors --&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">annotationProcessorPaths</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><mark>æ³¨æ„ï¼š</mark> Maven æ’ä»¶è¦ä½¿ç”¨ 3.6.0 ç‰ˆæœ¬åŠä»¥ä¸Šã€Lombok ä½¿ç”¨ 1.16.16 ç‰ˆæœ¬åŠä»¥ä¸Šã€‚ä¸ç„¶å°±ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š</p>
<pre>
java: No property named "numberOfSeats" exists in source parameter(s). Did you mean "null"?
</pre>
<p>å¦‚æœ Lombok ç‰ˆæœ¬ä¸º 1.18.16 åŠä»¥ä¸Šï¼Œè¯·å†æ·»åŠ ä¸Šï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok-mapstruct-binding<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<p>åˆ›å»ºä¸€ä¸ª <code>Car</code> å®ä½“ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String make;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> numberOfSeats;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†åˆ›å»ºä¸€ä¸ª <code>CarDto</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String make;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> seatCount;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œç”¨äºå¯¹å®ä½“è¿›è¡Œè½¬æ¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(CarMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°† Car è½¬æ¢æˆ CarDto</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> car Car å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>    å¯¹åº”çš„ DTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;numberOfSeats&quot;, target = &quot;seatCount&quot;)</span></span><br><span class="line">    CarDto <span class="title function_">carToCarDto</span><span class="params">(Car car)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ååˆ›å»ºæµ‹è¯•ç±»æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shouldMapCarToDto</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>( <span class="string">&quot;Morris&quot;</span>, <span class="number">5</span>,  <span class="string">&quot;Sedan&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">CarDto</span> <span class="variable">carDto</span> <span class="operator">=</span> CarMapper.INSTANCE.carToCarDto(car);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertNotNull(carDto);</span><br><span class="line">        assertEquals(<span class="string">&quot;Morris&quot;</span>, carDto.getMake());</span><br><span class="line">        assertEquals(<span class="number">5</span>, carDto.getSeatCount());</span><br><span class="line">        assertEquals(<span class="string">&quot;Sedan&quot;</span>, carDto.getType());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯•é€šè¿‡ï¼ ğŸ‰</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆå†™ä¸€ä¸ªæ¥å£åå°±èƒ½å¤Ÿå¸®æˆ‘ä»¬å®ç°å®ä½“çš„è½¬æ¢å‘¢ï¼Ÿ</p>
</blockquote>
<p>å…¶å® Java å®ä½“æ˜ å°„å·¥å…·æœ‰ä¸¤ç§ï¼š</p>
<p>1ã€åœ¨è¿è¡ŒæœŸï¼Œä½¿ç”¨åå°„è°ƒç”¨ Setter/Getter æ–¹æ³•æˆ–è€…æ˜¯ç›´æ¥å¯¹æˆå‘˜å˜é‡èµ‹å€¼ï¼Œè¿™ç§æ–¹å¼é€šè¿‡ <code>invoke()</code> æ‰§è¡Œèµ‹å€¼ã€‚ä¸€èˆ¬ä¼šä½¿ç”¨ Beanutilã€Javassist ç­‰å¼€æºåº“è¿›è¡Œå®ç°ï¼Œä»£è¡¨äº§å“æœ‰ Dozer å’Œ ModelMaperã€‚</p>
<p>2ã€åœ¨ç¼–è¯‘æœŸï¼ŒåŠ¨æ€ç”Ÿæˆå«æœ‰é€ä¸€èµ‹å€¼çš„ <code>class</code> æ–‡ä»¶ ï¼Œåœ¨è¿è¡Œæ—¶ç›´æ¥è°ƒç”¨è¯¥ <code>class</code> æ–‡ä»¶ï¼Œè¿™ç±»çš„ä»£è¡¨æœ‰ MapStructã€Selmaã€Orikaã€‚</p>
<p>å¦‚æœä¸ä½¿ç”¨ä»»ä½•ç±»åº“ï¼Œæ‰‹åŠ¨å®ç°å®ä½“çš„è½¬æ¢ï¼Œå¯ä»¥ä½¿ç”¨åå°„ï¼ˆå¯¹åº”ç¬¬ä¸€ç§æ–¹å¼ï¼‰ï¼Œä¹Ÿå¯ä»¥å¯¹è°ƒç”¨æ¯ä¸ªå±æ€§çš„ Get/Set æ–¹æ³•è¿›è¡Œèµ‹å€¼ï¼ˆå¯¹åº”ç¬¬äºŒç§æ–¹å¼ï¼‰ã€‚</p>
<p>è¿˜æ˜¯æœ‰ç‚¹æ‡µï¼Ÿ</p>
<p>æŸ¥çœ‹åˆšåˆšé¡¹ç›®çš„ target ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/JavaImages/%E7%94%9F%E6%88%90%E7%9A%84CarMapperImpl%E5%AE%9E%E7%8E%B0%E7%B1%BB.png" alt="ç”Ÿæˆçš„CarMapperImplå®ç°ç±»"></p>
<p>è‡ªåŠ¨ç”Ÿæˆäº† <code>CarMapperImpl</code> å®ç°ç±»ï¼Œå…¶å†…éƒ¨ä»ç„¶ä½¿ç”¨çš„æ˜¯é€ä¸€å¤åˆ¶çš„æ–¹å¼ï¼Œåªä¸è¿‡ä¸ç”¨æ‰‹åŠ¨å»å†™äº†ã€‚</p>
<p>æ­£å› å¦‚æ­¤ï¼ŒåŸå®ä½“å’Œç›®æ ‡å®ä½“æœ€å¥½éƒ½ç¼–å†™å„å±æ€§å¯¹åº”çš„ Getter å’Œ Setter æ–¹æ³•ï¼Œä»¥åŠå®ƒä»¬å„è‡ªçš„æ— å‚æ„é€ å™¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåˆ«çä½¿ç”¨ Lombok ä¸­çš„ <code>@Accessors</code> æ³¨è§£ã€‚</p>
<p>ç”±äºè¿™ä¸ª class æ–‡ä»¶æ˜¯åœ¨ç¼–è¯‘æœŸç”Ÿæˆçš„ï¼Œç›¸æ¯”ä½¿ç”¨åå°„æ¥å®ç°å®ä½“æ˜ å°„ï¼Œè¿™ç§æ–¹å¼çš„æ•ˆç‡æ›´é«˜ã€‚</p>
<p>æ›´å¤š Bean æ˜ å°„å·¥å…·çš„æ€§èƒ½å¯¹æ¯”ï¼Œå¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/javaguide/p/11861749.html">5ç§å¸¸è§Beanæ˜ å°„å·¥å…·çš„æ€§èƒ½æ¯”å¯¹</a></p>
<p><mark>æ³¨æ„ï¼š</mark> ç”±äºè¿™äº›å®ç°ç±»ä¼šåœ¨ç¼–è¯‘æœŸç”Ÿæˆå¹¶å­˜æ”¾åœ¨ target ç›®å½•ä¸­ï¼Œå› æ­¤å½“æ›´æ”¹å®ä½“ä¿¡æ¯æˆ–æ˜ å°„é€»è¾‘æ—¶ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘æˆ–åˆ é™¤ target ç›®å½•å†æ‰§è¡Œç¨‹åºï¼Œå¦åˆ™æ›´æ”¹å¯èƒ½ä¸ä¼šç”Ÿæ•ˆã€‚</p>
<blockquote>
<p>æ³¨è§£ä»‹ç»</p>
</blockquote>
<p>åœ¨ä¸Šè¿° Demo ä¸­ï¼Œä½¿ç”¨åˆ°ä¸¤ä¸ªæ³¨è§£ï¼š</p>
<p><code>@Mapper</code>ï¼šä½œç”¨äºæ¥å£ä¸Šï¼Œå‘Šè¯‰ MapStruct éœ€è¦ç¼–è¯‘æœŸç”Ÿæˆå“ªä¸ªæ¥å£çš„å®ç°ç±»ã€‚</p>
<p>åœ¨ç”Ÿæˆçš„å®ç°ç±»ä¸­ï¼Œå½“åŸå®ä½“çš„å±æ€§ä¸å…¶ç›®æ ‡å®ä½“å¯¹åº”çš„å±æ€§åç§° <strong>ç›¸åŒ</strong> æ—¶ï¼Œå°±ç›´æ¥è¢« <strong>éšå¼æ˜ å°„</strong>ã€‚å¦‚æœåç§°ä¸ä¸€æ ·ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ° <code>@Mapping</code> æ³¨è§£ã€‚</p>
<p><code>@Mapping</code>ï¼šå¸¸ä½œç”¨äºæ–¹æ³•ä¸Šï¼Œç”¨äºåŸå®ä½“ä¸ç›®æ ‡å®ä½“å±æ€§åç§°ä¸ç›¸åŒæ—¶æŒ‡å®šæ˜ å°„å…³ç³»ã€‚</p>
<h2 id="2-2-å…³é—­éšå¼æ˜ å°„"><a class="header-anchor" href="#2-2-å…³é—­éšå¼æ˜ å°„"></a>2.2 å…³é—­éšå¼æ˜ å°„</h2>
<p>MapStruct å­˜åœ¨é»˜è®¤çš„éšå¼æ˜ å°„ï¼Œä¹Ÿå¯ä»¥å…³é—­å®ƒï¼Œåªéœ€åœ¨æ¥å£å¯¹åº”çš„æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BeanMapping(ignoreByDefault = true)</span></span><br></pre></td></tr></table></figure>
<p>è¿˜æ˜¯é’ˆå¯¹æœ€å¼€å§‹çš„ Demoï¼Œåœ¨æ¥å£ä¸­çš„å”¯ä¸€æ–¹æ³•ä¸Šæ·»åŠ è¿™ä¸ªæ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BeanMapping(ignoreByDefault = true)</span></span><br><span class="line"><span class="meta">@Mapping(source = &quot;numberOfSeats&quot;, target = &quot;seatCount&quot;)</span></span><br><span class="line"><span class="meta">@Mapping(source = &quot;make&quot;, target = &quot;make&quot;)</span></span><br><span class="line">CarDto <span class="title function_">carToCarDto</span><span class="params">(Car car)</span>;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¿®æ”¹ä¸€ä¸‹æµ‹è¯•æ–¹æ³•ï¼ŒæŸ¥çœ‹æ‰“å°ç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBeanMapping</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>( <span class="string">&quot;Morris&quot;</span>, <span class="number">5</span>,  <span class="string">&quot;Sedan&quot;</span>);</span><br><span class="line">    <span class="type">CarDto</span> <span class="variable">carDto</span> <span class="operator">=</span> CarMapper.INSTANCE.carToCarDto(car);</span><br><span class="line">    System.out.println(carDto.getMake());</span><br><span class="line">    System.out.println(carDto.getSeatCount());</span><br><span class="line">    System.out.println(carDto.getType());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre>
Morris
5
null
</pre>
<p>ç”±äºæ²¡æœ‰ä½¿ç”¨ <code>@Mapping</code> æ³¨è§£ä¸º <code>type</code> æŒ‡å®šæ˜ å°„å…³ç³»ï¼Œå› æ­¤ <code>type</code> çš„å±æ€§å€¼æ˜¯ <code>null</code>ã€‚</p>
<p>ä½†ä¸€èˆ¬æ¥è¯´ï¼Œæ²¡äººä¼šé—²ç€æ²¡äº‹æŠŠéšå¼æ˜ å°„å…³é—­ã€‚ğŸ¤¨</p>
<h2 id="2-3-Mapping-æ³¨è§£"><a class="header-anchor" href="#2-3-Mapping-æ³¨è§£"></a>2.3 @Mapping æ³¨è§£</h2>
<p><code>@Mapping</code> æ³¨è§£å¸¸ä½œç”¨äºæ–¹æ³•ä¸Šï¼Œå…¶å®å®ƒä¹Ÿå¯ä»¥ä½œç”¨äºæ³¨è§£ä¹‹ä¸Šï¼Œå…è®¸ <code>@Mapping</code> ç”¨äºå…¶ä»–ï¼ˆç”¨æˆ·è‡ªå®šä¹‰çš„ï¼‰æ³¨é‡Šä»¥å®ç°é‡ç”¨ã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<p>æ–°å»º <code>UserInfo</code> å®ä½“ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line">    <span class="keyword">private</span> String dept;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†æ–°å»º <code>StudentDto</code> ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String department;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦å®ç° <code>UserInfo</code> å‘ <code>StudentDto</code> è½¬æ¢ã€‚</p>
<p>å†åˆ›å»ºä¸€ä¸ª <code>FromUserInfo</code> æ³¨è§£ï¼Œåœ¨è¿™ä¸ªæ³¨è§£ä¹‹ä¸Šä½¿ç”¨ <code>@Mapping</code> æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.CLASS)</span></span><br><span class="line"><span class="meta">@Mapping(target = &quot;id&quot;, ignore = true)</span></span><br><span class="line"><span class="meta">@Mapping(target = &quot;createTime&quot;, expression = &quot;java(new java.util.Date())&quot;)</span></span><br><span class="line"><span class="meta">@Mapping(source = &quot;dept&quot;, target = &quot;department&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> FromUserInfo &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»º <code>UserInfoMapper</code> æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserInfoMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">UserInfoMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(UserInfoMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è½¬æ¢ä¸º StudentDto</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userInfo userInfo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> StudentDto å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@FromUserInfo</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;pwd&quot;, target = &quot;password&quot;)</span></span><br><span class="line">    StudentDto <span class="title function_">toStudent</span><span class="params">(UserInfo userInfo)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åæ¥ä¸ªæµ‹è¯•ç±»æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfoMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testToStudent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserInfo</span>(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;mofan&quot;</span>, <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">                <span class="comment">// 2020-11-02 21:54:29</span></span><br><span class="line">                <span class="string">&quot;å¼€å‘éƒ¨&quot;</span>, <span class="number">19</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1604325269401L</span>));</span><br><span class="line">        <span class="type">StudentDto</span> <span class="variable">studentDto</span> <span class="operator">=</span> UserInfoMapper.INSTANCE.toStudent(userInfo);</span><br><span class="line"></span><br><span class="line">        System.out.println(studentDto.getId());</span><br><span class="line">        System.out.println(studentDto.getUsername());</span><br><span class="line">        System.out.println(studentDto.getPassword());</span><br><span class="line">        System.out.println(studentDto.getDepartment());</span><br><span class="line">        System.out.println(studentDto.getAge());</span><br><span class="line">        System.out.println(studentDto.getCreateTime());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•ç±»åï¼Œæ§åˆ¶å°è¾“å‡ºï¼š</p>
<pre>
null
mofan
123456
å¼€å‘éƒ¨
19
Tue Feb 02 18:33:11 CST 2021
</pre>
<blockquote>
<p><code>@Mapping</code> å±æ€§è®²è§£</p>
</blockquote>
<p>ä¸Šè¿°æ¡ˆä¾‹ä¸­åˆä½¿ç”¨äº† <code>@Mapping</code> æ³¨è§£çš„ä¸¤ä¸ªå±æ€§ï¼š<code>ignore</code> å’Œ <code>expression</code>ã€‚</p>
<p>åœ¨å®ä½“è½¬æ¢æ—¶ï¼Œå¦‚æœä¸æƒ³è®©æŸä¸ªå±æ€§å€¼ä»æºå®ä½“èµ‹å€¼åˆ°æ–°å®ä½“ï¼Œå¯ä»¥ä½¿ç”¨ <code>@Mapping</code> æ³¨è§£çš„ <code>target</code> æŒ‡å®šæ–°å®ä½“ä¸­ä¸æƒ³è¢«èµ‹å€¼çš„å±æ€§ï¼ŒåŒæ—¶å°† <code>ignore</code> è®¾ç½®ä¸º <code>true</code>ã€‚</p>
<p><code>expression</code> çš„å«ä¹‰å°±æ˜¯è¡¨è¾¾å¼ï¼Œä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œå¯ä»¥ä¸ºæ–°å®ä½“ä¸­æŸä¸ªå±æ€§æŒ‡å®šæˆè¡¨è¾¾å¼è®¾ç½®çš„å€¼ã€‚è¡¨è¾¾å¼æ ¼å¼ä¸ºï¼š<code>java(&lt;EXPRESSION&gt;)</code>ï¼Œå…¶å®å°±æ˜¯ä¸€å¥ Java ä»£ç ã€‚æ¯”å¦‚æƒ³è®© username å­—æ®µè®¾ç½®ä¸º <strong>é»˜çƒ¦</strong>ï¼Œå¯ä»¥è¿™äº›å†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(target = &quot;username&quot;, expression = &quot;java(\&quot;é»˜çƒ¦\&quot;)&quot;)</span></span><br></pre></td></tr></table></figure>
<p><mark>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</mark> <code>source</code> å±æ€§å’Œ <code>expression</code> å±æ€§ä¸èƒ½åŒæ—¶å­˜åœ¨ã€‚ä½¿ç”¨ <code>expression</code> æ—¶ï¼Œå…¶å€¼çš„ Java ä»£ç æ‰€ä½¿ç”¨çš„ç±»æœ€å¥½ä½¿ç”¨å…¨ç±»åï¼Œä½†å¦‚æœè¿™ä¸ª Java ä»£ç ä¼šæŠ›å¼‚å¸¸å°±ä¸è¦ä½¿ç”¨ <code>expression</code> äº†ï¼Œè€Œæ˜¯éœ€è¦è‡ªå®šä¹‰æ–¹æ³•å¹¶åœ¨ <code>qualifyByName</code> ä¸­å¼•ç”¨ã€‚</p>
<p>åƒä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œ<code>createTime</code> çš„å€¼æ˜¯æŒ‡ <code>2020-11-02 21:54:29</code>ï¼Œä¸ºå…¶æŒ‡å®šè¡¨è¾¾å¼åï¼ŒåŸæœ¬çš„å€¼å‘ç”Ÿäº†æ”¹å˜ã€‚</p>
<p>å¦‚æœä»”ç»†è§‚å¯Ÿï¼Œè¿˜èƒ½å‘ç° MapStruct ä¼šå¯¹æ•°æ®è¿›è¡Œè‡ªåŠ¨è½¬æ¢ã€‚æ¯”å¦‚åœ¨åŸå®ä½“ä¸­çš„ age å±æ€§æ˜¯ <code>Integer</code> ç±»å‹çš„ï¼Œè€Œ ç›®æ ‡å®ä½“ä¸­çš„ age å±æ€§æ˜¯ <code>String</code> ç±»å‹çš„ï¼Œå³ä¾¿å¦‚æ­¤ï¼Œä»ç„¶èƒ½å¤Ÿæ˜ å°„æˆåŠŸã€‚ ğŸ‘</p>
<blockquote>
<p>@Mapping å…¶ä»–å±æ€§</p>
</blockquote>
<p><code>@Mapping</code> æ³¨è§£è¿˜æœ‰å…¶ä»–çš„å±æ€§ï¼š</p>
<ol>
<li>dateFormatï¼šåŸå±æ€§æ˜¯ <code>Date</code>ï¼Œè½¬åŒ–ä¸º <code>String</code></li>
<li>numberFormatï¼šæ•°å€¼ç±»å‹ä¸ <code>String</code> ç±»å‹ä¹‹é—´çš„è½¬åŒ–</li>
<li>constantï¼šä¸ç®¡æºå±æ€§å€¼ï¼Œç›´æ¥å°†ç›®æ ‡å±æ€§è®¾ç½®ä¸ºæŒ‡å®šçš„å¸¸é‡</li>
<li>qualifiedByNameï¼šæ ¹æ®è‡ªå®šä¹‰çš„æ–¹æ³•è¿›è¡Œèµ‹å€¼</li>
<li>defaultValueï¼šé»˜è®¤å€¼ã€‚å¦‚æœåŸå±æ€§å€¼ä¸º <code>null</code>ï¼Œé‚£ä¹ˆè®¾ç½®ç›®æ ‡å±æ€§å€¼ä¸ºæŒ‡å®šçš„é»˜è®¤å€¼</li>
</ol>
<blockquote>
<p>è¿™ç§æ–¹å¼æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>
</blockquote>
<p>å¦‚æœæœ‰è‹¥å¹²ä¸ª DTO éƒ½ç”±åŒä¸€å®ä½“è½¬æ¢è€Œæ¥ï¼Œè¿™äº› DTO æœ‰äº›å±æ€§åç§°æ˜¯ç›¸åŒçš„ï¼Œä½†æœ‰äº›åˆä¸ä¸€æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™ä¸€ä¸ªæ³¨è§£ï¼Œåœ¨è¿™ä¸ªæ³¨è§£ä¸Šä½¿ç”¨ <code>@Mapping</code> æ³¨è§£ï¼Œä»¥å‡å°‘é‡å¤ä»£ç ã€‚</p>
<p>ä½¿ç”¨ <code>@Mapping</code> æ³¨è§£ä½œç”¨ä¸å…¶ä»–æ³¨è§£ä¸Šå¹¶ä½¿ç”¨å…¶ä»–æ³¨è§£æ—¶ï¼Œå¯ä»¥è®©è‹¥å¹²ä¸ª DTO éƒ½å…·å¤‡ç›¸åŒçš„ç‰¹æ€§ã€‚åœ¨å®˜ç½‘ä¸Šç§°è¿™ç§è§‚ç‚¹ä¸º â€œduck-typingâ€ï¼ˆé¸­å­ç±»å‹ï¼‰ï¼Œå½“ä¸€ä¸ªä¸œè¥¿å«å£°åƒé¸­å­ï¼Œèµ°è·¯åƒé¸­å­ï¼Œè¿˜ä¼šæ¸¸æ³³ï¼Œé‚£ä¹ˆå®ƒå¾ˆæœ‰å¯èƒ½å°±æ˜¯é¸­å­ ğŸ¦†ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç‰¹æ€§å†³å®šäº†ç±»å‹ï¼Œè€Œä¸æ˜¯ç±»å‹å†³å®šäº†ç‰¹æ€§ã€‚é¸­å­ç±»å‹åœ¨åŠ¨æ€è¯­è¨€ä¸­ç»å¸¸ä½¿ç”¨ï¼Œæ¯”å¦‚ Pythonï¼Œè¿™ä½¿å¾— Python ä¸åƒ Java é‚£æ ·ä¸“é—¨å»å¼„ä¸€å¤§å †çš„è®¾è®¡æ¨¡å¼ã€‚ğŸ¤ª</p>
<p>å¥½äº†ï¼Œè¯´è¿œäº†ï¼Œå›åˆ° MapStruct ä¸Šã€‚</p>
<p>ä½†æ˜¯å®˜ç½‘åˆè¯´ï¼Œè¿™ä¸ªåŠŸèƒ½å°šä¸æˆç†Ÿï¼Œç”¨æˆ·åº”å½“è°¨æ…ä½¿ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨ä¸ç¡®å®šä½•æ—¶å§‹ç»ˆå­˜åœ¨å±æ€§æ—¶ï¼š</p>
<pre>
the method on which the problem occurs is displayed, as well as the concerned values in the @Mapping annotation. However, the composition aspect is not visible.
</pre>
<h2 id="2-4-é»˜è®¤æ–¹æ³•ä¸æŠ½è±¡ç±»"><a class="header-anchor" href="#2-4-é»˜è®¤æ–¹æ³•ä¸æŠ½è±¡ç±»"></a>2.4 é»˜è®¤æ–¹æ³•ä¸æŠ½è±¡ç±»</h2>
<p>åœ¨ JDK 8 åŠå…¶æ›´é«˜çš„ç‰ˆæœ¬ä¸­ï¼Œæ¥å£ä¸­ä¹Ÿå¯ä»¥æœ‰æ–¹æ³•çš„å®ç°ï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•å¿…é¡»è¢« <code>static</code> æˆ– <code>default</code> å…³é”®è¯ä¿®é¥°ã€‚</p>
<p>ä½¿ç”¨ MapStruct å¯ä»¥å®ç°ç®€å•ç±»å‹çš„æ˜ å°„ï¼Œä½†æ˜¯æ²¡åŠæ³•å®Œæˆä¸€äº›å¸¦æœ‰é€»è¾‘çš„æ˜ å°„ã€‚æ¯”å¦‚åœ¨åŸå®ä½“ä¸­æœ‰ä¸€ä¸ªåä¸º <code>age</code> çš„å±æ€§ï¼Œåœ¨æ˜ å°„åˆ°æ–°å®ä½“æ—¶ï¼Œæƒ³è®© <code>age</code> çš„å€¼åŠ ä¸€ï¼Œè¿™å¯¹äº MapStruct æ¥è¯´æ˜¯æ— æ³•åšåˆ°çš„ã€‚</p>
<p>æ­¤æ—¶å¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰é»˜è®¤æ–¹æ³•ï¼Œåªè¦å‚æ•°æ˜¯åŸå®ä½“ç±»å‹ï¼Œè¿”å›å€¼æ˜¯æ–°å®ä½“ç±»å‹ï¼Œé‚£ä¹ˆä½¿ç”¨ MapStruct ç”Ÿæˆæ¥å£çš„å®ç°ç±»æ—¶å°†è°ƒç”¨è¿™ä¸ªé»˜è®¤æ–¹æ³•ã€‚</p>
<p><strong>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æŠ½è±¡ç±»æ¥å®šä¹‰æ˜ å°„å™¨ï¼Œè€Œä¸ä»…ä»…æ˜¯æ¥å£ã€‚</strong> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒMapStruct ä¼šç”ŸæˆæŠ½è±¡ç±»çš„å­ç±»ï¼Œå¹¶å®ç°æ‰€æœ‰çš„æŠ½è±¡æ–¹æ³•ã€‚è€Œå¯¹äºéæŠ½è±¡æ–¹æ³•æ¥è¯´ï¼Œåªè¦å‚æ•°å’Œè¿”å›å€¼ç±»å‹åŒ¹é…ï¼ŒMapStruct ä¹Ÿä¼šå­ç±»ä¸­è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚ä¸å£°æ˜é»˜è®¤æ–¹æ³•ç›¸æ¯”ï¼Œä½¿ç”¨æŠ½è±¡ç±»æ¥å®šä¹‰æ˜ å°„å™¨å¯ä»¥åœ¨æ˜ å°„å™¨ç±»ä¸­å£°æ˜é¢å¤–çš„å­—æ®µã€‚</p>
<h2 id="2-5-å¤šä¸ªæºå‚æ•°"><a class="header-anchor" href="#2-5-å¤šä¸ªæºå‚æ•°"></a>2.5 å¤šä¸ªæºå‚æ•°</h2>
<p><strong>MapStruct æ”¯æŒå¸¦æœ‰å¤šä¸ªæºå‚æ•°çš„æ˜ å°„æ–¹æ³•ã€‚</strong> æ¯”å¦‚ï¼Œå¯ä»¥å°†å®ä½“ A ä¸­çš„éƒ¨åˆ†å±æ€§å€¼å’Œå®ä½“ B ä¸­çš„éƒ¨åˆ†å±æ€§å€¼æ˜ å°„åˆ°åŒä¸€ DTO ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AddressMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(source = &quot;person.description&quot;, target = &quot;description&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;address.houseNo&quot;, target = &quot;houseNumber&quot;)</span></span><br><span class="line">    DeliveryAddressDto <span class="title function_">personAndAddressToDeliveryAddressDto</span><span class="params">(Person person, Address address)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸å•å‚æ•°æ˜ å°„æ–¹æ³•ä¸€æ ·ï¼Œå±æ€§æ˜¯æŒ‰åç§°æ˜ å°„çš„ã€‚</p>
<p>å¦‚æœå¤šä¸ªæºå‚æ•°ä¸­å®šä¹‰äº†å…·æœ‰ç›¸åŒåç§°çš„å±æ€§ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨ <code>@Mapping</code> æ³¨é‡Šæ¥æŒ‡å®šè¦ä»å“ªä¸ªæºå‚æ•°ä¸­çš„åŒåå±æ€§æ˜ å°„åˆ°ç›®æ ‡å®ä½“ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚å¯¹äºä»…åœ¨ç»™å®šæºå‚æ•°ä¸­å‡ºç°ä¸€æ¬¡çš„å±æ€§ï¼Œç”±äº <strong>éšå¼æ˜ å°„</strong> çš„å…³ç³»ï¼Œå› æ­¤å¯ä»¥é€‰æ‹©æ€§åœ°æŒ‡å®šåç§°ã€‚</p>
<p><mark>æ³¨æ„ï¼š</mark> å…·æœ‰å¤šä¸ªæºå‚æ•°çš„æ˜ å°„æ–¹æ³•å°†åœ¨ <strong>æ‰€æœ‰</strong> æºå‚æ•°ä¸ºç©ºçš„æƒ…å†µä¸‹æ‰è¿”å› <code>null</code>ã€‚å¦åˆ™ï¼Œç›®æ ‡å®ä½“å°†è¢«å®ä¾‹åŒ–ï¼ŒåŒæ—¶å°†æ‰€æœ‰æ¥è‡ªæ‰€æä¾›å‚æ•°çš„å±æ€§å€¼æ˜ å°„åˆ°ç›®æ ‡å®ä½“ä¸­ã€‚</p>
<p><strong>MapStruct è¿˜æ”¯æŒç›´æ¥å¼•ç”¨æºå‚æ•°ã€‚</strong> æ¯”å¦‚æºå‚æ•°ä¸­æœ‰ä¸€ä¸ª <code>Integer</code> ç±»å‹çš„å‚æ•°ï¼Œå¯ä»¥ç›´æ¥å°†è¿™ä¸ªå‚æ•°æ˜ å°„åˆ°ç›®æ ‡å®ä½“ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AddressMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(source = &quot;person.description&quot;, target = &quot;description&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;hn&quot;, target = &quot;houseNumber&quot;)</span></span><br><span class="line">    DeliveryAddressDto <span class="title function_">personAndAddressToDeliveryAddressDto</span><span class="params">(Person person, Integer hn)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-6-å¤šä¸ªåµŒå¥—å±æ€§æ˜ å°„"><a class="header-anchor" href="#2-6-å¤šä¸ªåµŒå¥—å±æ€§æ˜ å°„"></a>2.6 å¤šä¸ªåµŒå¥—å±æ€§æ˜ å°„</h2>
<p>å¦‚æœåœ¨å®ä½“ A ä¸­å­˜åœ¨æŸä¸€å±æ€§ Bï¼Œå…¶ç±»å‹æ˜¯ä¸€ä¸ªå®ä½“ï¼Œç°åœ¨æƒ³å°†å®ä½“ A ä¸­çš„ B å¯¹è±¡æ˜ å°„åˆ°æŸä¸€ä¸å«ä»»ä½•å¤æ‚å¯¹è±¡ç±»å‹å±æ€§çš„ DTO ä¸­ï¼Œé‚£ä¹ˆéœ€è¦å–å‡ºå±æ€§ B çš„å„ä¸ªå±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„ã€‚</p>
<p>å¦‚æœå®ä½“ A å­˜åœ¨å¤šä¸ªå¤æ‚å¯¹è±¡ç±»å‹çš„å±æ€§ï¼Œä¾æ¬¡è¿›è¡Œæ˜ å°„ä¼šååˆ†ç¹çã€‚</p>
<p>MapStruct æ”¯æŒä½¿ç”¨ <code>.</code> ä½œä¸º <code>@Mapping</code> æ³¨é‡Šä¸­ <code>target</code> çš„å±æ€§å€¼ã€‚è¿™å‘Šè¯‰ MapStruct å°†åŸå®ä½“ä¸­æ‰€æœ‰å¤æ‚å¯¹è±¡ç±»å‹çš„å±æ€§ä¸­çš„æ‰€æœ‰å±æ€§æ˜ å°„åˆ°ç›®æ ‡å®ä½“ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CustomerMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(target = &quot;name&quot;, source = &quot;record.name&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;.&quot;, source = &quot;record&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;.&quot;, source = &quot;account&quot;)</span></span><br><span class="line">    Customer <span class="title function_">customerDtoToCustomer</span><span class="params">(CustomerDto customerDto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç å°† <code>customerDto</code> å¯¹è±¡ä¸­çš„ <code>record</code> å¯¹è±¡å’Œ <code>account</code> å¯¹è±¡çš„å„ä¸ªå±æ€§éƒ½æ˜ å°„åˆ°ç›®æ ‡å®ä½“ä¸­ï¼Œä½†ç”±äº <code>record</code> å’Œ <code>account</code> éƒ½æœ‰ <code>name</code> å±æ€§ï¼Œå› æ­¤éœ€è¦æ˜¾å¼æŒ‡å®šä»¥æ¶ˆé™¤æ­§ä¹‰ã€‚</p>
<h2 id="2-7-æ›´æ–°å­˜åœ¨çš„å®ä¾‹"><a class="header-anchor" href="#2-7-æ›´æ–°å­˜åœ¨çš„å®ä¾‹"></a>2.7 æ›´æ–°å­˜åœ¨çš„å®ä¾‹</h2>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½å¹¶ä¸éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®æ ‡å®ä½“ï¼Œè€Œæ˜¯æ›´æ–°ä¸€ä¸ªç°æœ‰çš„å®ä¾‹ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ° <code>@MappingTarget</code> æ³¨è§£ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼šä¸€ä¸ªåŸå®ä½“ A çš„å±æ€§æ•°é‡æ¯”ç›®æ ‡å®ä½“ B å°‘ï¼Œå› æ­¤å°† A æ˜ å°„ä¸º B æ—¶ï¼ŒB ä¸­æœ‰äº›å±æ€§å€¼ä¼šæ˜¯ç©ºã€‚B ä¸­çš„è¿™äº›å±æ€§æ˜¯å­˜åœ¨äºå®ä½“ C ä¸­çš„ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ C æ¥æ›´æ–° Bã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<p>åŸå®ä½“ <code>UserInfo</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line">    <span class="keyword">private</span> String dept;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›®æ ‡å¯¹è±¡ <code>TeacherDto</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TeacherDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String department;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Integer sex;</span><br><span class="line">    <span class="keyword">private</span> String idCardNum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€å®ä½“ <code>PersonInfo</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonInfo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line">    <span class="keyword">private</span> String idCardNum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢æ¥å£ä¸­çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è½¬æ¢ä¸º TeacherDto --&gt; ç¼ºå°‘éƒ¨åˆ†å±æ€§å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userInfo userInfo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> TeacherDto å®ä¾‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapping(source = &quot;pwd&quot;, target = &quot;password&quot;)</span></span><br><span class="line"><span class="meta">@Mapping(source = &quot;dept&quot;, target = &quot;department&quot;)</span></span><br><span class="line">TeacherDto <span class="title function_">toTeacherDto</span><span class="params">(UserInfo userInfo)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ›´æ–° TeacherDto å®ä¾‹ --&gt; è¡¥å……ç¼ºå°‘çš„å±æ€§å€¼</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> personInfo personInfo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> teacherDto teacherDto</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapping(source = &quot;gender&quot;, target = &quot;sex&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateTeacherDto</span><span class="params">(PersonInfo personInfo, <span class="meta">@MappingTarget</span> TeacherDto teacherDto)</span>;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testToTeacherDto</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserInfo</span>(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;mofan&quot;</span>, <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">            <span class="comment">// 2020-11-02 21:54:29</span></span><br><span class="line">            <span class="string">&quot;å¼€å‘éƒ¨&quot;</span>, <span class="number">19</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1604325269401L</span>));</span><br><span class="line">    <span class="type">TeacherDto</span> <span class="variable">teacherDto</span> <span class="operator">=</span> UserInfoMapper.INSTANCE.toTeacherDto(userInfo);</span><br><span class="line">    assertEquals(<span class="string">&quot;123456&quot;</span>, teacherDto.getPassword());</span><br><span class="line">    assertNull(teacherDto.getFirstName());</span><br><span class="line"></span><br><span class="line">    <span class="type">PersonInfo</span> <span class="variable">personInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PersonInfo</span>();</span><br><span class="line">    personInfo.setFirstName(<span class="string">&quot;é»˜&quot;</span>);</span><br><span class="line">    personInfo.setLastName(<span class="string">&quot;çƒ¦&quot;</span>);</span><br><span class="line">    personInfo.setGender(<span class="number">1</span>);</span><br><span class="line">    personInfo.setIdCardNum(<span class="string">&quot;123456788914725896&quot;</span>);</span><br><span class="line">    UserInfoMapper.INSTANCE.updateTeacherDto(personInfo, teacherDto);</span><br><span class="line">    assertEquals(<span class="string">&quot;é»˜&quot;</span>, teacherDto.getFirstName());</span><br><span class="line">    assertEquals(<span class="number">1</span>, teacherDto.getSex().intValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ›´æ–°å®ä¾‹æ—¶ï¼Œå¦‚æœå­˜åœ¨å­—æ®µåä¸ä¸€æ ·çš„æƒ…å†µï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨ <code>@Mapping</code> æ³¨è§£è¿›è¡ŒæŒ‡å®šã€‚</p>
<p>åœ¨æ›´æ–°å¯¹è±¡çš„æ–¹æ³•ä¸­ï¼Œé™¤äº†ä½¿ç”¨ <code>void</code> ä½œä¸ºè¿”å›å€¼å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç›®æ ‡å‚æ•°ç±»å‹ä½œä¸ºè¿”å›å€¼ï¼Œè¿™è¡¨ç¤ºåœ¨æ›´æ–°ç›®æ ‡å‚æ•°ååˆè¿”å›å®ƒã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(source = &quot;gender&quot;, target = &quot;sex&quot;)</span></span><br><span class="line">TeacherDto <span class="title function_">updateTeacherDto</span><span class="params">(PersonInfo personInfo, <span class="meta">@MappingTarget</span> TeacherDto teacherDto)</span>;</span><br></pre></td></tr></table></figure>
<h2 id="2-8-åå‘æ˜ å°„"><a class="header-anchor" href="#2-8-åå‘æ˜ å°„"></a>2.8 åå‘æ˜ å°„</h2>
<p>ä¸Šè¿°å®ä¾‹ä¸­ï¼Œéƒ½æ˜¯ç”¨å®ä½“è½¬æ¢ä¸º DTOï¼Œé‚£ä¹ˆæ€ä¹ˆå°† DTO è½¬æ¢å›å®ä½“å‘¢ï¼Ÿ</p>
<p>å½“ç„¶å¯ä»¥ä½¿ç”¨ <code>@Mapping</code> æ³¨è§£ä¸€ä¸€æŒ‡å®šï¼Œä½†è¿™æ ·ä¹Ÿå¤ªéº»çƒ¦äº†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆç®€å•çš„æ–¹æ³•å‘¢ï¼Ÿ</p>
<p>MapStruct æä¾›äº†ä¸€ä¸ªåä¸º <code>@InheritInverseConfiguration</code> çš„æ³¨è§£ç”¨äºåå‘æ˜ å°„ã€‚è¯¥æ³¨è§£åªæœ‰ä¸€ä¸ªå±æ€§<code>name</code>ï¼Œè¡¨ç¤ºåŸæ˜ å°„åï¼Œå³åŸæ˜ å°„æ–¹æ³•åã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<p>æ–°å®ä½“ <code>PeopleInfo</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PeopleInfo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> Double weight;</span><br><span class="line">    <span class="keyword">private</span> String bloodType;</span><br><span class="line">    <span class="keyword">private</span> GenderEnum gender;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å·¥äºº <code>WorkerDto</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkerDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String createTime;</span><br><span class="line">    <span class="keyword">private</span> String weight;</span><br><span class="line">    <span class="keyword">private</span> String bloodType;</span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªç”¨äºè½¬æ¢å®ä½“çš„æ¥å£ <code>PeopleInfoMapper</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PeopleInfoMapper</span> &#123;</span><br><span class="line">    <span class="type">PeopleInfoMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(PeopleInfoMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°† PeopleInfo è½¬æ¢ä¸º WorkerDto</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> peopleInfo peopleInfoå®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> WorkerDto</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Mappings(&#123;</span></span><br><span class="line"><span class="meta">            @Mapping(target = &quot;name&quot;, defaultValue = &quot;é»˜çƒ¦&quot;),</span></span><br><span class="line"><span class="meta">            @Mapping(target = &quot;age&quot;, expression = &quot;java(java.lang.Integer.valueOf(peopleInfo.getAge()) + 1)&quot;),</span></span><br><span class="line"><span class="meta">            @Mapping(target = &quot;createTime&quot;, dateFormat = &quot;yyyy-MM-dd&quot;),</span></span><br><span class="line"><span class="meta">            @Mapping(target = &quot;weight&quot;, numberFormat = &quot;0.00&quot;),</span></span><br><span class="line"><span class="meta">            @Mapping(target = &quot;bloodType&quot;, constant = &quot;A å‹è¡€&quot;),</span></span><br><span class="line"><span class="meta">            @Mapping(source = &quot;gender&quot;, target = &quot;gender&quot;, qualifiedByName = &quot;getGenderEnumCode&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    WorkerDto <span class="title function_">toWorkerDto</span><span class="params">(PeopleInfo peopleInfo)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°† DTO è½¬æ¢ä¸ºå®ä½“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workerDto workerDto å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> PeopleInfo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@InheritInverseConfiguration(name = &quot;toWorkerDto&quot;)</span></span><br><span class="line">    <span class="meta">@Mappings(&#123;</span></span><br><span class="line"><span class="meta">            @Mapping(target = &quot;age&quot;, expression = &quot;java(java.lang.String.valueOf(workerDto.getAge()))&quot;),</span></span><br><span class="line"><span class="meta">            @Mapping(target = &quot;bloodType&quot;, constant = &quot;B å‹è¡€&quot;),</span></span><br><span class="line"><span class="meta">            @Mapping(target = &quot;gender&quot;, qualifiedByName = &quot;getGenderEnum&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    PeopleInfo <span class="title function_">fromPersonInfo</span><span class="params">(WorkerDto workerDto)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æšä¸¾å€¼çš„ä»£ç è·å–æšä¸¾å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code æšä¸¾å€¼å¯¹åº”çš„ä»£ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æšä¸¾å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Named(&quot;getGenderEnum&quot;)</span></span><br><span class="line">    <span class="keyword">default</span> GenderEnum <span class="title function_">getGenderEnum</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (GenderEnum value : GenderEnum.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value.getCode().equals(code)) &#123;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ€§åˆ«æšä¸¾å€¼è·å–å¯¹åº”çš„ä»£ç </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> genderEnum æšä¸¾å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æšä¸¾å€¼å¯¹åº”çš„ä»£ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Named(&quot;getGenderEnumCode&quot;)</span></span><br><span class="line">    <span class="keyword">default</span> Integer <span class="title function_">getGenderEnumCode</span><span class="params">(GenderEnum genderEnum)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (genderEnum == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> genderEnum.getCode();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–å†™ä¸€æ‰‹æµ‹è¯•æ–¹æ³•ï¼š ğŸ˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInheritInverseConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">PeopleInfo</span> <span class="variable">peopleInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PeopleInfo</span>();</span><br><span class="line">    peopleInfo.setId(<span class="number">233L</span>);</span><br><span class="line">    <span class="comment">// ç¼ºå°‘ name å±æ€§å€¼</span></span><br><span class="line">    peopleInfo.setAge(<span class="string">&quot;18&quot;</span>);</span><br><span class="line">    peopleInfo.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1604325269401L</span>));</span><br><span class="line">    peopleInfo.setWeight(<span class="number">122.2345</span>);</span><br><span class="line">    peopleInfo.setBloodType(<span class="string">&quot;AB å‹è¡€&quot;</span>);</span><br><span class="line">    peopleInfo.setGender(GenderEnum.MAN);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// to workerDto</span></span><br><span class="line">    <span class="type">WorkerDto</span> <span class="variable">workerDto</span> <span class="operator">=</span> PeopleInfoMapper.INSTANCE.toWorkerDto(peopleInfo);</span><br><span class="line">    assertEquals(<span class="string">&quot;é»˜çƒ¦&quot;</span>, workerDto.getName());</span><br><span class="line">    assertEquals(<span class="number">1</span>, workerDto.getGender().intValue());</span><br><span class="line">    assertEquals(<span class="number">19</span>, workerDto.getAge().intValue());</span><br><span class="line">    System.out.println(workerDto.getCreateTime());</span><br><span class="line">    System.out.println(workerDto.getWeight());</span><br><span class="line">    System.out.println(workerDto.getBloodType());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// from PeopleInfo</span></span><br><span class="line">    <span class="type">PeopleInfo</span> <span class="variable">person</span> <span class="operator">=</span> PeopleInfoMapper.INSTANCE.fromPersonInfo(workerDto);</span><br><span class="line">    assertEquals(<span class="string">&quot;B å‹è¡€&quot;</span>, person.getBloodType());</span><br><span class="line">    assertEquals(<span class="string">&quot;19&quot;</span>, person.getAge());</span><br><span class="line">    assertEquals(GenderEnum.MAN, person.getGender());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•æ–¹æ³•åï¼Œæµ‹è¯•é€šè¿‡ï¼Œæ§åˆ¶å°æ‰“å°ï¼š</p>
<pre>
2020-11-02
122.23
A å‹è¡€
</pre>
<blockquote>
<p>æ€»ç»“</p>
</blockquote>
<p>ç”±äº age çš„è½¬åŒ–ä¸­ä½¿ç”¨äº† <code>expression</code>ã€bloodType è½¬åŒ–çš„è¿‡ç¨‹ä¸­ä½¿ç”¨äº† <code>constant</code>ï¼Œè¿™ä¸¤ä¸ªå±æ€§å¯¹åº”çš„ <code>@Mapping</code> æ³¨é‡Šéƒ½æ²¡æœ‰æŒ‡å®š <code>source</code>ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨ <code>@InheritInverseConfiguration</code> æ³¨è§£è¿›è¡Œåå‘æ˜ å°„æ—¶ï¼Œéœ€è¦ä½¿ç”¨ <code>@Mapping</code> å¯¹è¿™ä¸¤ä¸ªå±æ€§è¿›è¡Œå•ç‹¬çš„æ˜ å°„ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™ã€‚</p>
<p>åœ¨ <code>PeopleInfo</code> ä¸­ gender å±æ€§ç±»å‹æ˜¯ <code>GenderEnum</code> æšä¸¾ç±»å‹ï¼Œè€Œ <code>WorkerDto</code>  ä¸­çš„ gender å±æ€§æ˜¯ <code>Integer</code> ç±»å‹çš„ï¼Œå› æ­¤åœ¨è¿›è¡Œå±æ€§æ˜ å°„æ—¶ï¼Œéœ€è¦æŒ‡å®šæ˜ å°„æ–¹å¼ï¼Œè¿™é‡Œæ¶‰åŠåˆ° <code>@Named</code> æ³¨è§£å’Œ <code>@Mapping</code> æ³¨è§£ä¸­ <code>qualifiedByName </code> å±æ€§çš„ä½¿ç”¨ã€‚</p>
<h2 id="2-9-ç›´æ¥ä½¿ç”¨å­—æ®µæ˜ å°„"><a class="header-anchor" href="#2-9-ç›´æ¥ä½¿ç”¨å­—æ®µæ˜ å°„"></a>2.9 ç›´æ¥ä½¿ç”¨å­—æ®µæ˜ å°„</h2>
<p>åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼Œå®ç°ä¸å®ä½“ä¹‹é—´çš„æ˜ å°„æ—¶éƒ½éœ€è¦å®ä½“ä¸­æœ‰ Getter å’Œ Setter æ–¹æ³•ï¼Œä½† MapStruct ä¹Ÿæ”¯æŒæ²¡æœ‰ Getter å’Œ Setter çš„å…¬å…±å­—æ®µæ˜ å°„ã€‚å¦‚æœ MapStruct ä¸ºå±æ€§æ‰¾ä¸åˆ°åˆé€‚çš„ Getter å’Œ Setter æ–¹æ³•ï¼Œå®ƒä¼šæŠŠå­—æ®µä½œä¸ºè¯» / å†™è®¿é—®å™¨ã€‚</p>
<p>å¦‚æœä¸€ä¸ªå­—æ®µè¢« <code>public</code> æˆ– <code>public final</code> ä¿®é¥°ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªè¯»è®¿é—®å™¨ã€‚å¦‚æœä¸€ä¸ªå­—æ®µè¢« <code>static</code> ä¿®é¥°ï¼Œå®ƒä¸ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªè¯»è®¿é—®å™¨ã€‚</p>
<p>å½“ä¸€ä¸ªå­—æ®µ <strong>ä»…ä»…åª</strong> è¢« <code>public</code> ä¿®é¥°æ—¶ï¼Œå®ƒæ‰ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå†™è®¿é—®å™¨ã€‚å¦‚æœä¸€ä¸ªå­—æ®µè¢« <code>final</code> æˆ– <code>static</code> ä¿®é¥°ï¼Œå®ƒä¸ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå†™è®¿é—®å™¨ã€‚</p>
<p>æ¯”å¦‚ï¼Œè¿™æ ·ä¸¤ä¸ªå®ä½“æ˜¯èƒ½å¤Ÿè¢«ç›¸äº’æ˜ å°„çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerDto</span> &#123;</span><br><span class="line">    <span class="comment">// æ³¨æ„è¿™äº›å­—æ®µæ˜¯è¢« public ä¿®é¥°çš„</span></span><br><span class="line">    <span class="keyword">public</span> Long id;</span><br><span class="line">    <span class="keyword">public</span> String customerName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äº <code>name</code> å±æ€§å’Œ <code>customerName</code> å±æ€§åç§°ä¸ä¸€æ ·ï¼Œåœ¨è¿›è¡Œæ˜ å°„æ—¶ï¼Œéœ€è¦ä½¿ç”¨ <code>@Mapping</code> æŒ‡å®šè§„åˆ™ã€‚</p>
<h2 id="2-10-ä½¿ç”¨æ„å»ºå™¨"><a class="header-anchor" href="#2-10-ä½¿ç”¨æ„å»ºå™¨"></a>2.10 ä½¿ç”¨æ„å»ºå™¨</h2>
<p>åœ¨ MapStruct ä¸­ï¼Œæ”¯æŒé€šè¿‡æ„å»ºå™¨å¯¹ä¸å¯å˜ç±»å‹è¿›è¡Œæ˜ å°„ã€‚</p>
<p>å½“è¿›è¡Œæ˜ å°„æ—¶ï¼ŒMapStruct ä¼šæ£€æŸ¥è¢«æ˜ å°„çš„ç±»ä¸­æ˜¯å¦æœ‰æ„å»ºå™¨ã€‚è¿™æ˜¯é€šè¿‡ BuilderProvider å®Œæˆçš„ï¼Œå¦‚æœè¿™ä¸ªç±»å­˜åœ¨æ„å»ºå™¨ï¼Œé‚£ä¹ˆè¯¥æ„å»ºå™¨å°†è¢«ç”¨äºæ˜ å°„ã€‚</p>
<p><code>BuilderProvider</code> çš„é»˜è®¤å®ç°å‡è®¾å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>è¯¥ç±»å‹æ‹¥æœ‰è¿”å› <code>Builder</code> å¯¹è±¡çš„å…¬å…±æ— å‚é™æ€æ–¹æ³•ï¼ˆè¯¥æ–¹æ³•ç§°ä¸º <strong>æ„å»ºå™¨åˆ›å»ºæ–¹æ³•</strong>ï¼‰ã€‚æ¯”å¦‚ <code>Person</code> ç±»ä¸­æœ‰ä¸€ä¸ªå…¬å…±é™æ€æ–¹æ³•ï¼Œå®ƒè¿”å› <code>PersonBuilder</code>ã€‚</p>
</li>
<li>
<p><code>Builder</code> ç±»å‹æœ‰ä¸€ä¸ªå…¬å…±æ— å‚æ–¹æ³•ï¼ˆè¯¥æ–¹æ³•ç§°ä¸º <strong>æ„å»ºæ–¹æ³•</strong>ï¼‰ï¼Œå®ƒè¿”å›æ­£åœ¨æ„å»ºçš„å¯¹è±¡ç±»å‹ã€‚æ¯”å¦‚ <code>PersonBuilder</code> ä¸­æœ‰ä¸€ä¸ª <code>build()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„è¿”å›å€¼ç±»å‹æ˜¯ <code>Person</code>ã€‚</p>
</li>
<li>
<p>åœ¨æœ‰å¤šä¸ª <strong>æ„å»ºæ–¹æ³•</strong> çš„æƒ…å†µä¸‹ï¼ŒMapStruct ä¼šå¯»æ‰¾ä¸€ä¸ªå«åš <code>build()</code> çš„æ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨è¿™æ ·çš„æ–¹æ³•ï¼Œå°†ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¦åˆ™ç¼–è¯‘é”™è¯¯ã€‚</p>
</li>
<li>
<p>å¯ä»¥åœ¨ <code>@BeanMapping</code>ã€<code>@Mapper</code> æˆ– <code>@MapperConfig</code> ç­‰æ³¨è§£ä¸­ä½¿ç”¨ <code>@Builder</code> æ¥å®šä¹‰ç‰¹å®šçš„ <strong>æ„å»ºæ–¹æ³•</strong>ã€‚</p>
</li>
<li>
<p>å¦‚æœæœ‰å¤šä¸ª <strong>æ„å»ºå™¨åˆ›å»ºæ–¹æ³•</strong> æ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œ<code>DefaultBuilderProvider</code> ä¼šæŠ›å‡º <code>MoreThanOneBuilderCreationMethodException</code> å¼‚å¸¸ã€‚å¦‚æœå‘ç”Ÿ <code>MoreThanOneBuilderCreationMethodException</code>ï¼ŒMapStruct å°†åœ¨ç¼–è¯‘æœŸé—´å†™å…¥è­¦å‘Šï¼Œå¹¶ä¸”ä¸ä½¿ç”¨ä»»ä½•ç”Ÿæˆå™¨ã€‚</p>
</li>
</ul>
<p>å¦‚æœåœ¨è¢«æ˜ å°„çš„ç±»ä¸­å­˜åœ¨ä¸Šè¿°çš„æ–¹æ³•å’Œæ„å»ºå™¨ï¼Œä¸ºäº†å®Œæˆæ˜ å°„ï¼ŒMapStruct ä¼šè°ƒç”¨æ„å»ºå™¨çš„æ„å»ºæ–¹æ³•å¹¶ç”Ÿæˆä»£ç ã€‚</p>
<p>è¿˜å¯ä»¥é€šè¿‡ MapStruct çš„ <code>@Builder</code> çš„ <code>disableBuilder</code> å±æ€§æ¥ç¦ç”¨æ„å»ºå™¨æ£€æµ‹ã€‚MapStruct å°†åœ¨æ„å»ºå™¨è¢«ç¦ç”¨çš„æƒ…å†µä¸‹å›åˆ°å¸¸è§„çš„ Getter / Setter æ¥ç”Ÿæˆä»£ç ã€‚è¿˜å¯ä»¥åœ¨ Maven å¤„ç†å™¨æ’ä»¶çš„é…ç½®ä¸­ä½¿ç”¨ <code>&lt;compilerArgs&gt;</code> æ·»åŠ  <code>&lt;arg&gt;-Amapstruct.disableBuilders=true&lt;/arg&gt;</code> æ¥ç¦ç”¨æ„å»ºå™¨çš„æ£€æµ‹ã€‚</p>
<p>å¯¹è±¡å·¥å‚ä¹Ÿè¢«è®¤ä¸ºæ˜¯æ„å»ºå™¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>PersonBuilder</code> ä¸­å­˜åœ¨ä¸€ä¸ªå¯¹è±¡å·¥å‚ï¼ŒMapStruct å°†ä½¿ç”¨å¯¹è±¡å·¥å‚è€Œä¸æ˜¯ <strong>æ„å»ºå™¨åˆ›å»ºæ–¹æ³•</strong>ã€‚</p>
<p>æ„å»ºå™¨çš„æ£€æµ‹ä¼šå½±å“ <code>@BeforeMapping</code> å’Œ <code>@AfterMapping</code> æ³¨è§£çš„è¡Œä¸ºï¼Œè¿™åœ¨åæ–‡ä¼šä»‹ç»ã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<p>åŸå®ä½“ <code>Animal</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›®æ ‡å®ä½“ä¸æ„é€ å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DogDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">DogDto</span> <span class="params">(DogDto.Builder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = builder.type;</span><br><span class="line">        <span class="built_in">this</span>.name = builder.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºå™¨åˆ›å»ºæ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ„å»ºå™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DogDto.Builder <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DogDto</span>.Builder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String type;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">type</span> <span class="params">(String type)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.type = type;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="title function_">name</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * æ„å»ºæ–¹æ³•</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> è¢«æ„å»ºçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> DogDto <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DogDto</span>(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AnimalMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">AnimalMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(AnimalMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°† Animal è½¬æ¢ä¸º DogDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> animal Animal å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> DogDto å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DogDto <span class="title function_">toDogDto</span><span class="params">(Animal animal)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnimalMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testToDogDto</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line">        animal.setName(<span class="string">&quot;å°é»‘&quot;</span>);</span><br><span class="line">        animal.setType(<span class="string">&quot;dog&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DogDto</span> <span class="variable">dogDto</span> <span class="operator">=</span> AnimalMapper.INSTANCE.toDogDto(animal);</span><br><span class="line">        assertEquals(<span class="string">&quot;å°é»‘&quot;</span>, dogDto.getName());</span><br><span class="line">        assertEquals(<span class="string">&quot;dog&quot;</span>, dogDto.getTYPE());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•æ–¹æ³•åï¼Œæµ‹è¯•é€šè¿‡ã€‚æŸ¥çœ‹ target ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnimalMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">AnimalMapper</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AnimalMapperImpl</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> DogDto <span class="title function_">toDogDto</span><span class="params">(Animal animal)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (animal == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Builder</span> <span class="variable">dogDto</span> <span class="operator">=</span> DogDto.builder();</span><br><span class="line">            dogDto.type(animal.getType());</span><br><span class="line">            dogDto.name(animal.getName());</span><br><span class="line">            <span class="keyword">return</span> dogDto.create();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ€»ç»“</p>
</blockquote>
<p>è¿™å…¶å®ä½¿ç”¨äº†ä¸€ç§è®¾è®¡æ¨¡å¼ â€”â€” æ„å»ºè€…æ¨¡å¼ï¼Œæˆ–è€…è¯´å»ºé€ è€…æ¨¡å¼ã€‚</p>
<p>åœ¨ã€ŠEffective Javaã€‹ä¸€ä¹¦ä¸­æœ‰æåˆ°ï¼Œ<strong>ä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°å‚æ•°ä¸ªæ•°æœ‰å¤šä¸ªæ—¶ï¼Œè€Œä¸”è¿™äº›å‚æ•°æœ‰äº›æ˜¯å¯é€‰çš„å‚æ•°</strong>ï¼Œè¦è€ƒè™‘ä½¿ç”¨æ„å»ºå™¨ï¼Œå³ä½¿ç”¨æ„å»ºè€…æ¨¡å¼ã€‚</p>
<p>ä½†ä¸Šè¿°ä»£ç ä¸­å¹¶æ²¡æœ‰ä½“ç°å¯é€‰å‚æ•°çš„æ¦‚å¿µï¼Œè¦æƒ³ä½“ç°ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨æ„å»ºå™¨ä¸­ç¼–å†™ç¼–å†™ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•çš„å‚æ•°å°±æ˜¯éœ€è¦å¿…å¡«çš„å‚æ•°ã€‚</p>
<p>æ¯æ¬¡ä½¿ç”¨æ„å»ºè€…æ¨¡å¼éƒ½ä¼šä¹¦å†™è®¸å¤šæ ·æ¿ä»£ç ï¼ŒLombok æä¾›äº†ä¸€ä¸ª <code>@Builder</code> æ³¨è§£ï¼Œä½¿ç”¨è¿™ä¸ªæ³¨è§£å¯ä»¥å¾ˆå¿«åœ°å®ç°æ„å»ºè€…æ¨¡å¼ã€‚ä½¿ç”¨ <code>@Builder</code> ç”Ÿæˆçš„æ„é€ æ–¹æ³•æ˜¯å…±æœ‰çš„ï¼Œä¸ç¬¦åˆæ„å»ºè€…æ¨¡å¼çš„æ€æƒ³ï¼Œå› æ­¤è¿˜éœ€è¦æŒ‡å®šæ„é€ æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦ã€‚æ¯”å¦‚æŒ‡å®šæˆ <code>protected</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor(access = AccessLevel.PROTECTED)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DogDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°† DogDto ä¿®æ”¹æˆä»¥ä¸Šå½¢å¼åï¼Œè¿è¡Œæµ‹è¯•æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡çš„ã€‚ ğŸ‘Š</p>
<h2 id="2-11-ä½¿ç”¨æ„é€ å‡½æ•°"><a class="header-anchor" href="#2-11-ä½¿ç”¨æ„é€ å‡½æ•°"></a>2.11 ä½¿ç”¨æ„é€ å‡½æ•°</h2>
<p>åœ¨å‰æ–‡ä¸­ï¼Œå¯¹è±¡æ˜ å°„ä½¿ç”¨ Getter / Setter å®Œæˆã€‚MapStruct ä¹Ÿæ”¯æŒä½¿ç”¨æ„é€ æ–¹æ³•æ¥æ˜ å°„ç›®æ ‡ç±»å‹ã€‚</p>
<p>åœ¨è¿›è¡Œæ˜ å°„æ—¶ï¼ŒMapStruct ä¼šæ£€æŸ¥è¢«æ˜ å°„çš„å®ä½“ä¸­æ˜¯å¦å­˜åœ¨æ„å»ºå™¨ã€‚å¦‚æœæ²¡æœ‰æ„å»ºå™¨ï¼ŒMapStruct ä¼šå¯»æ‰¾ä¸€ä¸ªå¯è®¿é—®çš„æ„é€ æ–¹æ³•ã€‚</p>
<blockquote>
<p>æ„é€ æ–¹æ³•çš„é€‰æ‹©</p>
</blockquote>
<p>å½“æœ‰å¤šä¸ªæ„é€ å‡½æ•°æ—¶ï¼ŒMapStruct æŒ‰ç…§ä»¥ä¸‹ä¼˜å…ˆçº§è¿›è¡Œé€‰æ‹©ï¼š</p>
<ol>
<li>è¢« <code>@Default</code> ï¼ˆè¯¥æ³¨è§£å¯ä»¥æ¥è‡ªä»»ä½•åŒ…ï¼ğŸ˜²ï¼‰æ³¨é‡Šæ‰€æ ‡æ³¨çš„å…¬å…±æ„é€ æ–¹æ³•ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰ï¼›</li>
<li>å¦‚æœ <strong>åªæœ‰ä¸€ä¸ªå…¬å…±</strong> çš„æ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°†è¢«ç”¨äºæ„é€ å¯¹è±¡ï¼Œè€Œå…¶ä»–éå…¬å…±çš„æ„é€ æ–¹æ³•ä¼šè¢«å¿½ç•¥ï¼›</li>
<li>å¦‚æœå­˜åœ¨ä¸€ä¸ªæ— å‚æ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°†è¢«ç”¨äºæ„é€ å¯¹è±¡ï¼Œè€Œå…¶ä»–æ„é€ æ–¹æ³•ä¼šè¢«å¿½ç•¥ï¼›</li>
<li>å¦‚æœæœ‰å¤šä¸ªç¬¦åˆæ¡ä»¶çš„æ„é€ æ–¹æ³•ï¼Œä¼šå› ä¸ºæ„é€ æ–¹æ³•æŒ‡ä»£ä¸æ¸…è€Œé€ æˆç¼–è¯‘é”™è¯¯ã€‚åœ¨è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ <code>@Default</code> æ³¨è§£æ¥æŒ‡å®šç”¨äºæ„é€ å¯¹è±¡çš„æ„é€ æ–¹æ³•ã€‚</li>
</ol>
<p>å®˜ç½‘ç»™å‡ºçš„ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">Vehicle</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">    <span class="comment">// MapStruct will use this constructor, because it is a single public constructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Vehicle</span><span class="params">(String color)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="comment">// MapStruct will use this constructor, because it is a parameterless empty constructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">(String make, String color)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Truck</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Truck</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">    <span class="comment">// MapStruct will use this constructor, because it is annotated with @Default</span></span><br><span class="line">    <span class="meta">@Default</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Truck</span><span class="params">(String make, String color)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Van</span> &#123;</span><br><span class="line">    <span class="comment">// There will be a compilation error when using this class because MapStruct cannot pick a constructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Van</span><span class="params">(String make)</span> &#123; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Van</span><span class="params">(String make, String color)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä½¿ç”¨æ„é€ æ–¹æ³•æ—¶ï¼Œå°†ä½¿ç”¨æ„é€ æ–¹æ³•çš„å‚æ•°åå¹¶ä¸ç›®æ ‡å±æ€§è¿›è¡ŒåŒ¹é…ã€‚å½“æ„é€ å‡½æ•°è¢« <code>@ConstructorProperties</code> ï¼ˆè¯¥æ³¨è§£ä¹Ÿå¯ä»¥æ¥è‡ªä»»ä½•åŒ…ï¼Œåªä¸è¿‡é€šå¸¸ä½¿ç”¨ <code>java.beans.ConstructorProperties</code>ï¼‰æ ‡æ³¨æ—¶ï¼Œè¯¥æ³¨è§£å°†è¢«ç”¨æ¥è·å–å‚æ•°çš„åç§°ã€‚</p>
<p>å½“ç›®æ ‡å®ä½“ä¸­å­˜åœ¨å¯¹è±¡å·¥å‚æ–¹æ³•æˆ–ç”¨ <code>@ObjectFactory</code> æ ‡è®°çš„æ–¹æ³•æ—¶ï¼Œè¿™äº›æ–¹æ³•å°†ä¼˜äºç›®æ ‡ä¸­ä»»ä½•æ„é€ æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç›®æ ‡å®ä½“ä¸­çš„æ„é€ æ–¹æ³•ä¸ä¼šè¢«ä½¿ç”¨ã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<p>è‡ªå·±ç¼–å†™çš„ <code>@Default</code> æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.CONSTRUCTOR)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.CLASS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Default &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ª <code>Book</code> å®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†åˆ›å»ºä¸€ä¸ª <code>NovelDto</code>ï¼Œåç»­ä¼šå°† <code>Book</code> å¯¹è±¡è½¬æ¢ä¸º <code>NovelDto</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NovelDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Default</span></span><br><span class="line">    <span class="comment">// @ConstructorProperties æ³¨è§£æŒ‡å®šæ¥æºå¯¹è±¡çš„å±æ€§å</span></span><br><span class="line">    <span class="meta">@java</span>.beans.ConstructorProperties(&#123;<span class="string">&quot;bookName&quot;</span>, <span class="string">&quot;price&quot;</span>, <span class="string">&quot;author&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NovelDto</span><span class="params">(String book, Double price, String author)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookName = book;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">        <span class="built_in">this</span>.author = <span class="string">&quot;author&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NovelDto</span><span class="params">(String bookName, Double price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookName = bookName;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªç”¨äºå®ä½“æ˜ å°„çš„æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookMapper</span> &#123;</span><br><span class="line">    <span class="type">BookMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(BookMapper.class);</span><br><span class="line">    NovelDto <span class="title function_">toNovelDto</span><span class="params">(Book book)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testToNovel</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">    book.setBookName(<span class="string">&quot;Effective Java&quot;</span>);</span><br><span class="line">    book.setPrice(<span class="number">78.0</span>);</span><br><span class="line">    <span class="type">NovelDto</span> <span class="variable">novelDto</span> <span class="operator">=</span> BookMapper.INSTANCE.toNovelDto(book);</span><br><span class="line"></span><br><span class="line">    assertEquals(<span class="string">&quot;Effective Java&quot;</span>, novelDto.getBookName());</span><br><span class="line">    assertEquals(<span class="string">&quot;author&quot;</span>, novelDto.getAuthor());</span><br><span class="line">    assertEquals(<span class="number">78.0</span>, novelDto.getPrice(), <span class="number">0.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•æ–¹æ³•åï¼Œæµ‹è¯•é€šè¿‡ï¼</p>
<p>æŸ¥çœ‹ç”Ÿæˆçš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> NovelDto <span class="title function_">toNovelDto</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (book == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">bookName</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Double</span> <span class="variable">price</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">author</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        bookName = book.getBookName();</span><br><span class="line">        price = book.getPrice();</span><br><span class="line">        author = book.getAuthor();</span><br><span class="line">        <span class="type">NovelDto</span> <span class="variable">novelDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NovelDto</span>(bookName, price, author);</span><br><span class="line">        <span class="keyword">return</span> novelDto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ€»ç»“</p>
</blockquote>
<p>é€šè¿‡ç”Ÿæˆä»£ç æ¥çœ‹ï¼Œä½¿ç”¨åˆ°äº†åŸç›®æ ‡å®ä½“çš„ Getter æ–¹æ³•ï¼Œç”¨åˆ°äº†ç›®æ ‡å®ä½“çš„æ„é€ æ–¹æ³•ï¼Œå› æ­¤åœ¨ç¼–ç æ—¶éœ€è¦ä¿è¯å­˜åœ¨è¿™äº›æ–¹æ³• <strong>æ‰èƒ½ä½¿ç”¨æ„é€ å‡½æ•°è¿›è¡Œæ˜ å°„</strong>ã€‚</p>
<p>ä½¿ç”¨ MapStruct å°† <code>Book</code> å®ä½“è½¬æ¢æˆ <code>NovelDto</code> æ—¶ï¼Œåœ¨ <code>NovelDto</code> ä¸­æ²¡æœ‰ Setter æ–¹æ³•ï¼Œä½†å­˜åœ¨å¤šä¸ªæ„é€ æ–¹æ³•ï¼Œæœ€ç»ˆä¼šé€‰å–åˆé€‚çš„æ„é€ æ–¹æ³•è¿›è¡Œæ˜ å°„ã€‚</p>
<p>åœ¨ <code>NovelDto</code> å®ä½“ç±»ä¸­å­˜åœ¨ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œä¸”éƒ½æ˜¯å…¬å…±æœ‰å‚æ„é€ æ–¹æ³•ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ <code>@Default</code> è¿›è¡ŒæŒ‡æ˜è¦ä½¿ç”¨å“ªä¸ªæ„é€ æ–¹æ³•è¿›è¡Œæ˜ å°„ï¼Œå¦‚æœä¸æŒ‡æ˜å°±ä¼šåœ¨ç¼–è¯‘é˜¶æ®µæŠ¥é”™ã€‚</p>
<p>ä½†æ˜¯åœ¨ MapStruct ä¸­å¹¶æ²¡æœ‰æä¾› <code>@Default</code> æ³¨è§£ï¼Œé‚£æ€ä¹ˆåŠï¼ŸğŸ¤”</p>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://mapstruct.org/documentation/stable/reference/html/#non-shipped-annotations">14.1. Non-shipped annotations</a> çš„è¯´è¯ï¼Œåªè¦ä½¿ç”¨ä»»æ„ä¸€ä¸ªèƒ½å¤Ÿä½œç”¨åœ¨æ„é€ æ–¹æ³•ä¸”åä¸º <code>@Default</code> çš„æ³¨è§£å°±è¡Œï¼Œä¹Ÿå°±æ˜¯ä»»æ„ç¬¬ä¸‰æ–¹çš„ã€èƒ½ä½œç”¨äºæ„é€ æ–¹æ³•ä¸Šçš„ <code>@Default</code> æ³¨è§£éƒ½èƒ½å¤Ÿè¢« MapStruct è¯†åˆ«ï¼Œå¹¶å°†æ³¨è§£æ ‡è®°çš„æ„é€ æ–¹æ³•ä½œä¸ºæ˜ å°„çš„æ„é€ æ–¹æ³•ã€‚é‚£é—®é¢˜æ¥äº†ï¼Œåœ¨æ²¡æœ‰å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä¸”å½“å‰é¡¹ç›®ä¸­æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ <code>@Default</code> æ³¨è§£å’‹åŠï¼Ÿ</p>
<p>è‡ªå·±å†™ä¸€ä¸ªå°±è¡Œï¼ŒMapStruct ä¹Ÿèƒ½è¯†åˆ«ã€‚å…·ä½“å‚è§ä¸Šè¿°æä¾›çš„ä»£ç ã€‚ğŸ˜</p>
<p>ä½¿ç”¨ç›®æ ‡å®ä½“çš„æ„é€ æ–¹æ³•æ—¶ï¼Œä¼šä½¿ç”¨è¯¥æ„é€ æ–¹æ³•çš„å‚æ•°åå¹¶ä¸ <mark>æ¥æºå®ä½“</mark> çš„å±æ€§è¿›è¡ŒåŒ¹é…ã€‚<strong>åŠ¡å¿…ä¿è¯è¿™äº›åç§°æ˜¯ä¸€æ ·çš„ï¼Œå¦åˆ™æ— æ³•æ˜ å°„æˆåŠŸã€‚</strong> å½“ç„¶ï¼Œä¹Ÿä¸æ˜¯è¯´åç§°ä¸ä¸€æ ·å°±ä¸èƒ½æ˜ å°„ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ <code>@ConstructorProperties</code> æ³¨è§£ï¼Œä½¿ç”¨è¿™ä¸ªæ³¨è§£æŒ‡å®šæ„é€ æ–¹æ³•çš„ç¬¬å‡ ä¸ªå‚æ•°å¯¹åº”æ¥æºå¯¹è±¡çš„å“ªä¸ª Getter æ–¹æ³•ï¼Œä»è€Œå®Œæˆå‚æ•°åä¸å±æ€§çš„åŒ¹é…ã€‚</p>
<p>é‚£å¦‚æœç›®æ ‡å®ä½“çš„å±æ€§åå’ŒåŸå®ä½“çš„å±æ€§åä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿè¿™å°±éœ€è¦ç”¨åˆ°å‰é¢è¯´çš„ <code>@Mapping</code> æ³¨è§£äº†ã€‚ğŸ˜</p>
<p><strong>å¤‡æ³¨ï¼š</strong> è¿™ä¸€å—æˆ–è®¸æ¯”è¾ƒéš¾ç†è§£ï¼Œå»ºè®®ä½¿ç”¨ä¸Šè¿°ä»£ç è¿›è¡Œå°æ”¹ç„¶åä¸€ä¸€ç†è§£ã€‚ğŸ˜”</p>
<h2 id="2-12-å°†-Map-æ˜ å°„åˆ°å¯¹è±¡"><a class="header-anchor" href="#2-12-å°†-Map-æ˜ å°„åˆ°å¯¹è±¡"></a>2.12 å°† Map æ˜ å°„åˆ°å¯¹è±¡</h2>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦å°† <code>Map&lt;String, Object&gt;</code> æ˜ å°„åˆ°æŸä¸ªå¯¹è±¡ï¼ŒMapStruct ä¹Ÿæ˜¯æ”¯æŒè¿™ç§éœ€æ±‚çš„ï¼Œæ­¤æ—¶ <code>@Mapping</code> ä¸­çš„ <code>source</code> å±æ€§å€¼ä¸º <code>Map</code> ä¸­çš„ keyï¼ˆæŠŠ <code>Map</code> å½“æˆä¸€ä¸ªæ²¡æœ‰ç‰¹å®šç±»å‹çš„å¯¹è±¡ï¼‰ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CustomerMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(target = &quot;name&quot;, source = &quot;customerName&quot;)</span></span><br><span class="line">    Customer <span class="title function_">toCustomer</span><span class="params">(Map&lt;String, String&gt; map)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">CustomerMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Customer <span class="title function_">toCustomer</span><span class="params">(Map&lt;String, String&gt; map)</span> &#123;</span><br><span class="line">        <span class="comment">// --snip--</span></span><br><span class="line">        <span class="keyword">if</span> ( map.containsKey( <span class="string">&quot;customerName&quot;</span> ) ) &#123;</span><br><span class="line">            customer.setName( map.get( <span class="string">&quot;customerName&quot;</span> ) );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// --snip--</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ä½¿ç”¨ raw mapï¼ˆæ²¡æœ‰æŒ‡å®šæ³›å‹çš„ <code>Map</code>ï¼‰ æˆ–æ²¡æœ‰å­—ç¬¦ä¸²ä½œä¸ºé”®çš„ <code>Map</code> æ—¶ï¼Œå°†ç”Ÿæˆè­¦å‘Šã€‚å¦‚æœ <code>Map</code> æœ¬èº«ç›´æ¥æ˜ å°„åˆ°å…¶ä»–ç›®æ ‡å±æ€§ï¼Œåˆ™ä¸ä¼šç”Ÿæˆè­¦å‘Šã€‚</p>
<h1 id="3-è·å–æ˜ å°„å™¨"><a class="header-anchor" href="#3-è·å–æ˜ å°„å™¨"></a>3. è·å–æ˜ å°„å™¨</h1>
<h2 id="3-1-æ˜ å°„å™¨å·¥å‚"><a class="header-anchor" href="#3-1-æ˜ å°„å™¨å·¥å‚"></a>3.1 æ˜ å°„å™¨å·¥å‚</h2>
<p>å½“æ²¡æœ‰ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ˆæ¯”å¦‚ Springï¼‰æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>org.mapstruct.factory.Mappers</code> ç±»æ¥è·å–ä¸€ä¸ªæ˜ å°„å™¨ï¼ˆMapperï¼‰å®ä¾‹ã€‚</p>
<p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong> è°ƒç”¨è¯¥ç±»çš„ <code>Mappers#getMapper()</code> æ–¹æ³•ï¼Œä¼ å…¥è¦è¿”å›çš„ Mapper æ¥å£ç±»å‹ã€‚</p>
<p>é€šå¸¸æ¥è¯´ï¼Œä¹ æƒ¯äºå°†æ˜ å°„å™¨å®ä¾‹å‘½åä¸º <code>INSTANCE</code>ã€‚</p>
<p>åœ¨å‰æ–‡ä¸­ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨æ¥å£æ¥å®šä¹‰æ˜ å°„å™¨ï¼Œè€Œåœ¨æŠ½è±¡ç±»ä¸­åº”è¯¥è¿™æ ·å®šä¹‰æ˜ å°„å™¨ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">CarMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(CarMapper.class);</span><br><span class="line">    CarDto <span class="title function_">carToCarDto</span><span class="params">(Car car)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ¨¡å¼ä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥éå¸¸å®¹æ˜“åœ°ä½¿ç”¨æ˜ å°„å™¨å¯¹è±¡ï¼Œè€Œä¸éœ€è¦é‡å¤å®ä¾‹åŒ–æ–°çš„å®ä¾‹ã€‚</p>
<p>MapStruct ç”Ÿæˆçš„æ˜ å°„å™¨æ˜¯æ— çŠ¶æ€å’Œçº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚</p>
<h2 id="3-2-ä½¿ç”¨ä¾èµ–æ³¨å…¥"><a class="header-anchor" href="#3-2-ä½¿ç”¨ä¾èµ–æ³¨å…¥"></a>3.2 ä½¿ç”¨ä¾èµ–æ³¨å…¥</h2>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ˆæ¯”å¦‚ï¼šSpringï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦é€šè¿‡ä¾èµ–æ³¨å…¥è€Œä¸æ˜¯é€šè¿‡ <code>Mappers#getMapper()</code> æ¥è·å–æ˜ å°„å™¨å¯¹è±¡ã€‚å¯ä»¥é€šè¿‡ <code>@Mapper</code> çš„ <code>componentModel</code> å±æ€§æˆ–ä½¿ç”¨é…ç½®é€‰é¡¹ä¸­æè¿°çš„ <a target="_blank" rel="noopener" href="https://mapstruct.org/documentation/stable/reference/html/#configuration-options">Configuration options</a> æŒ‡å®šç”Ÿæˆçš„æ˜ å°„å™¨ç±»åº”åŸºäºçš„ç»„ä»¶æ¨¡å‹ã€‚</p>
<p>ç›®å‰ï¼ŒMapStruct æ”¯æŒ CDI å’Œ Spring ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ‰€éœ€çš„æ³¨è§£å°†è¢«æ·»åŠ åˆ°ç”Ÿæˆçš„æ˜ å°„å™¨å®ç°ç±»ä¸­ï¼Œä»¥ä¾¿ä½¿å…¶åŒæ ·å—åˆ°ä¾èµ–æ³¨å…¥çš„å½±å“ã€‚</p>
<p><code>@Mapper#componentModel</code> å±æ€§æˆ– <code>mapstruct.defaultComponentModel</code> é…ç½®é€‰é¡¹æ”¯æŒçš„å€¼ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">å€¼</th>
<th style="text-align:center">æ³¨å…¥æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>default</code></td>
<td style="text-align:center">é»˜è®¤æ–¹å¼ï¼Œæ˜ å°„å™¨ä¸ä½¿ç”¨ç»„ä»¶æ¨¡å‹ï¼Œä½¿ç”¨ <code>Mappers.getMapper(Class)</code> æ¥è¿›è¡Œè·å–æ˜ å°„å™¨å®ä¾‹</td>
</tr>
<tr>
<td style="text-align:center"><code>cdi</code></td>
<td style="text-align:center">ç”Ÿæˆçš„æ˜ å°„å™¨æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºèŒƒå›´çš„ CDI Beanï¼Œä½¿ç”¨ <code>@Inject</code> æ³¨å…¥</td>
</tr>
<tr>
<td style="text-align:center"><code>spring</code></td>
<td style="text-align:center">ç”Ÿæˆçš„æ˜ å°„å™¨æ˜¯ä¸€ä¸ªå•ä¾‹çš„ Spring Beanï¼Œä½¿ç”¨ <code>@Autowired</code> æ³¨å…¥</td>
</tr>
<tr>
<td style="text-align:center"><code>jsr330</code></td>
<td style="text-align:center">ç”Ÿæˆçš„æ˜ å°„å™¨ä¸­è¢« <code>@Named</code> æ³¨è§£æ ‡è®°ï¼Œä½¿ç”¨ <code>@Inject</code> æ³¨å…¥</td>
</tr>
<tr>
<td style="text-align:center"><code>jakarta</code></td>
<td style="text-align:center">ç”Ÿæˆçš„æ˜ å°„å™¨ä¸­è¢« <code>@Named</code> æ³¨è§£æ ‡è®°ï¼Œä½¿ç”¨ <code>jakarta.inject.@Inject</code> æ³¨å…¥ï¼ˆsince 1.5.0.Finalï¼‰</td>
</tr>
</tbody>
</table>
<p>ä» MapStruct 1.5.0.Final å¼€å§‹ï¼Œè¿™äº›å€¼åœ¨ <code>org.mapstruct.MappingConstants.ComponentModel</code> ç±»ä¸­ä»¥å¸¸é‡çš„å½¢å¼å­˜åœ¨ã€‚</p>
<p>å½“ <code>mapstruct.defaultComponentModel</code> é…ç½®é€‰é¡¹å’Œ <code>@Mapper#componentModel</code> åŒæ—¶æŒ‡å®šäº†å€¼ï¼Œä»¥ <code>@Mapper</code> æ³¨è§£çš„ä¸ºå‡†ã€‚</p>
<p>ä½¿ç”¨å…¶ä»–æ˜ å°„å™¨ç±»çš„æ˜ å°„å™¨å°†ä½¿ç”¨é…ç½®çš„ç»„ä»¶æ¨¡å‹è·å¾—è¿™äº›æ˜ å°„å™¨ã€‚æ¯”å¦‚ï¼Œæ˜ å°„å™¨ A æ˜¯ä¸€ä¸ª Spring Beanï¼Œæ˜ å°„å™¨ A ä¸­æ³¨å…¥äº†æ˜ å°„å™¨ Bï¼Œé‚£ä¹ˆæ˜ å°„å™¨ B ä¹Ÿå¿…é¡»æ˜¯ä¸€ä¸ªå¯æ³¨å…¥çš„ Spring Beanã€‚</p>
<h2 id="3-3-æ³¨å…¥ç­–ç•¥"><a class="header-anchor" href="#3-3-æ³¨å…¥ç­–ç•¥"></a>3.3 æ³¨å…¥ç­–ç•¥</h2>
<p>ä½¿ç”¨ä¾èµ–æ³¨å…¥æ—¶ï¼Œå¯ä»¥æŒ‡å®šæ³¨å…¥ç­–ç•¥ã€‚</p>
<p>å¯ä»¥é€šè¿‡ <code>@Mapper</code> å’Œ <code>@MapperConfig</code> æ³¨è§£çš„ <code>injectionStrategy</code> å±æ€§æˆ– <code>mapstruct.defaultInjectionStrategy</code> æ¥æŒ‡å®šæ³¨å…¥ç­–ç•¥ã€‚æ³¨å…¥ç­–ç•¥æœ‰ä¸¤ç§ï¼šæ„é€ æ–¹æ³•å’Œå±æ€§æ³¨å…¥ï¼Œ é»˜è®¤æ˜¯å±æ€§æ³¨å…¥ã€‚</p>
<p>é’ˆå¯¹ <code>@Mapper</code> çš„ <code>injectionStrategy</code> å±æ€§æ¥è¯´ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ªæšä¸¾ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">InjectionStrategy</span> &#123;</span><br><span class="line">    <span class="comment">/** Annotations are written on the field **/</span></span><br><span class="line">    FIELD,</span><br><span class="line">    <span class="comment">/** Annotations are written on the constructor **/</span></span><br><span class="line">    CONSTRUCTOR</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>ä½¿ç”¨å±æ€§æ³¨å…¥æ—¶ï¼Œä¾èµ–å…³ç³»å°†è¢«æ³¨å…¥åˆ°å­—æ®µä¸­ã€‚</li>
<li>ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥æ—¶ï¼Œå°†ç”Ÿæˆæ„é€ å‡½æ•°ï¼Œä¾èµ–å…³ç³»å°†é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ã€‚</li>
</ol>
<p>å¦‚æœ MapStruct æ£€æµ‹åˆ° <strong>éœ€è¦ä½¿ç”¨</strong> <code>@Mapper#uses</code> å±æ€§çš„å®ä¾‹è¿›è¡Œæ˜ å°„ï¼Œåˆ™ç”Ÿæˆçš„æ˜ å°„å™¨å°†æ³¨å…¥åœ¨ <code>uses</code> å±æ€§ä¸­å®šä¹‰çš„ç±»ã€‚æ³¨æ„ <strong>éœ€è¦ä½¿ç”¨</strong> å‡ ä¸ªå­—ï¼Œå¦‚æœå‚ä¸æ˜ å°„å­—æ®µä¸éœ€è¦ä½¿ç”¨æŒ‡å®šç±»å‹å¯¹åº”çš„å®ä¾‹è¿›è¡Œæ˜ å°„ï¼Œé‚£ä¹ˆç”Ÿæˆçš„æ˜ å°„å™¨ä¸ä¼šæ³¨å…¥ <code>uses</code> å±æ€§ä¸­å®šä¹‰çš„ç±»ã€‚</p>
<p>å¯¹äºæŠ½è±¡ç±»æˆ–è£…é¥°å™¨åº”ä½¿ç”¨å±æ€§æ³¨å…¥ï¼Œå› ä¸ºå®ƒä»¬ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<p>ä½¿ç”¨æœ€å¼€å§‹çš„ <code>Car</code> å’Œ <code>CarDto</code> ä¸¤ä¸ªå®ä½“è¿›è¡Œæµ‹è¯•ï¼Œçœç•¥å®ä½“ä»£ç ã€‚</p>
<p>å¯¼å…¥ Spring æ‰€éœ€è¦çš„ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç¼–å†™ä¸€ä¸ª <code>SpringConfig</code> é…ç½®ç±»ï¼Œä¸»è¦ç”¨äºæ‰«æåŒ…ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;indi.mofan.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–å†™æ˜ å°„å™¨ï¼Œä½¿ç”¨ Spring çš„ä¾èµ–æ³¨å…¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper(componentModel = &quot;spring&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarInjectMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;numberOfSeats&quot;, target = &quot;seatCount&quot;)</span></span><br><span class="line">    CarDto <span class="title function_">carToCarDto</span><span class="params">(Car car)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç±»ä¸æµ‹è¯•æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DependencyInjectionTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CarInjectMapper carInjectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shouldMapCarToDto</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;Morris&quot;</span>, <span class="number">5</span>, <span class="string">&quot;Sedan&quot;</span>);</span><br><span class="line">        <span class="type">CarDto</span> <span class="variable">carDto</span> <span class="operator">=</span> carInjectMapper.carToCarDto(car);</span><br><span class="line">        assertEquals(<span class="string">&quot;Morris&quot;</span>, carDto.getMake());</span><br><span class="line">        assertEquals(<span class="number">5</span>, carDto.getSeatCount());</span><br><span class="line">        assertEquals(<span class="string">&quot;Sedan&quot;</span>, carDto.getType());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ç”Ÿæˆçš„å®ç°ç±» <code>CarInjectMapperImpl</code>ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»è¢« Spring çš„ <code>@Component</code> æ³¨è§£æ ‡è®°ã€‚</p>
<h1 id="4-æ•°æ®ç±»å‹è½¬æ¢"><a class="header-anchor" href="#4-æ•°æ®ç±»å‹è½¬æ¢"></a>4. æ•°æ®ç±»å‹è½¬æ¢</h1>
<p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼ŒMapStruct ä¼šè‡ªåŠ¨å¤„ç†ç±»å‹è½¬æ¢ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸€ä¸ªå±æ€§åœ¨æº Bean ä¸­æ˜¯ <code>int</code> ç±»å‹ï¼Œä½†åœ¨ç›®æ ‡ Bean ä¸­æ˜¯ <code>String</code> ç±»å‹ï¼Œé€šè¿‡ç”Ÿæˆçš„ä»£ç å¯ä»¥çœ‹åˆ°åˆ†åˆ«è°ƒç”¨ <code>String.valueOf(int)</code> å’Œ <code>Integer.parseInt(String)</code> ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œäº†ç±»å‹çš„è½¬æ¢ã€‚</p>
<p>åˆæ¯”å¦‚åœ¨ <code>Car</code> ç±»å‹ä¸­æœ‰ä¸€ä¸ª <code>Person</code> ç±»å‹çš„ <code>driver</code> å±æ€§ï¼Œå½“å¯¹ <code>Car</code> è¿›è¡Œæ˜ å°„æ—¶ï¼Œåº”å½“æŠŠ <code>driver</code> æ˜ å°„ä¸º <code>PersonDto</code> ç±»å‹ã€‚</p>
<h2 id="4-1-éšå¼ç±»å‹è½¬æ¢"><a class="header-anchor" href="#4-1-éšå¼ç±»å‹è½¬æ¢"></a>4.1 éšå¼ç±»å‹è½¬æ¢</h2>
<p>åœ¨æ­¤åˆ—ä¸¾ä¸€äº›å¸¸è§çš„è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼š</p>
<ul>
<li>Java åŸºæœ¬æ•°æ®ç±»å‹å’Œå…¶å¯¹åº”çš„åŒ…è£…ç±»ä¹‹é—´ã€‚æŠŠåŒ…è£…ç±»è½¬æ¢æˆåŸºæœ¬æ•°æ®ç±»å‹æ—¶ï¼Œä¼šæ‰§è¡Œ <code>null</code> å€¼æ£€æŸ¥ã€‚</li>
<li>Java åŸºæœ¬æ•°æ®ç±»å‹å’Œå°è£…ç±»å‹ä¹‹é—´ã€‚ä¾‹å¦‚ <code>int</code> å’Œ <code>long</code> ä¹‹é—´æˆ– <code>byte</code> å’Œ <code>Integer</code> ä¹‹é—´ã€‚</li>
</ul>
<p><mark>æ³¨æ„ï¼š</mark> ä»ç²¾åº¦è¾ƒå¤§ç±»å‹çš„æ•°æ®è½¬æ¢ä¸ºç²¾åº¦è¾ƒå°çš„æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šé€ æˆå€¼æˆ–ç²¾åº¦ç¼ºå¤±ï¼ˆä¾‹å¦‚ä» <code>long</code> è½¬æ¢ä¸º <code>int</code>ï¼‰ã€‚<code>@Mapper</code> å’Œ <code>@MapperConfig</code> æ³¨è§£æœ‰ä¸€ä¸ªå±æ€§ <code>typeConversionPolicy</code> æ¥æ§åˆ¶è­¦å‘Šæˆ–é”™è¯¯ï¼Œå…¶é»˜è®¤å€¼ä¸º <code>ReportingPolicy.IGNORE</code>ã€‚</p>
<ul>
<li>åŸºæœ¬æ•°æ®ç±»å‹åŠå…¶åŒ…è£…ç±»å’Œ <code>String</code> ä¹‹é—´ã€‚å¯ä»¥åœ¨ <code>@Mapping</code> çš„ <code>numberFormat</code> å±æ€§ä¸­æŒ‡å®š <code>java.text.DecimalFormat</code> èƒ½ç†è§£çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å¯¹æ•°å€¼æ ¼å¼åŒ–ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;price&quot;, numberFormat = &quot;$#.00&quot;)</span></span><br><span class="line">    CarDto <span class="title function_">carToCarDto</span><span class="params">(Car car)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IterableMapping(numberFormat = &quot;$#.00&quot;)</span></span><br><span class="line">    List&lt;String&gt; <span class="title function_">prices</span><span class="params">(List&lt;Integer&gt; prices)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>enum</code> å’Œ <code>String</code> ä¹‹é—´ã€‚</p>
</li>
<li>
<p>å¤§æ•°ç±»å‹ï¼ˆ<code>java.math.BigInteger</code>ï¼Œ<code>java.math.BigDecimal</code>ï¼‰å’ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼ˆåŠå…¶åŒ…è£…ç±»ï¼‰ä»¥åŠ <code>String</code> ä¹‹é—´ã€‚åŒæ ·å¯ä»¥ä½¿ç”¨ <code>@Mapping</code> çš„ <code>numberFormat </code> å±æ€§å¯¹æ•°å€¼æ ¼å¼åŒ–ã€‚</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;power&quot;, numberFormat = &quot;#.##E0&quot;)</span></span><br><span class="line">    CarDto <span class="title function_">carToCarDto</span><span class="params">(Car car)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>JAXBElement&lt;T&gt;</code> å’Œ <code>T</code> ä¹‹é—´ï¼Œ<code>List&lt;JAXBElement&lt;T&gt;&gt;</code> å’Œ <code>List&lt;T&gt;</code> ä¹‹é—´ã€‚</li>
<li><code>java.util.Calendar</code> æˆ– <code>java.util.Date</code> å’Œ JAXB çš„ <code>XMLGregorianCalendar</code> ä¹‹é—´ã€‚</li>
<li><code>java.util.Date</code> æ—¥æœŸç±»å‹æˆ– <code>XMLGregorianCalendar</code> å’Œ <code>String</code> ä¹‹é—´ã€‚å¯ä»¥åœ¨ <code>@Mapping</code> çš„ <code>dateFormat</code> å±æ€§ä¸­æŒ‡å®š <code>java.text.SimpleDateFormat</code> èƒ½ç†è§£çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å¯¹æ—¥æœŸå­—ç¬¦ä¸²æ ¼å¼åŒ–ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;manufacturingDate&quot;, dateFormat = &quot;dd.MM.yyyy&quot;)</span></span><br><span class="line">    CarDto <span class="title function_">carToCarDto</span><span class="params">(Car car)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@IterableMapping(dateFormat = &quot;dd.MM.yyyy&quot;)</span></span><br><span class="line">    List&lt;String&gt; <span class="title function_">stringListToDateList</span><span class="params">(List&lt;Date&gt; dates)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>Jodas ä¸­çš„æ—¥æœŸæ—¶é—´ç±»å‹ï¼ˆ<code>DateTime</code>ã€<code>LocalDateTime</code>ã€<code>LocalDate</code>ã€<code>LocalTime</code>ï¼‰å’Œ <code>String</code> ä¹‹é—´ã€‚å¯ä»¥ä½¿ç”¨ <code>@Mapping</code> çš„ <code>dateFormat</code> å±æ€§å¯¹æ•°å€¼è¿›è¡Œæ ¼å¼åŒ–ã€‚</p>
</li>
<li>
<p>Jodas çš„ <code>DateTime</code> ç±»å‹å’Œ <code>javax.xml.datatype.XMLGregorianCalendar</code>ã€<code>java.util.Calendar</code> ä¹‹é—´ã€‚</p>
</li>
<li>
<p>Jodas çš„ <code>LocalDateTime</code>ã€<code>LocalDate</code> å’Œ <code>javax.xml.datatype.XMLGregorianCalendar</code>ã€<code>java.util.Date</code> ä¹‹é—´ã€‚</p>
</li>
<li>
<p><code>java.time.LocalDate</code>ã€<code>java.time.LocalDateTime</code> å’Œ <code>javax.xml.datatype.XMLGregorianCalendar</code> ä¹‹é—´ã€‚</p>
</li>
<li>
<p>Java 8 æ—¥æœŸæ—¶é—´ç±»å‹ï¼ˆ<code>ZonedDateTime</code>ã€<code>LocalDateTime</code>ã€<code>LocalDate</code>ã€<code>LocalTime</code>ï¼‰å’Œ <code>String</code> ä¹‹é—´ã€‚å¯ä»¥ä½¿ç”¨ <code>@Mapping</code> çš„ <code>dateFormat</code> å±æ€§å¯¹æ•°å€¼è¿›è¡Œæ ¼å¼åŒ–ã€‚</p>
</li>
<li>
<p>Java 8 æ—¥æœŸç±»å‹ï¼ˆ<code>Instant</code>ã€<code>Duration</code>ã€<code>Period</code>ï¼‰å’Œ <code>String</code> ä¹‹é—´ã€‚</p>
</li>
<li>
<p>Java 8 çš„ <code>ZonedDateTime</code> ç±»å‹å’Œ <code>Date</code> ä¹‹é—´ï¼Œå½“ä»ç»™å®šçš„ <code>Date</code> è½¬æ¢æˆ <code>ZonedDateTime</code> æ—¶ï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤æ—¶åŒºã€‚</p>
</li>
<li>
<p>Java 8 çš„ <code>LocalDateTime</code> ç±»å‹å’Œ <code>Date</code> ä¹‹é—´ï¼Œä½¿ç”¨ UTC ä½œä¸ºæ—¶åŒºã€‚</p>
</li>
<li>
<p>Java 8 çš„ <code>LocalDate</code> ç±»å‹å’Œ <code>java.util.Date</code>ã€<code>java.sql.Date</code> ä¹‹é—´ï¼Œä½¿ç”¨ UTC ä½œä¸ºæ—¶åŒºã€‚</p>
</li>
<li>
<p>Java 8 çš„ <code>Instant</code> ç±»å‹å’Œ <code>Date</code> ä¹‹é—´ã€‚</p>
</li>
<li>
<p>Java 8 çš„ <code>ZonedDateTime</code> ç±»å‹å’Œ <code>Calendar</code> ä¹‹é—´ã€‚</p>
</li>
<li>
<p><code>java.sql.Date</code>ã€<code>java.sql.Time</code>ã€<code>java.sql.Timestamp</code> å’Œ <code>java.util.Date</code> ä¹‹é—´ã€‚</p>
</li>
<li>
<p>å½“ä»ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æ—¶ï¼Œå¦‚æœçœç•¥ <code>@Mapping</code> æ³¨è§£çš„ <code>dateFormat</code>ï¼Œä¼šä½¿ç”¨é»˜è®¤çš„æ ¼å¼å’Œç¬¦å·æ¥è½¬æ¢ï¼Œä½† <code>XmlGregorianCalendar</code> æ˜¯ä¸ªä¾‹å¤–ï¼Œå°†æ ¹æ® <a target="_blank" rel="noopener" href="http://www.w3.org/TR/xmlschema-2/#dateTime">XML Schema 1.0 Part 2, Section 3.2.7-14.1, Lexical Representation</a></p>
</li>
<li>
<p><code>java.util.Currency</code> å’Œ <code>String</code> ä¹‹é—´ã€‚å½“ä»ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æ—¶ï¼Œå…¶å€¼åº”ç¬¦åˆ ISO-4217 è§„èŒƒï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>IllegalArgumentException</code> å¼‚å¸¸ã€‚</p>
</li>
<li>
<p><code>java.util.UUID</code> å’Œ <code>String</code> ä¹‹é—´ã€‚å½“ä»ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æ—¶ï¼Œå…¶å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ UUIDï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>IllegalArgumentException</code> å¼‚å¸¸ã€‚</p>
</li>
<li>
<p><code>String</code> å’Œ <code>StringBuilder</code> ä¹‹é—´ã€‚</p>
</li>
<li>
<p><code>java.net.URL</code> å’Œ <code>String</code> ä¹‹é—´ã€‚å½“ä»ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢æ—¶ï¼Œå…¶å€¼åº”è¯¥æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ URLï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>MalformedURLException</code> å¼‚å¸¸ã€‚</p>
</li>
</ul>
<h2 id="4-2-æ˜ å°„å¯¹è±¡å¼•ç”¨"><a class="header-anchor" href="#4-2-æ˜ å°„å¯¹è±¡å¼•ç”¨"></a>4.2 æ˜ å°„å¯¹è±¡å¼•ç”¨</h2>
<p>é€šå¸¸ï¼Œä¸€ä¸ªå¯¹è±¡ä¸ä»…å…·æœ‰åŸºæœ¬æ•°æ®ç±»å‹çš„å±æ€§ï¼Œè¿˜å¼•ç”¨å…¶ä»–å¯¹è±¡ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª <code>Cage</code> å®ä½“å†…éƒ¨å«æœ‰ <code>Animal</code> ç±»å‹çš„å±æ€§ï¼Œè¡¨ç¤ºç¬¼å­é‡Œå…³ç€çš„åŠ¨ç‰©ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¹Ÿåªéœ€ä¸ºå¼•ç”¨çš„å¯¹è±¡ç±»å‹å®šä¹‰ä¸€ä¸ªæ˜ å°„æ–¹æ³•ã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Cage</code> å®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cage</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String size;</span><br><span class="line">    <span class="keyword">private</span> Animal animal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°†æ˜ å°„æˆçš„ <code>CageDto</code> å®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CageDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String size;</span><br><span class="line">    <span class="keyword">private</span> DogDto dog;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨äºå®ä½“æ˜ å°„çš„æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CageMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">CageMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(CageMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;animal&quot;, target = &quot;dog&quot;)</span></span><br><span class="line">    CageDto <span class="title function_">toCageDto</span><span class="params">(Cage cage)</span>;</span><br><span class="line"></span><br><span class="line">    DogDto <span class="title function_">toDogDto</span><span class="params">(Animal animal)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testToCageDto</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Cage</span> <span class="variable">cage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cage</span>();</span><br><span class="line">    <span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;å°é»‘&quot;</span>, <span class="string">&quot;Dog&quot;</span>);</span><br><span class="line">    cage.setAnimal(animal);</span><br><span class="line">    cage.setName(<span class="string">&quot;å°é»‘çš„å®¶&quot;</span>);</span><br><span class="line">    cage.setSize(<span class="string">&quot;70*50*60&quot;</span>);</span><br><span class="line">    <span class="type">CageDto</span> <span class="variable">cageDto</span> <span class="operator">=</span> CageMapper.INSTANCE.toCageDto(cage);</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;å°é»‘çš„å®¶&quot;</span>, cageDto.getName());</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;70*50*60&quot;</span>, cageDto.getSize());</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;å°é»‘&quot;</span>, cageDto.getDog().getName());</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;Dog&quot;</span>, cageDto.getDog().getType());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•æ–¹æ³•åï¼Œæµ‹è¯•é€šè¿‡ã€‚</p>
<p>æŸ¥çœ‹ç”Ÿæˆçš„å®ç°ç±» <code>CageMapperImpl</code> æ¥å£å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CageMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">CageMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CageDto <span class="title function_">toCageDto</span><span class="params">(Cage cage)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( cage == <span class="literal">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">CageDto</span> <span class="variable">cageDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CageDto</span>();</span><br><span class="line"></span><br><span class="line">        cageDto.setDog( toDogDto( cage.getAnimal() ) );</span><br><span class="line">        cageDto.setName( cage.getName() );</span><br><span class="line">        cageDto.setSize( cage.getSize() );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cageDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DogDto <span class="title function_">toDogDto</span><span class="params">(Animal animal)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( animal == <span class="literal">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">DogDtoBuilder</span> <span class="variable">dogDto</span> <span class="operator">=</span> DogDto.builder();</span><br><span class="line"></span><br><span class="line">        dogDto.name( animal.getName() );</span><br><span class="line">        dogDto.type( animal.getType() );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dogDto.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MapStruct å¯¹æºå¯¹è±¡ä¸ç›®æ ‡å¯¹è±¡å±æ€§çš„æ˜ å°„è§„åˆ™</p>
</blockquote>
<ol>
<li>
<p>å¦‚æœæºå±æ€§å’Œç›®æ ‡å±æ€§ç±»å‹ç›¸åŒï¼Œå€¼å°†ç›´æ¥ä»æºå¤åˆ¶åˆ°ç›®æ ‡ã€‚å¦‚æœå±æ€§æ˜¯ä¸€ä¸ªé›†åˆï¼ˆå¦‚ <code>List</code>ï¼‰ï¼Œé›†åˆçš„å‰¯æœ¬ï¼ˆæ–°å»ºä¸€ä¸ªé›†åˆï¼Œç„¶åæŠŠæºæ•°æ®ä¸€ä¸ªä¸ªåœ°å¡è¿›å»ï¼‰å°†è¢«è®¾ç½®åˆ°ç›®æ ‡å±æ€§ä¸­ã€‚</p>
</li>
<li>
<p>å¦‚æœæºå±æ€§å’Œç›®æ ‡å±æ€§ç±»å‹ä¸åŒï¼Œå°†åœ¨å½“å‰ç±»æ£€æŸ¥æ˜¯å¦å­˜åœ¨å°†æºå±æ€§çš„ç±»å‹ä½œä¸ºå‚æ•°ç±»å‹ï¼Œå°†ç›®æ ‡å±æ€§çš„ç±»å‹ä½œä¸ºè¿”å›ç±»å‹çš„å¦ä¸€ç§æ˜ å°„æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨è¿™æ ·çš„æ–¹æ³•ï¼Œå®ƒå°†åœ¨ç”Ÿæˆçš„å®ç°æ–¹æ³•ä¸­è¢«è°ƒç”¨ã€‚</p>
</li>
<li>
<p>å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„æ–¹æ³•ï¼ŒMapStruct å°†æŸ¥çœ‹æºå±æ€§ç±»å‹å’Œç›®æ ‡å±æ€§ç±»å‹æ˜¯å¦å­˜åœ¨å†…ç½®è½¬æ¢ã€‚å¦‚æœå­˜åœ¨ï¼Œç”Ÿæˆçš„ä»£ç å°†é‡‡ç”¨è¿™ç§è½¬æ¢ã€‚</p>
</li>
<li>
<p>å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„æ–¹æ³•ï¼ŒMapStruct å°†é‡‡ç”¨å¤æ‚çš„è½¬æ¢ï¼š</p>
<ul>
<li>æ˜ å°„æ–¹æ³•ï¼Œé€šè¿‡æ˜ å°„æ–¹æ³•æ˜ å°„ç»“æœï¼Œæ¯”å¦‚ï¼š<code>target = method1(method2(source))</code></li>
<li>å†…ç½®è½¬æ¢ï¼Œé€šè¿‡æ˜ å°„æ–¹æ³•æ˜ å°„ç»“æœï¼Œæ¯”å¦‚ï¼š<code>target = method(conversion(source))</code></li>
<li>æ˜ å°„æ–¹æ³•ï¼Œé€šè¿‡å†…ç½®è½¬æ¢æ˜ å°„ç»“æœï¼Œæ¯”å¦‚ï¼š<code>target = conversion(method(source))</code></li>
</ul>
</li>
<li>
<p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™æ ·çš„æ–¹æ³•ï¼ŒMapStruct å°†å°è¯•ç”Ÿæˆä¸€ä¸ªè‡ªåŠ¨çš„ <code>sub-mapping</code> æ–¹æ³•ï¼Œä½¿ç”¨æ–¹æ³•è¿›è¡Œæºå±æ€§å’Œç›®æ ‡å±æ€§ä¹‹é—´çš„æ˜ å°„ã€‚</p>
</li>
<li>
<p>å¦‚æœ MapStruct æ— æ³•åˆ›å»ºåŸºäºåç§°çš„æ˜ å°„æ–¹æ³•ï¼Œåˆ™ä¼šåœ¨ç¼–è¯‘æ—¶å¼•å‘é”™è¯¯ï¼Œæ˜¾ç¤ºä¸å¯æ˜ å°„çš„å±æ€§åŠå…¶è·¯å¾„ã€‚</p>
</li>
</ol>
<p>å¯ä»¥åœ¨ä»¥ä¸‹å››ä¸ªæ³¨è§£ä¸Šè®¾ç½® <code>mappingControl</code>ï¼ˆæ˜ å°„æ§ä»¶ï¼‰ï¼Œä¼˜å…ˆçº§ä¾æ¬¡å¢åŠ ï¼š</p>
<ul>
<li>@MapperConfig</li>
<li>@Mapper</li>
<li>@BeanMapping</li>
<li>@Mapping</li>
</ul>
<p>æ¯”å¦‚ <code>@Mapper(mappingControl = NoComplexMapping.class)</code> çš„ä¼˜å…ˆçº§é«˜äº <code>@MapperConfig(mappingControl = DeepClone.class)</code>ã€‚</p>
<p><code>@IterableMapping</code> å’Œ <code>@MapMapping</code> çš„å·¥ä½œåŸç†ä¸ <code>@Mapping</code> ç±»ä¼¼ã€‚</p>
<p>æ˜ å°„æ§ä»¶æ˜¯åœ¨ MapStruct 1.4 ä¸­å¼•å…¥çš„å®éªŒæ€§åŠŸèƒ½ã€‚</p>
<p>æ˜ å°„æ§ä»¶çš„ç±»å‹ç”±æšä¸¾ <code>org.mapstruct.control.MappingControl.Use</code> è¡¨ç¤ºï¼š</p>
<ul>
<li>BUILT_IN_CONVERSION</li>
<li>COMPLEX_MAPPING</li>
<li>DIRECT</li>
<li>MAPPING_METHOD</li>
</ul>
<p>æšä¸¾ <code>Use</code> çš„å­˜åœ¨ä½¿å¾—ç”¨æˆ·å¯ä»¥å¯¹ MapStruct çš„æ˜ å°„ç»†èŠ‚è¿›è¡Œæ§åˆ¶ï¼Œå½“ç¼ºå¤±æŸç§æšä¸¾æ—¶ï¼Œè¡¨ç¤ºå…³é—­å¯¹åº”çš„æ˜ å°„æ–¹å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ <code>mappingControl = MappingControl.class</code>ï¼Œè¡¨ç¤ºå¯ç”¨æ‰€æœ‰æ˜ å°„é€‰é¡¹ã€‚</p>
<blockquote>
<p>å±æ€§é—´åº”ç”¨æ‹“å±•</p>
</blockquote>
<ol>
<li>å¦‚æœä¸æƒ³è®© MapStruct ç”Ÿæˆè‡ªåŠ¨çš„ <code>sub-mapping</code> æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(disableSubMappingMethodsGeneration = true)</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ç”¨æˆ·å¯ä»¥é€šè¿‡å…ƒæ³¨è§£æ¥æ§åˆ¶æ˜ å°„ã€‚æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„æ³¨è§£ï¼Œæ¯”å¦‚ <code>@DeepClone</code> åªå…è®¸ç›´æ¥æ˜ å°„ã€‚ä½¿ç”¨è¯¥æ³¨è§£åï¼Œå¦‚æœæºç±»å‹å’Œç›®æ ‡ç±»å‹ç›¸åŒï¼ŒMapStruct å°†å¯¹æºç±»å‹è¿›è¡Œæ·±æ‹·è´ã€‚<code>sub-mappings-methods</code> å¿…é¡»è¢«å…è®¸ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ã€‚</li>
<li>åœ¨è‡ªåŠ¨çš„ <code>sub-mapping</code> æ–¹æ³•ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œå…±äº«é…ç½®å°†ä¸ä¼šè¢«è€ƒè™‘åœ¨å†…ã€‚</li>
<li>ç›®æ ‡å¯¹è±¡çš„æ„é€ å‡½æ•°å±æ€§ä¹Ÿè¢«è§†ä¸ºç›®æ ‡å±æ€§ã€‚</li>
</ol>
<h2 id="4-3-æ§åˆ¶åµŒå¥—å¯¹è±¡æ˜ å°„"><a class="header-anchor" href="#4-3-æ§åˆ¶åµŒå¥—å¯¹è±¡æ˜ å°„"></a>4.3 æ§åˆ¶åµŒå¥—å¯¹è±¡æ˜ å°„</h2>
<p>MapStruct ä¼šä½¿ç”¨æºå±æ€§åå’Œç›®æ ‡å±æ€§åç”Ÿæˆæ˜ å°„æ–¹æ³•ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªåç§°é€šå¸¸ä¸ä¼šç›¸ç­‰ã€‚åœ¨è¿™è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦ä½¿ç”¨ <code>@Mapping</code> æ³¨è§£æ¥æŒ‡å®šå±æ€§ä¹‹é—´çš„æ˜ å°„ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FishTankMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(target = &quot;fish.kind&quot;, source = &quot;fish.type&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;fish.name&quot;, ignore = true)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;ornament&quot;, source = &quot;interior.ornament&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;material.materialType&quot;, source = &quot;material&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;quality.report.organisation.name&quot;, </span></span><br><span class="line"><span class="meta">             source = &quot;quality.report.organisationName&quot;)</span></span><br><span class="line">    FishTankDto <span class="title function_">map</span><span class="params">( FishTank source )</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†æˆ–è€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FishTankMapperWithDocument</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(target = &quot;fish.kind&quot;, source = &quot;fish.type&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;fish.name&quot;, expression = &quot;java(\&quot;Jaws\&quot;)&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;plant&quot;, ignore = true )</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;ornament&quot;, ignore = true )</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;material&quot;, ignore = true)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;quality.document&quot;, source = &quot;quality.report&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;quality.document.organisation.name&quot;, constant = &quot;NoIdeaInc&quot; )</span></span><br><span class="line">    FishTankWithNestedDocumentDto <span class="title function_">map</span><span class="params">( FishTank source )</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MapStruct å°†å¯¹æºå¯¹è±¡ä¸­çš„æ¯ä¸ªåµŒå¥—å±æ€§æ‰§è¡Œ <code>null</code> æ£€æŸ¥ã€‚</p>
<p>MapStruct é¼“åŠ±ç”¨æˆ·ç¼–å†™æ˜ç¡®çš„ <strong>åµŒå¥—å±æ€§æ˜ å°„æ–¹æ³•</strong>ï¼Œè€Œä¸æ˜¯é€šè¿‡ <code>@Mapping</code> é…ç½®æ¥è§£å†³ä¸€åˆ‡ï¼Œè¿™æ ·è¿˜å¯ä»¥å®ç°ä»£ç å¤ç”¨ï¼Œæ›´åŠ ä¼˜é›…~ ğŸ‘Š</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”¨äºç”ŸæˆåµŒå¥—æ–¹æ³•çš„ <code>ReportingPolicy</code> å¯èƒ½æ˜¯ <code>IGNORE</code>ï¼Œè¿™æ„å‘³ç€ MapStruct ä¸ä¼šæ˜¾ç¤ºåµŒå¥—æ˜ å°„ä¸­æœªæ˜ å°„çš„ç›®æ ‡å±æ€§ã€‚</p>
<h2 id="4-4-æ‰§è¡Œè‡ªå®šä¹‰æ˜ å°„æ–¹æ³•"><a class="header-anchor" href="#4-4-æ‰§è¡Œè‡ªå®šä¹‰æ˜ å°„æ–¹æ³•"></a>4.4  æ‰§è¡Œè‡ªå®šä¹‰æ˜ å°„æ–¹æ³•</h2>
<p>æœ‰æ—¶æ˜ å°„å¹¶ä¸ç®€å•ï¼Œæœ‰äº›å­—æ®µå¯èƒ½éœ€è¦è‡ªå®šä¹‰é€»è¾‘ã€‚</p>
<p>æ¯”å¦‚å°† <code>FishTank</code> ä¸­çš„ <code>length</code>ã€<code>width</code> å’Œ <code>height</code> å±æ€§æ˜ å°„åˆ° <code>FishTankWithVolumeDto</code> ä¸­çš„ <code>volume</code> å±æ€§ï¼Œè¿™ä¸ªæ˜ å°„ä¹Ÿä¸æ˜¯ä¸€ä¸ªç®€å•çš„æ˜ å°„ï¼Œéœ€è¦è®¡ç®—é±¼ç¼¸ <code>FishTank</code> çš„ä½“ç§¯ï¼Œç„¶åè¾“å‡ºæè¿°ä¿¡æ¯ã€‚</p>
<p>å‚ä¸è½¬æ¢çš„ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FishTank</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Fish fish;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> length;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> height;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolumeDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> volume;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FishTankWithVolumeDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> FishDto fish;</span><br><span class="line">    <span class="keyword">private</span> VolumeDto volume;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Fish</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FishDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String kind;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨äºå®ä½“æ˜ å°„çš„æŠ½è±¡ç±»ï¼ˆæ¢ä¸€ç§æ–¹æ³•ï¼Œä¸è¦æ¥å£ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">FishTankMapperWithVolume</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">FishTankMapperWithVolume</span> <span class="variable">INSTANCE</span></span><br><span class="line">            <span class="operator">=</span> Mappers.getMapper(FishTankMapperWithVolume.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;å°† FishTank è½¬æ¢ä¸º FishTankWithVolumeDto&lt;/p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;code&gt;<span class="doctag">@Mapping</span>&lt;/code&gt; æ³¨è§£çš„ source å±æ€§å€¼æ˜¯ map() æ–¹æ³•çš„å‚æ•°,</span></span><br><span class="line"><span class="comment">     * è€Œä¸æ˜¯ FishTank ä¸­çš„å±æ€§</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source FishTankå®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> FishTankWithVolumeDto å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;fish.kind&quot;, source = &quot;source.fish.type&quot;)</span></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;volume&quot;, source = &quot;source&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> FishTankWithVolumeDto <span class="title function_">map</span><span class="params">(FishTank source)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> VolumeDto <span class="title function_">mapVolume</span><span class="params">(FishTank source)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">volume</span> <span class="operator">=</span> source.getLength() * source.getWidth() * source.getHeight();</span><br><span class="line">        <span class="type">String</span> <span class="variable">desc</span> <span class="operator">=</span> volume &lt; <span class="number">100</span> ? <span class="string">&quot;Small&quot;</span> : <span class="string">&quot;Large&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">VolumeDto</span>(volume, desc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Mapping</code> æ³¨è§£çš„ source å±æ€§å€¼æ˜¯ <code>map()</code> æ–¹æ³•çš„å‚æ•° <code>source</code>ï¼Œè€Œä¸æ˜¯ <code>FishTank</code> ä¸­åä¸º <code>source</code> çš„å±æ€§ã€‚</p>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FishTankMapperWithVolumeTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testToFishTankWithVolumeDto</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">FishTank</span> <span class="variable">fishTank</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FishTank</span>();</span><br><span class="line">        fishTank.setLength(<span class="number">70</span>);</span><br><span class="line">        fishTank.setWidth(<span class="number">50</span>);</span><br><span class="line">        fishTank.setHeight(<span class="number">60</span>);</span><br><span class="line">        <span class="type">Fish</span> <span class="variable">fish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Fish</span>();</span><br><span class="line">        fish.setType(<span class="string">&quot;Carp&quot;</span>);</span><br><span class="line">        fishTank.setFish(fish);</span><br><span class="line">        <span class="type">FishTankWithVolumeDto</span> <span class="variable">dto</span> <span class="operator">=</span> FishTankMapperWithVolume.INSTANCE.map(fishTank);</span><br><span class="line">        Assert.assertEquals(<span class="number">210000</span>, dto.getVolume().getVolume());</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;Large&quot;</span>, dto.getVolume().getDescription());</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;Carp&quot;</span>, dto.getFish().getKind());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•æ–¹æ³•åï¼Œæµ‹è¯•é€šè¿‡ã€‚</p>
<p>æŸ¥çœ‹ç”Ÿæˆçš„å®ç°ç±» <code>FishTankMapperWithVolumeImpl</code> æ¥å£å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FishTankMapperWithVolumeImpl</span> <span class="keyword">extends</span> <span class="title class_">FishTankMapperWithVolume</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> FishTankWithVolumeDto <span class="title function_">map</span><span class="params">(FishTank source)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( source == <span class="literal">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">FishTankWithVolumeDto</span> <span class="variable">fishTankWithVolumeDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FishTankWithVolumeDto</span>();</span><br><span class="line"></span><br><span class="line">        fishTankWithVolumeDto.setFish( fishToFishDto( source.getFish() ) );</span><br><span class="line">        fishTankWithVolumeDto.setVolume( mapVolume( source ) );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fishTankWithVolumeDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> FishDto <span class="title function_">fishToFishDto</span><span class="params">(Fish fish)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( fish == <span class="literal">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">FishDto</span> <span class="variable">fishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FishDto</span>();</span><br><span class="line"></span><br><span class="line">        fishDto.setKind( fish.getType() );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fishDto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-5-è°ƒç”¨å…¶ä»–æ˜ å°„å™¨"><a class="header-anchor" href="#4-5-è°ƒç”¨å…¶ä»–æ˜ å°„å™¨"></a>4.5  è°ƒç”¨å…¶ä»–æ˜ å°„å™¨</h2>
<p>MapStruct è¿˜å¯ä»¥è°ƒç”¨å…¶ä»–ç±»ä¸­å®šä¹‰çš„æ˜ å°„æ–¹æ³•ï¼Œè¿™äº›æ˜ å°„æ–¹æ³•å¯ä»¥æ˜¯ MapStruct ç”Ÿæˆçš„ä¹Ÿå¯ä»¥æ˜¯æ‰‹åŠ¨ç¼–å†™çš„ã€‚è¿™å¯¹äºåœ¨å¤šä¸ªç±»ä¸­ç¼–å†™æ˜ å°„ä»£ç ï¼Œæˆ–è€…æƒ³æä¾›æ— æ³•ç”± MapStruct ç”Ÿæˆçš„è‡ªå®šä¹‰æ˜ å°„é€»è¾‘ï¼Œæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>
<p>è°ƒç”¨å…¶ä»–æ˜ å°„å™¨æ—¶ï¼Œåªéœ€åœ¨ <code>@Mapper#uses</code> é…ç½®æƒ³ä½¿ç”¨çš„æ˜ å°„å™¨ç±»å³å¯ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<p>å‡è®¾æœ‰ä¸€å±æ€§ <code>manufacturingDate</code> åœ¨æºå®ä½“ä¸­çš„ç±»å‹ä¸º <code>Date</code>ï¼Œè€Œåœ¨ç›®æ ‡å®ä½“ä¸­ç±»å‹ä¸º <code>String</code>ï¼Œåœ¨è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œå¯¹æ—¥æœŸå€¼æŒ‰éœ€æ±‚è¿›è¡Œæ ¼å¼åŒ–ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨è‡ªå·±ç¼–å†™çš„æ˜ å°„å™¨è¿›è¡Œæ˜ å°„å¤„ç†ã€‚</p>
<p>æºå®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Date manufacturingDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›®æ ‡å®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String manufacturingDate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡ªå®šä¹‰çš„æ˜ å°„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan 2021/2/9</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">asString</span><span class="params">(Date date)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> date != <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>)</span><br><span class="line">                .format(date) : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">asDate</span><span class="params">(String date)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> date != <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>)</span><br><span class="line">                    .parse(date) : <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„æ˜ å°„æ–¹æ³•ï¼Œå› æ­¤éœ€è¦åœ¨ <code>@Mapper#uses</code> ä¸ŠæŒ‡å®šæ˜ å°„æ–¹æ³•æ‰€åœ¨çš„ç±»ã€‚</p>
<p>æ˜ å°„å™¨æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(uses = DateMapper.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">CarMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(CarMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°† Car è½¬æ¢æˆ CarDtoï¼Œä¸å¿½ç•¥ Date</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> car Car å®ä¾‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>    å¯¹åº”çš„ DTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CarDto <span class="title function_">carToCarDtoUseDate</span><span class="params">(Car car)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUseDate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ—¶é—´æˆ³è¡¨ç¤ºçš„æ—¶é—´ä¸º 2021-02-09 00:00:00</span></span><br><span class="line">    <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">1612800000000L</span>));</span><br><span class="line">    <span class="type">CarDto</span> <span class="variable">carDto</span> <span class="operator">=</span> CarMapper.INSTANCE.carToCarDtoUseDate(car);</span><br><span class="line">    assertEquals(<span class="string">&quot;2021-02-09&quot;</span>, carDto.getManufacturingDate());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•æ–¹æ³•åï¼Œæµ‹è¯•é€šè¿‡ã€‚</p>
<p>æŸ¥çœ‹ç”Ÿæˆçš„å®ç°ç±» <code>CarMapperImpl</code> æ¥å£å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">DateMapper</span> <span class="variable">dateMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CarMapperImpl</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CarDto <span class="title function_">carToCarDtoUseDate</span><span class="params">(Car car)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (car == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">CarDto</span> <span class="variable">carDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarDto</span>();</span><br><span class="line">            carDto.setManufacturingDate(<span class="built_in">this</span>.dateMapper</span><br><span class="line">                                        .asString(car.getManufacturingDate()));</span><br><span class="line">            <span class="keyword">return</span> carDto;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸ºå®ç° <code>carToCarDto()</code> æ–¹æ³•ç”Ÿæˆä»£ç æ—¶ï¼ŒMapStruct å°†å¯»æ‰¾ä¸€ä¸ªå°† <code>Date</code> å¯¹è±¡æ˜ å°„ä¸º <code>String</code> çš„æ–¹æ³•ï¼Œæœ€ç»ˆåœ¨ <code>DateMapper</code> ç±»ä¸­æ‰¾åˆ°å®ƒï¼Œä½¿ç”¨å…¶ä¸­çš„ <code>asString()</code> æ–¹æ³•æ¥æ˜ å°„ä¸åŒç±»å‹çš„ <code>manufacturingDate</code> å±æ€§ã€‚</p>
<blockquote>
<p>æ€»ç»“æ€è€ƒ</p>
</blockquote>
<p>ç”Ÿæˆçš„æ˜ å°„å™¨ä½¿ç”¨ä¸ºå…¶é…ç½®çš„ç»„ä»¶æ¨¡å‹ï¼ˆä½¿ç”¨ <code>@Mapper#componentModel</code> é…ç½®ç»„ä»¶æ¨¡å‹ï¼‰è·å–å¼•ç”¨çš„æ˜ å°„å™¨ã€‚</p>
<p>åœ¨ç¤ºä¾‹ä»£ç ç”Ÿæˆçš„æ˜ å°„å™¨å®ç°ç±»ä¸­ï¼Œä½¿ç”¨äº† <code>new</code> å…³é”®è¯ <strong>è°ƒç”¨æ— å‚æ„é€ æ–¹æ³•</strong> åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•çš„å¯¹è±¡ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œ</strong> åœ¨è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•çš„æ‰€åœ¨ç±»ä¸­ï¼Œä¸€å®šè¦å«æœ‰å…¬å…±æ— å‚æ„é€ æ–¹æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¢«å®ä¾‹åŒ–ã€‚</p>
<p>åœ¨ä½¿ç”¨äº†ä¾èµ–æ³¨å…¥æ—¶ï¼Œè‡ªå®šä¹‰æ˜ å°„æ–¹æ³•çš„æ‰€åœ¨ç±»ä¹Ÿè¦æ˜¯ä¸€ä¸ªå¯æ³¨å…¥çš„ Beanã€‚æ¯”å¦‚ä½¿ç”¨äº† Spring æ¡†æ¶æ—¶ï¼Œéœ€è¦è®©è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•çš„æ‰€åœ¨ç±»ä¹Ÿè¢« Spring ç®¡ç†ã€‚</p>
<h2 id="4-6-å°†ç›®æ ‡ç±»å‹ä¼ é€’ç»™è‡ªå®šä¹‰æ˜ å°„å™¨"><a class="header-anchor" href="#4-6-å°†ç›®æ ‡ç±»å‹ä¼ é€’ç»™è‡ªå®šä¹‰æ˜ å°„å™¨"></a>4.6 å°†ç›®æ ‡ç±»å‹ä¼ é€’ç»™è‡ªå®šä¹‰æ˜ å°„å™¨</h2>
<p>ä½¿ç”¨ <code>@Mapper#uses()</code> å°†è‡ªå®šä¹‰æ˜ å°„å™¨ä¸ç”Ÿæˆçš„æ˜ å°„å™¨æŒ‚é’©æ—¶ï¼Œå¯ä»¥åœ¨è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•ä¸­å®šä¹‰ <code>Class</code> ç±»å‹ï¼ˆæˆ–å…¶è¶…ç±»ï¼‰çš„é™„åŠ å‚æ•°ï¼Œä»¥ä¾¿é’ˆå¯¹ç‰¹å®šçš„ç›®æ ‡å¯¹è±¡ç±»å‹æ‰§è¡Œå¸¸è§„æ˜ å°„ä»»åŠ¡ã€‚è¯¥å±æ€§å¿…é¡»ä½¿ç”¨ <code>@TargetType</code> è¿›è¡Œæ ‡æ³¨ï¼Œä»¥ä¾¿ MapStruct ç”Ÿæˆä¸ç›®æ ‡å¯¹è±¡ä¸­å±æ€§å¯¹åº”ç±»å‹ä¸€è‡´çš„ <code>Class</code> å®ä¾‹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ<code>CarDto</code> ä¸­æœ‰ä¸€ä¸ª <code>Reference</code> ç±»å‹çš„ <code>owner</code> å±æ€§ï¼Œå®ƒåŒ…å«äº† <code>Person</code> å®ä½“çš„ä¸»é”®ã€‚ç°åœ¨å¯ä»¥åˆ›å»ºé€šç”¨çš„è‡ªå®šä¹‰æ˜ å°„å™¨ï¼Œå°†ä»»ä½• <code>Reference</code> å¯¹è±¡è§£æä¸ºå…¶å¯¹åº”çš„ã€ç”± JPA ç®¡ç†çš„å®ä½“å®ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApplicationScoped</span> <span class="comment">// CDI component model</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReferenceMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">BaseEntity</span>&gt; T <span class="title function_">resolve</span><span class="params">(Reference reference, </span></span><br><span class="line"><span class="params">                                            <span class="meta">@TargetType</span> Class&lt;T&gt; entityClass)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> reference != <span class="literal">null</span> ? </span><br><span class="line">            entityManager.find(entityClass, reference.getPk()) : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Reference <span class="title function_">toReference</span><span class="params">(BaseEntity entity)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> entity != <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">Reference</span>( entity.getPk() ) : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper(componentModel = &quot;cdi&quot;, uses = ReferenceMapper.class )</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line">    Car <span class="title function_">carDtoToCar</span><span class="params">(CarDto carDto)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GENERATED CODE</span></span><br><span class="line"><span class="meta">@ApplicationScoped</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">private</span> ReferenceMapper referenceMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Car <span class="title function_">carDtoToCar</span><span class="params">(CarDto carDto)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( carDto == <span class="literal">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line"></span><br><span class="line">        car.setOwner( referenceMapper.resolve( carDto.getOwner(), Owner.class ) );</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> car;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-7-ä¼ é€’ä¸Šä¸‹æ–‡æˆ–çŠ¶æ€å¯¹è±¡ç»™è‡ªå®šä¹‰æ–¹æ³•"><a class="header-anchor" href="#4-7-ä¼ é€’ä¸Šä¸‹æ–‡æˆ–çŠ¶æ€å¯¹è±¡ç»™è‡ªå®šä¹‰æ–¹æ³•"></a>4.7 ä¼ é€’ä¸Šä¸‹æ–‡æˆ–çŠ¶æ€å¯¹è±¡ç»™è‡ªå®šä¹‰æ–¹æ³•</h2>
<p>å¯ä»¥é€šè¿‡ç”Ÿæˆçš„æ˜ å°„æ–¹æ³•å°†é¢å¤–ä¸Šä¸‹æ–‡æˆ–çŠ¶æ€ä¿¡æ¯ä¼ é€’ç»™å…·æœ‰ <code>@Context</code> å‚æ•°çš„è‡ªå®šä¹‰æ–¹æ³•ã€‚</p>
<p>è¿™æ ·çš„å‚æ•°ä¼šä¼ é€’ç»™å…¶ä»–æ˜ å°„æ–¹æ³•ã€é€‚ç”¨çš„æƒ…å†µä¸‹çš„ <code>@ObjectFactory</code> æ–¹æ³•æˆ– <code>@BeforeMapping</code>ã€<code>@AfterMapping</code> æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥åœ¨è‡ªå®šä¹‰ä»£ç ä¸­ä½¿ç”¨ã€‚</p>
<p>åœ¨ <code>@ObjectFactory</code> æ–¹æ³•ä¸­æœç´¢è¢« <code>@Context</code> æ ‡è®°çš„å‚æ•°ï¼Œå¦‚æœé€‚ç”¨ï¼Œå°†æ ¹æ®æä¾›çš„ä¸Šä¸‹æ–‡å‚æ•°å€¼è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚</p>
<p>è¿˜ä¼šåœ¨ <code>@BeforeMapping</code>ã€<code>@AfterMapping</code> æ–¹æ³•ä¸­æœç´¢è¢« <code>@Context</code> æ ‡è®°çš„å‚æ•°ï¼Œå¦‚æœé€‚ç”¨ï¼Œå°†æ ¹æ®æä¾›çš„ä¸Šä¸‹æ–‡å‚æ•°å€¼è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚</p>
<p>æ³¨æ„ï¼šåœ¨è°ƒç”¨ä¼ å…¥ä¸Šä¸‹æ–‡å‚æ•°çš„æ˜ å°„æ–¹æ³•ä¹‹å‰ï¼Œä¸ä¼šè¿›è¡Œ <strong>ç©ºæ£€æŸ¥</strong>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨æ–¹éœ€è¦ç¡®ä¿æ²¡æœ‰ä¼ å…¥ <code>null</code>ã€‚</p>
<p>ä¸ºäº†åœ¨ç”Ÿæˆçš„ä»£ç ä¸­èƒ½å¤Ÿè°ƒç”¨å«æœ‰ <code>@Context</code> å‚æ•°çš„è‡ªå®šä¹‰æ–¹æ³•ï¼Œæ­£åœ¨ç”Ÿæˆçš„æ˜ å°„æ–¹æ³•çš„å£°æ˜ä¸­ä¹Ÿéœ€è¦åŒ…å«è¿™äº›ï¼ˆæˆ–å­ç±»ï¼‰<code>@Context</code> å‚æ•°ã€‚ç”Ÿæˆçš„ä»£ç ä¸­ä¸ä¼šä¸ºç¼ºå°‘çš„ <code>@Context</code> å‚æ•°åˆ›å»ºæ–°çš„å®ä¾‹ï¼Œä¹Ÿä¸ä¼šä¼ é€’ä¸€ä¸ªç©ºå€¼ä»£æ›¿ã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<p>ä½¿ç”¨ <code>@Context</code> å‚æ•°å°†æ•°æ®ä¼ é€’ç»™æˆ‘ä»¬è‡ªå®šä¹‰çš„å±æ€§æ˜ å°„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> CarDto <span class="title function_">toCar</span><span class="params">(Car car, <span class="meta">@Context</span> Locale translationLocale)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> OwnerManualDto <span class="title function_">translateOwnerManual</span><span class="params">(OwnerManual ownerManual, </span></span><br><span class="line"><span class="params">                                              <span class="meta">@Context</span> Locale locale)</span> &#123;</span><br><span class="line">    <span class="comment">// manually implemented logic to translate the OwnerManual with the given Locale</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GENERATED CODE</span></span><br><span class="line"><span class="keyword">public</span> CarDto <span class="title function_">toCar</span><span class="params">(Car car, Locale translationLocale)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ( car == <span class="literal">null</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">CarDto</span> <span class="variable">carDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarDto</span>();</span><br><span class="line"></span><br><span class="line">    carDto.setOwnerManual( translateOwnerManual( car.getOwnerManual(), translationLocale );</span><br><span class="line">    <span class="comment">// more generated mapping code</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> carDto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-8-æ˜ å°„æ–¹æ³•çš„è§£æ"><a class="header-anchor" href="#4-8-æ˜ å°„æ–¹æ³•çš„è§£æ"></a>4.8 æ˜ å°„æ–¹æ³•çš„è§£æ</h2>
<p>å°†å±æ€§ä»ä¸€ç§ç±»å‹æ˜ å°„åˆ°å¦ä¸€ç§ç±»å‹æ—¶ï¼ŒMapStruct å¯»æ‰¾å°†æºç±»å‹æ˜ å°„åˆ°ç›®æ ‡ç±»å‹çš„æœ€æ˜ç¡®çš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•å¯ä»¥æ˜¯åœ¨åŒä¸€ä¸ªæ˜ å°„å™¨æ¥å£ä¸­å£°æ˜çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯é€šè¿‡ <code>@Mapper#uses()</code> æ³¨å†Œçš„å¦ä¸€ä¸ªæ˜ å°„å™¨ä¸­å£°æ˜çš„ã€‚è¿™åŒæ ·é€‚ç”¨äºå·¥å‚æ–¹æ³•ã€‚</p>
<p>å¯»æ‰¾æ˜ å°„æ–¹æ³•æˆ–å·¥å‚æ–¹æ³•çš„ç®—æ³•ä¸ Java çš„æ–¹æ³•è§£æç®—æ³•å¾ˆç±»ä¼¼ï¼Œå°¤å…¶æ˜¯å…·æœ‰æ›´æ˜ç¡®æºç±»å‹çš„æ–¹æ³•éƒ½å°†è¢«ä¼˜å…ˆè·å–ï¼ˆå‡å¦‚æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ–¹æ³•æ˜ å°„å¯»æ‰¾çš„æºç±»å‹ï¼Œå¦ä¸€ä¸ªæ˜ å°„ç›¸åŒçš„çˆ¶ç±»å‹ï¼‰ã€‚å¦‚æœæœ‰å¤šä¸ªè¯¦ç»†ç¨‹åº¦ç›¸å½“çš„æ–¹æ³•æ—¶ï¼Œåˆ™ä¼šå¼•å‘é”™è¯¯ã€‚</p>
<p>åœ¨ä½¿ç”¨ JAXB æ—¶ï¼Œæ¯”å¦‚å°† <code>String</code> è½¬æ¢ä¸ºå¯¹åº”çš„ <code>JAXBElement&lt;String&gt;</code> æ—¶ï¼ŒMapStruct åœ¨å¯»æ‰¾æ˜ å°„æ–¹æ³•æ—¶å°†è€ƒè™‘ <code>@XmlElementDecl</code> æ³¨è§£çš„ <code>scope</code> å’Œ <code>name</code> å±æ€§å€¼ï¼Œè¿™å°†ç¡®ä¿åˆ›å»ºçš„ <code>JAXBElement</code> å®ä¾‹å…·æœ‰æ­£ç¡®çš„ <code>QNAME</code> å€¼ã€‚</p>
<h2 id="4-9-åŸºäºé™å®šç¬¦çš„æ˜ å°„æ–¹æ³•é€‰æ‹©"><a class="header-anchor" href="#4-9-åŸºäºé™å®šç¬¦çš„æ˜ å°„æ–¹æ³•é€‰æ‹©"></a>4.9 åŸºäºé™å®šç¬¦çš„æ˜ å°„æ–¹æ³•é€‰æ‹©</h2>
<p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹éœ€è¦å…·æœ‰ç›¸åŒæ–¹æ³•ç­¾åï¼ˆé™¤äº†åç§°ï¼‰ä½†å…·æœ‰ä¸åŒè¡Œä¸ºçš„æ˜ å°„æ–¹æ³•ã€‚</p>
<p>MapStruct æä¾› <code>@Qualifier</code>ï¼ˆorg.mapstruct.Qualifierï¼‰æ³¨è§£æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚ä¸€ä¸ªâ€œqualifierâ€ï¼ˆå¯è¯‘ä¸ºâ€œé™å®šç¬¦â€ï¼‰å¯ä»¥æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ä¸€ä¸ªæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£ä½œç”¨åœ¨ä¸€ä¸ªèƒ½è¢«ä½¿ç”¨çš„æ˜ å°„å™¨ä¸­çš„æ˜ å°„æ–¹æ³•ä¸Šï¼Œè¿™ä¸ªæ˜ å°„æ–¹æ³•å¯ä»¥åœ¨å¯¹è±¡å±æ€§æ˜ å°„ã€iterable æ˜ å°„æˆ– map æ˜ å°„ä¸­è¢«å¼•ç”¨ã€‚ä¸€ä¸ªæ–¹æ³•å’Œæ˜ å°„å™¨ä¸Šå¯ä»¥æœ‰å¤šä¸ªé™å®šç¬¦ã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<p>å‡è®¾æœ‰ä¸€ä¸ªæ‰‹å†™çš„æ˜ å°„å™¨ <code>Titles</code>ï¼Œå…¶å†…éƒ¨æœ‰å¤šä¸ªå‚æ•°ç±»å‹æ˜¯ <code>String</code>ï¼Œè¿”å›å€¼ç±»å‹ä¹Ÿæ˜¯ <code>String</code> çš„è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Titles</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">translateTitleEG</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="comment">// some mapping logic</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">translateTitleGE</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="comment">// some mapping logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ Mapper æ¥å£ä¸­éœ€è¦ä½¿ç”¨åˆ°å‰æ–‡ä¸­æ‰‹å†™çš„æ˜ å°„å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(uses = Titles.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MovieMapper</span> &#123;</span><br><span class="line">    GermanRelease <span class="title function_">toGerman</span><span class="params">(OriginalRelease movies)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†è¿™æ ·æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºåœ¨æ‰‹å†™çš„æ˜ å°„å™¨ä¸­æœ‰å¤šä¸ªç¬¦åˆæ¡ä»¶çš„æ˜ å°„æ–¹æ³•ï¼ŒMapStruct æ— æ³•åŒºåˆ†ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™éœ€è¦ä½¿ç”¨åˆ° <code>@Qualifier</code> æ³¨è§£ã€‚</p>
<p>ç¼–å†™ä¸€ä¸ªæ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£ä½œç”¨äº <strong>æ‰‹å†™çš„æ˜ å°„å™¨</strong> ä¸Šï¼Œå°† <code>@Qualifier</code> ä½œä¸ºå…ƒæ³¨è§£ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mapstruct.Qualifier;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.CLASS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TitleTranslator &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºå­˜åœ¨å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•ï¼Œè¿™äº›æ˜ å°„æ–¹æ³•ä¹Ÿéœ€è¦ä½¿ç”¨â€œé™å®šç¬¦â€ï¼Œå†ç¼–å†™ä¸€äº›æ³¨è§£ï¼Œè¿™äº›æ³¨è§£ä½œç”¨äº <strong>è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•</strong> ä¸Šï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mapstruct.Qualifier;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.CLASS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnglishToGerman &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mapstruct.Qualifier;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.CLASS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> GermanToEnglish &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨æ‰‹å†™çš„æ˜ å°„å™¨åŠå…¶å†…éƒ¨è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•ä¸Šä½¿ç”¨è¿™äº›æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TitleTranslator</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Titles</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnglishToGerman</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">translateTitleEG</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="comment">// some mapping logic</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GermanToEnglish</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">translateTitleGE</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="comment">// some mapping logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆï¼ŒMapper ä¼šå˜æˆè¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(uses = Titles.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MovieMapper</span> &#123;</span><br><span class="line">     <span class="meta">@Mapping(target = &quot;title&quot;, </span></span><br><span class="line"><span class="meta">              qualifiedBy = &#123;TitleTranslator.class, EnglishToGerman.class&#125;)</span></span><br><span class="line">     GermanRelease <span class="title function_">toGerman</span><span class="params">( OriginalRelease movies )</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><mark>æ³¨æ„ï¼š</mark></p>
<ol>
<li>ç¼–å†™çš„æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»æ˜¯ <code>@Retention(RetentionPolicy.CLASS)</code> çš„ï¼Œè¿™è¡¨ç¤ºæ³¨è§£è¢«ç¼–è¯‘å™¨ç¼–è¯‘è¿› class æ–‡ä»¶ï¼Œä½†è¿è¡Œæ—¶ä¼šå¿½ç•¥ã€‚</li>
<li>ç”¨é™å®šç¬¦æ ‡è®°çš„ç±»æˆ–æ–¹æ³•å°†ä¸å†é€‚ç”¨äºæ²¡æœ‰ä½¿ç”¨ <code>qualifiedBy</code> å±æ€§çš„æ˜ å°„é€»è¾‘ã€‚</li>
<li>åŒæ ·çš„æœºåˆ¶ä¹Ÿå­˜åœ¨äº Bean æ˜ å°„ä¸Šï¼Œ<code>@BeanMapping#qualifiedBy</code> å°†é€‰æ‹©ç”¨æŒ‡å®šé™å®šç¬¦æ ‡è®°çš„å·¥å‚æ–¹æ³•ã€‚</li>
</ol>
<blockquote>
<p>ä½¿ç”¨ <code>@Named</code> æ³¨è§£é€‰æ‹©æ˜ å°„æ–¹æ³•</p>
</blockquote>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå£°æ˜ä¸€ä¸ªæ–°æ³¨è§£æ¥å®Œæˆæ˜ å°„æ–¹æ³•çš„é€‰æ‹©æœ‰äº›å¤§æå°ç”¨ã€‚å¯¹äºè¿™äº›æƒ…å†µï¼ŒMapStruct æä¾›äº† <code>@Named</code> çš„æ³¨è§£ï¼Œä½¿ç”¨è¿™ä¸ªæ³¨è§£ä¹Ÿå¯ä»¥è¾¾åˆ° <code>@Qualifier</code> çš„æ•ˆæœã€‚ğŸ‘</p>
<p><code>@Named</code> æ³¨è§£æ˜¯é¢„å®šä¹‰çš„é™å®šç¬¦ï¼ˆå®ƒä¹Ÿè¢« <code>@Qualifier</code> æ³¨è§£æ ‡è®°ï¼‰ï¼Œ<code>@Named</code> å¯ç”¨äºå‘½åæ˜ å°„å™¨ï¼Œæˆ–è€…æ›´ç›´æ¥åœ°é€šè¿‡å…¶ <code>value</code> å€¼å‘½åæ˜ å°„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123; ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention( RetentionPolicy.CLASS )</span></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Named &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ‰‹å†™çš„æ˜ å°„å™¨åŠå…¶å†…éƒ¨è‡ªå®šä¹‰æ˜ å°„æ–¹æ³•ä¸Šä½¿ç”¨ <code>@Named</code> æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Named(&quot;TitleTranslator&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Titles</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(&quot;EnglishToGerman&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">translateTitleEG</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="comment">// some mapping logic</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(&quot;GermanToEnglish&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">translateTitleGE</span><span class="params">(String title)</span> &#123;</span><br><span class="line">        <span class="comment">// some mapping logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œ Mapper æ¥å£ä¸­ä¸å†ä½¿ç”¨ <code>@Mapping#qualifiedBy</code>ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>@Mapping#qualifiedByName</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper( uses = Titles.class )</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MovieMapper</span> &#123;</span><br><span class="line">     <span class="meta">@Mapping(target = &quot;title&quot;, qualifiedByName = &#123;&quot;TitleTranslator&quot;, &quot;EnglishToGerman&quot;&#125;)</span></span><br><span class="line">     GermanRelease <span class="title function_">toGerman</span><span class="params">( OriginalRelease movies )</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <code>@Named</code> éœ€è¦å®šä¹‰ä¸€ä¸ªé™å®šåç§°å¹¶ä½¿ç”¨ï¼Œè€Œä½¿ç”¨ <code>@Qualifier</code> åˆ™æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦è‡ªå®šä¹‰æ³¨è§£ã€‚è™½ç„¶ä¸¤è€…éƒ½èƒ½è¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼Œä½†ä½¿ç”¨ <code>@Named</code> æ—¶åº”å½“æ›´åŠ å°å¿ƒï¼Œå› ä¸ºåœ¨ä½¿ç”¨ <code>@Named</code> æ³¨è§£æ—¶ï¼ŒIDE å¹¶ä¸ä¼šæç¤ºåç§°æ˜¯å¦ä¹¦å†™æ­£ç¡®ï¼Œä¹Ÿä¸ä¼šåœ¨é‡æ„é™å®šç¬¦åç§°æ—¶åƒé‡æ„è‡ªå®šä¹‰æ³¨è§£çš„åç§°é‚£æ ·å·§å¦™åœ°é‡æ„ä»£ç ä¸­æ‰€æœ‰ä½¿ç”¨åˆ°çš„åœ°æ–¹ã€‚</p>
<h2 id="4-10-ç»“åˆé™å®šç¬¦ä¸é»˜è®¤å€¼"><a class="header-anchor" href="#4-10-ç»“åˆé™å®šç¬¦ä¸é»˜è®¤å€¼"></a>4.10 ç»“åˆé™å®šç¬¦ä¸é»˜è®¤å€¼</h2>
<p>è¯·æ³¨æ„ï¼Œ<code>@Mapping#defaultValue</code> æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª <code>String</code>ï¼Œéœ€è¦è½¬æ¢ä¸º <code>@Mapping#target</code>ã€‚ä½¿ç”¨ <code>@Mapping#qualifiedByName</code> æˆ– <code>@Mapping#qualifiedBy</code> æ—¶å°†å¼ºåˆ¶ MapStruct ä½¿ç”¨æŒ‡å®šçš„æ–¹æ³•ã€‚å¦‚æœæƒ³è¦ <code>@Mapping#defaultValue</code> æœ‰ä¸åŒçš„è¡Œä¸ºï¼Œè¯·æä¾›ä¸€ä¸ªé€‚å½“çš„æ˜ å°„æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦å°† <code>String</code> è½¬æ¢æˆ <code>@Mapping#target</code> æƒ³è¦çš„ç±»å‹ï¼ŒåŒæ—¶è¿˜è¦è¢«é™å®šç¬¦æ ‡è®°ï¼Œä»¥ä¾¿ <code>@Mapping#qualifiedByName</code> æˆ– <code>@Mapping#qualifiedBy</code> èƒ½å¤Ÿæ‰¾åˆ°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MovieMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;category&quot;, </span></span><br><span class="line"><span class="meta">             qualifiedByName = &quot;CategoryToString&quot;,</span></span><br><span class="line"><span class="meta">             defaultValue = &quot;DEFAULT&quot;)</span></span><br><span class="line">    GermanRelease <span class="title function_">toGerman</span><span class="params">(OriginalRelease movies)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(&quot;CategoryToString&quot;)</span></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">defaultValueForQualifier</span><span class="params">(Category cat)</span> &#123;</span><br><span class="line">        <span class="comment">// some mapping logic</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ç¤ºä¾‹ <code>cat</code> æ¥æºä¸­çš„ <code>category</code> å¦‚æœæ˜¯ <code>null</code>ï¼Œ<code>CategoryToString( Enum.valueOf( Category.class, &quot;DEFAULT&quot; ) )</code> æ–¹æ³•å°†è¢«è°ƒç”¨ï¼Œå…¶è¿”å›ç»“æœè¢«è®¾ç½®ç»™ç›®æ ‡çš„ <code>category</code> å­—æ®µã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MovieMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;category&quot;, </span></span><br><span class="line"><span class="meta">             qualifiedByName = &quot;CategoryToString&quot;, </span></span><br><span class="line"><span class="meta">             defaultValue = &quot;Unknown&quot;)</span></span><br><span class="line">    GermanRelease <span class="title function_">toGerman</span><span class="params">(OriginalRelease movies)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(&quot;CategoryToString&quot;)</span></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">defaultValueForQualifier</span><span class="params">(Category cat)</span> &#123;</span><br><span class="line">        <span class="comment">// some mapping logic</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(&quot;CategoryToString&quot;)</span></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">defaultValueForQualifier</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ç¤ºä¾‹ <code>cat</code> æ¥æºä¸­çš„ <code>category</code> å¦‚æœæ˜¯ <code>null</code>ï¼Œ<code>defaultValueForQualifier( &quot;Unknown&quot; )</code> æ–¹æ³•å°†è¢«è°ƒç”¨ï¼ˆå‚æ•°ä¸º <code>String</code> çš„æ–¹æ³•ï¼‰ï¼Œå…¶è¿”å›ç»“æœè¢«è®¾ç½®ç»™ç›®æ ‡çš„ <code>category</code> å­—æ®µã€‚</p>
<p>å¦‚æœä¸Šé¢æåˆ°çš„æ–¹æ³•ä¸èµ·ä½œç”¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>defaultExpression</code> æ¥è®¾ç½®é»˜è®¤å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MovieMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(target = &quot;category&quot;, </span></span><br><span class="line"><span class="meta">             qualifiedByName = &quot;CategoryToString&quot;, </span></span><br><span class="line"><span class="meta">             defaultExpression = &quot;java(\&quot;Unknown\&quot;)&quot;)</span></span><br><span class="line">    GermanRelease <span class="title function_">toGerman</span><span class="params">( OriginalRelease movies )</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="5-æ˜ å°„é›†åˆ"><a class="header-anchor" href="#5-æ˜ å°„é›†åˆ"></a>5. æ˜ å°„é›†åˆ</h1>
<h2 id="5-1-æ˜ å°„-Set-ä¸-List"><a class="header-anchor" href="#5-1-æ˜ å°„-Set-ä¸-List"></a>5.1 æ˜ å°„ Set ä¸ List</h2>
<p>MapStruct ä¹Ÿæ”¯æŒ Java ä¸­å„ç§é›†åˆç±»å‹ï¼ˆæ¯”å¦‚ Setã€Listï¼‰çš„æ˜ å°„ï¼ŒåŒ…æ‹¬ <a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/tutorial/collections/intro/index.html">Java Collection Framework</a> ä¸­å„ç§ <mark>å¯è¿­ä»£</mark> ç±»å‹ï¼Œå…¶ä½¿ç”¨ä¸æ˜ å°„å¯¹è±¡ç±»å‹ä¸€æ ·ã€‚ğŸ®</p>
<p>ç”Ÿæˆçš„ä»£ç ä¸­å°†åŒ…å«ä¸€ä¸ªå¾ªç¯ï¼Œåœ¨å¾ªç¯ä¸­éå†æºé›†åˆï¼Œè½¬æ¢æ¯ä¸ªå…ƒç´ å¹¶å°†å®ƒä»¬æ”¾å…¥ç›®æ ‡é›†åˆä¸­ã€‚</p>
<p>å¦‚æœåœ¨ç»™å®šçš„æ˜ å°„å™¨æˆ–å®ƒä½¿ç”¨çš„æ˜ å°„å™¨ä¸­æ‰¾åˆ°é›†åˆä¸­å…ƒç´ ç±»å‹çš„æ˜ å°„æ–¹æ³•ï¼Œåˆ™è°ƒç”¨æ­¤æ–¹æ³•æ‰§è¡Œå…ƒç´ è½¬æ¢ã€‚å†æˆ–è€…ï¼Œå¦‚æœå­˜åœ¨æºå…ƒç´ ç±»å‹å’Œç›®æ ‡å…ƒç´ ç±»å‹çš„éšå¼è½¬æ¢ï¼Œåˆ™è°ƒç”¨é‚£ä¸ªéšå¼è½¬æ¢ã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    Set&lt;String&gt; <span class="title function_">integerSetToStringSet</span><span class="params">(Set&lt;Integer&gt; integers)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;CarDto&gt; <span class="title function_">carsToCarDtos</span><span class="params">(List&lt;Car&gt; cars)</span>;</span><br><span class="line"></span><br><span class="line">    CarDto <span class="title function_">carToCarDto</span><span class="params">(Car car)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‡å†™çš„ <code>integerSetToStringSet()</code> æ–¹æ³•ä¸ºæ¯ä¸ªå…ƒç´ æ‰§è¡Œä» <code>Integer</code> åˆ° <code>String</code> çš„è½¬æ¢ï¼Œè€Œç”Ÿæˆçš„ <code>carsToCarDtos()</code> æ–¹æ³•ä¸ºæ¯ä¸ªåŒ…å«çš„å…ƒç´ è°ƒç”¨ <code>carToCarDto()</code> æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GENERATED CODE</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">integerSetToStringSet</span><span class="params">(Set&lt;Integer&gt; integers)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ( integers == <span class="literal">null</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( Integer integer : integers ) &#123;</span><br><span class="line">        set.add( String.valueOf( integer ) );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> set;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CarDto&gt; <span class="title function_">carsToCarDtos</span><span class="params">(List&lt;Car&gt; cars)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ( cars == <span class="literal">null</span> ) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;CarDto&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;CarDto&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( Car car : cars ) &#123;</span><br><span class="line">        list.add( carToCarDto( car ) );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æ˜ å°„é›†åˆç±»å‹çš„å±æ€§æ—¶ï¼ŒMapStruct å°†æŸ¥æ‰¾å…·æœ‰åŒ¹é…çš„å‚æ•°å’Œè¿”å›ç±»å‹çš„é›†åˆæ˜ å°„æ–¹æ³•ã€‚</p>
<p>ä¾‹å¦‚ä» <code>Car#passengers</code>ï¼ˆ<code>List&lt;Person&gt;</code> ç±»å‹ï¼‰åˆ° <code>CarDto#passengers</code>ï¼ˆ<code>List&lt;PersonDto&gt;</code> ç±»å‹ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GENERATED CODE</span></span><br><span class="line">carDto.setPassengers( personsToPersonDtos( car.getPassengers() ) );</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>ä¸€äº›æ¡†æ¶å’Œåº“åªæš´éœ²äº† JavaBeans çš„ Getterï¼Œè€Œä¸æš´éœ²é›†åˆç±»å‹å±æ€§çš„ Setterã€‚ä½¿ç”¨ JAXB ä» XML ç”Ÿæˆçš„ç±»å‹é»˜è®¤éµå¾ªè¿™ç§æ¨¡å¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨äºæ˜ å°„è¿™ç§å±æ€§çš„ç”Ÿæˆä»£ç å°†è°ƒç”¨å…¶ Getter å¹¶æ·»åŠ æ‰€æœ‰æ˜ å°„å…ƒç´ ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GENERATED CODE</span></span><br><span class="line">carDto.getPassengers().addAll( personsToPersonDtos( car.getPassengers() ) );</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><mark>æ³¨æ„ï¼š</mark> ä¸å…è®¸ä½¿ç”¨å¯è¿­ä»£çš„æºå’Œä¸å¯è¿­ä»£çš„ç›®æ ‡æ¥å£°æ˜æ˜ å°„æ–¹æ³•ï¼ˆæˆ–è€…ç›¸åï¼‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<h2 id="5-2-æ˜ å°„-Map"><a class="header-anchor" href="#5-2-æ˜ å°„-Map"></a>5.2 æ˜ å°„ Map</h2>
<p>MapStruct ä¹Ÿæ”¯æŒæ˜ å°„ Mapã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SourceTargetMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MapMapping(valueDateFormat = &quot;dd.MM.yyyy&quot;)</span></span><br><span class="line">    Map&lt;String, String&gt; <span class="title function_">longDateMapToStringStringMap</span><span class="params">(Map&lt;Long, Date&gt; source)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ ã€5.1 æ˜ å°„ Set ä¸ Listã€‘ç±»ä¼¼ï¼Œåœ¨ç”Ÿæˆçš„ä»£ç å°†éå†æº Mapï¼Œè½¬æ¢æ¯ä¸ª key å’Œ valueï¼ˆé€šè¿‡éšå¼è½¬æ¢æˆ–è°ƒç”¨å¦ä¸€ä¸ªæ˜ å°„æ–¹æ³•ï¼‰ï¼Œå¹¶å°†å®ƒä»¬æ”¾å…¥ç›®æ ‡ Map ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GENERATED CODE</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;Long, Date&gt; <span class="title function_">stringStringMapToLongDateMap</span><span class="params">(Map&lt;String, String&gt; source)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (source == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Map&lt;Long, Date&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Long, Date&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : source.entrySet()) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">key</span> <span class="operator">=</span> Long.parseLong(entry.getKey());</span><br><span class="line">        Date value;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            value = <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;dd.MM.yyyy&quot;</span> ).parse( entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(ParseException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        map.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-3-é›†åˆæ˜ å°„ç­–ç•¥"><a class="header-anchor" href="#5-3-é›†åˆæ˜ å°„ç­–ç•¥"></a>5.3 é›†åˆæ˜ å°„ç­–ç•¥</h2>
<p>å‚è€ƒåšæ–‡ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_32787481/article/details/110927957">MapStructæ–‡æ¡£ï¼ˆäº”ï¼‰â€”â€”é›†åˆæ˜ å°„</a></p>
<p>åœ¨ <code>@Mapper</code> æ³¨è§£ä¸­æœ‰ä¸€ä¸ªå±æ€§ <code>CollectionMappingStrategy</code>ï¼Œè¡¨ç¤ºé›†åˆæ˜ å°„ç­–ç•¥ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸ªæšä¸¾ç±»å‹ï¼Œå®ƒæœ‰å››ä¸ªæšä¸¾å€¼ï¼š</p>
<ul>
<li>
<p><code>ACCESSOR_ONLY</code></p>
</li>
<li>
<p><code>SETTER_PREFERRED</code></p>
</li>
<li>
<p><code>ADDER_PREFERRED</code></p>
</li>
<li>
<p><code>TARGET_IMMUTABLE</code></p>
</li>
</ul>
<p>ç›®æ ‡å¯¹è±¡ä¸­çš„ setã€get å’Œ add ç­‰æ–¹æ³•çš„å­˜åœ¨åœ¨ä¸åŒåœºæ™¯ä¸‹æœ‰ä¸åŒçš„æƒ…å†µã€‚ä¸‹è¡¨ä»‹ç»äº†ç›®æ ‡å¯¹è±¡åœ¨ä¸åŒçš„é›†åˆæ˜ å°„ç­–ç•¥ä¸‹å¯¹ setã€get å’Œ add æ–¹æ³•çš„åº”ç”¨ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">å€¼</th>
<th style="text-align:center">åªæœ‰ set æ–¹æ³•</th>
<th style="text-align:center">åªæœ‰ add æ–¹æ³•</th>
<th style="text-align:center">setã€add æ–¹æ³•éƒ½æœ‰</th>
<th style="text-align:center">setã€add æ–¹æ³•éƒ½æ²¡æœ‰</th>
<th style="text-align:center">å·²ç»å­˜åœ¨çš„é›†åˆå¯¹è±¡</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ACCESSOR_ONLY</td>
<td style="text-align:center">ç›´æ¥ set é›†åˆ</td>
<td style="text-align:center">å…ˆ get è·å–é›†åˆå†a ddAll</td>
<td style="text-align:center">ç›´æ¥ set é›†åˆ</td>
<td style="text-align:center">å…ˆ get è·å–é›†åˆå† addAll</td>
<td style="text-align:center">å…ˆ get è·å–é›†åˆå† addAll</td>
</tr>
<tr>
<td style="text-align:center">SETTER_PREFERRED</td>
<td style="text-align:center">ç›´æ¥ set é›†åˆ</td>
<td style="text-align:center">add é›†åˆçš„ä¸€é¡¹</td>
<td style="text-align:center">ç›´æ¥ set é›†åˆ</td>
<td style="text-align:center">å…ˆ get è·å–é›†åˆå† addAll</td>
<td style="text-align:center">å…ˆ get è·å–é›†åˆå† addAll</td>
</tr>
<tr>
<td style="text-align:center">ADDER_PREFERRED</td>
<td style="text-align:center">ç›´æ¥ set é›†åˆ</td>
<td style="text-align:center">add é›†åˆçš„ä¸€é¡¹</td>
<td style="text-align:center">add é›†åˆçš„ä¸€é¡¹</td>
<td style="text-align:center">å…ˆ get è·å–é›†åˆå† addAll</td>
<td style="text-align:center">å…ˆ get è·å–é›†åˆå† addAll</td>
</tr>
<tr>
<td style="text-align:center">TARGET_IMMUTABLE</td>
<td style="text-align:center">ç›´æ¥ set é›†åˆ</td>
<td style="text-align:center">å¼‚å¸¸</td>
<td style="text-align:center">ç›´æ¥ set é›†åˆ</td>
<td style="text-align:center">å¼‚å¸¸</td>
<td style="text-align:center">ç›´æ¥ set é›†åˆ</td>
</tr>
</tbody>
</table>
<p>åœ¨ç”Ÿæˆ JPA å®ä½“çš„æƒ…å†µä¸‹ï¼Œé€šå¸¸ä½¿ç”¨ <code>adder</code> æ–¹æ³•å°†å•ä¸ªå…ƒç´ ï¼ˆå®ä½“ï¼‰æ·»åŠ åˆ°é›†åˆä¸­ã€‚åœ¨çˆ¶çº§ï¼ˆæ‰§è¡Œ <code>adder</code> æ–¹æ³•çš„å®ä½“ï¼‰ä¸å­çº§ï¼ˆé›†åˆä¸­çš„å…ƒç´ ï¼Œè¿™äº›å…ƒç´ ä¹Ÿæ˜¯å®ä½“ï¼‰ä¹‹é—´é€šè¿‡è°ƒç”¨ <code>adder</code> æ–¹æ³•æ¥å»ºç«‹çˆ¶å­å…³ç³»ã€‚ä¸ºäº†æ‰¾åˆ°åˆé€‚çš„ <code>adder</code>ï¼ŒMapStruct å°†å°è¯•åœ¨é›†åˆçš„æ³›å‹å‚æ•°ç±»å‹å’Œå€™é€‰çš„ <code>adder</code> çš„å•ä¸ªå‚æ•°ä¹‹é—´è¿›è¡ŒåŒ¹é…ã€‚å½“æœ‰æ›´å¤šçš„å€™é€‰é¡¹æ—¶ï¼Œå¤æ•°å½¢å¼çš„ Setter/Getter åç§°å°†è½¬æ¢ä¸ºå•æ•°ï¼Œå¹¶ç”¨äºåŒ¹é…ã€‚</p>
<p>ä¸åº”è¯¥æ˜¾å¼åœ°ä½¿ç”¨ <code>DEFAULT</code> é€‰é¡¹ã€‚å®ƒç”¨äºåŒºåˆ†ç”¨æˆ·å¸Œæœ›æ˜¾å¼åœ°é‡å†™ <code>@MapperConfig</code> ä¸­çš„é»˜è®¤å€¼ä¸ <code>@Mapper</code> ä¸­ MapStruct çš„éšå¼é€‰æ‹©ã€‚<code>DEFAULT</code> é€‰é¡¹ä¸ <code>ACCESSOR_ONLY</code> åŒä¹‰ã€‚</p>
<p>å½“ä½¿ç”¨ <code>adder</code> æ–¹æ³•å’Œ JPA å®ä½“æ—¶ï¼ŒMapStruct å‡è®¾ç›®æ ‡é›†åˆæ˜¯ä½¿ç”¨è¯¥é›†åˆç±»å‹å¯¹åº”çš„æŸç§å®ç°ï¼ˆæ¯”å¦‚ List ä¸ ArrayListï¼‰æ¥åˆå§‹åŒ–çš„ã€‚å¯ä»¥ä½¿ç”¨å·¥å‚åˆ›å»ºå¸¦æœ‰å·²è¢«åˆå§‹åŒ–çš„é›†åˆçš„æ–°ç›®æ ‡å®ä½“ï¼Œè€Œä¸æ˜¯ MapStruct é€šè¿‡æ„é€ æ–¹æ³•æ¥åˆ›å»ºç›®æ ‡å®ä½“ã€‚</p>
<h2 id="5-4-é›†åˆæ˜ å°„çš„å®ç°ç±»"><a class="header-anchor" href="#5-4-é›†åˆæ˜ å°„çš„å®ç°ç±»"></a>5.4 é›†åˆæ˜ å°„çš„å®ç°ç±»</h2>
<p>å½“è¿­ä»£å™¨æ˜ å°„æ–¹æ³•æˆ– Map æ˜ å°„æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªæ¥å£ç±»å‹ä½œä¸ºè¿”å›ç±»å‹æ—¶ï¼Œå®ƒçš„ä¸€ä¸ªå®ç°ç±»å‹å°†åœ¨ç”Ÿæˆçš„ä»£ç ä¸­è¢«å®ä¾‹åŒ–ã€‚å…·ä½“æ¥å£ç±»å‹ä¸å¯¹åº”çš„å®ç°ç±»å‹å¦‚ä¸‹è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Interface type</th>
<th style="text-align:center">Implementation type</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>Iterable</code></td>
<td style="text-align:center"><code>ArrayList</code></td>
</tr>
<tr>
<td style="text-align:center"><code>Collection</code></td>
<td style="text-align:center"><code>ArrayList</code></td>
</tr>
<tr>
<td style="text-align:center"><code>List</code></td>
<td style="text-align:center"><code>ArrayList</code></td>
</tr>
<tr>
<td style="text-align:center"><code>Set</code></td>
<td style="text-align:center"><code>LinkedHashSet</code></td>
</tr>
<tr>
<td style="text-align:center"><code>SortedSet</code></td>
<td style="text-align:center"><code>TreeSet</code></td>
</tr>
<tr>
<td style="text-align:center"><code>NavigableSet</code></td>
<td style="text-align:center"><code>TreeSet</code></td>
</tr>
<tr>
<td style="text-align:center"><code>Map</code></td>
<td style="text-align:center"><code>LinkedHashMap</code></td>
</tr>
<tr>
<td style="text-align:center"><code>SortedMap</code></td>
<td style="text-align:center"><code>TreeMap</code></td>
</tr>
<tr>
<td style="text-align:center"><code>NavigableMap</code></td>
<td style="text-align:center"><code>TreeMap</code></td>
</tr>
<tr>
<td style="text-align:center"><code>ConcurrentMap</code></td>
<td style="text-align:center"><code>ConcurrentHashMap</code></td>
</tr>
<tr>
<td style="text-align:center"><code>ConcurrentNavigableMap</code></td>
<td style="text-align:center"><code>ConcurrentSkipListMap</code></td>
</tr>
</tbody>
</table>
<h1 id="6-æ˜ å°„-Stream"><a class="header-anchor" href="#6-æ˜ å°„-Stream"></a>6. æ˜ å°„ Stream</h1>
<p><code>java.util.Stream</code> çš„æ˜ å°„å’Œé›†åˆçš„æ˜ å°„æ˜¯ç±»ä¼¼çš„ï¼Œå³é€šè¿‡åœ¨æ˜ å°„å™¨æ¥å£ä¸­å®šä¹‰å…·æœ‰æ‰€éœ€æºå’Œç›®æ ‡ç±»å‹çš„æ˜ å°„æ–¹æ³•ã€‚</p>
<p>ç”Ÿæˆçš„ä»£ç å°†åŒ…å«ä»æ‰€æä¾›çš„è¿­ä»£å™¨æˆ–æ•°ç»„æ¥åˆ›å»ºä¸€ä¸ª <code>Stream</code>ï¼Œæˆ–è€…å°†æ‰€æä¾›çš„ <code>Stream</code> æ”¶é›†åˆ°ä¸€ä¸ªè¿­ä»£å™¨æˆ–æ•°ç»„ä¸­ã€‚å¦‚æœå­˜åœ¨æºå…ƒç´ ç±»å‹å’Œç›®æ ‡å…ƒç´ ç±»å‹çš„æ˜ å°„æ–¹æ³•æˆ–éšå¼è½¬æ¢ï¼Œé‚£ä¹ˆè¿™ç§è½¬æ¢å°†åœ¨ <code>Stream#map()</code> ä¸­å®Œæˆã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    Set&lt;String&gt; <span class="title function_">integerStreamToStringSet</span><span class="params">(Stream&lt;Integer&gt; integers)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;CarDto&gt; <span class="title function_">carsToCarDtos</span><span class="params">(Stream&lt;Car&gt; cars)</span>;</span><br><span class="line"></span><br><span class="line">    CarDto <span class="title function_">carToCarDto</span><span class="params">(Car car)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„ <code>integerStreamToStringSet()</code> æ–¹æ³•çš„å®ç°ä¸ºæ¯ä¸ªå…ƒç´ æ‰§è¡Œä» Integer åˆ° String çš„è½¬æ¢ï¼Œè€Œç”Ÿæˆçš„ <code>carsToCarDtos()</code> æ–¹æ³•çš„å®ç°ä¸ºæ¯ä¸ªåŒ…å«çš„å…ƒç´ æ‰§è¡Œ <code>carToCarDto()</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//GENERATED CODE</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">integerStreamToStringSet</span><span class="params">(Stream&lt;Integer&gt; integers)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (integers == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> integers.map(integer -&gt; String.valueOf(integer))</span><br><span class="line">        .collect(Collectors.toCollection(HashSet&lt;String&gt;::<span class="keyword">new</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CarDto&gt; <span class="title function_">carsToCarDtos</span><span class="params">(Stream&lt;Car&gt; cars)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cars == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cars.map(car -&gt; carToCarDto(car))</span><br><span class="line">        .collect(Collectors.toCollection(ArrayList&lt;CarDto&gt;::<span class="keyword">new</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><mark>æ³¨æ„ï¼š</mark> å¦‚æœè¿›è¡Œäº†ä» <code>Stream</code> åˆ°è¿­ä»£å™¨æˆ–æ•°ç»„çš„æ˜ å°„ï¼Œé‚£ä¹ˆæ‰€ä¼ é€’çš„ <code>Stream</code> å°†è¢«æ¶ˆè´¹ï¼Œå¹¶ä¸”ä¸èƒ½å†æ¶ˆè´¹å®ƒã€‚å› ä¸º Java ä¸­çš„ <code>Stream</code> åªå…è®¸è¢«æ¶ˆè´¹ï¼ˆä½¿ç”¨ï¼‰ä¸€æ¬¡ã€‚</p>
<p>åœ¨è¿›è¡Œ Stream åˆ°è¿­ä»£å™¨çš„æ˜ å°„æ—¶ï¼Œè¿­ä»£å™¨çš„å…·ä½“å®ç°ç±»å‹ä¸ã€5.4 é›†åˆæ˜ å°„çš„å®ç°ç±»ã€‘ä¸­ä¸€è‡´ã€‚</p>
<h1 id="7-æ˜ å°„å€¼"><a class="header-anchor" href="#7-æ˜ å°„å€¼"></a>7. æ˜ å°„å€¼</h1>
<h2 id="7-1-æ˜ å°„æšä¸¾"><a class="header-anchor" href="#7-1-æ˜ å°„æšä¸¾"></a>7.1 æ˜ å°„æšä¸¾</h2>
<p>MapStruct æ”¯æŒå°†ä¸€ç§ Java æšä¸¾ç±»å‹æ˜ å°„åˆ°å¦ä¸€ç§ Java æšä¸¾ç±»å‹çš„æ–¹æ³•çš„ç”Ÿæˆã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæºæšä¸¾ä¸­çš„æ¯ä¸ªæšä¸¾é¡¹éƒ½ä¼šè¢«æ˜ å°„åˆ°ç›®æ ‡æšä¸¾ç±»å‹ä¸­åŒåçš„æšä¸¾é¡¹ã€‚</p>
<p>å¦‚æœéœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨ <code>@ValueMapping</code> æ³¨è§£ï¼ˆè€Œé <code>@Mapping</code>ï¼‰å°†æºæšä¸¾ä¸­çš„æŸä¸ªæšä¸¾é¡¹æ˜ å°„åˆ°å¦ä¸€ä¸ªåç§°çš„æšä¸¾é¡¹ã€‚æºæšä¸¾ä¸­çš„å¤šä¸ªæšä¸¾é¡¹å¯ä»¥æ˜ å°„åˆ°ç›®æ ‡æšä¸¾ä¸­çš„åŒä¸€æšä¸¾é¡¹ã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">OrderMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper( OrderMapper.class );</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ValueMappings(&#123;</span></span><br><span class="line"><span class="meta">        @ValueMapping(source = &quot;EXTRA&quot;, target = &quot;SPECIAL&quot;),</span></span><br><span class="line"><span class="meta">        @ValueMapping(source = &quot;STANDARD&quot;, target = &quot;DEFAULT&quot;),</span></span><br><span class="line"><span class="meta">        @ValueMapping(source = &quot;NORMAL&quot;, target = &quot;DEFAULT&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    ExternalOrderType <span class="title function_">orderTypeToExternalOrderType</span><span class="params">(OrderType orderType)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GENERATED CODE</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">OrderMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ExternalOrderType <span class="title function_">orderTypeToExternalOrderType</span><span class="params">(OrderType orderType)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (orderType == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ExternalOrderType externalOrderType_;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (orderType) &#123;</span><br><span class="line">            <span class="keyword">case</span> EXTRA: </span><br><span class="line">                externalOrderType_ = ExternalOrderType.SPECIAL;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> STANDARD: </span><br><span class="line">                externalOrderType_ = ExternalOrderType.DEFAULT;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> NORMAL: </span><br><span class="line">                externalOrderType_ = ExternalOrderType.DEFAULT;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RETAIL: </span><br><span class="line">                externalOrderType_ = ExternalOrderType.RETAIL;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> B2B: </span><br><span class="line">                externalOrderType_ = ExternalOrderType.B2B;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: </span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>( <span class="string">&quot;Unexpected enum constant: &quot;</span> + orderType );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> externalOrderType_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæºæšä¸¾ç±»å‹çš„æšä¸¾é¡¹åœ¨ç›®æ ‡æšä¸¾ä¸­æ²¡æœ‰åŒåçš„æšä¸¾é¡¹ï¼Œå¹¶ä¸”ä¹Ÿæœªé€šè¿‡ <code>@ValueMapping</code> æ˜ å°„åˆ°å…¶ä»–æšä¸¾å€¼ï¼Œé‚£ä¹ˆ MapStruct å°†äº§ç”Ÿé”™è¯¯ã€‚è¿™ç¡®ä¿äº†æ‰€æœ‰æšä¸¾é¡¹éƒ½ä»¥ä¸€ç§å®‰å…¨ä¸”å¯é¢„æµ‹çš„æ–¹å¼è¿›è¡Œæ˜ å°„ã€‚å¦‚æœç”±äºæŸç§åŸå› å‡ºç°äº†æ— æ³•è¯†åˆ«çš„æºæšä¸¾é¡¹ï¼Œç”Ÿæˆçš„æ˜ å°„æ–¹æ³•å°†æŠ›å‡º IllegalStateExceptionã€‚</p>
<p>MapStruct è¿˜å…·æœ‰å°†ä»»ä½•å‰©ä½™ï¼ˆæœªæŒ‡å®šçš„ï¼‰çš„æ˜ å°„æ˜ å°„åˆ°é»˜è®¤æ˜ å°„çš„æœºåˆ¶ã€‚è¿™åªèƒ½åœ¨åŒä¸€ç»„å€¼æ˜ å°„ä¸­ä½¿ç”¨ä¸€æ¬¡ï¼Œå¹¶ä¸”ä»…é€‚ç”¨äºæºã€‚å®ƒæœ‰ä¸¤ç§ç­–ç•¥ï¼š<code>&lt;ANY_REMAINING&gt;</code> å’Œ <code>&lt;ANY_UNMAPPED&gt;</code>ã€‚<strong>å®ƒä»¬ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚</strong> æ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ValueMapping( source = MappingConstants.ANY_REMAINING, target = &quot;SPECIAL&quot; )</span></span><br><span class="line">ExternalOrderType <span class="title function_">orderTypeToExternalOrderType</span><span class="params">(OrderType orderType)</span>;</span><br></pre></td></tr></table></figure>
<p><code>&lt;ANY_REMAINING&gt;</code>ï¼šåªèƒ½ç”¨åœ¨ <code>source</code> ä¸Šã€‚è¡¨ç¤ºæºæšä¸¾ä¸­é™¤äº†åŒåè‡ªåŠ¨æ˜ å°„å’Œæ˜¾å¼æŒ‡å®šçš„æ˜ å°„å¤–ï¼Œå…¶ä½™æ‰€æœ‰æšä¸¾é¡¹éƒ½æ˜ å°„åˆ°æŒ‡å®šçš„ç›®æ ‡æšä¸¾é¡¹ä¸Šï¼ˆç›¸å½“äº <code>switch</code> ä¸­çš„ <code>default</code>ï¼‰ã€‚</p>
<p><code>&lt;ANY_UNMAPPED&gt;</code>ï¼šåªèƒ½ç”¨åœ¨ <code>source</code> ä¸Šï¼Œä¸èƒ½å’Œ <code>&lt;ANY_REMAINING&gt;</code> åŒæ—¶ä½¿ç”¨ï¼Œä¼šå°†æºæšä¸¾ä¸­é™¤ <strong>æ˜¾å¼</strong> æŒ‡å®šçš„æ˜ å°„å¤–ï¼ˆæ­¤æ—¶åŒåè‡ªåŠ¨æ˜ å°„å°†å¤±æ•ˆï¼‰çš„å…¶ä»–å‰©ä½™æšä¸¾é¡¹æ˜ å°„åˆ°ç›®æ ‡æšä¸¾é¡¹ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰ç»è¿‡ <code>@ValueMapping</code> æ³¨è§£ <strong>æ˜¾å¼</strong> æŒ‡å®šçš„æšä¸¾é¡¹éƒ½ä¼šæ˜ å°„åˆ°ç›®æ ‡æšä¸¾é¡¹ä¸Šã€‚</p>
<p>MapStruct å¯ä»¥é€šè¿‡ <code>&lt;NULL&gt;</code> å¤„ç†æ¥æºçš„ <code>null</code> å€¼å’Œç›®æ ‡çš„ <code>null</code> å€¼ã€‚è®¾ç½®åœ¨ source ä¸Šè¡¨ç¤ºæºæšä¸¾æ˜¯ <code>null</code> æ—¶ï¼Œè¢«æ˜ å°„åˆ°æŒ‡å®šçš„ç›®æ ‡æšä¸¾ï¼›è®¾ç½®åœ¨ target ä¸Šè¡¨ç¤ºç»™å®šçš„æ¥æºæšä¸¾é¡¹æ˜ å°„åˆ° <code>null</code>ã€‚</p>
<p>è¿™ä¸‰ä¸ªå€¼åœ¨ <code>MappingConstants</code> ç±»ä¸­ä»¥å¸¸é‡çš„å½¢å¼å­˜åœ¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MappingConstants</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">MappingConstants</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NULL</span> <span class="operator">=</span> <span class="string">&quot;&lt;NULL&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ANY_REMAINING</span> <span class="operator">=</span> <span class="string">&quot;&lt;ANY_REMAINING&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ANY_UNMAPPED</span> <span class="operator">=</span> <span class="string">&quot;&lt;ANY_UNMAPPED&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@InheritInverseConfiguration</code> å’Œ <code>@InheritConfiguration</code> å¯ä»¥ä¸ <code>@ValueMappings</code> ç»„åˆä½¿ç”¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>&lt;ANY_REMAINING&gt;</code> å’Œ <code>&lt;ANY_UNMAPPED&gt;</code> ä¼šè¢«å¿½ç•¥ã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SpecialOrderMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">SpecialOrderMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(SpecialOrderMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ValueMappings(&#123;</span></span><br><span class="line"><span class="meta">        @ValueMapping(source = MappingConstants.NULL, target = &quot;DEFAULT&quot;),</span></span><br><span class="line"><span class="meta">        @ValueMapping(source = &quot;STANDARD&quot;, target = MappingConstants.NULL),</span></span><br><span class="line"><span class="meta">        @ValueMapping(source = MappingConstants.ANY_REMAINING, target = &quot;SPECIAL&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    ExternalOrderType <span class="title function_">orderTypeToExternalOrderType</span><span class="params">(OrderType orderType)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GENERATED CODE</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpecialOrderMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">SpecialOrderMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ExternalOrderType <span class="title function_">orderTypeToExternalOrderType</span><span class="params">(OrderType orderType)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( orderType == <span class="literal">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> ExternalOrderType.DEFAULT;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ExternalOrderType externalOrderType_;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> ( orderType ) &#123;</span><br><span class="line">            <span class="keyword">case</span> STANDARD: externalOrderType_ = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RETAIL: externalOrderType_ = ExternalOrderType.RETAIL;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> B2B: externalOrderType_ = ExternalOrderType.B2B;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: externalOrderType_ = ExternalOrderType.SPECIAL;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> externalOrderType_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <code>&lt;ANY_UNMAPPED&gt;</code> æ—¶ï¼ŒMapStruct å°†ä¸ä¼šè‡ªåŠ¨æ˜ å°„ <code>RETAIL</code> å’Œ <code>B2B</code>ã€‚</p>
<p><strong>ä¸å»ºè®®</strong> ä½¿ç”¨ <code>@Mapping</code> æ³¨è§£å°†æšä¸¾æ˜ å°„åˆ°æšä¸¾ã€‚ä½¿ç”¨ <code>@Mapping</code> æ³¨è§£æ¥æ˜ å°„æšä¸¾çš„æ–¹å¼å°†åœ¨æœªæ¥çš„ MapStruct ç‰ˆæœ¬ä¸­åˆ é™¤ã€‚</p>
<h2 id="7-2-æšä¸¾ä¸å­—ç¬¦ä¸²çš„ç›¸äº’æ˜ å°„"><a class="header-anchor" href="#7-2-æšä¸¾ä¸å­—ç¬¦ä¸²çš„ç›¸äº’æ˜ å°„"></a>7.2 æšä¸¾ä¸å­—ç¬¦ä¸²çš„ç›¸äº’æ˜ å°„</h2>
<p>MapStruct æ”¯æŒæšä¸¾ä¸å­—ç¬¦ä¸²é—´çš„ç›¸äº’æ˜ å°„ï¼Œè¿™ä¸æšä¸¾ä¸æšä¸¾ä¹‹é—´çš„æ˜ å°„å¾ˆç±»ä¼¼ï¼Œä½†ä¹Ÿå­˜åœ¨ç€éƒ¨åˆ†å·®å¼‚ã€‚</p>
<blockquote>
<p>æšä¸¾æ˜ å°„åˆ°å­—ç¬¦ä¸²</p>
</blockquote>
<ol>
<li>ç›¸åŒï¼šåœ¨æœªæ˜¾å¼å®šä¹‰æ˜ å°„æ–¹å¼çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæºæšä¸¾é¡¹è¢«æ˜ å°„ä¸ºå…·æœ‰ç›¸åŒåç§°çš„ <code>String</code> å€¼ã€‚</li>
<li>ç›¸åŒï¼š<code>&lt;ANY_UNMAPPED&gt;</code> åœ¨å¤„ç†å®šä¹‰çš„æ˜ å°„ååœæ­¢ï¼Œå¹¶ç»§ç»­æ‰§è¡Œ switch ä¸­ default å­å¥å€¼ã€‚</li>
<li>å·®å¼‚ï¼š<strong>ä¸æ”¯æŒ</strong> <code>&lt;ANY_REMAINING&gt;</code> ï¼Œä½¿ç”¨è¿™ä¸ªå€¼å°†å¯¼è‡´é”™è¯¯ã€‚å®ƒçš„ä½œç”¨å‰ææ˜¯æºæšä¸¾é¡¹å’Œç›®æ ‡æšä¸¾é¡¹ä¹‹é—´å­˜åœ¨åç§°ç›¸ä¼¼æ€§ï¼Œè€Œè¿™å¯¹äº <code>String</code> ç±»å‹æ²¡æœ‰æ„ä¹‰ã€‚</li>
<li>å·®å¼‚ï¼šé‰´äº <code>1.</code> å’Œ <code>3.</code> å› æ­¤æ°¸è¿œä¸ä¼šæœ‰æœªæ˜ å°„çš„å€¼ã€‚</li>
</ol>
<blockquote>
<p>å­—ç¬¦ä¸²æ˜ å°„åˆ°æšä¸¾</p>
</blockquote>
<ol>
<li>ç›¸åŒï¼šåœ¨æœªæ˜¾å¼å®šä¹‰æ˜ å°„æ–¹å¼çš„æƒ…å†µä¸‹ï¼Œç»™å®šçš„ <code>String</code> å°†è¢«æ˜ å°„åˆ°ä¸ç›®æ ‡æšä¸¾é¡¹åç§°åŒ¹é…çš„å€¼ã€‚</li>
<li>ç›¸åŒï¼š<code>&lt;ANY_UNMAPPED&gt;</code> åœ¨å¤„ç†å®šä¹‰çš„æ˜ å°„ååœæ­¢ï¼Œå¹¶ç»§ç»­æ‰§è¡Œ switch ä¸­ default å­å¥å€¼ã€‚</li>
<li>ç›¸åŒï¼š<code>&lt;ANY_REMAINING&gt;</code> å°†ä¸ºæ¯ä¸ªç›®æ ‡æšä¸¾é¡¹åˆ›å»ºä¸€ä¸ªæ˜ å°„ï¼Œç„¶åç»§ç»­æ‰§è¡Œ switch ä¸­ default å­å¥å€¼ã€‚</li>
<li>å·®å¼‚ï¼šéœ€è¦æä¾› switch ä¸­ default å­å¥æ‰èƒ½å¾—å‡ºç¡®å®šçš„ç»“æœï¼ˆæšä¸¾å€¼é›†æœ‰é™ï¼Œ<code>String</code> é€‰é¡¹ä¸é™ï¼‰ã€‚ä¸æŒ‡å®š <code>&lt;ANY_REMAINING&gt;</code> æˆ– <code>&lt;ANY_UNMAPPED&gt;</code> å°†å‡ºç°è­¦å‘Šã€‚</li>
</ol>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ExternalOrderType</span> &#123;</span><br><span class="line">    DEFAULT,</span><br><span class="line"></span><br><span class="line">    RETAIL,</span><br><span class="line"></span><br><span class="line">    B2B,</span><br><span class="line"></span><br><span class="line">    SPECIAL,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EnumStringMapper</span> &#123;</span><br><span class="line">    <span class="type">EnumStringMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper(EnumStringMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ValueMappings(&#123;</span></span><br><span class="line"><span class="meta">            @ValueMapping(source = MappingConstants.NULL, target = &quot;DEFAULT&quot;),</span></span><br><span class="line"><span class="meta">            @ValueMapping(source = &quot;RETAIL&quot;, target = MappingConstants.NULL),</span></span><br><span class="line"><span class="meta">            @ValueMapping(source = MappingConstants.ANY_UNMAPPED, target = &quot;SPECIAL&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    String <span class="title function_">enumToString</span><span class="params">(ExternalOrderType type)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ValueMappings(&#123;</span></span><br><span class="line"><span class="meta">            @ValueMapping(source = MappingConstants.NULL, target = &quot;DEFAULT&quot;),</span></span><br><span class="line"><span class="meta">            @ValueMapping(source = &quot;STANDARD&quot;, target = MappingConstants.NULL),</span></span><br><span class="line"><span class="meta">            @ValueMapping(source = MappingConstants.ANY_UNMAPPED, target = &quot;SPECIAL&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    ExternalOrderType <span class="title function_">stringToEnumWithUnmapped</span><span class="params">(String str)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ValueMappings(&#123;</span></span><br><span class="line"><span class="meta">            @ValueMapping(source = MappingConstants.NULL, target = &quot;DEFAULT&quot;),</span></span><br><span class="line"><span class="meta">            @ValueMapping(source = &quot;STANDARD&quot;, target = MappingConstants.NULL),</span></span><br><span class="line"><span class="meta">            @ValueMapping(source = MappingConstants.ANY_REMAINING, target = &quot;SPECIAL&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    ExternalOrderType <span class="title function_">stringToEnumWithRemaining</span><span class="params">(String str)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumStringMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">EnumStringMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">enumToString</span><span class="params">(ExternalOrderType type)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( type == <span class="literal">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;DEFAULT&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String string;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> ( type ) &#123;</span><br><span class="line">            <span class="keyword">case</span> RETAIL: string = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: string = <span class="string">&quot;SPECIAL&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> string;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ExternalOrderType <span class="title function_">stringToEnumWithUnmapped</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( str == <span class="literal">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> ExternalOrderType.DEFAULT;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ExternalOrderType externalOrderType;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> ( str ) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;STANDARD&quot;</span>: externalOrderType = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: externalOrderType = ExternalOrderType.SPECIAL;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> externalOrderType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ExternalOrderType <span class="title function_">stringToEnumWithRemaining</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ( str == <span class="literal">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> ExternalOrderType.DEFAULT;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ExternalOrderType externalOrderType;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> ( str ) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;STANDARD&quot;</span>: externalOrderType = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;DEFAULT&quot;</span>: externalOrderType = ExternalOrderType.DEFAULT;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;RETAIL&quot;</span>: externalOrderType = ExternalOrderType.RETAIL;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;B2B&quot;</span>: externalOrderType = ExternalOrderType.B2B;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;SPECIAL&quot;</span>: externalOrderType = ExternalOrderType.SPECIAL;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: externalOrderType = ExternalOrderType.SPECIAL;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> externalOrderType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7-3-è‡ªå®šä¹‰åç§°è½¬æ¢"><a class="header-anchor" href="#7-3-è‡ªå®šä¹‰åç§°è½¬æ¢"></a>7.3 è‡ªå®šä¹‰åç§°è½¬æ¢</h2>
<p>åœ¨æœªä½¿ç”¨ <code>@ValueMapping</code> çš„æƒ…å†µä¸‹ï¼Œæºæšä¸¾ä¸­çš„æ¯ä¸ªæšä¸¾é¡¹å°† <strong>é»˜è®¤</strong> æ˜ å°„åˆ°ç›®æ ‡æšä¸¾ä¸­å…·æœ‰ç›¸åŒåç§°çš„æšä¸¾é¡¹ã€‚</p>
<p>ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæºæšä¸¾éœ€è¦åœ¨è¿›è¡Œæ˜ å°„ä¹‹å‰è¿›è¡Œè½¬æ¢ã€‚æ¯”å¦‚ç›®æ ‡æšä¸¾ç›¸æ¯”æºæšä¸¾å¢åŠ äº†ç»Ÿä¸€çš„åç¼€å‘¢ï¼Œè¿™æ—¶å€™å°†æ— æ³•è¿›è¡ŒåŒåè‡ªåŠ¨æ˜ å°„ã€‚</p>
<p>ä½¿ç”¨ <code>@ValueMapping</code> ä¾æ¬¡æŒ‡å®šæ˜ å°„è§„åˆ™å›ºç„¶å¯ä»¥ï¼Œä½†ç›¸å¯¹ç¹çã€‚MapStruct æä¾›äº†ä¸€ä¸ªåä¸º <code>@EnumMapping</code> çš„æ³¨è§£æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<blockquote>
<p>å…·ä½“ä½¿ç”¨</p>
</blockquote>
<p>å‡è®¾æœ‰å¦‚ä¸‹ä¸¤ä¸ªæšä¸¾ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CheeseType</span> &#123;</span><br><span class="line">    BRIE,</span><br><span class="line">    ROQUEFORT</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CheeseTypeSuffixed</span> &#123;</span><br><span class="line">    BRIE_TYPE,</span><br><span class="line">    ROQUEFORT_TYPE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥è¿™æ ·å®šä¹‰ Mapper æ¥å£å®ç°ä¸¤ä¸ªæšä¸¾ç±»ä¹‹é—´çš„è½¬æ¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CheeseMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">CheeseMapper</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> Mappers.getMapper( CheeseMapper.class );</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnumMapping(nameTransformationStrategy = &quot;suffix&quot;, configuration = &quot;_TYPE&quot;)</span></span><br><span class="line">    CheeseTypeSuffixed <span class="title function_">map</span><span class="params">(CheeseType cheese)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InheritInverseConfiguration</span> <span class="comment">// ç”¨äºåå‘æ˜ å°„</span></span><br><span class="line">    CheeseType <span class="title function_">map</span><span class="params">(CheeseTypeSuffix cheese)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆç”Ÿæˆçš„å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GENERATED CODE</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheeseSuffixMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">CheeseSuffixMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CheeseTypeSuffixed <span class="title function_">map</span><span class="params">(CheeseType cheese)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (cheese == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CheeseTypeSuffixed cheeseTypeSuffixed;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (cheese) &#123;</span><br><span class="line">            <span class="keyword">case</span> BRIE: </span><br><span class="line">                cheeseTypeSuffixed = CheeseTypeSuffixed.BRIE_TYPE;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ROQUEFORT: </span><br><span class="line">                cheeseTypeSuffixed = CheeseTypeSuffixed.ROQUEFORT_TYPE;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: </span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unexpected enum constant: &quot;</span> + cheese);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cheeseTypeSuffixed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CheeseType <span class="title function_">map</span><span class="params">(CheeseTypeSuffixed cheese)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (cheese == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CheeseType cheeseType;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (cheese) &#123;</span><br><span class="line">            <span class="keyword">case</span> BRIE_TYPE: </span><br><span class="line">                cheeseType = CheeseType.BRIE;</span><br><span class="line">                   <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> ROQUEFORT_TYPE: </span><br><span class="line">                cheeseType = CheeseType.ROQUEFORT;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>: </span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unexpected enum constant: &quot;</span> + cheese);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cheeseType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MapStruct æä¾›äº†ä»¥ä¸‹å››ç§å¼€ç®±å³ç”¨çš„æšä¸¾åç§°è½¬æ¢ç­–ç•¥ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">åç§°</th>
<th style="text-align:center">å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">suffix</td>
<td style="text-align:center">ä¸ºæºæšä¸¾æ·»åŠ åç¼€</td>
</tr>
<tr>
<td style="text-align:center">stripSuffix</td>
<td style="text-align:center">ä»æºæšä¸¾ä¸­åˆ é™¤åç¼€</td>
</tr>
<tr>
<td style="text-align:center">prefix</td>
<td style="text-align:center">ä¸ºæºæšä¸¾æ·»åŠ å‰ç¼€</td>
</tr>
<tr>
<td style="text-align:center">stripPrefix</td>
<td style="text-align:center">ä»æºæšä¸¾ä¸­åˆ é™¤å‰ç¼€</td>
</tr>
</tbody>
</table>
<p>åœ¨ MapStruct 1.5.0.Final ä¸­æ–°å¢è½¬æ¢ç­–ç•¥ <code>case</code>ï¼Œè¿™ç§ç­–ç•¥å°†ä¸ºæºæšä¸¾è¿›è¡Œå¤§å°å†™è½¬æ¢ï¼Œæ”¯æŒçš„æ–¹å¼æœ‰ï¼š</p>
<ul>
<li><code>upper</code>ï¼šå°†æºæšä¸¾è½¬æ¢ä¸ºå¤§å†™</li>
<li><code>lower</code>ï¼šå°†æºæšä¸¾è½¬æ¢ä¸ºå¤§å†™</li>
<li><code>capital</code>ï¼šå°†æºæšä¸¾ä¸­æ¯ä¸ªå•è¯çš„é¦–å­—æ¯å¤§å†™ï¼Œå…¶ä½™å­—æ¯å°å†™ï¼Œæ¯ä¸ªå•è¯ä¹‹é—´ä»¥ä¸‹åˆ’çº¿åˆ†å‰²</li>
</ul>
<p>ä¹Ÿå¯ä»¥æ³¨å†Œè‡ªå®šä¹‰ç­–ç•¥ï¼Œè¿™ä¼šåœ¨åæ–‡ä¸­è®²åˆ°ã€‚</p>
<h1 id="8-Spring-æ‹“å±•"><a class="header-anchor" href="#8-Spring-æ‹“å±•"></a>8. Spring æ‹“å±•</h1>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://mapstruct.org/documentation/spring-extensions/reference/html/">MapStruct Spring Extensions 1.0.0 Reference Guide</a></p>
<p>MapStruct Spring Extensions æ˜¯ä¸€ä¸ª Java æ³¨é‡Šå¤„ç†å™¨ï¼Œå®ƒæ‰©å±•äº†è‘—åçš„ MapStruct é¡¹ç›®å¹¶å¸¦æœ‰ Spring æ¡†æ¶ç‰¹æ€§ã€‚</p>
<p>åœ¨ Spring æœ‰ä¸€ä¸ªåä¸º <code>Converter</code>ï¼Œé‡å†™è¯¥æ¥å£çš„ <code>convert()</code> æ–¹æ³•åï¼Œå¯ä»¥å°†æŸä¸ªå¯¹è±¡è½¬æ¢æˆå¦ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ MapStruct çš„åŠŸèƒ½ä¸è°‹è€Œåˆã€‚ä½¿ç”¨ MapStruct Spring Extensions åï¼Œåœ¨ç¼–è¯‘æœŸé—´å°†ç”Ÿæˆä¸€ä¸ªé€‚é…å™¨ï¼Œè¯¥é€‚é…å™¨å…è®¸æ ‡å‡† MapStruct æ˜ å°„å™¨ä½¿ç”¨ Spring çš„ <code>ConversionService</code>ã€‚</p>
<p>è¿™ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåœ¨å…¶ <code>uses</code> å±æ€§ä¸­ä»…ä½¿ç”¨ <code>ConversionService</code> æ¥å®šä¹‰ MapStruct æ˜ å°„å™¨ï¼Œè€Œä¸å¿…å•ç‹¬å¯¼å…¥æ¯ä¸ª Mapperï¼Œä»è€Œä½¿å¾—å„ä¸ª Mapper ä¹‹é—´è§£è€¦ã€‚</p>
<p><mark>æ³¨æ„ï¼š</mark> MapStruct Spring Extensions è‡³å°‘è¦åœ¨ MapStruct 1.4.0.Final çš„ç‰ˆæœ¬ä¸Šè¿è¡Œï¼</p>
<h2 id="8-1-æ‰€é€‰ä¾èµ–ä¿¡æ¯"><a class="header-anchor" href="#8-1-æ‰€é€‰ä¾èµ–ä¿¡æ¯"></a>8.1 æ‰€é€‰ä¾èµ–ä¿¡æ¯</h2>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    åˆ«ç”¨æœ€æ–°ç‰ˆï¼Œ1.5.x ç”± JDK11 ç¼–è¯‘    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">org.mapstruct.version</span>&gt;</span>1.4.2.Final<span class="tag">&lt;/<span class="name">org.mapstruct.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">org.mapstruct.extensions.spring.version</span>&gt;</span>0.1.1<span class="tag">&lt;/<span class="name">org.mapstruct.extensions.spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    å°±ç”¨è¿™ç‰ˆæœ¬ï¼Œå¦åˆ™å¯èƒ½å‡ºç° No property named â€œXXXâ€œ exists in source parameter(s) çš„é”™è¯¯    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lomnok.version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">lomnok.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.mapstruct.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lomnok.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct.extensions.spring<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct-spring-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.mapstruct.extensions.spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span> <span class="comment">&lt;!-- depending on your project --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span> <span class="comment">&lt;!-- depending on your project --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">annotationProcessorPaths</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.mapstruct.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mapstruct.extensions.spring<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapstruct-spring-extensions<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;org.mapstruct.extensions.spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--ä½¿ç”¨ Lombok åï¼Œè¿™é‡Œä¹Ÿè¦æ·»åŠ --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">path</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lomnok.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- other annotation processors --&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">annotationProcessorPaths</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="8-2-æ˜ å°„å™¨ä½œä¸ºè½¬æ¢å™¨"><a class="header-anchor" href="#8-2-æ˜ å°„å™¨ä½œä¸ºè½¬æ¢å™¨"></a>8.2 æ˜ å°„å™¨ä½œä¸ºè½¬æ¢å™¨</h2>
<p>æ–°å»º MapStruct æ˜ å°„å™¨æ¥å£ï¼Œç»§æ‰¿ Spring çš„ <code>Converter</code> æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> indi.mofan.converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.convert.converter.Converter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper(componentModel = &quot;spring&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarConverter</span> <span class="keyword">extends</span> <span class="title class_">Converter</span>&lt;Car, CarDto&gt; &#123;</span><br><span class="line">    <span class="meta">@Mappings(&#123;</span></span><br><span class="line"><span class="meta">            @Mapping(target = &quot;seatCount&quot;, source = &quot;numberOfSeats&quot;),</span></span><br><span class="line"><span class="meta">            @Mapping(target = &quot;manufacturingDate&quot;, source = &quot;manufacturingDate&quot;, dateFormat = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    CarDto <span class="title function_">convert</span><span class="params">(Car car)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºè¿™ä¸ªæ˜ å°„å™¨ç¼–å†™ä¸€ä¸€æ®µæµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/2/26 21:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringExtensionsTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ConversionService conversionService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleUse</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">manufacturingDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;Morris&quot;</span>, <span class="number">5</span>,  <span class="string">&quot;Sedan&quot;</span>, manufacturingDate);</span><br><span class="line">        <span class="type">CarDto</span> <span class="variable">carDto</span> <span class="operator">=</span> conversionService.convert(car, CarDto.class);</span><br><span class="line">        Assert.assertNotNull(carDto);</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;Morris&quot;</span>, carDto.getMake());</span><br><span class="line">        Assert.assertEquals(<span class="number">5</span>, carDto.getSeatCount());</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;Sedan&quot;</span>, carDto.getType());</span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> format.format(manufacturingDate);</span><br><span class="line">        Assert.assertEquals(date, carDto.getManufacturingDate());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•ä»£ç åï¼Œæµ‹è¯•å¹¶æ²¡æœ‰é€šè¿‡ï¼Œæç¤º Spring å®¹å™¨ä¸­ä¸å­˜åœ¨ <code>ConversionService</code> çš„ Beanã€‚</p>
<p>å°è¯•åœ¨ Spring é…ç½®ç±» <code>SpringConfig</code> ä¸­æ·»åŠ  <code>ConversionService</code> ç±»å‹çš„ Bean åï¼Œå†æ¬¡è¿è¡Œï¼Œä¾æ—§æµ‹è¯•å¤±è´¥ï¼Œæç¤ºä¸å­˜åœ¨ç›®æ ‡è½¬æ¢å™¨ã€‚</p>
<p>å› æ­¤è¿˜éœ€è¦å°†å®šä¹‰çš„è½¬æ¢å™¨æ³¨å…¥åˆ° <code>ConversionService</code> ç±»å‹çš„ Bean ä¸­ï¼Œæœ€ç»ˆ Spring é…ç½®ç±»ä¸­çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;indi.mofan.mapper&quot;, &quot;indi.mofan.converter&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> &lt;S, T&gt; DefaultConversionService <span class="title function_">conversionService</span><span class="params">(List&lt;Converter&lt;S, T&gt;&gt; converters)</span> &#123;</span><br><span class="line">        <span class="type">DefaultConversionService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConversionService</span>();</span><br><span class="line">        converters.forEach(service::addConverter);</span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>@ComponentScan</code> æ³¨è§£æ‰«æçš„ <code>indi.mofan.converter</code> åŒ…ä¸ºè½¬æ¢å™¨æ‰€åœ¨çš„åŒ…ã€‚</p>
<p>æœ€åå†æ¬¡è¿è¡Œæµ‹è¯•æ–¹æ³•åï¼Œæµ‹è¯•é€šè¿‡ã€‚</p>
<h2 id="8-3-ConversionServiceAdapter"><a class="header-anchor" href="#8-3-ConversionServiceAdapter"></a>8.3 ConversionServiceAdapter</h2>
<p>ä½¿ç”¨ MapStruct Spring Extensions åï¼Œä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰è½¬æ¢æ–¹æ³•çš„é€‚é…å™¨ç±» â€”â€” <code>ConversionServiceAdapter</code>ã€‚</p>
<p>å½“ä¸€ä¸ª Mapper è°ƒç”¨å¦ä¸€ä¸ª Mapper æ—¶ï¼Œéœ€è¦åœ¨è°ƒç”¨ Mapper çš„ <code>@Mapper#uses</code> å±æ€§ä¸­æŒ‡å®šè¢«è°ƒç”¨çš„ Mapper ä¿¡æ¯ï¼Œè¿™ä¼šé€ æˆä¸¤ä¸ª Mapper ä¹‹é—´çš„è€¦åˆã€‚</p>
<p>åˆ©ç”¨ç”Ÿæˆçš„é€‚é…å™¨ç±»ï¼Œç°åœ¨åªéœ€è¦åœ¨ <code>@Mapper#uses</code> æŒ‡å®š <code>ConversionServiceAdapter</code> å³å¯ï¼Œè€Œä¸æ˜¯å…·ä½“çš„ Mapperã€‚</p>
<blockquote>
<p>ä»£ç ç¤ºä¾‹</p>
</blockquote>
<p>è¢«è°ƒç”¨çš„ Mapperï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(componentModel = &quot;spring&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AnimalConverter</span> <span class="keyword">extends</span> <span class="title class_">Converter</span>&lt;Animal, DogDto&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    DogDto <span class="title function_">convert</span><span class="params">(Animal source)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨çš„ Mapperï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.mapstruct.extensions.spring.converter.ConversionServiceAdapter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> mofan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/2/27 0:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="meta">@Mapper(componentModel = &quot;spring&quot;, uses = ConversionServiceAdapter.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CageConverter</span> <span class="keyword">extends</span> <span class="title class_">Converter</span>&lt;Cage, CageDto&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;animal&quot;, target = &quot;dog&quot;)</span></span><br><span class="line">    CageDto <span class="title function_">convert</span><span class="params">(Cage source)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤ç”Ÿæˆçš„ <code>ConversionServiceAdapter</code> åœ¨ <code>org.mapstruct.extensions.spring.converter</code> åŒ…ä¸‹ï¼Œåœ¨æœªç¼–è¯‘å‰ï¼Œè¿™äº›ä»£ç å¯èƒ½æŠ¥é”™ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œå¤§èƒ†è¿è¡Œï¼</p>
<p>è¿˜è¦åœ¨ Spring çš„é…ç½®ç±»ä¸­è®© Spring æ‰«æ <code>ConversionServiceAdapter</code> æ‰€åœ¨çš„åŒ…ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;indi.mofan.mapper&quot;, &quot;indi.mofan.converter&quot;, &quot;org.mapstruct.extensions.spring.converter&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUseAdapter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Cage</span> <span class="variable">cage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cage</span>();</span><br><span class="line">    <span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;å°é»‘&quot;</span>, <span class="string">&quot;Dog&quot;</span>);</span><br><span class="line">    cage.setAnimal(animal);</span><br><span class="line">    cage.setName(<span class="string">&quot;å°é»‘çš„å®¶&quot;</span>);</span><br><span class="line">    cage.setSize(<span class="string">&quot;70*50*60&quot;</span>);</span><br><span class="line">    <span class="type">CageDto</span> <span class="variable">cageDto</span> <span class="operator">=</span> conversionService.convert(cage, CageDto.class);</span><br><span class="line">    Assert.assertNotNull(cageDto);</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;å°é»‘çš„å®¶&quot;</span>, cageDto.getName());</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;70*50*60&quot;</span>, cageDto.getSize());</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;å°é»‘&quot;</span>, cageDto.getDog().getName());</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;Dog&quot;</span>, cageDto.getDog().getType());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œæµ‹è¯•æ–¹æ³•åï¼Œæµ‹è¯•é€šè¿‡ï¼</p>
<h2 id="8-4-è‡ªå®šä¹‰åç§°"><a class="header-anchor" href="#8-4-è‡ªå®šä¹‰åç§°"></a>8.4 è‡ªå®šä¹‰åç§°</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆçš„é€‚é…å™¨åä¸º <code>ConversionServiceAdapter</code>ï¼Œåœ¨ <code>org.mapstruct.extensions.spring.converter</code> åŒ…ä¸‹ã€‚</p>
<p>å¦‚æœæƒ³è¦è‡ªå®šä¹‰åç§°å’ŒåŒ…åï¼Œå¯ä»¥ä½¿ç”¨ <code>@SpringMapperConfig</code> æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringMapperConfig(</span></span><br><span class="line"><span class="meta">    conversionServiceAdapterPackage = &quot;indi.mofan.adapter&quot;,</span></span><br><span class="line"><span class="meta">    conversionServiceAdapterClassName = &quot;MyAdapter&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MapperSpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šç”Ÿæˆçš„é€‚é…å™¨åä¸º <code>MyAdapter</code>ï¼Œæ‰€åœ¨åŒ…è·¯å¾„ä¸º <code>indi.mofan.adapter</code>ã€‚è¿™æ · Spring åœ¨æ‰«æåŒ…æ—¶å°±ä¸ç”¨å†æ‰«æ <code>org.mapstruct.extensions.spring.converter</code>ï¼Œç›´æ¥æ‰«æ <code>indi.mofan</code> å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;indi.mofan&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <code>@SpringMapperConfig</code> æ³¨è§£å¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡å®š <code>conversionServiceAdapterPackage</code>ï¼Œé‚£ä¹ˆé€‚é…å™¨ç±»å°†ç”Ÿæˆåœ¨ <code>@SpringMapperConfig</code> æ‰€æ ‡è®°çš„ç±»çš„ç›¸åŒè·¯å¾„ä¸‹ã€‚</p>
<h2 id="8-5-æŒ‡å®š-ConversionService-Bean-çš„åç§°"><a class="header-anchor" href="#8-5-æŒ‡å®š-ConversionService-Bean-çš„åç§°"></a>8.5 æŒ‡å®š ConversionService Bean çš„åç§°</h2>
<p>å½“ Spring å®¹å™¨ä¸­å­˜åœ¨å¤šä¸ª <code>ConversionService</code> ç±»å‹çš„ Bean æ—¶ï¼Œéœ€è¦æŒ‡å®š MapStruct Spring Extensions æ‰€ç”¨çš„ <code>ConversionService</code> ç±»å‹çš„ Bean çš„åç§°ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ <code>@SpringMapperConfig</code> æ³¨è§£çš„ <code>conversionServiceBeanName</code> å±æ€§è¿›è¡ŒæŒ‡å®šã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringMapperConfig(</span></span><br><span class="line"><span class="meta">    conversionServiceAdapterPackage = &quot;indi.mofan.adapter&quot;,</span></span><br><span class="line"><span class="meta">    conversionServiceAdapterClassName = &quot;MyAdapter&quot;,</span></span><br><span class="line"><span class="meta">    conversionServiceBeanName = &quot;myConversionService&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MapperSpringConfig</span> &#123;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>Spring é…ç½®ç±»ä¸­æ³¨å…¥ <code>ConversionService</code> ç±»å‹çš„ Bean çš„æ–¹æ³•åå‘ç”Ÿå˜åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> &lt;S, T&gt; DefaultConversionService <span class="title function_">myConversionService</span><span class="params">(List&lt;Converter&lt;S, T&gt;&gt; converters)</span> &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Bean</code> æ³¨è§£é€šè¿‡æ‰€æ ‡è®°çš„æ–¹æ³•åç§°æ¥æŒ‡å®š Bean çš„åç§°ã€‚</p>
<p>è€Œåœ¨ä¾èµ–æ³¨å…¥ <code>ConversionService</code> çš„åœ°æ–¹ï¼Œéœ€è¦ä½¿ç”¨ <code>@Qualifier</code> æ³¨è§£æŒ‡å®š Bean çš„åç§°ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;myConversionService&quot;)</span></span><br><span class="line"><span class="keyword">private</span> ConversionService conversionService;</span><br></pre></td></tr></table></figure>
<h2 id="8-6-å¤–ç½®è½¬æ¢"><a class="header-anchor" href="#8-6-å¤–ç½®è½¬æ¢"></a>8.6 å¤–ç½®è½¬æ¢</h2>
<p>Spring æä¾›äº†è®¸å¤šçš„å†…ç½®è½¬æ¢ï¼Œæ¯”å¦‚å°† <code>String</code> ç±»å‹è½¬æ¢æˆ <code>Locale</code> ç±»å‹ï¼Œå°† <code>Object</code> ç±»å‹è½¬æ¢æˆ <code>Optional</code> ç±»å‹ã€‚ä¸ºäº†ä½¿ MapStruct åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¹Ÿèƒ½ä½¿ç”¨è¿™äº›è½¬æ¢å™¨ï¼Œå¯ä»¥åœ¨ <code>@SpringMapperConfig</code> æ³¨è§£çš„ <code>externalConversions</code> å±æ€§ä¸­æŒ‡å®šä½¿ç”¨çš„å¤–ç½®è½¬æ¢ã€‚</p>
<p>åœ¨ä¸ Spring çš„æ•´åˆè¿‡ç¨‹ä¸­ï¼Œæ˜ å°„å™¨çš„ <code>@Mapper</code> æ³¨è§£éƒ½è¦æŒ‡å®š <code>componentModel</code> ä¸º <code>spring</code>ï¼Œå¦‚æœè¿˜æœ‰è°ƒç”¨ Mapper çš„æƒ…å†µï¼Œè¿˜éœ€è¦æŒ‡å®š <code>uses</code> ä¸ºç”Ÿæˆçš„é€‚é…å™¨ç±»å‹ã€‚å½“é…ç½®æ›´å¤šæ—¶ï¼Œé‡å¤çš„ <code>@Mapper</code> çœ‹ç€ååˆ†æ¶å¿ƒï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ <code>@MapperConfig</code> æ³¨è§£æ¥å…±äº«é…ç½®ï¼Œè€Œååœ¨ <code>@Mapper</code> æ³¨è§£ä¸­æŒ‡å®š <code>config</code> å±æ€§å€¼ä¸º <code>@MapperConfig</code> æ ‡è®°çš„ç±»å³å¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperConfig(componentModel = &quot;spring&quot;, uses = MyAdapter.class)</span></span><br><span class="line"><span class="meta">@SpringMapperConfig(</span></span><br><span class="line"><span class="meta">        conversionServiceAdapterPackage = &quot;indi.mofan.adapter&quot;,</span></span><br><span class="line"><span class="meta">        conversionServiceAdapterClassName = &quot;MyAdapter&quot;,</span></span><br><span class="line"><span class="meta">        conversionServiceBeanName = &quot;myConversionService&quot;,</span></span><br><span class="line"><span class="meta">        externalConversions = &#123;@ExternalConversion(</span></span><br><span class="line"><span class="meta">                sourceType = CarDto.class,</span></span><br><span class="line"><span class="meta">                targetType = Optional.class</span></span><br><span class="line"><span class="meta">        )&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MapperSpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ–°å®šä¹‰çš„è½¬æ¢å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper(config = MapperSpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OptionalConverter</span> <span class="keyword">extends</span> <span class="title class_">Converter</span>&lt;NestedDto, OptionalDto&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Mapping(source = &quot;carDto&quot;, target = &quot;optional&quot;)</span></span><br><span class="line">    OptionalDto <span class="title function_">convert</span><span class="params">(NestedDto source)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testExternalConversions</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">CarDto</span> <span class="variable">carDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarDto</span>();</span><br><span class="line">    carDto.setMake(<span class="string">&quot;Morris&quot;</span>);</span><br><span class="line">    <span class="type">NestedDto</span> <span class="variable">nestedDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NestedDto</span>();</span><br><span class="line">    nestedDto.setCarDto(carDto);</span><br><span class="line"></span><br><span class="line">    <span class="type">OptionalDto</span> <span class="variable">convert</span> <span class="operator">=</span> conversionService.convert(nestedDto, OptionalDto.class);</span><br><span class="line">    Assert.assertNotNull(convert);</span><br><span class="line">    Optional&lt;CarDto&gt; optional = convert.getOptional();</span><br><span class="line">    Assert.assertNotNull(optional);</span><br><span class="line">    Assert.assertTrue(optional.isPresent());</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;Morris&quot;</span>, optional.map(CarDto::getMake).orElse(<span class="string">&quot;&quot;</span>));</span><br><span class="line">    Assert.assertNull(optional.map(CarDto::getType).orElse(<span class="literal">null</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8-7-è½¬æ¢-List"><a class="header-anchor" href="#8-7-è½¬æ¢-List"></a>8.7 è½¬æ¢ List</h2>
<p>å®Œæˆäº†å•ä¸ªå¯¹è±¡çš„è½¬æ¢ï¼Œä½†å¯¹äºæ˜¯åˆ—è¡¨çš„æ¥æºæ•°æ®ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨å¾ªç¯ã€Stream ç­‰æ“ä½œå¤–ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªå·¥å…·ç±»å®Œæˆè½¬æ¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringExtensionHelper</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONVERSION_SERVICE_BEAN_NAME</span> <span class="operator">=</span> <span class="string">&quot;myConversionService&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ConversionService <span class="title function_">getConversionService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> context.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">convert</span><span class="params">(Object source, Class&lt;T&gt; targetType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getConversionService().convert(source, targetType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">convert</span><span class="params">(Object source, TypeDescriptor sourceType, TypeDescriptor targetType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getConversionService().convert(source, sourceType, targetType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, R&gt; List&lt;R&gt; <span class="title function_">convertList</span><span class="params">(List&lt;T&gt; source, Class&lt;R&gt; targetClass)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(source)) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (List&lt;R&gt;) convert(</span><br><span class="line">                source,</span><br><span class="line">                TypeDescriptor.collection(List.class, TypeDescriptor.valueOf(source.get(<span class="number">0</span>).getClass())),</span><br><span class="line">                TypeDescriptor.collection(List.class, TypeDescriptor.valueOf(targetClass))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        SpringExtensionHelper.context = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConvertList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">    car.setMake(<span class="string">&quot;Morris&quot;</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;CarDto&gt; carDtoList = SpringExtensionHelper.convertList(Collections.singletonList(car), CarDto.class);</span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>, carDtoList.size());</span><br><span class="line">    <span class="type">CarDto</span> <span class="variable">carDto</span> <span class="operator">=</span> carDtoList.get(<span class="number">0</span>);</span><br><span class="line">    Assert.assertNotNull(carDto);</span><br><span class="line">    Assert.assertEquals(<span class="string">&quot;Morris&quot;</span>, carDto.getMake());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="9-ç»“è¯­"><a class="header-anchor" href="#9-ç»“è¯­"></a>9. ç»“è¯­</h1>
<p>åšä¸»ç²¾åŠ›æœ‰é™ï¼ˆå¥½å§ï¼Œå°±æ˜¯æ‡’ç‹— ğŸ¶ï¼‰ï¼Œæš‚æ—¶å°±ç¿»è¯‘è¿™ä¹ˆå¤šï¼Œä»¥ä¸Šå†…å®¹è¶³ä»¥æ»¡è¶³æ—¥å¸¸æ‰€éœ€ï¼Œæ›´é«˜çº§çš„ç‰¹æ€§å¾…ä½¿ç”¨åˆ°å†è¿›è¡Œè¡¥å……ã€‚</p>
<p>å¾…å®Œå–„çš„å†…å®¹ï¼š</p>
<ul>
<li>å¯¹è±¡å·¥å‚</li>
<li>é«˜çº§æ˜ å°„é€‰é¡¹</li>
<li>é‡ç”¨æ˜ å°„é…ç½®</li>
<li>è‡ªå®šä¹‰æ˜ å°„</li>
<li>ä½¿ç”¨ MapStruct SPI</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://mofan212.github.io">é»˜çƒ¦</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://mofan212.github.io/posts/MapStruct-User-Manual/">https://mofan212.github.io/posts/MapStruct-User-Manual/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://mofan212.github.io" target="_blank">Mofan</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MapStruct/">MapStruct</a></div><div class="post-share"><div class="social-share" data-image="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/82.png" data-sites="wechat,qq,weibo,facebook,x"></div><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" target="_blank"><img class="post-qr-code-img" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/AliPay.png" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li><li class="reward-item"><a href="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" target="_blank"><img class="post-qr-code-img" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/WeChatPay.png" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/Design-Pattern-Builder-Pattern/" title="ã€è®¾è®¡æ¨¡å¼ã€‘å»ºé€ è€…æ¨¡å¼"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/81.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">ã€è®¾è®¡æ¨¡å¼ã€‘å»ºé€ è€…æ¨¡å¼</div></div><div class="info-2"><div class="info-item-1">æœ¬æ–‡ä¸»è¦å¯¹ Java è®¾è®¡æ¨¡å¼ä¸­çš„å»ºé€ è€…æ¨¡å¼è¿›è¡Œäº†ä»‹ç»ï¼ŒåŒæ—¶ä¹Ÿä»‹ç»äº† Lombok ä¸­ @Builder æ³¨è§£çš„ä½¿ç”¨ã€‚</div></div></div></a><a class="pagination-related" href="/posts/Design-Pattern-Strategy-Pattern/" title="ã€è®¾è®¡æ¨¡å¼ã€‘ç­–ç•¥æ¨¡å¼"><img class="cover" src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/83.png" onerror="onerror=null;src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">ã€è®¾è®¡æ¨¡å¼ã€‘ç­–ç•¥æ¨¡å¼</div></div><div class="info-2"><div class="info-item-1">æœ¬æ–‡ä¸»è¦å¯¹ Java è®¾è®¡æ¨¡å¼ä¸­çš„ç­–ç•¥æ¨¡å¼è¿›è¡Œäº†ä»‹ç»ã€‚</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/avatar.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">é»˜çƒ¦</div><div class="author-info-description">å½©ç¬”çš„æ‰“æ€ªå‡çº§ä¹‹è·¯...</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">174</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">54</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">37</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mofan212"><i class="fab fa-github"></i><span>follow me</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:cy.mofan@foxmail.com" target="_blank" title="é‚®ç®±"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">æœ¬ç«™æ‰€æœ‰åšæ–‡å‡æ˜¯åšä¸»çš„å­¦ä¹ ç¬”è®°ä¸ä¸ªäººç†è§£ã€‚<strong><font style="color:red">é™¤ç‰¹åˆ«æ³¨æ˜å¤–ï¼Œ</font>å¦‚éœ€è½¬è½½ï¼Œè¯·åœ¨æ–‡ç« å¤´éƒ¨é†’ç›®å¤„é™„å¸¦åŸæ–‡é“¾æ¥å¹¶<a href="./mine/" style="color:#49B1F5;text-decoration:underline">å‘ŠçŸ¥æˆ‘</a></strong>ä½ å°†è½¬è½½ã€‚ğŸ˜Š</br><strong><font style="color:red">ä¸¥ç¦æœªéµå¾ªè§„èŒƒçš„è½¬è½½ã€‚</font></strong>ğŸ˜¡</br><strong>æ­»å»çš„è¯„è®ºç³»ç»Ÿå¤æ´»å•¦ï¼æ¬¢è¿åˆ°ç•™è¨€æ¿ç•…æ‰€æ¬²è¨€ï¼</strong>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´é«˜æ•ˆçš„<a target="_blank" href="https://space.bilibili.com/23658864/dynamic" style="color:#49B1F5;text-decoration:underline"> å“”å“©å“”å“©ç§ä¿¡ </a>æˆ–<a href="mailto:cy.mofan@foxmail.com" style="color:#49B1F5;text-decoration:underline" target="_blank">é‚®ç®±</a>ã€‚ ğŸ˜‰</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0-%E9%98%85%E8%AF%BB%E5%89%8D%E8%A8%80"><span class="toc-text">0. é˜…è¯»å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-MapStruct-%E6%A6%82%E8%BF%B0"><span class="toc-text">1. MapStruct æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF-MapStruct"><span class="toc-text">1.1 ä»€ä¹ˆæ˜¯ MapStruct</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-MapStruct-%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="toc-text">1.2 MapStruct é…ç½®é€‰é¡¹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84%E5%99%A8"><span class="toc-text">2. å®šä¹‰æ˜ å°„å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-Hello-MapStruct"><span class="toc-text">2.1 Hello MapStruct</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%85%B3%E9%97%AD%E9%9A%90%E5%BC%8F%E6%98%A0%E5%B0%84"><span class="toc-text">2.2 å…³é—­éšå¼æ˜ å°„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Mapping-%E6%B3%A8%E8%A7%A3"><span class="toc-text">2.3 @Mapping æ³¨è§£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E9%BB%98%E8%AE%A4%E6%96%B9%E6%B3%95%E4%B8%8E%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-text">2.4 é»˜è®¤æ–¹æ³•ä¸æŠ½è±¡ç±»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E5%A4%9A%E4%B8%AA%E6%BA%90%E5%8F%82%E6%95%B0"><span class="toc-text">2.5 å¤šä¸ªæºå‚æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E5%A4%9A%E4%B8%AA%E5%B5%8C%E5%A5%97%E5%B1%9E%E6%80%A7%E6%98%A0%E5%B0%84"><span class="toc-text">2.6 å¤šä¸ªåµŒå¥—å±æ€§æ˜ å°„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-%E6%9B%B4%E6%96%B0%E5%AD%98%E5%9C%A8%E7%9A%84%E5%AE%9E%E4%BE%8B"><span class="toc-text">2.7 æ›´æ–°å­˜åœ¨çš„å®ä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-8-%E5%8F%8D%E5%90%91%E6%98%A0%E5%B0%84"><span class="toc-text">2.8 åå‘æ˜ å°„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-9-%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84"><span class="toc-text">2.9 ç›´æ¥ä½¿ç”¨å­—æ®µæ˜ å°„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-10-%E4%BD%BF%E7%94%A8%E6%9E%84%E5%BB%BA%E5%99%A8"><span class="toc-text">2.10 ä½¿ç”¨æ„å»ºå™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-11-%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">2.11 ä½¿ç”¨æ„é€ å‡½æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-12-%E5%B0%86-Map-%E6%98%A0%E5%B0%84%E5%88%B0%E5%AF%B9%E8%B1%A1"><span class="toc-text">2.12 å°† Map æ˜ å°„åˆ°å¯¹è±¡</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E8%8E%B7%E5%8F%96%E6%98%A0%E5%B0%84%E5%99%A8"><span class="toc-text">3. è·å–æ˜ å°„å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E6%98%A0%E5%B0%84%E5%99%A8%E5%B7%A5%E5%8E%82"><span class="toc-text">3.1 æ˜ å°„å™¨å·¥å‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E4%BD%BF%E7%94%A8%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-text">3.2 ä½¿ç”¨ä¾èµ–æ³¨å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E6%B3%A8%E5%85%A5%E7%AD%96%E7%95%A5"><span class="toc-text">3.3 æ³¨å…¥ç­–ç•¥</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-text">4. æ•°æ®ç±»å‹è½¬æ¢</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E9%9A%90%E5%BC%8F%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-text">4.1 éšå¼ç±»å‹è½¬æ¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E6%98%A0%E5%B0%84%E5%AF%B9%E8%B1%A1%E5%BC%95%E7%94%A8"><span class="toc-text">4.2 æ˜ å°„å¯¹è±¡å¼•ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E6%8E%A7%E5%88%B6%E5%B5%8C%E5%A5%97%E5%AF%B9%E8%B1%A1%E6%98%A0%E5%B0%84"><span class="toc-text">4.3 æ§åˆ¶åµŒå¥—å¯¹è±¡æ˜ å°„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E6%89%A7%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84%E6%96%B9%E6%B3%95"><span class="toc-text">4.4  æ‰§è¡Œè‡ªå®šä¹‰æ˜ å°„æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-%E8%B0%83%E7%94%A8%E5%85%B6%E4%BB%96%E6%98%A0%E5%B0%84%E5%99%A8"><span class="toc-text">4.5  è°ƒç”¨å…¶ä»–æ˜ å°„å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-%E5%B0%86%E7%9B%AE%E6%A0%87%E7%B1%BB%E5%9E%8B%E4%BC%A0%E9%80%92%E7%BB%99%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84%E5%99%A8"><span class="toc-text">4.6 å°†ç›®æ ‡ç±»å‹ä¼ é€’ç»™è‡ªå®šä¹‰æ˜ å°„å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7-%E4%BC%A0%E9%80%92%E4%B8%8A%E4%B8%8B%E6%96%87%E6%88%96%E7%8A%B6%E6%80%81%E5%AF%B9%E8%B1%A1%E7%BB%99%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95"><span class="toc-text">4.7 ä¼ é€’ä¸Šä¸‹æ–‡æˆ–çŠ¶æ€å¯¹è±¡ç»™è‡ªå®šä¹‰æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-8-%E6%98%A0%E5%B0%84%E6%96%B9%E6%B3%95%E7%9A%84%E8%A7%A3%E6%9E%90"><span class="toc-text">4.8 æ˜ å°„æ–¹æ³•çš„è§£æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-9-%E5%9F%BA%E4%BA%8E%E9%99%90%E5%AE%9A%E7%AC%A6%E7%9A%84%E6%98%A0%E5%B0%84%E6%96%B9%E6%B3%95%E9%80%89%E6%8B%A9"><span class="toc-text">4.9 åŸºäºé™å®šç¬¦çš„æ˜ å°„æ–¹æ³•é€‰æ‹©</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-10-%E7%BB%93%E5%90%88%E9%99%90%E5%AE%9A%E7%AC%A6%E4%B8%8E%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-text">4.10 ç»“åˆé™å®šç¬¦ä¸é»˜è®¤å€¼</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%98%A0%E5%B0%84%E9%9B%86%E5%90%88"><span class="toc-text">5. æ˜ å°„é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E6%98%A0%E5%B0%84-Set-%E4%B8%8E-List"><span class="toc-text">5.1 æ˜ å°„ Set ä¸ List</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E6%98%A0%E5%B0%84-Map"><span class="toc-text">5.2 æ˜ å°„ Map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E9%9B%86%E5%90%88%E6%98%A0%E5%B0%84%E7%AD%96%E7%95%A5"><span class="toc-text">5.3 é›†åˆæ˜ å°„ç­–ç•¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E9%9B%86%E5%90%88%E6%98%A0%E5%B0%84%E7%9A%84%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-text">5.4 é›†åˆæ˜ å°„çš„å®ç°ç±»</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E6%98%A0%E5%B0%84-Stream"><span class="toc-text">6. æ˜ å°„ Stream</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E6%98%A0%E5%B0%84%E5%80%BC"><span class="toc-text">7. æ˜ å°„å€¼</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E6%98%A0%E5%B0%84%E6%9E%9A%E4%B8%BE"><span class="toc-text">7.1 æ˜ å°„æšä¸¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E6%9E%9A%E4%B8%BE%E4%B8%8E%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E7%9B%B8%E4%BA%92%E6%98%A0%E5%B0%84"><span class="toc-text">7.2 æšä¸¾ä¸å­—ç¬¦ä¸²çš„ç›¸äº’æ˜ å°„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%8D%E7%A7%B0%E8%BD%AC%E6%8D%A2"><span class="toc-text">7.3 è‡ªå®šä¹‰åç§°è½¬æ¢</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-Spring-%E6%8B%93%E5%B1%95"><span class="toc-text">8. Spring æ‹“å±•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E6%89%80%E9%80%89%E4%BE%9D%E8%B5%96%E4%BF%A1%E6%81%AF"><span class="toc-text">8.1 æ‰€é€‰ä¾èµ–ä¿¡æ¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E6%98%A0%E5%B0%84%E5%99%A8%E4%BD%9C%E4%B8%BA%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-text">8.2 æ˜ å°„å™¨ä½œä¸ºè½¬æ¢å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-ConversionServiceAdapter"><span class="toc-text">8.3 ConversionServiceAdapter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%8D%E7%A7%B0"><span class="toc-text">8.4 è‡ªå®šä¹‰åç§°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-%E6%8C%87%E5%AE%9A-ConversionService-Bean-%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="toc-text">8.5 æŒ‡å®š ConversionService Bean çš„åç§°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-6-%E5%A4%96%E7%BD%AE%E8%BD%AC%E6%8D%A2"><span class="toc-text">8.6 å¤–ç½®è½¬æ¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-7-%E8%BD%AC%E6%8D%A2-List"><span class="toc-text">8.7 è½¬æ¢ List</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E7%BB%93%E8%AF%AD"><span class="toc-text">9. ç»“è¯­</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/Something-About-Blog/" title="åšå®¢æ­å»ºä¸ç»´æŠ¤"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/42.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="åšå®¢æ­å»ºä¸ç»´æŠ¤"/></a><div class="content"><a class="title" href="/posts/Something-About-Blog/" title="åšå®¢æ­å»ºä¸ç»´æŠ¤">åšå®¢æ­å»ºä¸ç»´æŠ¤</a><time datetime="2026-01-24T16:00:00.000Z" title="æ›´æ–°äº 2026-01-25 00:00:00">2026-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Memory-Model/" title="Java å†…å­˜æ¨¡å‹"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/174.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java å†…å­˜æ¨¡å‹"/></a><div class="content"><a class="title" href="/posts/Java-Memory-Model/" title="Java å†…å­˜æ¨¡å‹">Java å†…å­˜æ¨¡å‹</a><time datetime="2026-01-02T16:00:00.000Z" title="æ›´æ–°äº 2026-01-03 00:00:00">2026-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Java-Bytecode-And-Class-Loading/" title="å­—èŠ‚ç ä¸ç±»åŠ è½½"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/173.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="å­—èŠ‚ç ä¸ç±»åŠ è½½"/></a><div class="content"><a class="title" href="/posts/Java-Bytecode-And-Class-Loading/" title="å­—èŠ‚ç ä¸ç±»åŠ è½½">å­—èŠ‚ç ä¸ç±»åŠ è½½</a><time datetime="2026-01-01T16:00:00.000Z" title="æ›´æ–°äº 2026-01-02 00:00:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Class-Resource-Loading-In-Java/" title="Java çš„ç±»èµ„æºåŠ è½½"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/103.png" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="Java çš„ç±»èµ„æºåŠ è½½"/></a><div class="content"><a class="title" href="/posts/Class-Resource-Loading-In-Java/" title="Java çš„ç±»èµ„æºåŠ è½½">Java çš„ç±»èµ„æºåŠ è½½</a><time datetime="2026-01-01T16:00:00.000Z" title="æ›´æ–°äº 2026-01-02 00:00:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Annotation-And-Reflection/" title="æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/20.jpg" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„"/></a><div class="content"><a class="title" href="/posts/Annotation-And-Reflection/" title="æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„">æ³¨è§£ã€ç±»çš„åŠ è½½ã€åå°„</a><time datetime="2026-01-01T16:00:00.000Z" title="æ›´æ–°äº 2026-01-02 00:00:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ren-zhi-jue-xing/" title="è®¤çŸ¥è§‰é†’"><img src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/loading.gif" data-lazy-src="https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/ArticleCover/172.webp" onerror="this.onerror=null;this.src='https://mofan-blog-pics.oss-cn-chengdu.aliyuncs.com/myblog/404.jpg'" alt="è®¤çŸ¥è§‰é†’"/></a><div class="content"><a class="title" href="/posts/ren-zhi-jue-xing/" title="è®¤çŸ¥è§‰é†’">è®¤çŸ¥è§‰é†’</a><time datetime="2025-12-28T16:00:00.000Z" title="æ›´æ–°äº 2025-12-29 00:00:00">2025-12-29</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2020 - 2026 By é»˜çƒ¦</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><script src="https://testingcf.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://testingcf.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://testingcf.jsdelivr.net/npm/vanilla-lazyload@latest/dist/lazyload.iife.min.js"></script><script src="https://testingcf.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://gcore.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://testingcf.jsdelivr.net/gh/mofan212/blog-static-resources@master/js/mine.min.js"></script><script src="/js/tip_portal.js"></script><script defer="defer" id="ribbon" src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="click-show-text" src="https://testingcf.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Azathoth,Yog-Sothoth,Shub-Niggurath,Nyarlathotep,Cthulhu,Hastur,Abhoth,Ghroth,Tsathoggua,Cthugha,Deep Ones,Dagon,Chaugnar Faugn,Mordiggian,Shoggoth,Old One,Mi-Go,Great Race of Yith,Flying Polyp,Hounds of Tindalos,Dhole" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="docsearch-wrap"><div id="docsearch" style="display:none"></div><link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@docsearch/css/dist/style.min.css"/><script src="https://testingcf.jsdelivr.net/npm/@docsearch/js/dist/umd/index.min.js"></script><script>(() => {
  docsearch(Object.assign({
    appId: 'BAFEL7A6K1',
    apiKey: '89fcb5961984c5c054bf04149f345f38',
    indexName: 'mofan212io',
    container: '#docsearch',
    placeholder: 'è¾“å…¥å…³é”®å­—è¿›è¡Œæœç´¢',
  }, null))

  const handleClick = () => {
    document.querySelector('.DocSearch-Button').click()
  }

  const searchClickFn = () => {
    btf.addEventListenerPjax(document.querySelector('#search-button > .search'), 'click', handleClick)
  }

  searchClickFn()
  window.addEventListener('pjax:complete', searchClickFn)
})()</script></div></div></body></html>